[{"filePath":"D:\\dealdirectcurrentlive\\dealdirect\\client\\eslint.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\dealdirectcurrentlive\\dealdirect\\client\\src\\App.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\dealdirectcurrentlive\\dealdirect\\client\\src\\Components\\AuthModal\\AuthModal.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\dealdirectcurrentlive\\dealdirect\\client\\src\\Components\\Chat\\ChatButton.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\dealdirectcurrentlive\\dealdirect\\client\\src\\Components\\Chat\\ChatWidget.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\dealdirectcurrentlive\\dealdirect\\client\\src\\Components\\DiscoverSection\\DiscoverSection.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\dealdirectcurrentlive\\dealdirect\\client\\src\\Components\\EmailVerificationModal\\EmailVerificationModal.jsx","messages":[],"suppressedMessages":[{"ruleId":"no-unused-vars","severity":2,"message":"'motion' is defined but never used. Allowed unused vars must match /^[A-Z_]/u.","line":4,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":16,"suggestions":[{"messageId":"removeVar","data":{"varName":"motion"},"fix":{"range":[175,182],"text":""},"desc":"Remove unused variable 'motion'."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\dealdirectcurrentlive\\dealdirect\\client\\src\\Components\\Footer\\Footer.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\dealdirectcurrentlive\\dealdirect\\client\\src\\Components\\HeroSection\\AgentForFilter.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\dealdirectcurrentlive\\dealdirect\\client\\src\\Components\\HeroSection\\AvailableForFilter.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\dealdirectcurrentlive\\dealdirect\\client\\src\\Components\\HeroSection\\BudgetFilter.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\dealdirectcurrentlive\\dealdirect\\client\\src\\Components\\HeroSection\\CommercialPropertyTypeFilter.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\dealdirectcurrentlive\\dealdirect\\client\\src\\Components\\HeroSection\\FurnishingFilter.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\dealdirectcurrentlive\\dealdirect\\client\\src\\Components\\HeroSection\\HeroSection.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'dropdownRefs'. Either include it or remove the dependency array.","line":176,"column":6,"nodeType":"ArrayExpression","endLine":176,"endColumn":20,"suggestions":[{"desc":"Update the dependencies array to be: [dropdownRefs, openDropdown]","fix":{"range":[5919,5933],"text":"[dropdownRefs, openDropdown]"}}]},{"ruleId":"no-unused-vars","severity":2,"message":"'tabs' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":178,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":178,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"tabs"},"fix":{"range":[5941,5966],"text":""},"desc":"Remove unused variable 'tabs'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'updateFilter' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":182,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":182,"endColumn":21,"suggestions":[{"messageId":"removeVar","data":{"varName":"updateFilter"},"fix":{"range":[6082,6186],"text":""},"desc":"Remove unused variable 'updateFilter'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'renderFilters' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":194,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":194,"endColumn":22,"suggestions":[{"messageId":"removeVar","data":{"varName":"renderFilters"},"fix":{"range":[6472,7003],"text":""},"desc":"Remove unused variable 'renderFilters'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'handleTabSelect' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":218,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":218,"endColumn":24,"suggestions":[{"messageId":"removeVar","data":{"varName":"handleTabSelect"},"fix":{"range":[7224,7294],"text":""},"desc":"Remove unused variable 'handleTabSelect'."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/Components/HeroSection/HeroSection.jsx - Omnibox Style\r\nimport React, { useState, useRef, useEffect } from \"react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport api from \"../../utils/api\";\r\nimport { AiOutlineSearch } from \"react-icons/ai\";\r\nimport { FaMapMarkerAlt, FaMicrophone, FaHome, FaKey, FaBuilding, FaBed, FaTree, FaHistory } from \"react-icons/fa\";\r\nimport { tabConfig } from \"./filterConfig\";\r\nimport PropertyTypeFilter from \"./PropertyTypeFilter\";\r\nimport herokaback from \"../../assets/herokaback.png\";\r\n\r\nconst API_BASE = import.meta.env.VITE_API_BASE;\r\n\r\nconst defaultTabs = [\r\n  { label: \"Buy\", intent: \"buy\", icon: FaHome },\r\n  { label: \"Rental\", intent: \"rent\", icon: FaKey },\r\n  { label: \"Projects\", intent: \"project\", icon: FaBuilding },\r\n  { label: \"PG / Hostels\", intent: \"pg\", icon: FaBed },\r\n  { label: \"Plot & Land\", intent: \"plot\", icon: FaTree },\r\n];\r\n\r\n// Simple in-memory cache for suggestions\r\nconst suggestionsCache = new Map();\r\nconst CACHE_TTL = 60000; // 1 minute cache\r\n\r\nconst HeroSection = ({ filters, setFilters }) => {\r\n  const navigate = useNavigate();\r\n  const [activeTab, setActiveTab] = useState(\"Buy\");\r\n  const [openDropdown, setOpenDropdown] = useState(null);\r\n  const [suggestions, setSuggestions] = useState([]);\r\n  const [showSuggestions, setShowSuggestions] = useState(false);\r\n  const [isLoadingSuggestions, setIsLoadingSuggestions] = useState(false);\r\n  const [isListening, setIsListening] = useState(false);\r\n\r\n  const [selectedIndex, setSelectedIndex] = useState(-1);\r\n  const searchInputRef = useRef(null);\r\n  const suggestionsRef = useRef(null);\r\n  const abortControllerRef = useRef(null);\r\n  const recognitionRef = useRef(null);\r\n\r\n  const [recentSearches, setRecentSearches] = useState([]);\r\n\r\n  useEffect(() => {\r\n    const saved = localStorage.getItem(\"dealDirectRecentSearches\");\r\n    if (saved) {\r\n      try {\r\n        setRecentSearches(JSON.parse(saved));\r\n      } catch {\r\n        console.error(\"Failed to parse recent searches\");\r\n      }\r\n    }\r\n  }, []);\r\n\r\n  const addToRecentSearches = (item) => {\r\n    setRecentSearches(prev => {\r\n      const filtered = prev.filter(p => p.value !== item.value);\r\n      const newRecent = [{ ...item, timestamp: Date.now() }, ...filtered].slice(0, 5);\r\n      localStorage.setItem(\"dealDirectRecentSearches\", JSON.stringify(newRecent));\r\n      return newRecent;\r\n    });\r\n  };\r\n\r\n  const dropdownRefs = {\r\n    budget: useRef(null),\r\n    propertyType: useRef(null),\r\n  };\r\n\r\n  // Optimized autocomplete with dedicated endpoint, caching, and request cancellation\r\n  useEffect(() => {\r\n    const searchTerm = filters.search?.trim() || '';\r\n\r\n    if (searchTerm.length < 2) {\r\n      setSuggestions([]);\r\n      setShowSuggestions(false);\r\n      return;\r\n    }\r\n\r\n    // Check cache first\r\n    const cacheKey = searchTerm.toLowerCase();\r\n    const cached = suggestionsCache.get(cacheKey);\r\n    if (cached && Date.now() - cached.timestamp < CACHE_TTL) {\r\n      setSuggestions(cached.data);\r\n      setShowSuggestions(cached.data.length > 0);\r\n      setSelectedIndex(-1);\r\n      return;\r\n    }\r\n\r\n    const fetchSuggestions = async () => {\r\n      // Cancel previous request\r\n      if (abortControllerRef.current) {\r\n        abortControllerRef.current.abort();\r\n      }\r\n      abortControllerRef.current = new AbortController();\r\n\r\n      setIsLoadingSuggestions(true);\r\n      try {\r\n        const response = await api.get(\r\n          '/properties/suggestions',\r\n          {\r\n            params: { q: searchTerm },\r\n            signal: abortControllerRef.current.signal,\r\n            timeout: 3000 // 3 second timeout\r\n          }\r\n        );\r\n\r\n        const data = response.data.suggestions || [];\r\n\r\n        // Cache the result\r\n        suggestionsCache.set(cacheKey, {\r\n          data,\r\n          timestamp: Date.now()\r\n        });\r\n\r\n        setSuggestions(data);\r\n        setShowSuggestions(data.length > 0);\r\n        setSelectedIndex(-1);\r\n      } catch (error) {\r\n        // Only log error if not an abort (user typing too fast)\r\n        if (error?.name !== 'AbortError' && error?.name !== 'CanceledError') {\r\n          console.error('Error fetching suggestions:', error);\r\n          setSuggestions([]);\r\n        }\r\n      } finally {\r\n        setIsLoadingSuggestions(false);\r\n      }\r\n    };\r\n\r\n    // Debounce: 150ms for fast response\r\n    const debounceTimer = setTimeout(fetchSuggestions, 150);\r\n    return () => {\r\n      clearTimeout(debounceTimer);\r\n      if (abortControllerRef.current) {\r\n        abortControllerRef.current.abort();\r\n      }\r\n    };\r\n  }, [filters.search]);\r\n\r\n  // Handle keyboard navigation\r\n  const handleKeyDown = (e) => {\r\n    if (!showSuggestions || suggestions.length === 0) return;\r\n\r\n    if (e.key === 'ArrowDown') {\r\n      e.preventDefault();\r\n      setSelectedIndex(prev => (prev < suggestions.length - 1 ? prev + 1 : prev));\r\n    } else if (e.key === 'ArrowUp') {\r\n      e.preventDefault();\r\n      setSelectedIndex(prev => (prev > 0 ? prev - 1 : -1));\r\n    } else if (e.key === 'Enter' && selectedIndex >= 0) {\r\n      e.preventDefault();\r\n      handleSuggestionClick(suggestions[selectedIndex]);\r\n    } else if (e.key === 'Escape') {\r\n      setShowSuggestions(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    const handleClickOutside = (event) => {\r\n      if (\r\n        openDropdown &&\r\n        dropdownRefs[openDropdown]?.current &&\r\n        !dropdownRefs[openDropdown].current.contains(event.target)\r\n      ) {\r\n        setOpenDropdown(null);\r\n      }\r\n\r\n      if (\r\n        suggestionsRef.current &&\r\n        !suggestionsRef.current.contains(event.target) &&\r\n        searchInputRef.current &&\r\n        !searchInputRef.current.contains(event.target)\r\n      ) {\r\n        setShowSuggestions(false);\r\n      }\r\n    };\r\n    document.addEventListener(\"mousedown\", handleClickOutside);\r\n    return () => document.removeEventListener(\"mousedown\", handleClickOutside);\r\n  }, [openDropdown]);\r\n\r\n  const tabs = defaultTabs;\r\n  const configKey = tabConfig[activeTab] ? activeTab : \"Buy\";\r\n  const currentConfig = tabConfig[configKey];\r\n\r\n  const updateFilter = (field, value) => {\r\n    setFilters((prev) => ({ ...prev, [field]: value }));\r\n  };\r\n\r\n  const updatePropertyTypes = (updater) => {\r\n    setFilters((prev) => {\r\n      const previous = prev.propertyTypes || [];\r\n      const nextValue = typeof updater === \"function\" ? updater(previous) : updater;\r\n      return { ...prev, propertyTypes: nextValue };\r\n    });\r\n  };\r\n\r\n  const renderFilters = () =>\r\n    currentConfig.filters.map((filterType) => {\r\n      if (filterType === \"propertyType\") {\r\n        return (\r\n          <PropertyTypeFilter\r\n            key=\"propertyType\"\r\n            selectedPropertyTypes={filters.propertyTypes || []}\r\n            setSelectedPropertyTypes={updatePropertyTypes}\r\n            openDropdown={openDropdown}\r\n            setOpenDropdown={setOpenDropdown}\r\n            dropdownRef={dropdownRefs.propertyType}\r\n          />\r\n        );\r\n      }\r\n      return null;\r\n    });\r\n\r\n  const handleSuggestionClick = (suggestion) => {\r\n    addToRecentSearches(suggestion);\r\n    setFilters({ ...filters, search: suggestion.value });\r\n    setShowSuggestions(false);\r\n    setSelectedIndex(-1);\r\n  };\r\n\r\n  const handleTabSelect = (tab) => {\r\n    setActiveTab(tab.label);\r\n  };\r\n\r\n  const handleMapClick = () => {\r\n    // Navigate to PropertyList with map view enabled\r\n    // Preserve current search query if any\r\n    const searchParams = new URLSearchParams();\r\n    searchParams.set('view', 'map');\r\n    if (filters.search) {\r\n      searchParams.set('search', filters.search);\r\n    }\r\n    navigate(`/properties?${searchParams.toString()}`);\r\n  };\r\n\r\n  const handleSearchClick = () => {\r\n    const searchParams = new URLSearchParams();\r\n\r\n    if (filters.search) {\r\n      searchParams.set(\"search\", filters.search);\r\n    }\r\n\r\n    // Optionally pass tab label as a generic hint (no hard filter)\r\n    searchParams.set(\"intent\", activeTab);\r\n\r\n    navigate(`/properties?${searchParams.toString()}`);\r\n  };\r\n\r\n  const startVoiceInput = () => {\r\n    if (isListening) {\r\n      if (recognitionRef.current) {\r\n        recognitionRef.current.stop();\r\n      }\r\n      return;\r\n    }\r\n\r\n    if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {\r\n      alert(\"Voice input is not supported in this browser.\");\r\n      return;\r\n    }\r\n\r\n    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\r\n    const recognition = new SpeechRecognition();\r\n    recognitionRef.current = recognition;\r\n\r\n    recognition.continuous = false;\r\n    recognition.interimResults = false;\r\n    recognition.lang = 'en-US';\r\n\r\n    recognition.onstart = () => {\r\n      setIsListening(true);\r\n    };\r\n\r\n    recognition.onresult = (event) => {\r\n      const transcript = event.results[0][0].transcript;\r\n      if (transcript) {\r\n        setFilters(prev => ({ ...prev, search: transcript }));\r\n        setShowSuggestions(true);\r\n      }\r\n    };\r\n\r\n    recognition.onerror = (event) => {\r\n      console.error(\"Speech recognition error\", event.error);\r\n      setIsListening(false);\r\n    };\r\n\r\n    recognition.onend = () => {\r\n      setIsListening(false);\r\n    };\r\n\r\n    recognition.start();\r\n  };\r\n\r\n  // Highlight matching text\r\n  const highlightMatch = (text, query) => {\r\n    if (!query || !text) return text;\r\n    const index = text.toLowerCase().indexOf(query.toLowerCase());\r\n    if (index === -1) return text;\r\n\r\n    return (\r\n      <>\r\n        {text.substring(0, index)}\r\n        <span className=\"text-red-500 font-bold\">{text.substring(index, index + query.length)}</span>\r\n        {text.substring(index + query.length)}\r\n      </>\r\n    );\r\n  };\r\n\r\n  return (\r\n    <section className=\"relative flex flex-col justify-center items-center px-4 sm:px-8 lg:px-16 text-center z-20\">\r\n      {/* Background image */}\r\n      <div\r\n        className=\"absolute inset-0 bg-cover bg-left md:bg-center bg-no-repeat\"\r\n        style={{ backgroundImage: `url(${herokaback})` }}\r\n      ></div>\r\n\r\n      {/* Dark overlay for better text readability */}\r\n      <div className=\"absolute inset-0 bg-black/40\"></div>\r\n\r\n      <div className=\"relative pt-32 pb-16 z-10 flex flex-col items-center max-w-7xl w-full space-y-2\">\r\n        <h1 className=\"text-3xl sm:text-4xl lg:text-5xl font-[700] text-white leading-tight max-w-4xl\">\r\n          Buy, Rent & Sell Properties\r\n          <br />\r\n          <span className=\"text-red-600\">Directly from Owners</span>\r\n        </h1>\r\n\r\n        <p className=\"font-bold text-lg sm:text-xl lg:text-2xl text-gray-200 max-w-3xl\">\r\n          No middleman. No commission fees.\r\n          <br />\r\n          <span className=\"font-bold text-white\">\r\n            Deal directly with property owners\r\n          </span>\r\n        </p>\r\n\r\n        <div className=\"bg-white/95 backdrop-blur-md shadow-2xl rounded-full p-1.5 sm:p-3 mt-8 w-full max-w-5xl relative z-50\">\r\n          <div className=\"flex flex-row gap-2 items-center\">\r\n            <div className=\"relative flex-1 w-full z-50\" ref={searchInputRef}>\r\n              <div className=\"relative flex items-center\">\r\n                <AiOutlineSearch className=\"absolute left-3 sm:left-4 text-gray-400 text-lg sm:text-2xl\" />\r\n                <input\r\n                  type=\"text\"\r\n                  placeholder=\"Search by Project, Locality, or City\"\r\n                  value={filters.search}\r\n                  onChange={(e) => {\r\n                    setFilters({ ...filters, search: e.target.value });\r\n                    setShowSuggestions(true);\r\n                  }}\r\n                  onKeyDown={handleKeyDown}\r\n                  onFocus={() => {\r\n                    setShowSuggestions(true);\r\n                  }}\r\n                  className=\"w-full bg-transparent rounded-full pl-9 sm:pl-12 pr-16 sm:pr-20 py-2 sm:py-4 text-sm sm:text-lg text-gray-900 placeholder-gray-400 focus:outline-none placeholder:text-ellipsis\"\r\n                />\r\n                {/* Responsive placeholder text using CSS */}\r\n                {/* Re-setting placeholder to long text, but relying on CSS to handle overflow gracefully if needed. \r\n                     Actually, a short placeholder \"Search by Project...\" works better. \r\n                     Let's use the full text but rely on text-overflow (already added placeholder:text-ellipsis). */}\r\n                <div className=\"absolute right-2 sm:right-4 flex items-center gap-2 sm:gap-4\">\r\n                  <FaMapMarkerAlt\r\n                    className=\"text-gray-600 cursor-pointer hover:text-blue-800 text-base sm:text-blue-600-2xl transition-colors hover:scale-110 animate-pulse\"\r\n                    onClick={handleMapClick}\r\n                    title=\"Search on Map\"\r\n                  />\r\n                  <FaMicrophone\r\n                    className={`cursor-pointer text-base sm:text-xl transition-all hover:scale-110 ${isListening ? 'text-red-600 animate-pulse scale-110' : 'text-red-600 hover:text-red-700'}`}\r\n                    onClick={startVoiceInput}\r\n                    title=\"Search by Voice\"\r\n                  />\r\n                </div>\r\n              </div>\r\n\r\n              {/* Omnibox Suggestions */}\r\n              {showSuggestions && (\r\n                <div\r\n                  ref={suggestionsRef}\r\n                  className=\"absolute top-full left-0 right-0 mt-3 bg-white border border-gray-100 rounded-2xl shadow-2xl max-h-[500px] overflow-y-auto z-50 text-left py-2\"\r\n                >\r\n                  {isLoadingSuggestions ? (\r\n                    <div className=\"p-6 text-center text-gray-500\">\r\n                      <div className=\"animate-spin inline-block w-6 h-6 border-2 border-red-600 border-t-transparent rounded-full\"></div>\r\n                      <p className=\"mt-2 text-sm font-medium\">Finding best matches...</p>\r\n                    </div>\r\n                  ) : (\r\n                    <div className=\"flex flex-col\">\r\n                      {/* Recent Searches Section - Show if query is empty or matches found */}\r\n                      {(!filters.search || filters.search.length < 2) && recentSearches.length > 0 && (\r\n                        <div className=\"mb-2\">\r\n                          <h3 className=\"text-xs font-bold text-gray-500 uppercase tracking-wider mb-2 px-6 mt-2\">Recent Searches</h3>\r\n                          <div className=\"px-4 space-y-2\">\r\n                            {recentSearches.map((suggestion, index) => (\r\n                              <div\r\n                                key={`recent-${index}`}\r\n                                onClick={() => handleSuggestionClick(suggestion)}\r\n                                className=\"border border-gray-200 rounded-xl p-3 hover:bg-red-50 cursor-pointer transition-colors group\"\r\n                              >\r\n                                <div className=\"flex items-center gap-3\">\r\n                                  <div className=\"w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-gray-400 group-hover:bg-white group-hover:text-red-500 transition-colors\">\r\n                                    <FaHistory size={12} className=\"transform rotate-12\" /> {/* Using generic icon for recent */}\r\n                                  </div>\r\n                                  <div>\r\n                                    <p className=\"text-sm font-semibold text-gray-800\">{suggestion.value}</p>\r\n                                    {suggestion.subtitle && <p className=\"text-xs text-gray-500\">{suggestion.subtitle}</p>}\r\n                                  </div>\r\n                                </div>\r\n                              </div>\r\n                            ))}\r\n                          </div>\r\n                        </div>\r\n                      )}\r\n\r\n                      {/* Grouped API Results */}\r\n                      {suggestions.length > 0 && (\r\n                        <>\r\n                          {/* Locations Group */}\r\n                          {suggestions.filter(s => s.type === 'city' || s.type === 'locality').length > 0 && (\r\n                            <div className=\"mt-2\">\r\n                              <h3 className=\"text-xs font-bold text-gray-500 uppercase tracking-wider mb-1 px-6 pt-2\">Location</h3>\r\n                              <ul>\r\n                                {suggestions.filter(s => s.type === 'city' || s.type === 'locality').map((suggestion, index) => (\r\n                                  <li\r\n                                    key={`loc-${index}`}\r\n                                    onClick={() => handleSuggestionClick(suggestion)}\r\n                                    className=\"px-6 py-2.5 cursor-pointer hover:bg-gray-50 transition-colors flex items-center gap-3 group\"\r\n                                  >\r\n                                    <div className=\"w-8 h-8 rounded-lg flex items-center justify-center bg-gray-50 text-gray-400 group-hover:bg-red-50 group-hover:text-red-500 transition-colors\">\r\n                                      <FaMapMarkerAlt />\r\n                                    </div>\r\n                                    <div className=\"flex-1\">\r\n                                      <p className=\"text-sm text-gray-700\">\r\n                                        {highlightMatch(suggestion.value, filters.search)}\r\n                                      </p>\r\n                                      {suggestion.subtitle && (\r\n                                        <p className=\"text-xs text-gray-400\">{suggestion.subtitle}</p>\r\n                                      )}\r\n                                    </div>\r\n                                  </li>\r\n                                ))}\r\n                              </ul>\r\n                            </div>\r\n                          )}\r\n\r\n                          {/* Projects Group */}\r\n                          {suggestions.filter(s => s.type === 'project').length > 0 && (\r\n                            <div className=\"mt-2 text-gray-800\">\r\n                              <h3 className=\"text-xs font-bold text-gray-500 uppercase tracking-wider mb-1 px-6 pt-2\">Project</h3>\r\n                              <ul>\r\n                                {suggestions.filter(s => s.type === 'project').map((suggestion, index) => (\r\n                                  <li\r\n                                    key={`proj-${index}`}\r\n                                    onClick={() => handleSuggestionClick(suggestion)}\r\n                                    className=\"px-6 py-2.5 cursor-pointer hover:bg-gray-50 transition-colors flex items-center gap-3 group\"\r\n                                  >\r\n                                    <div className=\"w-8 h-8 rounded-lg flex items-center justify-center bg-gray-50 text-gray-400 group-hover:bg-blue-50 group-hover:text-blue-500 transition-colors\">\r\n                                      <FaBuilding />\r\n                                    </div>\r\n                                    <div className=\"flex-1\">\r\n                                      <p className=\"text-sm text-gray-700\">\r\n                                        {highlightMatch(suggestion.value, filters.search)}\r\n                                      </p>\r\n                                      {suggestion.subtitle && (\r\n                                        <p className=\"text-xs text-gray-400\">{suggestion.subtitle}</p>\r\n                                      )}\r\n                                    </div>\r\n                                  </li>\r\n                                ))}\r\n                              </ul>\r\n                            </div>\r\n                          )}\r\n\r\n                          {/* Other Group (if any) */}\r\n                          {suggestions.filter(s => !['city', 'locality', 'project'].includes(s.type)).length > 0 && (\r\n                            <div className=\"mt-2 text-gray-800\">\r\n                              <h3 className=\"text-xs font-bold text-gray-500 uppercase tracking-wider mb-1 px-6 pt-2\">Other Matches</h3>\r\n                              <ul>\r\n                                {suggestions.filter(s => !['city', 'locality', 'project'].includes(s.type)).map((suggestion, index) => (\r\n                                  <li\r\n                                    key={`other-${index}`}\r\n                                    onClick={() => handleSuggestionClick(suggestion)}\r\n                                    className=\"px-6 py-2.5 cursor-pointer hover:bg-gray-50 transition-colors flex items-center gap-3 group\"\r\n                                  >\r\n                                    <div className=\"w-8 h-8 rounded-lg flex items-center justify-center bg-gray-50 text-gray-400\">\r\n                                      <AiOutlineSearch />\r\n                                    </div>\r\n                                    <div className=\"flex-1\">\r\n                                      <p className=\"text-sm text-gray-700\">\r\n                                        {highlightMatch(suggestion.value, filters.search)}\r\n                                      </p>\r\n                                    </div>\r\n                                  </li>\r\n                                ))}\r\n                              </ul>\r\n                            </div>\r\n                          )}\r\n                        </>\r\n                      )}\r\n\r\n                      {suggestions.length === 0 && (!filters.search || filters.search.length < 2) && recentSearches.length === 0 && (\r\n                        <div className=\"p-8 text-center text-gray-400\">\r\n                          <p>Start typing to search properties...</p>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            <button\r\n              onClick={handleSearchClick}\r\n              className=\"bg-red-600 text-white p-3 sm:px-8 sm:py-4 rounded-full font-semibold text-sm sm:text-lg hover:bg-red-700 transition-all shadow-lg flex items-center justify-center gap-2 whitespace-nowrap flex-shrink-0 aspect-square sm:aspect-auto\"\r\n            >\r\n              <AiOutlineSearch className=\"text-xl sm:text-xl\" />\r\n              <span className=\"hidden sm:inline\">Search</span>\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </section>\r\n  );\r\n};\r\n\r\nexport default HeroSection;","usedDeprecatedRules":[]},{"filePath":"D:\\dealdirectcurrentlive\\dealdirect\\client\\src\\Components\\HeroSection\\HeroSection_omnibox.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'propertyTypes' is assigned a value but never used.","line":43,"column":45,"nodeType":"Identifier","messageId":"unusedVar","endLine":43,"endColumn":58,"suggestions":[{"messageId":"removeVar","data":{"varName":"propertyTypes"},"fix":{"range":[1684,1704],"text":""},"desc":"Remove unused variable 'propertyTypes'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'navigate' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":44,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":44,"endColumn":19,"suggestions":[{"messageId":"removeVar","data":{"varName":"navigate"},"fix":{"range":[1718,1749],"text":""},"desc":"Remove unused variable 'navigate'."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'dropdownRefs'. Either include it or remove the dependency array.","line":172,"column":8,"nodeType":"ArrayExpression","endLine":172,"endColumn":22,"suggestions":[{"desc":"Update the dependencies array to be: [dropdownRefs, openDropdown]","fix":{"range":[6988,7002],"text":"[dropdownRefs, openDropdown]"}}]},{"ruleId":"no-unused-vars","severity":2,"message":"'updateFilter' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":178,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":178,"endColumn":23,"suggestions":[{"messageId":"removeVar","data":{"varName":"updateFilter"},"fix":{"range":[7159,7269],"text":""},"desc":"Remove unused variable 'updateFilter'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'renderFilters' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":190,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":190,"endColumn":24,"suggestions":[{"messageId":"removeVar","data":{"varName":"renderFilters"},"fix":{"range":[7587,8252],"text":""},"desc":"Remove unused variable 'renderFilters'."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/Components/HeroSection/HeroSection.jsx - Omnibox Style\r\nimport React, { useState, useRef, useEffect } from \"react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport api from \"../../utils/api\";\r\nimport { AiOutlineSearch } from \"react-icons/ai\";\r\nimport { FaMapMarkerAlt, FaMicrophone, FaHome, FaKey, FaBuilding, FaBed, FaTree } from \"react-icons/fa\";\r\nimport { tabConfig } from \"./filterConfig\";\r\nimport PropertyTypeFilter from \"./PropertyTypeFilter\";\r\nimport SKYBACKGROUND from \"../../assets/SKYBACKGROUND.png\";\r\n\r\nconst API_BASE = import.meta.env.VITE_API_BASE;\r\n\r\nconst defaultTabs = [\r\n    { label: \"Buy\", intent: \"buy\", icon: FaHome },\r\n    { label: \"Rental\", intent: \"rent\", icon: FaKey },\r\n    { label: \"Projects\", intent: \"project\", icon: FaBuilding },\r\n    { label: \"PG / Hostels\", intent: \"pg\", icon: FaBed },\r\n    { label: \"Plot & Land\", intent: \"plot\", icon: FaTree },\r\n];\r\n\r\n// Omnibox-style relevance scoring\r\nconst calculateRelevanceScore = (query, text) => {\r\n    if (!text) return 0;\r\n\r\n    const queryLower = query.toLowerCase();\r\n    const textLower = text.toLowerCase();\r\n\r\n    if (textLower === queryLower) return 100;\r\n    if (textLower.startsWith(queryLower)) return 90;\r\n\r\n    const words = textLower.split(/\\s+/);\r\n    if (words.some(word => word.startsWith(queryLower))) return 80;\r\n    if (textLower.includes(queryLower)) return 70;\r\n\r\n    // Fuzzy match\r\n    let queryIndex = 0;\r\n    for (let i = 0; i < textLower.length && queryIndex < queryLower.length; i++) {\r\n        if (textLower[i] === queryLower[queryIndex]) queryIndex++;\r\n    }\r\n    return queryIndex === queryLower.length ? 50 : 0;\r\n};\r\n\r\nconst HeroSection = ({ filters, setFilters, propertyTypes = [] }) => {\r\n    const navigate = useNavigate();\r\n    const [activeTab, setActiveTab] = useState(\"Buy\");\r\n    const [openDropdown, setOpenDropdown] = useState(null);\r\n    const [suggestions, setSuggestions] = useState([]);\r\n    const [showSuggestions, setShowSuggestions] = useState(false);\r\n    const [isLoadingSuggestions, setIsLoadingSuggestions] = useState(false);\r\n    const [selectedIndex, setSelectedIndex] = useState(-1);\r\n    const searchInputRef = useRef(null);\r\n    const suggestionsRef = useRef(null);\r\n\r\n    const dropdownRefs = {\r\n        budget: useRef(null),\r\n        propertyType: useRef(null),\r\n    };\r\n\r\n    // Omnibox-style search with debouncing\r\n    useEffect(() => {\r\n        const fetchSuggestions = async () => {\r\n            if (!filters.search || filters.search.trim().length < 2) {\r\n                setSuggestions([]);\r\n                setShowSuggestions(false);\r\n                return;\r\n            }\r\n\r\n            setIsLoadingSuggestions(true);\r\n            try {\r\n                const response = await api.get('/properties/property-list');\r\n                const properties = response.data.data || [];\r\n\r\n                const searchTerm = filters.search.toLowerCase().trim();\r\n                const scoredSuggestions = [];\r\n\r\n                properties.forEach(property => {\r\n                    if (property.title) {\r\n                        const score = calculateRelevanceScore(searchTerm, property.title);\r\n                        if (score > 0) {\r\n                            scoredSuggestions.push({\r\n                                type: 'project',\r\n                                value: property.title,\r\n                                subtitle: `${property.city || ''} ${property.locality ? 'ΓÇó ' + property.locality : ''}`.trim(),\r\n                                score,\r\n                            });\r\n                        }\r\n                    }\r\n\r\n                    if (property.locality) {\r\n                        const score = calculateRelevanceScore(searchTerm, property.locality);\r\n                        if (score > 0) {\r\n                            scoredSuggestions.push({\r\n                                type: 'locality',\r\n                                value: property.locality,\r\n                                subtitle: property.city || '',\r\n                                score: score * 0.9,\r\n                            });\r\n                        }\r\n                    }\r\n\r\n                    if (property.city) {\r\n                        const score = calculateRelevanceScore(searchTerm, property.city);\r\n                        if (score > 0) {\r\n                            scoredSuggestions.push({\r\n                                type: 'city',\r\n                                value: property.city,\r\n                                subtitle: 'City',\r\n                                score: score * 0.8,\r\n                            });\r\n                        }\r\n                    }\r\n                });\r\n\r\n                const uniqueSuggestions = Array.from(\r\n                    new Map(scoredSuggestions.map(item => [`${item.type}-${item.value}`, item])).values()\r\n                ).sort((a, b) => b.score - a.score).slice(0, 8);\r\n\r\n                setSuggestions(uniqueSuggestions);\r\n                setShowSuggestions(uniqueSuggestions.length > 0);\r\n                setSelectedIndex(-1);\r\n            } catch (error) {\r\n                console.error('Error fetching suggestions:', error);\r\n                setSuggestions([]);\r\n            } finally {\r\n                setIsLoadingSuggestions(false);\r\n            }\r\n        };\r\n\r\n        const debounceTimer = setTimeout(fetchSuggestions, 200);\r\n        return () => clearTimeout(debounceTimer);\r\n    }, [filters.search]);\r\n\r\n    // Handle keyboard navigation\r\n    const handleKeyDown = (e) => {\r\n        if (!showSuggestions || suggestions.length === 0) return;\r\n\r\n        if (e.key === 'ArrowDown') {\r\n            e.preventDefault();\r\n            setSelectedIndex(prev => (prev < suggestions.length - 1 ? prev + 1 : prev));\r\n        } else if (e.key === 'ArrowUp') {\r\n            e.preventDefault();\r\n            setSelectedIndex(prev => (prev > 0 ? prev - 1 : -1));\r\n        } else if (e.key === 'Enter' && selectedIndex >= 0) {\r\n            e.preventDefault();\r\n            handleSuggestionClick(suggestions[selectedIndex]);\r\n        } else if (e.key === 'Escape') {\r\n            setShowSuggestions(false);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        const handleClickOutside = (event) => {\r\n            if (\r\n                openDropdown &&\r\n                dropdownRefs[openDropdown]?.current &&\r\n                !dropdownRefs[openDropdown].current.contains(event.target)\r\n            ) {\r\n                setOpenDropdown(null);\r\n            }\r\n\r\n            if (\r\n                suggestionsRef.current &&\r\n                !suggestionsRef.current.contains(event.target) &&\r\n                searchInputRef.current &&\r\n                !searchInputRef.current.contains(event.target)\r\n            ) {\r\n                setShowSuggestions(false);\r\n            }\r\n        };\r\n        document.addEventListener(\"mousedown\", handleClickOutside);\r\n        return () => document.removeEventListener(\"mousedown\", handleClickOutside);\r\n    }, [openDropdown]);\r\n\r\n    const tabs = defaultTabs;\r\n    const configKey = tabConfig[activeTab] ? activeTab : \"Buy\";\r\n    const currentConfig = tabConfig[configKey];\r\n\r\n    const updateFilter = (field, value) => {\r\n        setFilters((prev) => ({ ...prev, [field]: value }));\r\n    };\r\n\r\n    const updatePropertyTypes = (updater) => {\r\n        setFilters((prev) => {\r\n            const previous = prev.propertyTypes || [];\r\n            const nextValue = typeof updater === \"function\" ? updater(previous) : updater;\r\n            return { ...prev, propertyTypes: nextValue };\r\n        });\r\n    };\r\n\r\n    const renderFilters = () =>\r\n        currentConfig.filters.map((filterType) => {\r\n            if (filterType === \"propertyType\") {\r\n                return (\r\n                    <PropertyTypeFilter\r\n                        key=\"propertyType\"\r\n                        selectedPropertyTypes={filters.propertyTypes || []}\r\n                        setSelectedPropertyTypes={updatePropertyTypes}\r\n                        openDropdown={openDropdown}\r\n                        setOpenDropdown={setOpenDropdown}\r\n                        dropdownRef={dropdownRefs.propertyType}\r\n                    />\r\n                );\r\n            }\r\n            return null;\r\n        });\r\n\r\n    const handleSuggestionClick = (suggestion) => {\r\n        setFilters({ ...filters, search: suggestion.value });\r\n        setShowSuggestions(false);\r\n        setSelectedIndex(-1);\r\n    };\r\n\r\n    const handleTabSelect = (tab) => {\r\n        setActiveTab(tab.label);\r\n    };\r\n\r\n    // Highlight matching text\r\n    const highlightMatch = (text, query) => {\r\n        if (!query || !text) return text;\r\n        const index = text.toLowerCase().indexOf(query.toLowerCase());\r\n        if (index === -1) return text;\r\n\r\n        return (\r\n            <>\r\n                {text.substring(0, index)}\r\n                <span className=\"font-semibold\">{text.substring(index, index + query.length)}</span>\r\n                {text.substring(index + query.length)}\r\n            </>\r\n        );\r\n    };\r\n\r\n    return (\r\n        <section className=\"relative flex flex-col justify-center items-center px-4 sm:px-8 lg:px-16 text-center overflow-visible\">\r\n            <div\r\n                className=\"absolute inset-0 bg-cover bg-center bg-no-repeat\"\r\n                style={{ backgroundImage: `url(${SKYBACKGROUND})` }}\r\n            ></div>\r\n\r\n            <div\r\n                className=\"absolute inset-0 opacity-[0.03]\"\r\n                style={{\r\n                    backgroundImage:\r\n                        \"url('data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22100%22 height=%22100%22 viewBox=%220 0 100 100%22%3E%3Ccircle cx=%2250%22 cy=%2250%22 r=%2250%22 fill=%22%23ffffff10%22/%3E%3C/svg%3E')\",\r\n                }}\r\n            ></div>\r\n\r\n            <div className=\"relative pt-20 py-15 z-10 flex flex-col items-center max-w-7xl w-full space-y-2\">\r\n                <h1 className=\"text-3xl sm:text-4xl lg:text-5xl font-[700] text-white leading-tight max-w-4xl\">\r\n                    Buy, Sell & Rent Properties\r\n                    <br />\r\n                    <span className=\"text-red-500\">Directly from Owners</span>\r\n                </h1>\r\n\r\n                <p className=\"text-lg sm:text-xl lg:text-2xl text-gray-200 max-w-3xl\">\r\n                    No middleman. No commission fees.\r\n                    <br />\r\n                    <span className=\"font-semibold text-white\">\r\n                        Deal directly with property owners\r\n                    </span>\r\n                </p>\r\n\r\n                <div className=\"flex flex-wrap justify-center gap-3 mt-5\">\r\n                    {tabs.map((tab, i) => {\r\n                        const Icon = tab.icon;\r\n                        return (\r\n                            <button\r\n                                key={`${tab.label}-${i}`}\r\n                                onClick={() => handleTabSelect(tab)}\r\n                                className={`flex items-center gap-2 px-5 py-2.5 rounded-full font-semibold text-sm border-2 transition-all duration-300 ${activeTab === tab.label\r\n                                    ? \"bg-red-600 text-white border-transparent shadow-lg shadow-red-500/50 scale-105\"\r\n                                    : \"bg-white/10 backdrop-blur-sm text-white border-white/30 hover:border-white/50 hover:bg-white/20\"\r\n                                    }`}\r\n                            >\r\n                                {Icon && <Icon className=\"text-base\" />}\r\n                                {tab.label}\r\n                            </button>\r\n                        );\r\n                    })}\r\n                </div>\r\n\r\n                <div className=\"bg-white/95 backdrop-blur-md shadow-2xl rounded-3xl p-6 sm:p-8 mt-6 w-full max-w-5xl border border-gray-100\">\r\n                    <div className=\"flex flex-col sm:flex-row gap-3\">\r\n                        <div className=\"relative flex-1\" ref={searchInputRef}>\r\n                            <div className=\"relative flex items-center\">\r\n                                <AiOutlineSearch className=\"absolute left-4 text-gray-500 text-lg\" />\r\n                                <input\r\n                                    type=\"text\"\r\n                                    placeholder=\"Search by Project, Locality, or City\"\r\n                                    value={filters.search}\r\n                                    onChange={(e) => {\r\n                                        setFilters({ ...filters, search: e.target.value });\r\n                                        setShowSuggestions(true);\r\n                                    }}\r\n                                    onKeyDown={handleKeyDown}\r\n                                    onFocus={() => {\r\n                                        if (suggestions.length > 0) setShowSuggestions(true);\r\n                                    }}\r\n                                    className=\"w-full border border-gray-300 rounded-xl pl-11 pr-20 py-3 text-sm text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-red-500 outline-none\"\r\n                                />\r\n                                <div className=\"absolute right-4 flex items-center gap-3\">\r\n                                    <FaMapMarkerAlt className=\"text-gray-600 cursor-pointer hover:text-gray-800\" />\r\n                                    <FaMicrophone className=\"text-red-600 cursor-pointer hover:text-red-700\" />\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Omnibox Suggestions */}\r\n                            {showSuggestions && (suggestions.length > 0 || isLoadingSuggestions) && (\r\n                                <div\r\n                                    ref={suggestionsRef}\r\n                                    className=\"absolute top-full left-0 right-0 mt-2 bg-white border border-gray-200 rounded-xl shadow-2xl max-h-96 overflow-y-auto z-50\"\r\n                                >\r\n                                    {isLoadingSuggestions ? (\r\n                                        <div className=\"p-4 text-center text-gray-500\">\r\n                                            <div className=\"animate-spin inline-block w-5 h-5 border-2 border-red-600 border-t-transparent rounded-full\"></div>\r\n                                            <p className=\"mt-2 text-sm\">Searching...</p>\r\n                                        </div>\r\n                                    ) : (\r\n                                        <ul className=\"py-1\">\r\n                                            {suggestions.map((suggestion, index) => (\r\n                                                <li\r\n                                                    key={index}\r\n                                                    onClick={() => handleSuggestionClick(suggestion)}\r\n                                                    onMouseEnter={() => setSelectedIndex(index)}\r\n                                                    className={`px-4 py-3 cursor-pointer transition-colors flex items-start gap-3 ${selectedIndex === index ? 'bg-gray-100' : 'hover:bg-gray-50'\r\n                                                        }`}\r\n                                                >\r\n                                                    <AiOutlineSearch className=\"text-gray-400 flex-shrink-0 mt-0.5\" />\r\n                                                    <div className=\"flex-1 min-w-0\">\r\n                                                        <p className=\"text-sm text-gray-900\">\r\n                                                            {highlightMatch(suggestion.value, filters.search)}\r\n                                                        </p>\r\n                                                        {suggestion.subtitle && (\r\n                                                            <p className=\"text-xs text-gray-500 truncate\">{suggestion.subtitle}</p>\r\n                                                        )}\r\n                                                    </div>\r\n                                                    <span className=\"text-xs text-gray-400 capitalize flex-shrink-0\">{suggestion.type}</span>\r\n                                                </li>\r\n                                            ))}\r\n                                        </ul>\r\n                                    )}\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n\r\n                        <button className=\"bg-red-600 text-white px-8 py-3 rounded-xl font-semibold text-sm hover:bg-red-700 transition-all shadow-lg flex items-center gap-2 whitespace-nowrap\">\r\n                            <AiOutlineSearch />\r\n                            Search\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </section>\r\n    );\r\n};\r\n\r\nexport default HeroSection;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\dealdirectcurrentlive\\dealdirect\\client\\src\\Components\\HeroSection\\PossessionFilter.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\dealdirectcurrentlive\\dealdirect\\client\\src\\Components\\HeroSection\\PostedByFilter.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\dealdirectcurrentlive\\dealdirect\\client\\src\\Components\\HeroSection\\ProjectPropertyTypeFilter.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\dealdirectcurrentlive\\dealdirect\\client\\src\\Components\\HeroSection\\PropertyTypeFilter.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\dealdirectcurrentlive\\dealdirect\\client\\src\\Components\\HeroSection\\TransactionTypeFilter.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\dealdirectcurrentlive\\dealdirect\\client\\src\\Components\\HeroSection\\filterConfig.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\dealdirectcurrentlive\\dealdirect\\client\\src\\Components\\LogoLoop\\LogoLoop.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\dealdirectcurrentlive\\dealdirect\\client\\src\\Components\\MiddelComp.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\dealdirectcurrentlive\\dealdirect\\client\\src\\Components\\MiddelSection.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\dealdirectcurrentlive\\dealdirect\\client\\src\\Components\\Navbar\\CityDropdown.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\dealdirectcurrentlive\\dealdirect\\client\\src\\Components\\Navbar\\MegaMenu.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\dealdirectcurrentlive\\dealdirect\\client\\src\\Components\\Navbar\\Navbar.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'selectedCity' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":41,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":41,"endColumn":22,"suggestions":[{"messageId":"removeVar","data":{"varName":"selectedCity"},"fix":{"range":[1865,1877],"text":""},"desc":"Remove unused variable 'selectedCity'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'setSelectedCity' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":41,"column":24,"nodeType":"Identifier","messageId":"unusedVar","endLine":41,"endColumn":39,"suggestions":[{"messageId":"removeVar","data":{"varName":"setSelectedCity"},"fix":{"range":[1877,1894],"text":""},"desc":"Remove unused variable 'setSelectedCity'."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useCallback, useMemo, useRef } from \"react\";\r\nimport { Link, useNavigate } from \"react-router-dom\";\r\nimport { toast } from \"react-toastify\";\r\nimport { AiOutlineUser, AiOutlineMenu, AiOutlineClose, AiOutlineSearch, AiOutlineHome, AiOutlineInfoCircle, AiOutlinePhone, AiOutlineFileText, AiOutlinePlusCircle, AiOutlineLogin, AiOutlineLogout, AiOutlineSetting, AiOutlineHeart, AiOutlineBell } from \"react-icons/ai\";\r\nimport { FaMapMarkerAlt, FaMicrophone } from \"react-icons/fa\";\r\nimport { BsBuilding, BsHouseDoor, BsPersonCircle } from \"react-icons/bs\";\r\nimport { HiOutlineHome, HiOutlineDocumentText } from \"react-icons/hi\";\r\nimport logo from \"../../assets/dealdirect_logo.png\";\r\nimport AuthModal from \"../AuthModal/AuthModal\";\r\nimport EmailVerificationModal from \"../EmailVerificationModal/EmailVerificationModal\";\r\nimport api from \"../../utils/api\";\r\nimport { useAuth } from \"../../context/AuthContext\";\r\n\r\nconst API_BASE = import.meta.env.VITE_API_BASE;\r\n\r\n// Omnibox-style relevance scoring (Same as HeroSection)\r\nconst calculateRelevanceScore = (query, text) => {\r\n  if (!text) return 0;\r\n\r\n  const queryLower = query.toLowerCase();\r\n  const textLower = text.toLowerCase();\r\n\r\n  if (textLower === queryLower) return 100;\r\n  if (textLower.startsWith(queryLower)) return 90;\r\n\r\n  const words = textLower.split(/\\s+/);\r\n  if (words.some(word => word.startsWith(queryLower))) return 80;\r\n  if (textLower.includes(queryLower)) return 70;\r\n\r\n  // Fuzzy match\r\n  let queryIndex = 0;\r\n  for (let i = 0; i < textLower.length && queryIndex < queryLower.length; i++) {\r\n    if (textLower[i] === queryLower[queryIndex]) queryIndex++;\r\n  }\r\n  return queryIndex === queryLower.length ? 50 : 0;\r\n};\r\n\r\nfunction Navbar() {\r\n  const [menuOpen, setMenuOpen] = useState(false);\r\n  const [isScrolled, setIsScrolled] = useState(false);\r\n  const [selectedCity, setSelectedCity] = useState(\"Mumbai\");\r\n  const [activeMenu, setActiveMenu] = useState(null);\r\n  const [searchQuery, setSearchQuery] = useState(\"\");\r\n  const [isAuthModalOpen, setIsAuthModalOpen] = useState(false);\r\n  const [isVerificationModalOpen, setIsVerificationModalOpen] = useState(false);\r\n  const [isUserDropdownOpen, setIsUserDropdownOpen] = useState(false);\r\n  const [unreadNotifications, setUnreadNotifications] = useState(0);\r\n  const userDropdownRef = useRef(null);\r\n\r\n  // Use AuthContext for user state\r\n  const { user, isAuthenticated, logout: authLogout } = useAuth();\r\n\r\n  // Search Suggestions State\r\n  const [suggestions, setSuggestions] = useState([]);\r\n  const [showSuggestions, setShowSuggestions] = useState(false);\r\n  const [isLoadingSuggestions, setIsLoadingSuggestions] = useState(false);\r\n  const [selectedIndex, setSelectedIndex] = useState(-1);\r\n  const searchInputRef = useRef(null);\r\n  const suggestionsRef = useRef(null);\r\n\r\n  const navigate = useNavigate();\r\n\r\n  const toggleMenu = () => setMenuOpen((s) => !s);\r\n\r\n  useEffect(() => {\r\n    const handleScroll = () => {\r\n      // Detect if we've scrolled past the hero section (approximately 600-700px)\r\n      setIsScrolled(window.scrollY > 500);\r\n    };\r\n    window.addEventListener(\"scroll\", handleScroll);\r\n    return () => window.removeEventListener(\"scroll\", handleScroll);\r\n  }, []);\r\n\r\n  // Fetch unread notification count when user logs in\r\n  useEffect(() => {\r\n    const fetchUnread = async () => {\r\n      if (!isAuthenticated) {\r\n        setUnreadNotifications(0);\r\n        return;\r\n      }\r\n      try {\r\n        const res = await api.get('/notifications');\r\n        if (res.data.success) {\r\n          const list = res.data.notifications || [];\r\n          const count = list.filter((n) => !n.isRead).length;\r\n          setUnreadNotifications(count);\r\n        }\r\n      } catch (err) {\r\n        // Silently fail - 401 handled by interceptor\r\n        console.error(\"Failed to fetch notifications\", err);\r\n      }\r\n    };\r\n\r\n    fetchUnread();\r\n  }, [isAuthenticated]);\r\n\r\n  // Search Suggestions Logic\r\n  useEffect(() => {\r\n    const fetchSuggestions = async () => {\r\n      if (!searchQuery || searchQuery.trim().length < 2) {\r\n        setSuggestions([]);\r\n        setShowSuggestions(false);\r\n        return;\r\n      }\r\n\r\n      setIsLoadingSuggestions(true);\r\n      try {\r\n        const response = await api.get('/properties/property-list');\r\n        const properties = response.data.data || [];\r\n\r\n        const searchTerm = searchQuery.toLowerCase().trim();\r\n        const scoredSuggestions = [];\r\n\r\n        properties.forEach(property => {\r\n          if (property.title) {\r\n            const score = calculateRelevanceScore(searchTerm, property.title);\r\n            if (score > 0) {\r\n              scoredSuggestions.push({\r\n                type: 'project',\r\n                value: property.title,\r\n                subtitle: `${property.city || ''} ${property.locality ? 'ΓÇó ' + property.locality : ''}`.trim(),\r\n                score,\r\n              });\r\n            }\r\n          }\r\n\r\n          if (property.locality) {\r\n            const score = calculateRelevanceScore(searchTerm, property.locality);\r\n            if (score > 0) {\r\n              scoredSuggestions.push({\r\n                type: 'locality',\r\n                value: property.locality,\r\n                subtitle: property.city || '',\r\n                score: score * 0.9,\r\n              });\r\n            }\r\n          }\r\n\r\n          if (property.city) {\r\n            const score = calculateRelevanceScore(searchTerm, property.city);\r\n            if (score > 0) {\r\n              scoredSuggestions.push({\r\n                type: 'city',\r\n                value: property.city,\r\n                subtitle: 'City',\r\n                score: score * 0.8,\r\n              });\r\n            }\r\n          }\r\n        });\r\n\r\n        const uniqueSuggestions = Array.from(\r\n          new Map(scoredSuggestions.map(item => [`${item.type}-${item.value}`, item])).values()\r\n        ).sort((a, b) => b.score - a.score).slice(0, 8);\r\n\r\n        setSuggestions(uniqueSuggestions);\r\n        setShowSuggestions(uniqueSuggestions.length > 0);\r\n        setSelectedIndex(-1);\r\n      } catch (error) {\r\n        console.error('Error fetching suggestions:', error);\r\n        setSuggestions([]);\r\n      } finally {\r\n        setIsLoadingSuggestions(false);\r\n      }\r\n    };\r\n\r\n    const debounceTimer = setTimeout(fetchSuggestions, 200);\r\n    return () => clearTimeout(debounceTimer);\r\n  }, [searchQuery]);\r\n\r\n  // Handle Click Outside for Suggestions\r\n  useEffect(() => {\r\n    const handleClickOutside = (event) => {\r\n      if (\r\n        suggestionsRef.current &&\r\n        !suggestionsRef.current.contains(event.target) &&\r\n        searchInputRef.current &&\r\n        !searchInputRef.current.contains(event.target)\r\n      ) {\r\n        setShowSuggestions(false);\r\n      }\r\n      // Close user dropdown when clicking outside\r\n      if (\r\n        userDropdownRef.current &&\r\n        !userDropdownRef.current.contains(event.target)\r\n      ) {\r\n        setIsUserDropdownOpen(false);\r\n      }\r\n    };\r\n    document.addEventListener(\"mousedown\", handleClickOutside);\r\n    return () => document.removeEventListener(\"mousedown\", handleClickOutside);\r\n  }, []);\r\n\r\n  const handleSuggestionClick = (suggestion) => {\r\n    setSearchQuery(suggestion.value);\r\n    setShowSuggestions(false);\r\n    setSelectedIndex(-1);\r\n    navigate(`/properties?search=${encodeURIComponent(suggestion.value)}`);\r\n  };\r\n\r\n  const handleMapClick = () => {\r\n    const searchParams = new URLSearchParams();\r\n    searchParams.set('view', 'map');\r\n    if (searchQuery) {\r\n      searchParams.set('search', searchQuery);\r\n    }\r\n    navigate(`/properties?${searchParams.toString()}`);\r\n  };\r\n\r\n  const handleSearch = () => {\r\n    if (searchQuery.trim()) {\r\n      navigate(`/properties?search=${encodeURIComponent(searchQuery)}`);\r\n      setShowSuggestions(false);\r\n    }\r\n  };\r\n\r\n  const handleKeyDown = (e) => {\r\n    if (!showSuggestions || suggestions.length === 0) {\r\n      if (e.key === 'Enter') {\r\n        handleSearch();\r\n      }\r\n      return;\r\n    }\r\n\r\n    if (e.key === 'ArrowDown') {\r\n      e.preventDefault();\r\n      setSelectedIndex(prev => (prev < suggestions.length - 1 ? prev + 1 : prev));\r\n    } else if (e.key === 'ArrowUp') {\r\n      e.preventDefault();\r\n      setSelectedIndex(prev => (prev > 0 ? prev - 1 : -1));\r\n    } else if (e.key === 'Enter') {\r\n      e.preventDefault();\r\n      if (selectedIndex >= 0) {\r\n        handleSuggestionClick(suggestions[selectedIndex]);\r\n      } else {\r\n        handleSearch();\r\n      }\r\n    } else if (e.key === 'Escape') {\r\n      setShowSuggestions(false);\r\n    }\r\n  };\r\n\r\n  const highlightMatch = (text, query) => {\r\n    if (!query || !text) return text;\r\n    const index = text.toLowerCase().indexOf(query.toLowerCase());\r\n    if (index === -1) return text;\r\n\r\n    return (\r\n      <>\r\n        {text.substring(0, index)}\r\n        <span className=\"font-semibold\">{text.substring(index, index + query.length)}</span>\r\n        {text.substring(index + query.length)}\r\n      </>\r\n    );\r\n  };\r\n\r\n  const handleLogout = async () => {\r\n    await authLogout();\r\n    // authLogout handles navigation and state clearing\r\n  };\r\n\r\n  const derivedRole = useMemo(() => {\r\n    if (!user) return \"user\";\r\n    const fallbacks = user.role || user.accountType || user.userType || user.type;\r\n    if (typeof fallbacks === \"string\") return fallbacks.toLowerCase();\r\n    if (user.isAgent) return \"agent\";\r\n    return \"user\";\r\n  }, [user]);\r\n\r\n  const isAgent = derivedRole === \"agent\";\r\n  const agentUploadUrl = import.meta.env.VITE_AGENT_UPLOAD_URL || \"/admin/add-property\";\r\n  const isExternalAgentUrl = /^https?:\\/\\//i.test(agentUploadUrl || \"\");\r\n  const showAgentUpload = isAgent && Boolean(agentUploadUrl);\r\n\r\n  const handleAgentUploadNavigation = useCallback(() => {\r\n    if (!showAgentUpload) return;\r\n    if (isExternalAgentUrl) {\r\n      window.location.href = agentUploadUrl;\r\n      return;\r\n    }\r\n    navigate(agentUploadUrl);\r\n  }, [agentUploadUrl, isExternalAgentUrl, navigate, showAgentUpload]);\r\n\r\n  const handleRegisterProperty = async () => {\r\n    if (!isAuthenticated) {\r\n      setIsAuthModalOpen(true);\r\n      return;\r\n    }\r\n\r\n    // Check if user is a buyer (user role) - needs email verification to list property\r\n    const userRole = (user.role || \"user\").toLowerCase();\r\n\r\n    if (userRole === \"user\") {\r\n      // Buyer needs to verify email first\r\n      setIsVerificationModalOpen(true);\r\n      return;\r\n    }\r\n\r\n    // For agents, keep existing behaviour\r\n    if (userRole === \"agent\") {\r\n      navigate(\"/add-property\");\r\n      return;\r\n    }\r\n\r\n    // For owners, enforce: only one property can be listed\r\n    if (userRole === \"owner\") {\r\n      try {\r\n        const res = await api.get('/properties/my-properties');\r\n\r\n        const count =\r\n          typeof res.data?.count === \"number\"\r\n            ? res.data.count\r\n            : Array.isArray(res.data?.data)\r\n              ? res.data.data.length\r\n              : 0;\r\n\r\n        if (count >= 1) {\r\n          toast.info(\r\n            \"You can list only one property as an owner. Please edit your existing listing from My Properties.\",\r\n          );\r\n          navigate(\"/my-properties\");\r\n          return;\r\n        }\r\n      } catch (error) {\r\n        console.error(\"Error checking existing properties:\", error);\r\n        // If the check fails, fall back to allowing navigation so user isn't blocked unexpectedly\r\n      }\r\n\r\n      navigate(\"/add-property\");\r\n    }\r\n  };\r\n\r\n  const handleVerificationSuccess = () => {\r\n    // After successful verification, navigate to add property\r\n    navigate(\"/add-property\");\r\n  };\r\n\r\n  // Classes that adapt: white background always\r\n  const navWrapperClass = `fixed top-0 left-0 w-full z-[9999] transition-all duration-300 ${isScrolled\r\n    ? \"bg-white shadow-lg py-3\"\r\n    : \"bg-white py-4\"\r\n    }`;\r\n\r\n  const navTextClass = \"text-gray-800\"; // Dark text for white background\r\n\r\n  return (\r\n    <>\r\n      <AuthModal\r\n        isOpen={isAuthModalOpen}\r\n        onClose={() => setIsAuthModalOpen(false)}\r\n      />\r\n      <EmailVerificationModal\r\n        isOpen={isVerificationModalOpen}\r\n        onClose={() => setIsVerificationModalOpen(false)}\r\n        user={user}\r\n        onVerified={handleVerificationSuccess}\r\n      />\r\n      <nav className={navWrapperClass}>\r\n        <div className=\"mx-auto flex items-center justify-between px-6 lg:px-8 max-w-[1400px]\">\r\n          {/* Left Side: Logo + Navigation */}\r\n          <div className=\"flex items-center gap-6\">\r\n            {/* Logo */}\r\n            <Link to=\"/\" className=\"flex items-center\">\r\n              <img\r\n                src={logo}\r\n                alt=\"DealDirect\"\r\n                className=\"h-10 w-auto object-contain hover:scale-105 transition-transform duration-300\"\r\n              />\r\n            </Link>\r\n\r\n            {/* Scrolled State: Search Bar */}\r\n            {isScrolled && (\r\n              <div className=\"hidden lg:flex items-center flex-1 max-w-2xl mx-6 gap-3 relative\" ref={searchInputRef}>\r\n\r\n                {/* Search Bar */}\r\n                <div className=\"relative flex-1 flex items-center\">\r\n                  <AiOutlineSearch className=\"absolute left-3 text-gray-400 text-lg\" />\r\n                  <input\r\n                    type=\"text\"\r\n                    placeholder=\"Enter Locality / Project / Society / Landmark\"\r\n                    value={searchQuery}\r\n                    onChange={(e) => {\r\n                      setSearchQuery(e.target.value);\r\n                      setShowSuggestions(true);\r\n                    }}\r\n                    onKeyDown={handleKeyDown}\r\n                    onFocus={() => {\r\n                      if (suggestions.length > 0) setShowSuggestions(true);\r\n                    }}\r\n                    className=\"w-full border border-gray-300 rounded-lg pl-10 pr-16 py-2 text-sm text-gray-700 focus:ring-2 focus:ring-red-500 outline-none\"\r\n                  />\r\n                  <div className=\"absolute right-3 flex items-center gap-2\">\r\n                    <FaMapMarkerAlt\r\n                      className=\"text-red-600 cursor-pointer hover:text-red-700 transition-transform hover:scale-110\"\r\n                      onClick={handleMapClick}\r\n                      title=\"Search on Map\"\r\n                    />\r\n                    <FaMicrophone className=\"text-red-600 cursor-pointer hover:text-red-700\" />\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Search Suggestions Dropdown */}\r\n                {showSuggestions && (suggestions.length > 0 || isLoadingSuggestions) && (\r\n                  <div\r\n                    ref={suggestionsRef}\r\n                    className=\"absolute top-full left-0 right-0 mt-2 bg-white border border-gray-200 rounded-xl shadow-2xl max-h-96 overflow-y-auto z-50\"\r\n                  >\r\n                    {isLoadingSuggestions ? (\r\n                      <div className=\"p-4 text-center text-gray-500\">\r\n                        <div className=\"animate-spin inline-block w-5 h-5 border-2 border-red-600 border-t-transparent rounded-full\"></div>\r\n                        <p className=\"mt-2 text-sm\">Searching...</p>\r\n                      </div>\r\n                    ) : (\r\n                      <ul className=\"py-1\">\r\n                        {suggestions.map((suggestion, index) => (\r\n                          <li\r\n                            key={index}\r\n                            onClick={() => handleSuggestionClick(suggestion)}\r\n                            onMouseEnter={() => setSelectedIndex(index)}\r\n                            className={`px-4 py-3 cursor-pointer transition-colors flex items-start gap-3 ${selectedIndex === index ? 'bg-gray-100' : 'hover:bg-gray-50'\r\n                              }`}\r\n                          >\r\n                            <AiOutlineSearch className=\"text-gray-400 flex-shrink-0 mt-0.5\" />\r\n                            <div className=\"flex-1 min-w-0\">\r\n                              <p className=\"text-sm text-gray-900\">\r\n                                {highlightMatch(suggestion.value, searchQuery)}\r\n                              </p>\r\n                              {suggestion.subtitle && (\r\n                                <p className=\"text-xs text-gray-500 truncate\">{suggestion.subtitle}</p>\r\n                              )}\r\n                            </div>\r\n                            <span className=\"text-xs text-gray-400 capitalize flex-shrink-0\">{suggestion.type}</span>\r\n                          </li>\r\n                        ))}\r\n                      </ul>\r\n                    )}\r\n                  </div>\r\n                )}\r\n\r\n                {/* Search Button */}\r\n                <button\r\n                  onClick={handleSearch}\r\n                  className=\"bg-red-600 text-white px-6 py-2 rounded-lg font-semibold text-sm hover:bg-red-700 transition flex items-center gap-2\"\r\n                >\r\n                  <AiOutlineSearch />\r\n                  Search\r\n                </button>\r\n              </div>\r\n            )}\r\n\r\n            {/* Desktop Navigation Items - Only in non-scrolled state */}\r\n            {!isScrolled && (\r\n              <div className=\"hidden lg:flex items-center gap-6\">\r\n\r\n                {/* Buy Dropdown */}\r\n                <div\r\n                  className=\"relative\"\r\n                  onMouseEnter={() => setActiveMenu('buy')}\r\n                  onMouseLeave={() => setActiveMenu(null)}\r\n                >\r\n                  <button className={`${navTextClass} hover:text-red-600 font-medium text-[15px] flex items-center gap-1 transition-colors duration-200`}>\r\n                    Buy\r\n                    <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\r\n                    </svg>\r\n                  </button>\r\n                  {activeMenu === 'buy' && (\r\n                    <div className=\"absolute top-full left-0 pt-2 bg-white shadow-2xl rounded-lg p-6 w-[600px] z-50\">\r\n                      <div className=\"grid grid-cols-3 gap-6\">\r\n                        <div>\r\n                          <h3 className=\"font-bold text-gray-900 mb-3 text-sm\">Residential</h3>\r\n                          <ul className=\"space-y-2\">\r\n                            <li><Link to=\"/properties?search=Apartment&availableFor=Sell\" className=\"text-gray-700 hover:text-red-600 text-sm\">Apartment / Flat</Link></li>\r\n                            <li><Link to=\"/properties?search=Independent House&availableFor=Sell\" className=\"text-gray-700 hover:text-red-600 text-sm\">Independent House</Link></li>\r\n                            <li><Link to=\"/properties?search=Villa&availableFor=Sell\" className=\"text-gray-700 hover:text-red-600 text-sm\">Villa</Link></li>\r\n                            <li><Link to=\"/properties?search=Builder Floor&availableFor=Sell\" className=\"text-gray-700 hover:text-red-600 text-sm\">Builder Floor</Link></li>\r\n                            <li><Link to=\"/properties?search=Penthouse&availableFor=Sell\" className=\"text-gray-700 hover:text-red-600 text-sm\">Penthouse</Link></li>\r\n                          </ul>\r\n                        </div>\r\n                        <div>\r\n                          <h3 className=\"font-bold text-gray-900 mb-3 text-sm\">Commercial</h3>\r\n                          <ul className=\"space-y-2\">\r\n                            <li><Link to=\"/properties?search=Office Space&availableFor=Sell\" className=\"text-gray-700 hover:text-red-600 text-sm\">Office Space</Link></li>\r\n                            <li><Link to=\"/properties?search=Shop&availableFor=Sell\" className=\"text-gray-700 hover:text-red-600 text-sm\">Shop / Showroom</Link></li>\r\n                            <li><Link to=\"/properties?search=Warehouse&availableFor=Sell\" className=\"text-gray-700 hover:text-red-600 text-sm\">Warehouse / Godown</Link></li>\r\n                            <li><Link to=\"/properties?search=Industrial&availableFor=Sell\" className=\"text-gray-700 hover:text-red-600 text-sm\">Industrial Building</Link></li>\r\n                          </ul>\r\n                        </div>\r\n                        <div>\r\n                          <h3 className=\"font-bold text-gray-900 mb-3 text-sm\">By BHK</h3>\r\n                          <ul className=\"space-y-2\">\r\n                            <li><Link to=\"/properties?search=1 BHK&availableFor=Sell\" className=\"text-gray-700 hover:text-red-600 text-sm\">1 BHK</Link></li>\r\n                            <li><Link to=\"/properties?search=2 BHK&availableFor=Sell\" className=\"text-gray-700 hover:text-red-600 text-sm\">2 BHK</Link></li>\r\n                            <li><Link to=\"/properties?search=3 BHK&availableFor=Sell\" className=\"text-gray-700 hover:text-red-600 text-sm\">3 BHK</Link></li>\r\n                            <li><Link to=\"/properties?search=4 BHK&availableFor=Sell\" className=\"text-gray-700 hover:text-red-600 text-sm\">4 BHK</Link></li>\r\n                            <li><Link to=\"/properties?search=5%2B BHK&availableFor=Sell\" className=\"text-gray-700 hover:text-red-600 text-sm\">5+ BHK</Link></li>\r\n                          </ul>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n\r\n                {/* Rent Dropdown */}\r\n                <div\r\n                  className=\"relative\"\r\n                  onMouseEnter={() => setActiveMenu('rent')}\r\n                  onMouseLeave={() => setActiveMenu(null)}\r\n                >\r\n                  <button className={`${navTextClass} hover:text-red-600 font-medium text-[15px] flex items-center gap-1 transition-colors duration-200`}>\r\n                    Rent\r\n                    <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\r\n                    </svg>\r\n                  </button>\r\n                  {activeMenu === 'rent' && (\r\n                    <div className=\"absolute top-full left-0 pt-2 bg-white shadow-2xl rounded-lg p-6 w-[600px] z-50\">\r\n                      <div className=\"grid grid-cols-3 gap-6\">\r\n                        <div>\r\n                          <h3 className=\"font-bold text-gray-900 mb-3 text-sm\">Residential</h3>\r\n                          <ul className=\"space-y-2\">\r\n                            <li><Link to=\"/properties?search=Apartment&availableFor=Rent\" className=\"text-gray-700 hover:text-red-600 text-sm\">Apartment / Flat</Link></li>\r\n                            <li><Link to=\"/properties?search=Independent House&availableFor=Rent\" className=\"text-gray-700 hover:text-red-600 text-sm\">Independent House</Link></li>\r\n                            <li><Link to=\"/properties?search=Villa&availableFor=Rent\" className=\"text-gray-700 hover:text-red-600 text-sm\">Villa</Link></li>\r\n                            <li><Link to=\"/properties?search=Builder Floor&availableFor=Rent\" className=\"text-gray-700 hover:text-red-600 text-sm\">Builder Floor</Link></li>\r\n                            <li><Link to=\"/properties?search=PG&availableFor=Rent\" className=\"text-gray-700 hover:text-red-600 text-sm\">PG / Hostel</Link></li>\r\n                          </ul>\r\n                        </div>\r\n                        <div>\r\n                          <h3 className=\"font-bold text-gray-900 mb-3 text-sm\">Commercial</h3>\r\n                          <ul className=\"space-y-2\">\r\n                            <li><Link to=\"/properties?search=Office Space&availableFor=Rent\" className=\"text-gray-700 hover:text-red-600 text-sm\">Office Space</Link></li>\r\n                            <li><Link to=\"/properties?search=Shop&availableFor=Rent\" className=\"text-gray-700 hover:text-red-600 text-sm\">Shop / Showroom</Link></li>\r\n                            <li><Link to=\"/properties?search=Coworking&availableFor=Rent\" className=\"text-gray-700 hover:text-red-600 text-sm\">Coworking Space</Link></li>\r\n                            <li><Link to=\"/properties?search=Warehouse&availableFor=Rent\" className=\"text-gray-700 hover:text-red-600 text-sm\">Warehouse / Godown</Link></li>\r\n                          </ul>\r\n                        </div>\r\n                        <div>\r\n                          <h3 className=\"font-bold text-gray-900 mb-3 text-sm\">By BHK</h3>\r\n                          <ul className=\"space-y-2\">\r\n                            <li><Link to=\"/properties?search=1 RK&availableFor=Rent\" className=\"text-gray-700 hover:text-red-600 text-sm\">1 RK</Link></li>\r\n                            <li><Link to=\"/properties?search=1 BHK&availableFor=Rent\" className=\"text-gray-700 hover:text-red-600 text-sm\">1 BHK</Link></li>\r\n                            <li><Link to=\"/properties?search=2 BHK&availableFor=Rent\" className=\"text-gray-700 hover:text-red-600 text-sm\">2 BHK</Link></li>\r\n                            <li><Link to=\"/properties?search=3 BHK&availableFor=Rent\" className=\"text-gray-700 hover:text-red-600 text-sm\">3 BHK</Link></li>\r\n                            <li><Link to=\"/properties?search=4 BHK&availableFor=Rent\" className=\"text-gray-700 hover:text-red-600 text-sm\">4 BHK</Link></li>\r\n                          </ul>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n\r\n                {/* Services Dropdown */}\r\n                <div\r\n                  className=\"relative\"\r\n                  onMouseEnter={() => setActiveMenu('services')}\r\n                  onMouseLeave={() => setActiveMenu(null)}\r\n                >\r\n                  <button className={`${navTextClass} hover:text-red-600 font-medium text-[15px] flex items-center gap-1 transition-colors duration-200`}>\r\n                    Services\r\n                    <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\r\n                    </svg>\r\n                  </button>\r\n                  {activeMenu === 'services' && (\r\n                    <div className=\"absolute top-full left-0 pt-2 bg-white shadow-2xl rounded-lg p-6 w-[400px] z-50\">\r\n                      <div className=\"grid grid-cols-2 gap-6\">\r\n                        <div>\r\n                          <h3 className=\"font-bold text-gray-900 mb-3 text-sm\">Property Services</h3>\r\n                          <ul className=\"space-y-2\">\r\n                            <li><button onClick={handleRegisterProperty} className=\"text-gray-700 hover:text-red-600 text-sm text-left w-full\">Post Property Free</button></li>\r\n                            <li><Link to=\"/properties\" className=\"text-gray-700 hover:text-red-600 text-sm\">Browse Properties</Link></li>\r\n                          </ul>\r\n                        </div>\r\n                        <div>\r\n                          <h3 className=\"font-bold text-gray-900 mb-3 text-sm\">Company</h3>\r\n                          <ul className=\"space-y-2\">\r\n                            <li><Link to=\"/pricing\" className=\"text-gray-700 hover:text-red-600 text-sm\">Pricing & Plans</Link></li>\r\n                            <li><Link to=\"/about\" className=\"text-gray-700 hover:text-red-600 text-sm\">About Us</Link></li>\r\n                            <li><Link to=\"/contact\" className=\"text-gray-700 hover:text-red-600 text-sm\">Contact Us</Link></li>\r\n                          </ul>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n\r\n\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          {/* Right Side: Sell Property + Login */}\r\n          <div className=\"hidden lg:flex items-center gap-6 ml-auto\">\r\n\r\n            <div className=\"flex items-center gap-6\">\r\n              {isScrolled && (\r\n                <>\r\n                  <Link to=\"/properties\" className={`${navTextClass} hover:text-red-600 font-medium text-[15px] transition-colors duration-200`}>\r\n                    Properties\r\n                  </Link>\r\n                  <Link\r\n                    to=\"/pricing\"\r\n                    className={`${navTextClass} hover:text-red-600 font-medium text-[15px] transition-colors duration-200`}\r\n                  >\r\n                    Pricing\r\n                  </Link>\r\n                  <Link\r\n                    to=\"/agreements\"\r\n                    className={`${navTextClass} hover:text-red-600 font-medium text-[15px] transition-colors duration-200`}\r\n                  >\r\n                    Agreements\r\n                  </Link>\r\n                  <Link to=\"/about\" className={`${navTextClass} hover:text-red-600 font-medium text-[15px] transition-colors duration-200`}>\r\n                    About\r\n                  </Link>\r\n                  <Link to=\"/contact\" className={`${navTextClass} hover:text-red-600 font-medium text-[15px] transition-colors duration-200`}>\r\n                    Contact\r\n                  </Link>\r\n                </>\r\n              )}\r\n\r\n              {showAgentUpload && (\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={handleAgentUploadNavigation}\r\n                  className=\"bg-gradient-to-r from-red-600 to-rose-700 text-white px-4 py-2 rounded-lg text-sm font-semibold shadow-md hover:opacity-95 transition\"\r\n                >\r\n                  Upload Property\r\n                </button>\r\n              )}\r\n\r\n              {/* Register Property Button - always visible */}\r\n              <button\r\n                type=\"button\"\r\n                onClick={handleRegisterProperty}\r\n                className=\"bg-red-600 text-white px-6 py-2.5 rounded-lg text-base font-bold hover:bg-red-700 transition shadow-md\"\r\n              >\r\n                Register Property\r\n              </button>\r\n            </div>\r\n\r\n            {user ? (\r\n              <div className=\"relative\" ref={userDropdownRef}>\r\n                <button\r\n                  onClick={() => setIsUserDropdownOpen(!isUserDropdownOpen)}\r\n                  className=\"flex items-center gap-2 p-1 rounded-full hover:bg-gray-100 transition-colors\"\r\n                >\r\n                  {user.profileImage ? (\r\n                    <img\r\n                      src={user.profileImage}\r\n                      alt={user.name}\r\n                      className=\"w-9 h-9 rounded-full object-cover border-2 border-gray-200\"\r\n                    />\r\n                  ) : (\r\n                    <div className=\"w-9 h-9 rounded-full bg-gradient-to-br from-red-500 to-red-600 flex items-center justify-center text-white font-bold text-sm\">\r\n                      {user.name?.charAt(0).toUpperCase() || \"U\"}\r\n                    </div>\r\n                  )}\r\n                  <svg className={`w-4 h-4 text-gray-600 transition-transform ${isUserDropdownOpen ? 'rotate-180' : ''}`} fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\r\n                  </svg>\r\n                </button>\r\n\r\n                {/* User Dropdown Menu */}\r\n                {isUserDropdownOpen && (\r\n                  <div className=\"absolute right-0 top-full mt-2 w-64 bg-white rounded-xl shadow-2xl border border-gray-100 py-2 z-50 animate-in fade-in slide-in-from-top-2 duration-200\">\r\n                    {/* User Info Header */}\r\n                    <div className=\"px-4 py-3 border-b border-gray-100\">\r\n                      <div className=\"flex items-center gap-3\">\r\n                        {user.profileImage ? (\r\n                          <img\r\n                            src={user.profileImage}\r\n                            alt={user.name}\r\n                            className=\"w-11 h-11 rounded-full object-cover border-2 border-gray-200\"\r\n                          />\r\n                        ) : (\r\n                          <div className=\"w-11 h-11 rounded-full bg-gradient-to-br from-red-500 to-red-600 flex items-center justify-center text-white font-bold text-lg\">\r\n                            {user.name?.charAt(0).toUpperCase() || \"U\"}\r\n                          </div>\r\n                        )}\r\n                        <div className=\"flex-1 min-w-0\">\r\n                          <p className=\"font-semibold text-gray-900 truncate\">{user.name}</p>\r\n                          <p className=\"text-xs text-gray-500 truncate\">{user.email}</p>\r\n                          <span className={`inline-block mt-1 px-2 py-0.5 rounded-full text-xs font-medium ${user.role === 'owner' ? 'bg-blue-100 text-blue-700' :\r\n                            user.role === 'agent' ? 'bg-purple-100 text-purple-700' :\r\n                              'bg-gray-100 text-gray-600'\r\n                            }`}>\r\n                            {user.role === 'owner' ? '≡ƒÅá Property Owner' : user.role === 'agent' ? '≡ƒæö Agent' : '≡ƒæñ Buyer'}\r\n                          </span>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n\r\n                    {/* Menu Items */}\r\n                    <div className=\"py-2\">\r\n                      <Link\r\n                        to=\"/notifications\"\r\n                        onClick={() => setIsUserDropdownOpen(false)}\r\n                        className=\"flex items-center gap-3 px-4 py-2.5 text-gray-700 hover:bg-gray-50 transition-colors\"\r\n                      >\r\n                        <div className=\"relative\">\r\n                          <AiOutlineBell className=\"w-5 h-5 text-gray-500\" />\r\n                          {unreadNotifications > 0 && (\r\n                            <span className=\"absolute -top-1 -right-1 w-2 h-2 rounded-full bg-red-500\"></span>\r\n                          )}\r\n                        </div>\r\n                        <span className=\"font-medium\">Notifications</span>\r\n                      </Link>\r\n                      <Link\r\n                        to=\"/profile\"\r\n                        onClick={() => setIsUserDropdownOpen(false)}\r\n                        className=\"flex items-center gap-3 px-4 py-2.5 text-gray-700 hover:bg-gray-50 transition-colors\"\r\n                      >\r\n                        <AiOutlineUser className=\"w-5 h-5 text-gray-500\" />\r\n                        <span className=\"font-medium\">My Profile</span>\r\n                      </Link>\r\n\r\n                      {(user.role === 'owner' || user.role === 'agent') && (\r\n                        <Link\r\n                          to=\"/my-properties\"\r\n                          onClick={() => setIsUserDropdownOpen(false)}\r\n                          className=\"flex items-center gap-3 px-4 py-2.5 text-gray-700 hover:bg-gray-50 transition-colors\"\r\n                        >\r\n                          <BsHouseDoor className=\"w-5 h-5 text-gray-500\" />\r\n                          <span className=\"font-medium\">My Properties</span>\r\n                        </Link>\r\n                      )}\r\n\r\n                      <Link\r\n                        to=\"/saved-properties\"\r\n                        onClick={() => setIsUserDropdownOpen(false)}\r\n                        className=\"flex items-center gap-3 px-4 py-2.5 text-gray-700 hover:bg-gray-50 transition-colors\"\r\n                      >\r\n                        <AiOutlineHeart className=\"w-5 h-5 text-gray-500\" />\r\n                        <span className=\"font-medium\">Saved Properties</span>\r\n                      </Link>\r\n\r\n                      <Link\r\n                        to=\"/agreements\"\r\n                        onClick={() => setIsUserDropdownOpen(false)}\r\n                        className=\"flex items-center gap-3 px-4 py-2.5 text-gray-700 hover:bg-gray-50 transition-colors\"\r\n                      >\r\n                        <HiOutlineDocumentText className=\"w-5 h-5 text-gray-500\" />\r\n                        <span className=\"font-medium\">My Agreements</span>\r\n                      </Link>\r\n                    </div>\r\n\r\n                    {/* Divider */}\r\n                    <div className=\"border-t border-gray-100 my-1\"></div>\r\n\r\n                    {/* Settings & Logout */}\r\n                    <div className=\"py-1\">\r\n                      <Link\r\n                        to=\"/profile?tab=settings\"\r\n                        onClick={() => setIsUserDropdownOpen(false)}\r\n                        className=\"flex items-center gap-3 px-4 py-2.5 text-gray-700 hover:bg-gray-50 transition-colors\"\r\n                      >\r\n                        <AiOutlineSetting className=\"w-5 h-5 text-gray-500\" />\r\n                        <span className=\"font-medium\">Settings</span>\r\n                      </Link>\r\n\r\n                      <button\r\n                        onClick={() => {\r\n                          handleLogout();\r\n                          setIsUserDropdownOpen(false);\r\n                        }}\r\n                        className=\"w-full flex items-center gap-3 px-4 py-2.5 text-red-600 hover:bg-red-50 transition-colors\"\r\n                      >\r\n                        <AiOutlineLogout className=\"w-5 h-5\" />\r\n                        <span className=\"font-medium\">Logout</span>\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            ) : (\r\n              <Link to=\"/login\" className={`flex items-center space-x-1 ${navTextClass} hover:text-red-600 transition-colors duration-200`}>\r\n                <AiOutlineUser className=\"text-lg\" />\r\n                <span className=\"font-medium text-sm\">Login</span>\r\n              </Link>\r\n            )}\r\n          </div>\r\n\r\n          {/* Mobile Menu Toggle */}\r\n          <button\r\n            onClick={toggleMenu}\r\n            className={`lg:hidden text-2xl transition text-gray-700`}\r\n            aria-label={menuOpen ? \"Close menu\" : \"Open menu\"}\r\n          >\r\n            {menuOpen ? <AiOutlineClose /> : <AiOutlineMenu />}\r\n          </button>\r\n        </div>\r\n\r\n        {/* Mobile Menu Overlay */}\r\n        <div\r\n          className={`lg:hidden fixed inset-0 z-[5000] bg-black/50 backdrop-blur-sm transition-opacity duration-300 ${menuOpen ? \"opacity-100 visible\" : \"opacity-0 invisible\"\r\n            }`}\r\n          onClick={toggleMenu}\r\n        />\r\n\r\n        {/* Mobile Menu Drawer */}\r\n        <div\r\n          className={`lg:hidden fixed top-0 right-0 h-full w-[80%] max-w-sm bg-white shadow-2xl z-[5001] transform transition-transform duration-300 ease-out ${menuOpen ? \"translate-x-0\" : \"translate-x-full\"\r\n            }`}\r\n        >\r\n          <div className=\"flex flex-col h-full\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center justify-between p-5 border-b\">\r\n              <span className=\"text-xl font-bold text-slate-800\">Menu</span>\r\n              <button\r\n                onClick={toggleMenu}\r\n                className=\"p-2 text-slate-500 hover:bg-slate-100 rounded-full transition\"\r\n              >\r\n                <AiOutlineClose size={24} />\r\n              </button>\r\n            </div>\r\n\r\n            {/* Links */}\r\n            <div className=\"flex-1 overflow-y-auto py-4 px-3 space-y-2\">\r\n              <Link\r\n                to=\"/\"\r\n                onClick={toggleMenu}\r\n                className=\"flex items-center gap-4 px-4 py-3 text-slate-700 font-medium rounded-xl hover:bg-red-50 hover:text-red-600 transition\"\r\n              >\r\n                <AiOutlineHome size={20} />\r\n                Home\r\n              </Link>\r\n\r\n              <Link\r\n                to=\"/properties\"\r\n                onClick={toggleMenu}\r\n                className=\"flex items-center gap-4 px-4 py-3 text-slate-700 font-medium rounded-xl hover:bg-red-50 hover:text-red-600 transition\"\r\n              >\r\n                <BsBuilding size={20} />\r\n                Properties\r\n              </Link>\r\n\r\n              <Link\r\n                to=\"/pricing\"\r\n                onClick={toggleMenu}\r\n                className=\"flex items-center gap-4 px-4 py-3 text-slate-700 font-medium rounded-xl hover:bg-red-50 hover:text-red-600 transition\"\r\n              >\r\n                <AiOutlineFileText size={20} />\r\n                Pricing & Plans\r\n              </Link>\r\n\r\n              <button\r\n                onClick={() => {\r\n                  handleRegisterProperty();\r\n                  toggleMenu();\r\n                }}\r\n                className=\"w-full flex items-center gap-4 px-4 py-3 text-slate-700 font-medium rounded-xl hover:bg-red-50 hover:text-red-600 transition text-left\"\r\n              >\r\n                <AiOutlinePlusCircle size={20} />\r\n                Register Property\r\n              </button>\r\n\r\n              {showAgentUpload && (\r\n                <button\r\n                  type=\"button\"\r\n                  className=\"w-full flex items-center gap-4 px-4 py-3 text-slate-700 font-medium rounded-xl hover:bg-red-50 hover:text-red-600 transition text-left\"\r\n                  onClick={() => {\r\n                    handleAgentUploadNavigation();\r\n                    if (!isExternalAgentUrl) toggleMenu();\r\n                  }}\r\n                >\r\n                  <AiOutlinePlusCircle size={20} />\r\n                  Upload Property\r\n                </button>\r\n              )}\r\n\r\n              <Link\r\n                to=\"/agreements\"\r\n                onClick={toggleMenu}\r\n                className=\"flex items-center gap-4 px-4 py-3 text-slate-700 font-medium rounded-xl hover:bg-red-50 hover:text-red-600 transition\"\r\n              >\r\n                <AiOutlineFileText size={20} />\r\n                Agreements\r\n              </Link>\r\n\r\n              <Link\r\n                to=\"/about\"\r\n                onClick={toggleMenu}\r\n                className=\"flex items-center gap-4 px-4 py-3 text-slate-700 font-medium rounded-xl hover:bg-red-50 hover:text-red-600 transition\"\r\n              >\r\n                <AiOutlineInfoCircle size={20} />\r\n                About\r\n              </Link>\r\n\r\n              <Link\r\n                to=\"/contact\"\r\n                onClick={toggleMenu}\r\n                className=\"flex items-center gap-4 px-4 py-3 text-slate-700 font-medium rounded-xl hover:bg-red-50 hover:text-red-600 transition\"\r\n              >\r\n                <AiOutlinePhone size={20} />\r\n                Contact\r\n              </Link>\r\n            </div>\r\n\r\n            {/* Footer / User Section */}\r\n            <div className=\"p-5 border-t bg-slate-50\">\r\n              {user ? (\r\n                <div className=\"flex flex-col gap-3\">\r\n                  {/* User Info */}\r\n                  <div className=\"flex items-center gap-3 p-2\">\r\n                    {user.profileImage ? (\r\n                      <img\r\n                        src={user.profileImage}\r\n                        alt={user.name}\r\n                        className=\"w-12 h-12 rounded-full object-cover border-2 border-gray-200\"\r\n                      />\r\n                    ) : (\r\n                      <div className=\"w-12 h-12 bg-gradient-to-br from-red-500 to-red-600 rounded-full flex items-center justify-center text-white font-bold text-lg\">\r\n                        {user.name?.charAt(0).toUpperCase() || \"U\"}\r\n                      </div>\r\n                    )}\r\n                    <div className=\"flex-1\">\r\n                      <p className=\"font-semibold text-slate-800\">{user.name || \"User\"}</p>\r\n                      <p className=\"text-xs text-slate-500 truncate\">{user.email}</p>\r\n                      <span className={`inline-block mt-1 px-2 py-0.5 rounded-full text-xs font-medium ${user.role === 'owner' ? 'bg-blue-100 text-blue-700' :\r\n                        user.role === 'agent' ? 'bg-purple-100 text-purple-700' :\r\n                          'bg-gray-100 text-gray-600'\r\n                        }`}>\r\n                        {user.role === 'owner' ? 'Owner' : user.role === 'agent' ? 'Agent' : 'Buyer'}\r\n                      </span>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Quick Links */}\r\n                  <div className=\"space-y-1\">\r\n                    <Link\r\n                      to=\"/profile\"\r\n                      onClick={toggleMenu}\r\n                      className=\"flex items-center gap-3 px-3 py-2.5 text-slate-700 font-medium rounded-lg hover:bg-white transition\"\r\n                    >\r\n                      <AiOutlineUser size={18} />\r\n                      My Profile\r\n                    </Link>\r\n                    {(user.role === 'owner' || user.role === 'agent') && (\r\n                      <Link\r\n                        to=\"/my-properties\"\r\n                        onClick={toggleMenu}\r\n                        className=\"flex items-center gap-3 px-3 py-2.5 text-slate-700 font-medium rounded-lg hover:bg-white transition\"\r\n                      >\r\n                        <BsHouseDoor size={18} />\r\n                        My Properties\r\n                      </Link>\r\n                    )}\r\n                    <Link\r\n                      to=\"/saved-properties\"\r\n                      onClick={toggleMenu}\r\n                      className=\"flex items-center gap-3 px-3 py-2.5 text-slate-700 font-medium rounded-lg hover:bg-white transition\"\r\n                    >\r\n                      <AiOutlineHeart size={18} />\r\n                      Saved Properties\r\n                    </Link>\r\n                  </div>\r\n\r\n                  {/* Logout Button */}\r\n                  <button\r\n                    onClick={() => { handleLogout(); toggleMenu(); }}\r\n                    className=\"w-full flex items-center justify-center gap-2 bg-white border border-red-200 text-red-600 py-2.5 rounded-lg font-medium hover:bg-red-50 transition mt-2\"\r\n                  >\r\n                    <AiOutlineLogout size={18} />\r\n                    Logout\r\n                  </button>\r\n                </div>\r\n              ) : (\r\n                <Link\r\n                  to=\"/login\"\r\n                  onClick={toggleMenu}\r\n                  className=\"w-full flex items-center justify-center gap-2 bg-slate-900 text-white py-3 rounded-lg font-semibold hover:bg-slate-800 transition\"\r\n                >\r\n                  <AiOutlineLogin size={20} />\r\n                  Login / Sign Up\r\n                </Link>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </nav>\r\n    </>\r\n  );\r\n}\r\n\r\nexport default Navbar;\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\dealdirectcurrentlive\\dealdirect\\client\\src\\Components\\Property\\PropertyFilter.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\dealdirectcurrentlive\\dealdirect\\client\\src\\Components\\Property\\PropertyList.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\dealdirectcurrentlive\\dealdirect\\client\\src\\Components\\SampleAgreement\\AgreementGenerator.jsx","messages":[{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":142,"column":9,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":142,"endColumn":58,"suggestions":[{"messageId":"addBrackets","fix":{"range":[3766,5359],"text":"{ if (!formData.landlordName.trim() || !formData.tenantName.trim()) {\r\n          toast.error(\"Please fill in both Landlord and Tenant names\");\r\n          return false;\r\n        }\r\n        const landlordAge = Number(formData.landlordAge);\r\n        const tenantAge = Number(formData.tenantAge);\r\n        if (!landlordAge || !tenantAge) {\r\n          toast.error(\"Please provide age for both parties\");\r\n          return false;\r\n        }\r\n        if (landlordAge < 18 || tenantAge < 18) {\r\n          toast.error(\"Both landlord and tenant must be at least 18 years old\");\r\n          return false;\r\n        }\r\n        if (!formData.landlordAddress.trim() || !formData.tenantAddress.trim()) {\r\n          toast.error(\"Please provide permanent address for both parties\");\r\n          return false;\r\n        }\r\n        if (formData.landlordPhone && !/^\\d{10}$/.test(formData.landlordPhone)) {\r\n          toast.error(\"Please enter a valid 10-digit landlord phone number\");\r\n          return false;\r\n        }\r\n        if (formData.tenantPhone && !/^\\d{10}$/.test(formData.tenantPhone)) {\r\n          toast.error(\"Please enter a valid 10-digit tenant phone number\");\r\n          return false;\r\n        }\r\n        if (formData.landlordAadhaar && !/^\\d{4}$/.test(formData.landlordAadhaar)) {\r\n          toast.error(\"Landlord Aadhaar should be last 4 digits only\");\r\n          return false;\r\n        }\r\n        if (formData.tenantAadhaar && !/^\\d{4}$/.test(formData.tenantAadhaar)) {\r\n          toast.error(\"Tenant Aadhaar should be last 4 digits only\");\r\n          return false;\r\n        }\r\n        return true; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":143,"column":9,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":143,"endColumn":54,"suggestions":[{"messageId":"addBrackets","fix":{"range":[3766,5359],"text":"{ if (!formData.landlordName.trim() || !formData.tenantName.trim()) {\r\n          toast.error(\"Please fill in both Landlord and Tenant names\");\r\n          return false;\r\n        }\r\n        const landlordAge = Number(formData.landlordAge);\r\n        const tenantAge = Number(formData.tenantAge);\r\n        if (!landlordAge || !tenantAge) {\r\n          toast.error(\"Please provide age for both parties\");\r\n          return false;\r\n        }\r\n        if (landlordAge < 18 || tenantAge < 18) {\r\n          toast.error(\"Both landlord and tenant must be at least 18 years old\");\r\n          return false;\r\n        }\r\n        if (!formData.landlordAddress.trim() || !formData.tenantAddress.trim()) {\r\n          toast.error(\"Please provide permanent address for both parties\");\r\n          return false;\r\n        }\r\n        if (formData.landlordPhone && !/^\\d{10}$/.test(formData.landlordPhone)) {\r\n          toast.error(\"Please enter a valid 10-digit landlord phone number\");\r\n          return false;\r\n        }\r\n        if (formData.tenantPhone && !/^\\d{10}$/.test(formData.tenantPhone)) {\r\n          toast.error(\"Please enter a valid 10-digit tenant phone number\");\r\n          return false;\r\n        }\r\n        if (formData.landlordAadhaar && !/^\\d{4}$/.test(formData.landlordAadhaar)) {\r\n          toast.error(\"Landlord Aadhaar should be last 4 digits only\");\r\n          return false;\r\n        }\r\n        if (formData.tenantAadhaar && !/^\\d{4}$/.test(formData.tenantAadhaar)) {\r\n          toast.error(\"Tenant Aadhaar should be last 4 digits only\");\r\n          return false;\r\n        }\r\n        return true; }"},"desc":"Add {} brackets around the case block."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useRef } from \"react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { toast } from \"react-toastify\";\r\nimport api from \"../../utils/api\";\r\nimport { useAuth } from \"../../context/AuthContext\";\r\nimport ReactMarkdown from \"react-markdown\";\r\nimport {\r\n  FaFileContract,\r\n  FaShieldAlt,\r\n  FaCheckCircle,\r\n  FaLock,\r\n  FaUserCheck,\r\n  FaCertificate,\r\n  FaDownload,\r\n  FaPrint,\r\n  FaCopy,\r\n  FaRedo,\r\n  FaInfoCircle,\r\n  FaBuilding,\r\n  FaUser,\r\n  FaMapMarkerAlt,\r\n  FaCalendarAlt,\r\n  FaRupeeSign,\r\n  FaHome,\r\n  FaSpinner,\r\n  FaLightbulb,\r\n  FaGavel,\r\n  FaEdit,\r\n  FaEye,\r\n  FaArrowLeft,\r\n  FaArrowRight,\r\n  FaMagic,\r\n  FaFilePdf,\r\n} from \"react-icons/fa\";\r\nimport { HiSparkles } from \"react-icons/hi\";\r\n\r\n\r\n\r\nconst INDIAN_STATES = [\r\n  \"Andhra Pradesh\", \"Arunachal Pradesh\", \"Assam\", \"Bihar\", \"Chhattisgarh\",\r\n  \"Delhi\", \"Goa\", \"Gujarat\", \"Haryana\", \"Himachal Pradesh\", \"Jharkhand\",\r\n  \"Karnataka\", \"Kerala\", \"Madhya Pradesh\", \"Maharashtra\", \"Manipur\",\r\n  \"Meghalaya\", \"Mizoram\", \"Nagaland\", \"Odisha\", \"Punjab\", \"Rajasthan\",\r\n  \"Sikkim\", \"Tamil Nadu\", \"Telangana\", \"Tripura\", \"Uttar Pradesh\",\r\n  \"Uttarakhand\", \"West Bengal\", \"Chandigarh\", \"Puducherry\",\r\n];\r\n\r\nfunction AgreementGenerator() {\r\n  const navigate = useNavigate();\r\n  const agreementRef = useRef(null);\r\n  const [step, setStep] = useState(1);\r\n  const [loading, setLoading] = useState(false);\r\n  const [generatedAgreement, setGeneratedAgreement] = useState(null);\r\n  const [isLoggedIn, setIsLoggedIn] = useState(false);\r\n\r\n  const [formData, setFormData] = useState({\r\n    // Landlord Details\r\n    landlordName: \"\",\r\n    landlordAge: \"\",\r\n    landlordAddress: \"\",\r\n    landlordPhone: \"\",\r\n    landlordAadhaar: \"\",\r\n    // Tenant Details\r\n    tenantName: \"\",\r\n    tenantAge: \"\",\r\n    tenantAddress: \"\",\r\n    tenantPhone: \"\",\r\n    tenantAadhaar: \"\",\r\n    // Property Details\r\n    propertyAddress: \"\",\r\n    state: \"\",\r\n    city: \"\",\r\n    propertyType: \"Residential\",\r\n    bhkType: \"\",\r\n    furnishing: \"Unfurnished\",\r\n    carpetArea: \"\",\r\n    // State-specific details\r\n    scheduleEast: \"\",\r\n    scheduleWest: \"\",\r\n    scheduleNorth: \"\",\r\n    scheduleSouth: \"\",\r\n    lockInMonths: \"\",\r\n    includePoliceVerification: false,\r\n    includeForceMajeure: true,\r\n    includeIndemnity: true,\r\n    includeDiplomaticClause: false,\r\n    // Financial Details\r\n    rentAmount: \"\",\r\n    securityDeposit: \"\",\r\n    maintenanceCharges: \"\",\r\n    // Agreement Details\r\n    startDate: \"\",\r\n    durationMonths: 11,\r\n    noticePeriod: 1,\r\n    rentDueDay: 5,\r\n    additionalTerms: \"\",\r\n  });\r\n\r\n  const { isAuthenticated, user } = useAuth();\r\n\r\n  useEffect(() => {\r\n    window.scrollTo({ top: 0, left: 0, behavior: \"auto\" });\r\n    if (isAuthenticated && user) {\r\n      setIsLoggedIn(true);\r\n      // Pre-fill landlord name if user is the owner\r\n      if (user.name) {\r\n        setFormData((prev) => ({ ...prev, landlordName: user.name }));\r\n      }\r\n    } else {\r\n      setIsLoggedIn(false);\r\n    }\r\n  }, [isAuthenticated, user]);\r\n\r\n  // Auto-enable Police Verification clause for Delhi\r\n  useEffect(() => {\r\n    if (!formData.state) return;\r\n    const lower = formData.state.toLowerCase();\r\n    if (lower === \"delhi\" && !formData.includePoliceVerification) {\r\n      setFormData((prev) =>\r\n        prev.includePoliceVerification\r\n          ? prev\r\n          : { ...prev, includePoliceVerification: true }\r\n      );\r\n    }\r\n  }, [formData.state, formData.includePoliceVerification]);\r\n\r\n  const handleChange = (e) => {\r\n    const { name, value, type, checked } = e.target;\r\n    setFormData((prev) => ({\r\n      ...prev,\r\n      [name]: type === \"checkbox\" ? checked : value,\r\n    }));\r\n  };\r\n\r\n  const validateStep = (currentStep) => {\r\n    switch (currentStep) {\r\n      case 1:\r\n        if (!formData.landlordName.trim() || !formData.tenantName.trim()) {\r\n          toast.error(\"Please fill in both Landlord and Tenant names\");\r\n          return false;\r\n        }\r\n        const landlordAge = Number(formData.landlordAge);\r\n        const tenantAge = Number(formData.tenantAge);\r\n        if (!landlordAge || !tenantAge) {\r\n          toast.error(\"Please provide age for both parties\");\r\n          return false;\r\n        }\r\n        if (landlordAge < 18 || tenantAge < 18) {\r\n          toast.error(\"Both landlord and tenant must be at least 18 years old\");\r\n          return false;\r\n        }\r\n        if (!formData.landlordAddress.trim() || !formData.tenantAddress.trim()) {\r\n          toast.error(\"Please provide permanent address for both parties\");\r\n          return false;\r\n        }\r\n        if (formData.landlordPhone && !/^\\d{10}$/.test(formData.landlordPhone)) {\r\n          toast.error(\"Please enter a valid 10-digit landlord phone number\");\r\n          return false;\r\n        }\r\n        if (formData.tenantPhone && !/^\\d{10}$/.test(formData.tenantPhone)) {\r\n          toast.error(\"Please enter a valid 10-digit tenant phone number\");\r\n          return false;\r\n        }\r\n        if (formData.landlordAadhaar && !/^\\d{4}$/.test(formData.landlordAadhaar)) {\r\n          toast.error(\"Landlord Aadhaar should be last 4 digits only\");\r\n          return false;\r\n        }\r\n        if (formData.tenantAadhaar && !/^\\d{4}$/.test(formData.tenantAadhaar)) {\r\n          toast.error(\"Tenant Aadhaar should be last 4 digits only\");\r\n          return false;\r\n        }\r\n        return true;\r\n      case 2:\r\n        if (!formData.propertyAddress.trim() || !formData.state || !formData.city.trim()) {\r\n          toast.error(\"Please fill in all property details\");\r\n          return false;\r\n        }\r\n        if (formData.carpetArea && Number(formData.carpetArea) <= 0) {\r\n          toast.error(\"Carpet area should be a positive number\");\r\n          return false;\r\n        }\r\n        if (formData.state.toLowerCase() === \"karnataka\") {\r\n          const { scheduleEast, scheduleWest, scheduleNorth, scheduleSouth } = formData;\r\n          if (\r\n            !scheduleEast.trim() ||\r\n            !scheduleWest.trim() ||\r\n            !scheduleNorth.trim() ||\r\n            !scheduleSouth.trim()\r\n          ) {\r\n            toast.error(\r\n              \"Please fill the Schedule of Property (East/West/North/South) for Karnataka.\"\r\n            );\r\n            return false;\r\n          }\r\n        }\r\n        return true;\r\n      case 3:\r\n        if (!formData.rentAmount || !formData.securityDeposit || !formData.startDate) {\r\n          toast.error(\"Please fill in all financial and date details\");\r\n          return false;\r\n        }\r\n        if (Number(formData.rentAmount) <= 0 || Number(formData.securityDeposit) <= 0) {\r\n          toast.error(\"Rent and deposit must be positive amounts\");\r\n          return false;\r\n        }\r\n        return true;\r\n      default:\r\n        return true;\r\n    }\r\n  };\r\n\r\n  const nextStep = () => {\r\n    if (validateStep(step)) {\r\n      setStep((prev) => Math.min(prev + 1, 4));\r\n    }\r\n  };\r\n\r\n  const prevStep = () => {\r\n    setStep((prev) => Math.max(prev - 1, 1));\r\n  };\r\n\r\n  const generateAgreement = async () => {\r\n    if (!isLoggedIn) {\r\n      toast.info(\"Please login to generate agreements\");\r\n      navigate(\"/login\", { state: { from: \"/agreements\" } });\r\n      return;\r\n    }\r\n\r\n    if (!validateStep(3)) return;\r\n\r\n    setLoading(true);\r\n    try {\r\n      const response = await api.post(\r\n        `/agreements/generate`,\r\n        formData\r\n      );\r\n\r\n      if (response.data.success) {\r\n        setGeneratedAgreement(response.data);\r\n        setStep(4);\r\n        toast.success(\"Agreement generated successfully!\");\r\n      } else {\r\n        toast.error(response.data.message || \"Failed to generate agreement\");\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Generate agreement error:\", error);\r\n      toast.error(error.response?.data?.message || \"Failed to generate agreement\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const copyToClipboard = () => {\r\n    if (generatedAgreement?.agreement) {\r\n      navigator.clipboard.writeText(generatedAgreement.agreement);\r\n      toast.success(\"Agreement copied to clipboard!\");\r\n    }\r\n  };\r\n\r\n  const printAgreement = () => {\r\n    const printContent = agreementRef.current;\r\n    const printWindow = window.open(\"\", \"\", \"height=800,width=900\");\r\n    printWindow.document.write(`\r\n      <html>\r\n        <head>\r\n          <title>Rental Agreement - ${formData.landlordName}</title>\r\n          <style>\r\n            body { font-family: 'Times New Roman', serif; padding: 40px; line-height: 1.8; }\r\n            h1, h2, h3 { color: #1a1a1a; margin-top: 20px; }\r\n            p { margin: 10px 0; text-align: justify; }\r\n            strong { font-weight: bold; }\r\n            .disclaimer { background: #fff3cd; padding: 15px; border: 1px solid #ffc107; margin: 20px 0; }\r\n          </style>\r\n        </head>\r\n        <body>${printContent.innerHTML}</body>\r\n      </html>\r\n    `);\r\n    printWindow.document.close();\r\n    printWindow.print();\r\n  };\r\n\r\n  const downloadAsText = () => {\r\n    if (generatedAgreement?.agreement) {\r\n      const blob = new Blob([generatedAgreement.agreement], { type: \"text/plain\" });\r\n      const url = URL.createObjectURL(blob);\r\n      const a = document.createElement(\"a\");\r\n      a.href = url;\r\n      a.download = `Agreement_${formData.landlordName}_${formData.tenantName}.txt`;\r\n      a.click();\r\n      URL.revokeObjectURL(url);\r\n      toast.success(\"Agreement downloaded!\");\r\n    }\r\n  };\r\n\r\n  const downloadAsPDF = async () => {\r\n    if (!generatedAgreement?.agreement) return;\r\n\r\n    toast.info(\"Generating PDF... Please wait\");\r\n\r\n    // Create a clean HTML document for PDF generation\r\n    const printWindow = window.open(\"\", \"_blank\");\r\n\r\n    const htmlContent = `\r\n      <!DOCTYPE html>\r\n      <html>\r\n        <head>\r\n          <meta charset=\"UTF-8\">\r\n          <title>Rental Agreement - ${formData.landlordName} & ${formData.tenantName}</title>\r\n          <style>\r\n            * {\r\n              margin: 0;\r\n              padding: 0;\r\n              box-sizing: border-box;\r\n            }\r\n            body {\r\n              font-family: 'Times New Roman', Times, serif;\r\n              font-size: 12pt;\r\n              line-height: 1.6;\r\n              color: #000;\r\n              padding: 40px 50px;\r\n              max-width: 210mm;\r\n              margin: 0 auto;\r\n            }\r\n            h1 {\r\n              font-size: 18pt;\r\n              font-weight: bold;\r\n              text-align: center;\r\n              text-transform: uppercase;\r\n              margin: 20px 0;\r\n              border-bottom: 2px solid #000;\r\n              padding-bottom: 10px;\r\n            }\r\n            h2 {\r\n              font-size: 14pt;\r\n              font-weight: bold;\r\n              text-transform: uppercase;\r\n              margin: 20px 0 10px 0;\r\n              border-bottom: 1px solid #666;\r\n              padding-bottom: 5px;\r\n            }\r\n            h3 {\r\n              font-size: 12pt;\r\n              font-weight: bold;\r\n              margin: 15px 0 8px 0;\r\n            }\r\n            p {\r\n              text-align: justify;\r\n              margin-bottom: 10px;\r\n            }\r\n            strong {\r\n              font-weight: bold;\r\n            }\r\n            em {\r\n              font-style: italic;\r\n            }\r\n            ul, ol {\r\n              margin-left: 25px;\r\n              margin-bottom: 10px;\r\n            }\r\n            li {\r\n              margin-bottom: 5px;\r\n            }\r\n            hr {\r\n              border: none;\r\n              border-top: 1px solid #ccc;\r\n              margin: 20px 0;\r\n            }\r\n            .disclaimer {\r\n              background: #fff8e1;\r\n              border: 1px solid #ffb300;\r\n              padding: 15px;\r\n              margin: 15px 0;\r\n              font-size: 10pt;\r\n            }\r\n            @media print {\r\n              body {\r\n                padding: 20px;\r\n              }\r\n            }\r\n          </style>\r\n        </head>\r\n        <body>\r\n          ${generatedAgreement.agreement\r\n        .replace(/\\*\\*([^*]+)\\*\\*/g, '<strong>$1</strong>')\r\n        .replace(/\\*([^*]+)\\*/g, '<em>$1</em>')\r\n        .replace(/^### (.+)$/gm, '<h3>$1</h3>')\r\n        .replace(/^## (.+)$/gm, '<h2>$1</h2>')\r\n        .replace(/^# (.+)$/gm, '<h1>$1</h1>')\r\n        .replace(/^---$/gm, '<hr>')\r\n        .replace(/^- (.+)$/gm, '<li>$1</li>')\r\n        .replace(/(<li>.*<\\/li>\\n?)+/g, '<ul>$&</ul>')\r\n        .replace(/\\n\\n/g, '</p><p>')\r\n        .replace(/^(?!<[hulo])/gm, '<p>')\r\n        .replace(/(?<![>])$/gm, '</p>')\r\n        .replace(/<p><\\/p>/g, '')\r\n        .replace(/<p>(<[hulo])/g, '$1')\r\n        .replace(/(<\\/[hulo][^>]*>)<\\/p>/g, '$1')\r\n      }\r\n        </body>\r\n      </html>\r\n    `;\r\n\r\n    printWindow.document.write(htmlContent);\r\n    printWindow.document.close();\r\n\r\n    // Wait for content to load then print as PDF\r\n    printWindow.onload = () => {\r\n      setTimeout(() => {\r\n        printWindow.print();\r\n        toast.success(\"Use 'Save as PDF' in the print dialog to download!\");\r\n      }, 500);\r\n    };\r\n  };\r\n\r\n  const resetForm = () => {\r\n    setFormData({\r\n      landlordName: \"\",\r\n      landlordAge: \"\",\r\n      landlordAddress: \"\",\r\n      landlordPhone: \"\",\r\n      landlordAadhaar: \"\",\r\n      tenantName: \"\",\r\n      tenantAge: \"\",\r\n      tenantAddress: \"\",\r\n      tenantPhone: \"\",\r\n      tenantAadhaar: \"\",\r\n      propertyAddress: \"\",\r\n      state: \"\",\r\n      city: \"\",\r\n      propertyType: \"Residential\",\r\n      bhkType: \"\",\r\n      furnishing: \"Unfurnished\",\r\n      carpetArea: \"\",\r\n      rentAmount: \"\",\r\n      securityDeposit: \"\",\r\n      maintenanceCharges: \"\",\r\n      startDate: \"\",\r\n      durationMonths: 11,\r\n      noticePeriod: 1,\r\n      rentDueDay: 5,\r\n      additionalTerms: \"\",\r\n    });\r\n    setGeneratedAgreement(null);\r\n    setStep(1);\r\n  };\r\n\r\n  const isMaharashtra = formData.state.toLowerCase() === \"maharashtra\";\r\n\r\n  // Step indicator component\r\n  const StepIndicator = () => (\r\n    <div className=\"flex items-center justify-center mb-8\">\r\n      {[1, 2, 3, 4].map((s, idx) => (\r\n        <React.Fragment key={s}>\r\n          <div\r\n            className={`flex items-center justify-center w-10 h-10 rounded-full font-bold text-sm transition-all duration-300 ${step >= s\r\n                ? \"bg-blue-600 text-white shadow-lg shadow-blue-500/30\"\r\n                : \"bg-gray-200 text-gray-500\"\r\n              }`}\r\n          >\r\n            {step > s ? <FaCheckCircle /> : s}\r\n          </div>\r\n          {idx < 3 && (\r\n            <div\r\n              className={`w-12 sm:w-20 h-1 mx-1 rounded transition-all duration-300 ${step > s ? \"bg-blue-600\" : \"bg-gray-200\"\r\n                }`}\r\n            />\r\n          )}\r\n        </React.Fragment>\r\n      ))}\r\n    </div>\r\n  );\r\n\r\n  const trustFeatures = [\r\n    { icon: HiSparkles, text: \"AI-Powered\", subtext: \"Smart legal-style drafting\" },\r\n    { icon: FaGavel, text: \"State-Specific\", subtext: \"Compliant with local laws\" },\r\n    { icon: FaLock, text: \"Secure\", subtext: \"Your data is protected\" },\r\n    { icon: FaCertificate, text: \"Professional\", subtext: \"Legal quality drafts\" },\r\n  ];\r\n\r\n  return (\r\n    <div className=\"min-h-screen mt-20 sm:mt-28 py-12 px-4 sm:px-8 lg:px-20 bg-gradient-to-br from-slate-50 to-blue-50/30\">\r\n      {/* Header */}\r\n      <div className=\"text-center mb-12\">\r\n        <div className=\"flex justify-center mb-6\">\r\n          <div className=\"relative\">\r\n            <div className=\"absolute inset-0 bg-gradient-to-r from-blue-400 to-indigo-500 rounded-full blur-xl opacity-40 animate-pulse\"></div>\r\n            <div className=\"relative bg-gradient-to-r from-blue-600 to-indigo-600 p-4 rounded-2xl shadow-xl\">\r\n              <FaFileContract className=\"text-white text-3xl sm:text-4xl\" />\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <h1 className=\"text-3xl sm:text-4xl lg:text-5xl font-bold mb-4 text-gray-900\">\r\n          Digital Agreement Generator\r\n        </h1>\r\n        <p className=\"text-gray-600 max-w-2xl mx-auto text-sm sm:text-base\">\r\n          Generate legally compliant rental agreements instantly using AI.\r\n          Customized for each Indian state with proper legal clauses.\r\n        </p>\r\n\r\n        {/* Trust Badges */}\r\n        <div className=\"grid grid-cols-2 sm:grid-cols-4 gap-4 mt-8 max-w-4xl mx-auto\">\r\n          {trustFeatures.map((feature, index) => (\r\n            <div\r\n              key={index}\r\n              className=\"bg-white/80 backdrop-blur rounded-xl p-4 shadow-sm border border-gray-100 hover:shadow-md transition-all\"\r\n            >\r\n              <feature.icon className=\"text-blue-600 text-xl mx-auto mb-2\" />\r\n              <h3 className=\"font-semibold text-gray-900 text-sm\">{feature.text}</h3>\r\n              <p className=\"text-gray-500 text-xs\">{feature.subtext}</p>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Main Card */}\r\n      <div className=\"max-w-4xl mx-auto\">\r\n        <div className=\"bg-white rounded-3xl shadow-xl border border-gray-100 overflow-hidden\">\r\n          {/* Step Indicator */}\r\n          <div className=\"bg-gradient-to-r from-blue-600 to-indigo-600 px-6 py-6\">\r\n            <div className=\"flex items-center justify-between text-white mb-4\">\r\n              <h2 className=\"text-lg font-semibold\">\r\n                {step === 1 && \"Step 1: Party Details\"}\r\n                {step === 2 && \"Step 2: Property Details\"}\r\n                {step === 3 && \"Step 3: Agreement Terms\"}\r\n                {step === 4 && \"Generated Agreement\"}\r\n              </h2>\r\n              <span className=\"text-blue-100 text-sm\">\r\n                {step < 4 ? `${step}/3` : \"Complete\"}\r\n              </span>\r\n            </div>\r\n            <StepIndicator />\r\n          </div>\r\n\r\n          {/* Form Content */}\r\n          <div className=\"p-6 sm:p-8\">\r\n            {/* Login Notice */}\r\n            {!isLoggedIn && (\r\n              <div className=\"mb-6 p-4 bg-amber-50 border border-amber-200 rounded-xl flex items-center gap-3\">\r\n                <FaLock className=\"text-amber-500 flex-shrink-0\" />\r\n                <div className=\"flex-1\">\r\n                  <p className=\"text-amber-800 text-sm font-medium\">Login Required</p>\r\n                  <p className=\"text-amber-600 text-xs\">Please login to generate agreements.</p>\r\n                </div>\r\n                <button\r\n                  onClick={() => navigate(\"/login\", { state: { from: \"/agreements\" } })}\r\n                  className=\"px-4 py-2 bg-amber-500 text-white text-sm font-medium rounded-lg hover:bg-amber-600 transition-colors\"\r\n                >\r\n                  Login\r\n                </button>\r\n              </div>\r\n            )}\r\n\r\n            {/* Step 1: Party Details */}\r\n            {step === 1 && (\r\n              <div className=\"space-y-6\">\r\n                {/* Landlord Section */}\r\n                <div className=\"bg-blue-50 rounded-xl p-5 border border-blue-100\">\r\n                  <h3 className=\"flex items-center gap-2 font-semibold text-gray-800 mb-4\">\r\n                    <FaUser className=\"text-blue-600\" />\r\n                    {isMaharashtra ? \"Licensor Details\" : \"Landlord Details\"}\r\n                  </h3>\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                    <div className=\"space-y-2\">\r\n                      <label className=\"text-sm font-medium text-gray-700\">Full Name *</label>\r\n                      <input\r\n                        type=\"text\"\r\n                        name=\"landlordName\"\r\n                        value={formData.landlordName}\r\n                        onChange={handleChange}\r\n                        placeholder=\"Enter full legal name\"\r\n                        className=\"w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition-all outline-none\"\r\n                      />\r\n                    </div>\r\n                    <div className=\"space-y-2\">\r\n                      <label className=\"text-sm font-medium text-gray-700\">Age *</label>\r\n                      <input\r\n                        type=\"number\"\r\n                        name=\"landlordAge\"\r\n                        value={formData.landlordAge}\r\n                        onChange={handleChange}\r\n                        placeholder=\"e.g., 35\"\r\n                        className=\"w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition-all outline-none\"\r\n                      />\r\n                    </div>\r\n                    <div className=\"space-y-2 md:col-span-2\">\r\n                      <label className=\"text-sm font-medium text-gray-700\">Permanent Address *</label>\r\n                      <input\r\n                        type=\"text\"\r\n                        name=\"landlordAddress\"\r\n                        value={formData.landlordAddress}\r\n                        onChange={handleChange}\r\n                        placeholder=\"Enter complete permanent address\"\r\n                        className=\"w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition-all outline-none\"\r\n                      />\r\n                    </div>\r\n                    <div className=\"space-y-2\">\r\n                      <label className=\"text-sm font-medium text-gray-700\">Phone Number</label>\r\n                      <input\r\n                        type=\"tel\"\r\n                        name=\"landlordPhone\"\r\n                        value={formData.landlordPhone}\r\n                        onChange={handleChange}\r\n                        placeholder=\"+91 XXXXXXXXXX\"\r\n                        className=\"w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition-all outline-none\"\r\n                      />\r\n                    </div>\r\n                    <div className=\"space-y-2\">\r\n                      <label className=\"text-sm font-medium text-gray-700\">Aadhaar (Last 4 digits)</label>\r\n                      <input\r\n                        type=\"text\"\r\n                        name=\"landlordAadhaar\"\r\n                        value={formData.landlordAadhaar}\r\n                        onChange={handleChange}\r\n                        placeholder=\"XXXX\"\r\n                        maxLength={4}\r\n                        className=\"w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition-all outline-none\"\r\n                      />\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Tenant Section */}\r\n                <div className=\"bg-green-50 rounded-xl p-5 border border-green-100\">\r\n                  <h3 className=\"flex items-center gap-2 font-semibold text-gray-800 mb-4\">\r\n                    <FaUserCheck className=\"text-green-600\" />\r\n                    {isMaharashtra ? \"Licensee Details\" : \"Tenant Details\"}\r\n                  </h3>\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                    <div className=\"space-y-2\">\r\n                      <label className=\"text-sm font-medium text-gray-700\">Full Name *</label>\r\n                      <input\r\n                        type=\"text\"\r\n                        name=\"tenantName\"\r\n                        value={formData.tenantName}\r\n                        onChange={handleChange}\r\n                        placeholder=\"Enter full legal name\"\r\n                        className=\"w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition-all outline-none\"\r\n                      />\r\n                    </div>\r\n                    <div className=\"space-y-2\">\r\n                      <label className=\"text-sm font-medium text-gray-700\">Age *</label>\r\n                      <input\r\n                        type=\"number\"\r\n                        name=\"tenantAge\"\r\n                        value={formData.tenantAge}\r\n                        onChange={handleChange}\r\n                        placeholder=\"e.g., 28\"\r\n                        className=\"w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition-all outline-none\"\r\n                      />\r\n                    </div>\r\n                    <div className=\"space-y-2 md:col-span-2\">\r\n                      <label className=\"text-sm font-medium text-gray-700\">Permanent Address *</label>\r\n                      <input\r\n                        type=\"text\"\r\n                        name=\"tenantAddress\"\r\n                        value={formData.tenantAddress}\r\n                        onChange={handleChange}\r\n                        placeholder=\"Enter complete permanent address\"\r\n                        className=\"w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition-all outline-none\"\r\n                      />\r\n                    </div>\r\n                    <div className=\"space-y-2\">\r\n                      <label className=\"text-sm font-medium text-gray-700\">Phone Number</label>\r\n                      <input\r\n                        type=\"tel\"\r\n                        name=\"tenantPhone\"\r\n                        value={formData.tenantPhone}\r\n                        onChange={handleChange}\r\n                        placeholder=\"+91 XXXXXXXXXX\"\r\n                        className=\"w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition-all outline-none\"\r\n                      />\r\n                    </div>\r\n                    <div className=\"space-y-2\">\r\n                      <label className=\"text-sm font-medium text-gray-700\">Aadhaar (Last 4 digits)</label>\r\n                      <input\r\n                        type=\"text\"\r\n                        name=\"tenantAadhaar\"\r\n                        value={formData.tenantAadhaar}\r\n                        onChange={handleChange}\r\n                        placeholder=\"XXXX\"\r\n                        maxLength={4}\r\n                        className=\"w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition-all outline-none\"\r\n                      />\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Info Box */}\r\n                <div className=\"bg-amber-50 border border-amber-200 rounded-xl p-4 flex items-start gap-3\">\r\n                  <FaInfoCircle className=\"text-amber-500 mt-0.5 flex-shrink-0\" />\r\n                  <div className=\"text-sm text-amber-700\">\r\n                    <p className=\"font-medium\">Privacy Note</p>\r\n                    <p className=\"text-amber-600\">\r\n                      Only the last 4 digits of Aadhaar are stored for reference. Full details should be verified during physical agreement signing.\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* Step 2: Property Details */}\r\n            {step === 2 && (\r\n              <div className=\"space-y-6\">\r\n                {/* State & City */}\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                  <div className=\"space-y-2\">\r\n                    <label className=\"flex items-center gap-2 text-sm font-semibold text-gray-700\">\r\n                      <FaMapMarkerAlt className=\"text-red-500\" />\r\n                      State *\r\n                    </label>\r\n                    <select\r\n                      name=\"state\"\r\n                      value={formData.state}\r\n                      onChange={handleChange}\r\n                      className=\"w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition-all outline-none\"\r\n                    >\r\n                      <option value=\"\">Select State</option>\r\n                      {INDIAN_STATES.map((state) => (\r\n                        <option key={state} value={state}>\r\n                          {state}\r\n                        </option>\r\n                      ))}\r\n                    </select>\r\n                  </div>\r\n\r\n                  <div className=\"space-y-2\">\r\n                    <label className=\"flex items-center gap-2 text-sm font-semibold text-gray-700\">\r\n                      <FaBuilding className=\"text-purple-600\" />\r\n                      City *\r\n                    </label>\r\n                    <input\r\n                      type=\"text\"\r\n                      name=\"city\"\r\n                      value={formData.city}\r\n                      onChange={handleChange}\r\n                      placeholder=\"Enter city name\"\r\n                      className=\"w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition-all outline-none\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Property Address */}\r\n                <div className=\"space-y-2\">\r\n                  <label className=\"flex items-center gap-2 text-sm font-semibold text-gray-700\">\r\n                    <FaHome className=\"text-indigo-600\" />\r\n                    Complete Property Address *\r\n                  </label>\r\n                  <textarea\r\n                    name=\"propertyAddress\"\r\n                    value={formData.propertyAddress}\r\n                    onChange={handleChange}\r\n                    placeholder=\"Enter complete address including flat no., building, street, landmark, PIN code\"\r\n                    rows={3}\r\n                    className=\"w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition-all outline-none resize-none\"\r\n                  />\r\n                </div>\r\n\r\n                {/* Property Type & BHK */}\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\r\n                  <div className=\"space-y-2\">\r\n                    <label className=\"text-sm font-semibold text-gray-700\">Property Type</label>\r\n                    <select\r\n                      name=\"propertyType\"\r\n                      value={formData.propertyType}\r\n                      onChange={handleChange}\r\n                      className=\"w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition-all outline-none\"\r\n                    >\r\n                      <option value=\"Residential\">Residential</option>\r\n                      <option value=\"Commercial\">Commercial</option>\r\n                    </select>\r\n                  </div>\r\n\r\n                  <div className=\"space-y-2\">\r\n                    <label className=\"text-sm font-semibold text-gray-700\">BHK Type</label>\r\n                    <select\r\n                      name=\"bhkType\"\r\n                      value={formData.bhkType}\r\n                      onChange={handleChange}\r\n                      className=\"w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition-all outline-none\"\r\n                    >\r\n                      <option value=\"\">Select BHK</option>\r\n                      <option value=\"1 RK\">1 RK</option>\r\n                      <option value=\"1 BHK\">1 BHK</option>\r\n                      <option value=\"2 BHK\">2 BHK</option>\r\n                      <option value=\"3 BHK\">3 BHK</option>\r\n                      <option value=\"4 BHK\">4 BHK</option>\r\n                      <option value=\"4+ BHK\">4+ BHK</option>\r\n                      <option value=\"Independent House\">Independent House</option>\r\n                      <option value=\"Villa\">Villa</option>\r\n                    </select>\r\n                  </div>\r\n\r\n                  <div className=\"space-y-2\">\r\n                    <label className=\"text-sm font-semibold text-gray-700\">Furnishing</label>\r\n                    <select\r\n                      name=\"furnishing\"\r\n                      value={formData.furnishing}\r\n                      onChange={handleChange}\r\n                      className=\"w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition-all outline-none\"\r\n                    >\r\n                      <option value=\"Unfurnished\">Unfurnished</option>\r\n                      <option value=\"Semi-Furnished\">Semi-Furnished</option>\r\n                      <option value=\"Fully Furnished\">Fully Furnished</option>\r\n                    </select>\r\n                  </div>\r\n\r\n                  <div className=\"space-y-2\">\r\n                    <label className=\"text-sm font-semibold text-gray-700\">Carpet Area (sq.ft)</label>\r\n                    <input\r\n                      type=\"number\"\r\n                      name=\"carpetArea\"\r\n                      value={formData.carpetArea}\r\n                      onChange={handleChange}\r\n                      placeholder=\"e.g., 850\"\r\n                      className=\"w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition-all outline-none\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Maharashtra Notice */}\r\n                {formData.state.toLowerCase() === \"maharashtra\" && (\r\n                  <div className=\"bg-purple-50 border border-purple-200 rounded-xl p-4 flex items-start gap-3\">\r\n                    <FaGavel className=\"text-purple-500 mt-0.5 flex-shrink-0\" />\r\n                    <div className=\"text-sm text-purple-700\">\r\n                      <p className=\"font-medium\">Maharashtra State</p>\r\n                      <p className=\"text-purple-600\">\r\n                        For Maharashtra, a \"Leave and License Agreement\" will be generated\r\n                        as per the Maharashtra Rent Control Act, 1999.\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n\r\n                {/* Karnataka Schedule of Property */}\r\n                {formData.state.toLowerCase() === \"karnataka\" && (\r\n                  <div className=\"bg-indigo-50 border border-indigo-200 rounded-xl p-4 space-y-3\">\r\n                    <div className=\"flex items-start gap-3\">\r\n                      <FaGavel className=\"text-indigo-500 mt-0.5 flex-shrink-0\" />\r\n                      <div className=\"text-sm text-indigo-800\">\r\n                        <p className=\"font-medium\">Karnataka Schedule of Property</p>\r\n                        <p className=\"text-indigo-700 text-xs sm:text-sm\">\r\n                          Karnataka agreements usually carry a clear boundary schedule. Please describe\r\n                          what lies on each side of the property (East / West / North / South).\r\n                        </p>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3 mt-2\">\r\n                      <div className=\"space-y-1\">\r\n                        <label className=\"text-xs sm:text-sm font-semibold text-gray-700\">\r\n                          East Boundary *\r\n                        </label>\r\n                        <input\r\n                          type=\"text\"\r\n                          name=\"scheduleEast\"\r\n                          value={formData.scheduleEast}\r\n                          onChange={handleChange}\r\n                          placeholder=\"e.g., 30 ft road / Neighbor's house\"\r\n                          className=\"w-full px-3 py-2 rounded-lg border border-gray-200 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-100 text-sm outline-none\"\r\n                        />\r\n                      </div>\r\n                      <div className=\"space-y-1\">\r\n                        <label className=\"text-xs sm:text-sm font-semibold text-gray-700\">\r\n                          West Boundary *\r\n                        </label>\r\n                        <input\r\n                          type=\"text\"\r\n                          name=\"scheduleWest\"\r\n                          value={formData.scheduleWest}\r\n                          onChange={handleChange}\r\n                          placeholder=\"e.g., Neighbor's compound wall\"\r\n                          className=\"w-full px-3 py-2 rounded-lg border border-gray-200 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-100 text-sm outline-none\"\r\n                        />\r\n                      </div>\r\n                      <div className=\"space-y-1\">\r\n                        <label className=\"text-xs sm:text-sm font-semibold text-gray-700\">\r\n                          North Boundary *\r\n                        </label>\r\n                        <input\r\n                          type=\"text\"\r\n                          name=\"scheduleNorth\"\r\n                          value={formData.scheduleNorth}\r\n                          onChange={handleChange}\r\n                          placeholder=\"e.g., Open land / Park\"\r\n                          className=\"w-full px-3 py-2 rounded-lg border border-gray-200 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-100 text-sm outline-none\"\r\n                        />\r\n                      </div>\r\n                      <div className=\"space-y-1\">\r\n                        <label className=\"text-xs sm:text-sm font-semibold text-gray-700\">\r\n                          South Boundary *\r\n                        </label>\r\n                        <input\r\n                          type=\"text\"\r\n                          name=\"scheduleSouth\"\r\n                          value={formData.scheduleSouth}\r\n                          onChange={handleChange}\r\n                          placeholder=\"e.g., Existing building\"\r\n                          className=\"w-full px-3 py-2 rounded-lg border border-gray-200 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-100 text-sm outline-none\"\r\n                        />\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            )}\r\n\r\n            {/* Step 3: Agreement Terms */}\r\n            {step === 3 && (\r\n              <div className=\"space-y-6\">\r\n                {/* Financial Details */}\r\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                  <div className=\"space-y-2\">\r\n                    <label className=\"flex items-center gap-2 text-sm font-semibold text-gray-700\">\r\n                      <FaRupeeSign className=\"text-green-600\" />\r\n                      Monthly Rent (INR) *\r\n                    </label>\r\n                    <input\r\n                      type=\"number\"\r\n                      name=\"rentAmount\"\r\n                      value={formData.rentAmount}\r\n                      onChange={handleChange}\r\n                      placeholder=\"e.g., 25000\"\r\n                      className=\"w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition-all outline-none\"\r\n                    />\r\n                  </div>\r\n\r\n                  <div className=\"space-y-2\">\r\n                    <label className=\"flex items-center gap-2 text-sm font-semibold text-gray-700\">\r\n                      <FaShieldAlt className=\"text-blue-600\" />\r\n                      Security Deposit (INR) *\r\n                    </label>\r\n                    <input\r\n                      type=\"number\"\r\n                      name=\"securityDeposit\"\r\n                      value={formData.securityDeposit}\r\n                      onChange={handleChange}\r\n                      placeholder=\"e.g., 50000\"\r\n                      className=\"w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition-all outline-none\"\r\n                    />\r\n                  </div>\r\n\r\n                  <div className=\"space-y-2\">\r\n                    <label className=\"text-sm font-semibold text-gray-700\">\r\n                      Maintenance Charges (INR)\r\n                    </label>\r\n                    <input\r\n                      type=\"number\"\r\n                      name=\"maintenanceCharges\"\r\n                      value={formData.maintenanceCharges}\r\n                      onChange={handleChange}\r\n                      placeholder=\"e.g., 2000 (Optional)\"\r\n                      className=\"w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition-all outline-none\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Duration & Dates */}\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\r\n                  <div className=\"space-y-2\">\r\n                    <label className=\"flex items-center gap-2 text-sm font-semibold text-gray-700\">\r\n                      <FaCalendarAlt className=\"text-orange-500\" />\r\n                      Start Date *\r\n                    </label>\r\n                    <input\r\n                      type=\"date\"\r\n                      name=\"startDate\"\r\n                      value={formData.startDate}\r\n                      onChange={handleChange}\r\n                      className=\"w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition-all outline-none\"\r\n                    />\r\n                  </div>\r\n\r\n                  <div className=\"space-y-2\">\r\n                    <label className=\"text-sm font-semibold text-gray-700\">Duration (Months)</label>\r\n                    <select\r\n                      name=\"durationMonths\"\r\n                      value={formData.durationMonths}\r\n                      onChange={handleChange}\r\n                      className=\"w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition-all outline-none\"\r\n                    >\r\n                      {[6, 11, 12, 24, 36].map((m) => (\r\n                        <option key={m} value={m}>\r\n                          {m} months {m === 11 && \"(Recommended)\"}\r\n                        </option>\r\n                      ))}\r\n                    </select>\r\n                  </div>\r\n\r\n                  <div className=\"space-y-2\">\r\n                    <label className=\"text-sm font-semibold text-gray-700\">Notice Period</label>\r\n                    <select\r\n                      name=\"noticePeriod\"\r\n                      value={formData.noticePeriod}\r\n                      onChange={handleChange}\r\n                      className=\"w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition-all outline-none\"\r\n                    >\r\n                      <option value={1}>1 month</option>\r\n                      <option value={2}>2 months</option>\r\n                      <option value={3}>3 months</option>\r\n                    </select>\r\n                  </div>\r\n\r\n                  <div className=\"space-y-2\">\r\n                    <label className=\"text-sm font-semibold text-gray-700\">Rent Due Day</label>\r\n                    <select\r\n                      name=\"rentDueDay\"\r\n                      value={formData.rentDueDay}\r\n                      onChange={handleChange}\r\n                      className=\"w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition-all outline-none\"\r\n                    >\r\n                      {[1, 5, 7, 10, 15].map((d) => (\r\n                        <option key={d} value={d}>\r\n                          {d}{d === 1 ? \"st\" : d === 5 ? \"th\" : d === 7 ? \"th\" : d === 10 ? \"th\" : \"th\"} of month\r\n                        </option>\r\n                      ))}\r\n                    </select>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Additional Terms */}\r\n                <div className=\"space-y-2\">\r\n                  <label className=\"flex items-center gap-2 text-sm font-semibold text-gray-700\">\r\n                    <FaEdit className=\"text-gray-600\" />\r\n                    Additional Terms (Optional)\r\n                  </label>\r\n                  <textarea\r\n                    name=\"additionalTerms\"\r\n                    value={formData.additionalTerms}\r\n                    onChange={handleChange}\r\n                    placeholder=\"Add any specific terms or conditions you want to include...\"\r\n                    rows={3}\r\n                    className=\"w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition-all outline-none resize-none\"\r\n                  />\r\n                </div>\r\n\r\n                {/* Tip */}\r\n                <div className=\"bg-amber-50 border border-amber-200 rounded-xl p-4 flex items-start gap-3\">\r\n                  <FaLightbulb className=\"text-amber-500 mt-0.5 flex-shrink-0\" />\r\n                  <div className=\"text-sm text-amber-700\">\r\n                    <p className=\"font-medium\">Pro Tip</p>\r\n                    <p className=\"text-amber-600\">\r\n                      11-month agreements are recommended as they don't require mandatory\r\n                      registration under the Registration Act, 1908. However, registration\r\n                      is still advisable for legal protection.\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Quick Review Summary */}\r\n                <div className=\"bg-slate-50 border border-slate-200 rounded-xl p-4 sm:p-5\">\r\n                  <h3 className=\"text-sm font-semibold text-slate-800 mb-3 flex items-center gap-2\">\r\n                    <FaEye className=\"text-blue-600\" />\r\n                    Review before you generate\r\n                  </h3>\r\n                  <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4 text-xs sm:text-sm text-slate-700\">\r\n                    <div className=\"space-y-1\">\r\n                      <p className=\"font-semibold text-slate-900\">Parties</p>\r\n                      <p>\r\n                        <span className=\"font-medium\">Landlord:&nbsp;</span>\r\n                        {formData.landlordName || \"├óΓé¼ΓÇ¥\"}\r\n                      </p>\r\n                      <p>\r\n                        <span className=\"font-medium\">Tenant:&nbsp;</span>\r\n                        {formData.tenantName || \"├óΓé¼ΓÇ¥\"}\r\n                      </p>\r\n                      <p>\r\n                        <span className=\"font-medium\">State / City:&nbsp;</span>\r\n                        {formData.state || \"├óΓé¼ΓÇ¥\"} {formData.city && `├óΓé¼┬ó ${formData.city}`}\r\n                      </p>\r\n                    </div>\r\n                    <div className=\"space-y-1\">\r\n                      <p className=\"font-semibold text-slate-900\">Key Terms</p>\r\n                      <p>\r\n                        <span className=\"font-medium\">Rent:&nbsp;</span>\r\n                        {formData.rentAmount\r\n                          ? `├óΓÇÜ┬╣${Number(formData.rentAmount).toLocaleString(\"en-IN\")}`\r\n                          : \"├óΓé¼ΓÇ¥\"}\r\n                      </p>\r\n                      <p>\r\n                        <span className=\"font-medium\">Deposit:&nbsp;</span>\r\n                        {formData.securityDeposit\r\n                          ? `├óΓÇÜ┬╣${Number(formData.securityDeposit).toLocaleString(\"en-IN\")}`\r\n                          : \"├óΓé¼ΓÇ¥\"}\r\n                      </p>\r\n                      <p>\r\n                        <span className=\"font-medium\">Start / Duration:&nbsp;</span>\r\n                        {formData.startDate || \"├óΓé¼ΓÇ¥\"}\r\n                        {formData.durationMonths && ` ├óΓé¼┬ó ${formData.durationMonths} months`}\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* Step 4: Generated Agreement */}\r\n            {step === 4 && generatedAgreement && (\r\n              <div className=\"space-y-6\">\r\n                {/* Metadata */}\r\n                <div className=\"bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-xl p-5\">\r\n                  <div className=\"flex items-center gap-2 text-green-700 font-semibold mb-4\">\r\n                    <FaCheckCircle className=\"text-xl\" />\r\n                    Agreement Generated Successfully\r\n                  </div>\r\n                  <div className=\"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-4 text-sm\">\r\n                    <div className=\"bg-white/60 rounded-lg p-3\">\r\n                      <p className=\"text-gray-500 text-xs mb-1\">Type</p>\r\n                      <p className=\"font-semibold text-gray-900 text-xs\">{generatedAgreement.metadata?.agreementType || 'Rental Agreement'}</p>\r\n                    </div>\r\n                    <div className=\"bg-white/60 rounded-lg p-3\">\r\n                      <p className=\"text-gray-500 text-xs mb-1\">Duration</p>\r\n                      <p className=\"font-semibold text-gray-900\">{generatedAgreement.metadata?.duration || `${formData.durationMonths} months`}</p>\r\n                    </div>\r\n                    <div className=\"bg-white/60 rounded-lg p-3\">\r\n                      <p className=\"text-gray-500 text-xs mb-1\">Monthly Rent</p>\r\n                      <p className=\"font-semibold text-green-700\">├óΓÇÜ┬╣{Number(formData.rentAmount).toLocaleString('en-IN')}</p>\r\n                    </div>\r\n                    <div className=\"bg-white/60 rounded-lg p-3\">\r\n                      <p className=\"text-gray-500 text-xs mb-1\">Deposit</p>\r\n                      <p className=\"font-semibold text-blue-700\">├óΓÇÜ┬╣{Number(formData.securityDeposit).toLocaleString('en-IN')}</p>\r\n                    </div>\r\n                    <div className=\"bg-white/60 rounded-lg p-3\">\r\n                      <p className=\"text-gray-500 text-xs mb-1\">Start Date</p>\r\n                      <p className=\"font-semibold text-gray-900\">{generatedAgreement.metadata?.startDate || formData.startDate}</p>\r\n                    </div>\r\n                    <div className=\"bg-white/60 rounded-lg p-3\">\r\n                      <p className=\"text-gray-500 text-xs mb-1\">Location</p>\r\n                      <p className=\"font-semibold text-gray-900\">{generatedAgreement.metadata?.city || formData.city}</p>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Action Buttons */}\r\n                <div className=\"flex flex-wrap gap-3\">\r\n                  <button\r\n                    onClick={downloadAsPDF}\r\n                    className=\"flex items-center gap-2 px-5 py-2.5 bg-gradient-to-r from-red-600 to-rose-600 text-white rounded-xl hover:from-red-700 hover:to-rose-700 transition-all shadow-lg shadow-red-500/30 font-medium\"\r\n                  >\r\n                    <FaFilePdf /> Download PDF\r\n                  </button>\r\n                  <button\r\n                    onClick={copyToClipboard}\r\n                    className=\"flex items-center gap-2 px-4 py-2 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200 transition-colors\"\r\n                  >\r\n                    <FaCopy /> Copy\r\n                  </button>\r\n                  <button\r\n                    onClick={printAgreement}\r\n                    className=\"flex items-center gap-2 px-4 py-2 bg-blue-100 text-blue-700 rounded-xl hover:bg-blue-200 transition-colors\"\r\n                  >\r\n                    <FaPrint /> Print\r\n                  </button>\r\n                  <button\r\n                    onClick={downloadAsText}\r\n                    className=\"flex items-center gap-2 px-4 py-2 bg-green-100 text-green-700 rounded-xl hover:bg-green-200 transition-colors\"\r\n                  >\r\n                    <FaDownload /> Text File\r\n                  </button>\r\n                  <button\r\n                    onClick={resetForm}\r\n                    className=\"flex items-center gap-2 px-4 py-2 bg-orange-100 text-orange-700 rounded-xl hover:bg-orange-200 transition-colors\"\r\n                  >\r\n                    <FaRedo /> New Agreement\r\n                  </button>\r\n                </div>\r\n\r\n                {/* Agreement Content */}\r\n                <div\r\n                  ref={agreementRef}\r\n                  className=\"bg-white border-2 border-gray-300 rounded-xl p-8 sm:p-10 max-h-[600px] overflow-y-auto shadow-inner\"\r\n                  style={{\r\n                    fontFamily: \"'Times New Roman', Georgia, serif\",\r\n                    lineHeight: \"1.8\",\r\n                    fontSize: \"14px\",\r\n                    color: \"#1a1a1a\",\r\n                  }}\r\n                >\r\n                  <ReactMarkdown\r\n                    components={{\r\n                      h1: ({ children }) => (\r\n                        <h1 className=\"text-xl font-bold text-center uppercase tracking-wide border-b-2 border-gray-800 pb-3 mb-6 mt-6\">\r\n                          {children}\r\n                        </h1>\r\n                      ),\r\n                      h2: ({ children }) => (\r\n                        <h2 className=\"text-lg font-bold uppercase border-b border-gray-300 pb-2 mt-6 mb-3\">\r\n                          {children}\r\n                        </h2>\r\n                      ),\r\n                      h3: ({ children }) => (\r\n                        <h3 className=\"text-base font-bold mt-4 mb-2\">{children}</h3>\r\n                      ),\r\n                      p: ({ children }) => (\r\n                        <p className=\"text-justify mb-3 leading-relaxed\">{children}</p>\r\n                      ),\r\n                      strong: ({ children }) => (\r\n                        <strong className=\"font-bold text-gray-900\">{children}</strong>\r\n                      ),\r\n                      em: ({ children }) => (\r\n                        <em className=\"italic\">{children}</em>\r\n                      ),\r\n                      ul: ({ children }) => (\r\n                        <ul className=\"list-disc ml-6 mb-3 space-y-1\">{children}</ul>\r\n                      ),\r\n                      ol: ({ children }) => (\r\n                        <ol className=\"list-decimal ml-6 mb-3 space-y-1\">{children}</ol>\r\n                      ),\r\n                      li: ({ children }) => (\r\n                        <li className=\"mb-1\">{children}</li>\r\n                      ),\r\n                      hr: () => (\r\n                        <hr className=\"border-t border-gray-300 my-6\" />\r\n                      ),\r\n                      blockquote: ({ children }) => (\r\n                        <blockquote className=\"bg-amber-50 border-l-4 border-amber-500 pl-4 py-3 my-4 italic\">\r\n                          {children}\r\n                        </blockquote>\r\n                      ),\r\n                    }}\r\n                  >\r\n                    {generatedAgreement.agreement}\r\n                  </ReactMarkdown>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* Navigation Buttons */}\r\n            {step < 4 && (\r\n              <div className=\"flex justify-between mt-8 pt-6 border-t border-gray-100\">\r\n                <button\r\n                  onClick={prevStep}\r\n                  disabled={step === 1}\r\n                  className=\"flex items-center gap-2 px-6 py-3 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                >\r\n                  <FaArrowLeft /> Previous\r\n                </button>\r\n\r\n                {step < 3 ? (\r\n                  <button\r\n                    onClick={nextStep}\r\n                    className=\"flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-xl hover:from-blue-700 hover:to-indigo-700 transition-all shadow-lg shadow-blue-500/30\"\r\n                  >\r\n                    Next <FaArrowRight />\r\n                  </button>\r\n                ) : (\r\n                  <button\r\n                    onClick={generateAgreement}\r\n                    disabled={loading || !isLoggedIn}\r\n                    className=\"flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-green-600 to-emerald-600 text-white rounded-xl hover:from-green-700 hover:to-emerald-700 transition-all shadow-lg shadow-green-500/30 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                  >\r\n                    {loading ? (\r\n                      <>\r\n                        <FaSpinner className=\"animate-spin\" /> Generating...\r\n                      </>\r\n                    ) : (\r\n                      <>\r\n                        <FaMagic /> Generate Agreement\r\n                      </>\r\n                    )}\r\n                  </button>\r\n                )}\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Footer Disclaimer */}\r\n      <div className=\"max-w-4xl mx-auto mt-8 text-center\">\r\n        <div className=\"bg-amber-50 border border-amber-200 rounded-xl p-4\">\r\n          <p className=\"text-amber-800 text-xs sm:text-sm\">\r\n            <strong>├ó┼íΓÇô├»┬╕┬Å Legal Disclaimer:</strong> This is an AI-generated draft for informational purposes only.\r\n            Please verify with a qualified lawyer and ensure proper stamp paper and registration as per the Registration Act, 1908.\r\n          </p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default AgreementGenerator;","usedDeprecatedRules":[]},{"filePath":"D:\\dealdirectcurrentlive\\dealdirect\\client\\src\\Components\\SampleAgreement\\SampleAgreement.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\dealdirectcurrentlive\\dealdirect\\client\\src\\Components\\ScrollToTop\\ScrollToTop.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\dealdirectcurrentlive\\dealdirect\\client\\src\\Components\\TopDevelopers\\TopDevelopers.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\dealdirectcurrentlive\\dealdirect\\client\\src\\Components\\TopLocalities\\TopLocalities.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\dealdirectcurrentlive\\dealdirect\\client\\src\\Components\\VisitModal\\VisitModal.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\dealdirectcurrentlive\\dealdirect\\client\\src\\Pages\\About\\About.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\dealdirectcurrentlive\\dealdirect\\client\\src\\Pages\\About\\Middel.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\dealdirectcurrentlive\\dealdirect\\client\\src\\Pages\\AddProperty\\AddProperty.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'useMemo' is defined but never used. Allowed unused vars must match /^[A-Z_]/u.","line":1,"column":46,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":53,"suggestions":[{"messageId":"removeVar","data":{"varName":"useMemo"},"fix":{"range":[43,52],"text":""},"desc":"Remove unused variable 'useMemo'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'motion' is defined but never used. Allowed unused vars must match /^[A-Z_]/u.","line":9,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":16,"suggestions":[{"messageId":"removeVar","data":{"varName":"motion"},"fix":{"range":[442,449],"text":""},"desc":"Remove unused variable 'motion'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'setImages' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":412,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":412,"endColumn":29,"suggestions":[{"messageId":"removeVar","data":{"varName":"setImages"},"fix":{"range":[20291,20302],"text":""},"desc":"Remove unused variable 'setImages'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'setPreviewImages' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":413,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":413,"endColumn":43,"suggestions":[{"messageId":"removeVar","data":{"varName":"setPreviewImages"},"fix":{"range":[20345,20363],"text":""},"desc":"Remove unused variable 'setPreviewImages'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'isSearchingLocation' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":449,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":449,"endColumn":31,"suggestions":[{"messageId":"removeVar","data":{"varName":"isSearchingLocation"},"fix":{"range":[22650,22669],"text":""},"desc":"Remove unused variable 'isSearchingLocation'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'setIsSearchingLocation' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":449,"column":33,"nodeType":"Identifier","messageId":"unusedVar","endLine":449,"endColumn":55,"suggestions":[{"messageId":"removeVar","data":{"varName":"setIsSearchingLocation"},"fix":{"range":[22669,22693],"text":""},"desc":"Remove unused variable 'setIsSearchingLocation'."}]},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":578,"column":17,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":578,"endColumn":57,"suggestions":[{"messageId":"addBrackets","fix":{"range":[28324,28774],"text":"{ const categories = getImageCategories();\r\n                const exteriorCategory = categories.find(c => ['exterior', 'facade'].includes(c.key));\r\n\r\n                if (exteriorCategory) {\r\n                    const hasExteriorImage = categorizedImages[exteriorCategory.key]?.files?.length > 0;\r\n                    if (!hasExteriorImage) return `Please upload at least one ${exteriorCategory.label} photo.`;\r\n                }\r\n                break; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":579,"column":17,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":579,"endColumn":103,"suggestions":[{"messageId":"addBrackets","fix":{"range":[28324,28774],"text":"{ const categories = getImageCategories();\r\n                const exteriorCategory = categories.find(c => ['exterior', 'facade'].includes(c.key));\r\n\r\n                if (exteriorCategory) {\r\n                    const hasExteriorImage = categorizedImages[exteriorCategory.key]?.files?.length > 0;\r\n                    if (!hasExteriorImage) return `Please upload at least one ${exteriorCategory.label} photo.`;\r\n                }\r\n                break; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'getShortDisplayName' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":1088,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":1088,"endColumn":30,"suggestions":[{"messageId":"removeVar","data":{"varName":"getShortDisplayName"},"fix":{"range":[54120,54596],"text":""},"desc":"Remove unused variable 'getShortDisplayName'."}]}],"suppressedMessages":[],"errorCount":9,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"∩╗┐import React, { useState, useEffect, useRef, useMemo } from \"react\";\r\nimport {\r\n    Home, MapPin, IndianRupee, Layers, Image as ImageIcon, Calendar,\r\n    ChevronLeft, Upload, Check, X, Building2, Users, Utensils, Car, Zap,\r\n    Shield, Store, ArrowRight, FileText, Tag, Wifi, LandPlot, Plus, AlertTriangle, Navigation\r\n} from \"lucide-react\";\r\nimport { toast } from \"react-toastify\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport EmailVerificationModal from \"../../Components/EmailVerificationModal/EmailVerificationModal\";\r\nimport locationData from \"../../data/real-estate-locations.json\";\r\nimport { MapContainer, TileLayer, Marker, useMapEvents, useMap } from \"react-leaflet\";\r\nimport L from \"leaflet\";\r\nimport \"leaflet/dist/leaflet.css\";\r\nimport api from \"../../utils/api\";\r\nimport { useAuth } from \"../../context/AuthContext\";\r\nimport axios from \"axios\"; // Keep for metadata fetching (public endpoints)\r\n\r\n// Fix for default marker icon in react-leaflet\r\ndelete L.Icon.Default.prototype._getIconUrl;\r\nL.Icon.Default.mergeOptions({\r\n    iconRetinaUrl: \"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon-2x.png\",\r\n    iconUrl: \"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png\",\r\n    shadowUrl: \"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png\",\r\n});\r\n\r\n// Custom marker icon\r\nconst customIcon = new L.Icon({\r\n    iconUrl: \"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png\",\r\n    iconRetinaUrl: \"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon-2x.png\",\r\n    shadowUrl: \"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png\",\r\n    iconSize: [25, 41],\r\n    iconAnchor: [12, 41],\r\n    popupAnchor: [1, -34],\r\n    shadowSize: [41, 41]\r\n});\r\n\r\n// Map click handler component\r\nfunction LocationMarker({ position, setPosition, setFormData }) {\r\n    useMapEvents({\r\n        click(e) {\r\n            const { lat, lng } = e.latlng;\r\n            setPosition([lat, lng]);\r\n            setFormData(prev => ({\r\n                ...prev,\r\n                latitude: lat.toFixed(6),\r\n                longitude: lng.toFixed(6)\r\n            }));\r\n        },\r\n    });\r\n\r\n    return position ? <Marker position={position} icon={customIcon} /> : null;\r\n}\r\n\r\n// Component to recenter map\r\nfunction RecenterMap({ position }) {\r\n    const map = useMap();\r\n    useEffect(() => {\r\n        if (position) {\r\n            map.setView(position, 15);\r\n        }\r\n    }, [position, map]);\r\n    return null;\r\n}\r\n\r\n// API Base URL\r\nconst API_BASE = import.meta.env.VITE_API_BASE;\r\n\r\n// Steps\r\nconst STEPS = [\r\n    { id: 1, label: \"Category & Type\", icon: <Home size={18} />, description: \"Property basics\" },\r\n    { id: 2, label: \"Location\", icon: <MapPin size={18} />, description: \"Address details\" },\r\n    { id: 3, label: \"Pricing & Area\", icon: <IndianRupee size={18} />, description: \"Value & size\" },\r\n    { id: 4, label: \"Property Details\", icon: <Layers size={18} />, description: \"Specific features\" },\r\n    { id: 5, label: \"Photos & Docs\", icon: <ImageIcon size={18} />, description: \"Images & documents\" },\r\n    { id: 6, label: \"Review\", icon: <Calendar size={18} />, description: \"Final check\" },\r\n];\r\n\r\n// Categories & types (customized & professional)\r\nconst PROPERTY_CATEGORIES = {\r\n    Residential: {\r\n        icon: <Home size={28} />,\r\n        types: [\r\n            \"Apartment / Flat\",\r\n            \"Independent House\",\r\n            \"Villa\",\r\n            \"Builder Floor\",\r\n            \"Row House\",\r\n            \"Studio Apartment\",\r\n            \"Penthouse\",\r\n            \"Farm House\"\r\n        ],\r\n        desc: \"Homes for living\",\r\n        amenities: [\r\n            \"Lift\", \"Gym\", \"Swimming Pool\", \"Club House\", \"Power Backup\", \"CCTV\", \"Parking Covered\", \"Parking Open\",\r\n            \"Modular Kitchen\", \"Wardrobes\", \"Geyser\", \"AC\", \"Fans\", \"Water Purifier\", \"Intercom\", \"Garden\", \"Jogging Track\",\r\n            \"Kids Play Area\", \"Community Hall\", \"RO Water\", \"Store Room\", \"Servant Room\"\r\n        ]\r\n    },\r\n    Commercial: {\r\n        icon: <Store size={28} />,\r\n        types: [\r\n            \"Office Space\",\r\n            \"Shop / Retail\",\r\n            \"Showroom\",\r\n            \"Restaurant / Cafe\",\r\n            \"Co-Working Space\",\r\n            \"Warehouse / Godown\",\r\n            \"Industrial Shed\",\r\n            \"Commercial Building / Floor\"\r\n        ],\r\n        desc: \"Business spaces\",\r\n        amenities: [\r\n            \"Lift\", \"Power Backup\", \"CCTV\", \"Fire Safety\", \"Reserved Parking\", \"Visitor Parking\", \"Internet\",\r\n            \"Loading Dock\", \"Goods Lift\", \"Sprinkler System\", \"Water Storage\", \"Security\", \"Washrooms\", \"AC\"\r\n        ]\r\n    }\r\n};\r\n\r\n// Commercial property specific configurations\r\nconst COMMERCIAL_CONFIGS = {\r\n    \"Office Space\": {\r\n        icon: <Building2 size={16} />,\r\n        fields: [\"workstations\", \"conferenceRooms\", \"cabins\", \"washrooms\", \"pantry\"],\r\n        label: \"Office Configuration\"\r\n    },\r\n    \"Shop / Retail\": {\r\n        icon: <Store size={16} />,\r\n        fields: [\"frontage\", \"washrooms\", \"storage\", \"displayWindows\"],\r\n        label: \"Shop Configuration\"\r\n    },\r\n    \"Showroom\": {\r\n        icon: <Store size={16} />,\r\n        fields: [\"frontage\", \"washrooms\", \"storage\", \"displayArea\", \"parking\"],\r\n        label: \"Showroom Configuration\"\r\n    },\r\n    \"Restaurant / Cafe\": {\r\n        icon: <Utensils size={16} />,\r\n        fields: [\"seatingCapacity\", \"kitchenArea\", \"washrooms\", \"barArea\", \"outdoorSeating\"],\r\n        label: \"Restaurant Configuration\"\r\n    },\r\n    \"Co-Working Space\": {\r\n        icon: <Users size={16} />,\r\n        fields: [\"workstations\", \"meetingRooms\", \"privateCabins\", \"phoneBooths\", \"loungeArea\"],\r\n        label: \"Co-Working Configuration\"\r\n    },\r\n    \"Warehouse / Godown\": {\r\n        icon: <LandPlot size={16} />,\r\n        fields: [\"loadingDocks\", \"ceilingHeight\", \"floorLoadCapacity\", \"officeSpace\", \"washrooms\"],\r\n        label: \"Warehouse Configuration\"\r\n    },\r\n    \"Industrial Shed\": {\r\n        icon: <Building2 size={16} />,\r\n        fields: [\"ceilingHeight\", \"floorLoadCapacity\", \"powerConnection\", \"overheadCrane\", \"officeSpace\"],\r\n        label: \"Industrial Shed Configuration\"\r\n    },\r\n    \"Commercial Building / Floor\": {\r\n        icon: <Building2 size={16} />,\r\n        fields: [\"washrooms\", \"pantry\", \"centralAC\", \"powerBackup\", \"parking\"],\r\n        label: \"Building Configuration\"\r\n    }\r\n};\r\n\r\n// Amenity mapping for icons\r\nconst AMENITY_ICONS = {\r\n    Lift: <Building2 size={16} />,\r\n    Gym: <Zap size={16} />,\r\n    \"Swimming Pool\": <Zap size={16} />,\r\n    \"Power Backup\": <Zap size={16} />,\r\n    CCTV: <Shield size={16} />,\r\n    \"Parking Covered\": <Car size={16} />,\r\n    \"Parking Open\": <Car size={16} />,\r\n    Internet: <Wifi size={16} />,\r\n    \"Modular Kitchen\": <Utensils size={16} />,\r\n    Security: <Shield size={16} />,\r\n    \"Fire Safety\": <Shield size={16} />,\r\n    \"Loading Dock\": <Car size={16} />\r\n};\r\n\r\n// Image categories based on property type\r\nconst IMAGE_CATEGORIES = {\r\n    Residential: {\r\n        \"Apartment / Flat\": [\r\n            { key: \"exterior\", label: \"Building Exterior\", maxImages: 3, tip: \"Show the building facade and entrance\" },\r\n            { key: \"livingRoom\", label: \"Living Room\", maxImages: 4, tip: \"Main living area with natural lighting\" },\r\n            { key: \"bedroom\", label: \"Bedroom(s)\", maxImages: 4, tip: \"All bedrooms - master and other rooms\" },\r\n            { key: \"bathroom\", label: \"Bathroom(s)\", maxImages: 3, tip: \"Attached and common bathrooms\" },\r\n            { key: \"kitchen\", label: \"Kitchen\", maxImages: 2, tip: \"Kitchen with appliances visible\" },\r\n            { key: \"balcony\", label: \"Balcony / Terrace\", maxImages: 2, tip: \"Balcony view and space\" },\r\n            { key: \"hall\", label: \"Hall / Lobby\", maxImages: 2, tip: \"Building lobby or common areas\" },\r\n            { key: \"parking\", label: \"Parking Area\", maxImages: 2, tip: \"Covered or open parking space\" },\r\n            { key: \"floorPlan\", label: \"Floor Plan\", maxImages: 1, tip: \"2D layout if available\" },\r\n            { key: \"other\", label: \"Other Areas\", maxImages: 5, tip: \"Amenities, garden, pool, etc.\" }\r\n        ],\r\n        \"Independent House\": [\r\n            { key: \"exterior\", label: \"House Exterior\", maxImages: 4 },\r\n            { key: \"livingRoom\", label: \"Living Room\", maxImages: 3 },\r\n            { key: \"bedroom\", label: \"Bedroom(s)\", maxImages: 4 },\r\n            { key: \"bathroom\", label: \"Bathroom(s)\", maxImages: 3 },\r\n            { key: \"kitchen\", label: \"Kitchen\", maxImages: 2 },\r\n            { key: \"garden\", label: \"Garden/Lawn\", maxImages: 3 },\r\n            { key: \"parking\", label: \"Parking\", maxImages: 2 },\r\n            { key: \"floorPlan\", label: \"Floor Plan\", maxImages: 1 },\r\n            { key: \"other\", label: \"Other\", maxImages: 5 }\r\n        ],\r\n        \"Villa\": [\r\n            { key: \"exterior\", label: \"Villa Exterior\", maxImages: 5 },\r\n            { key: \"livingRoom\", label: \"Living Room\", maxImages: 4 },\r\n            { key: \"bedroom\", label: \"Bedroom(s)\", maxImages: 5 },\r\n            { key: \"bathroom\", label: \"Bathroom(s)\", maxImages: 3 },\r\n            { key: \"kitchen\", label: \"Kitchen\", maxImages: 2 },\r\n            { key: \"garden\", label: \"Garden\", maxImages: 3 },\r\n            { key: \"balcony\", label: \"Balcony / Terrace\", maxImages: 3 },\r\n            { key: \"parking\", label: \"Parking\", maxImages: 2 },\r\n            { key: \"floorPlan\", label: \"Floor Plan\", maxImages: 1 },\r\n            { key: \"other\", label: \"Other\", maxImages: 5 }\r\n        ],\r\n        \"Builder Floor\": [\r\n            { key: \"exterior\", label: \"Building Exterior\", maxImages: 2 },\r\n            { key: \"livingRoom\", label: \"Living Room\", maxImages: 3 },\r\n            { key: \"bedroom\", label: \"Bedrooms\", maxImages: 4 },\r\n            { key: \"bathroom\", label: \"Bathroom(s)\", maxImages: 3 },\r\n            { key: \"kitchen\", label: \"Kitchen\", maxImages: 2 },\r\n            { key: \"balcony\", label: \"Balcony\", maxImages: 2 },\r\n            { key: \"parking\", label: \"Parking\", maxImages: 2 },\r\n            { key: \"floorPlan\", label: \"Floor Plan\", maxImages: 1 },\r\n            { key: \"other\", label: \"Other\", maxImages: 5 }\r\n        ],\r\n        \"Studio Apartment\": [\r\n            { key: \"livingRoom\", label: \"Studio Space\", maxImages: 4 },\r\n            { key: \"kitchen\", label: \"Kitchen\", maxImages: 2 },\r\n            { key: \"bathroom\", label: \"Bathroom\", maxImages: 2 },\r\n            { key: \"balcony\", label: \"Balcony / Sit-out\", maxImages: 2 },\r\n            { key: \"other\", label: \"Other\", maxImages: 3 }\r\n        ],\r\n        \"Penthouse\": [\r\n            { key: \"exterior\", label: \"Building & Terrace\", maxImages: 4 },\r\n            { key: \"livingRoom\", label: \"Living Area\", maxImages: 4 },\r\n            { key: \"bedroom\", label: \"Bedroom(s)\", maxImages: 4 },\r\n            { key: \"bathroom\", label: \"Bathroom(s)\", maxImages: 3 },\r\n            { key: \"kitchen\", label: \"Kitchen\", maxImages: 2 },\r\n            { key: \"balcony\", label: \"Balcony\", maxImages: 2 },\r\n            { key: \"hall\", label: \"Lobby / Passage\", maxImages: 2 },\r\n            { key: \"parking\", label: \"Parking\", maxImages: 2 },\r\n            { key: \"floorPlan\", label: \"Floor Plan\", maxImages: 1 },\r\n            { key: \"other\", label: \"Other\", maxImages: 5 }\r\n        ],\r\n        \"Row House\": [\r\n            { key: \"exterior\", label: \"House Exterior\", maxImages: 3 },\r\n            { key: \"livingRoom\", label: \"Living Room\", maxImages: 3 },\r\n            { key: \"bedroom\", label: \"Bedrooms\", maxImages: 4 },\r\n            { key: \"bathroom\", label: \"Bathroom(s)\", maxImages: 3 },\r\n            { key: \"kitchen\", label: \"Kitchen\", maxImages: 2 },\r\n            { key: \"garden\", label: \"Garden / Front Yard\", maxImages: 3 },\r\n            { key: \"parking\", label: \"Parking\", maxImages: 2 },\r\n            { key: \"floorPlan\", label: \"Floor Plan\", maxImages: 1 },\r\n            { key: \"other\", label: \"Other\", maxImages: 5 }\r\n        ],\r\n        \"Farm House\": [\r\n            { key: \"exterior\", label: \"Property Exterior\", maxImages: 5 },\r\n            { key: \"livingRoom\", label: \"Living Space\", maxImages: 3 },\r\n            { key: \"bedroom\", label: \"Bedrooms / Guest Rooms\", maxImages: 4 },\r\n            { key: \"bathroom\", label: \"Bathroom(s)\", maxImages: 3 },\r\n            { key: \"kitchen\", label: \"Kitchen\", maxImages: 2 },\r\n            { key: \"garden\", label: \"Garden / Lawn\", maxImages: 5 },\r\n            { key: \"parking\", label: \"Parking / Driveway\", maxImages: 3 },\r\n            { key: \"floorPlan\", label: \"Floor / Site Plan\", maxImages: 1 },\r\n            { key: \"other\", label: \"Other\", maxImages: 5 }\r\n        ]\r\n    },\r\n    Commercial: {\r\n        // These keys are aligned with Property.categorizedImages.commercial\r\n        \"Office Space\": [\r\n            { key: \"facade\", label: \"Building Exterior\", maxImages: 4, tip: \"Building facade and entrance\" },\r\n            { key: \"reception\", label: \"Reception / Lobby\", maxImages: 3, tip: \"Front desk and waiting area\" },\r\n            { key: \"workArea\", label: \"Open Work Area\", maxImages: 6, tip: \"Main working floor, desks and cubicles\" },\r\n            { key: \"cabin\", label: \"Cabins / Private Rooms\", maxImages: 4, tip: \"Manager and private cabins\" },\r\n            { key: \"conferenceRoom\", label: \"Conference / Meeting Rooms\", maxImages: 3, tip: \"Conference and huddle rooms\" },\r\n            { key: \"pantry\", label: \"Pantry / Cafeteria\", maxImages: 3, tip: \"Pantry, tea/coffee area\" },\r\n            { key: \"washroom\", label: \"Washrooms\", maxImages: 3, tip: \"Restrooms for staff and visitors\" },\r\n            { key: \"parking\", label: \"Parking Area\", maxImages: 3, tip: \"Covered / open parking\" },\r\n            { key: \"floorPlan\", label: \"Floor Plan\", maxImages: 1, tip: \"2D layout if available\" },\r\n            { key: \"other\", label: \"Other Areas\", maxImages: 5, tip: \"Server room, terrace, utilities, etc.\" }\r\n        ],\r\n        \"Shop / Retail\": [\r\n            { key: \"facade\", label: \"Shop Front / Facade\", maxImages: 4, tip: \"Street view and entrance\" },\r\n            { key: \"shopFloor\", label: \"Shop Floor\", maxImages: 6, tip: \"Main retail floor and aisles\" },\r\n            { key: \"displayArea\", label: \"Display / Window Area\", maxImages: 4, tip: \"Display racks and windows\" },\r\n            { key: \"storageArea\", label: \"Back Storage / Inventory\", maxImages: 4, tip: \"Stock room and storage\" },\r\n            { key: \"washroom\", label: \"Washrooms\", maxImages: 2 },\r\n            { key: \"parking\", label: \"Customer Parking\", maxImages: 3 },\r\n            { key: \"floorPlan\", label: \"Floor Plan\", maxImages: 1 },\r\n            { key: \"other\", label: \"Other Areas\", maxImages: 5 }\r\n        ],\r\n        \"Showroom\": [\r\n            { key: \"facade\", label: \"Showroom Exterior\", maxImages: 4 },\r\n            { key: \"reception\", label: \"Reception / Front Desk\", maxImages: 3 },\r\n            { key: \"displayArea\", label: \"Display Area\", maxImages: 6 },\r\n            { key: \"seatingArea\", label: \"Customer Seating / Lounge\", maxImages: 3 },\r\n            { key: \"storageArea\", label: \"Back Office / Storage\", maxImages: 3 },\r\n            { key: \"parking\", label: \"Parking\", maxImages: 3 },\r\n            { key: \"floorPlan\", label: \"Floor Plan\", maxImages: 1 },\r\n            { key: \"other\", label: \"Other Areas\", maxImages: 5 }\r\n        ],\r\n        \"Restaurant / Cafe\": [\r\n            { key: \"facade\", label: \"Exterior / Entrance\", maxImages: 4 },\r\n            { key: \"seatingArea\", label: \"Dining / Seating Area\", maxImages: 6 },\r\n            { key: \"kitchenCommercial\", label: \"Commercial Kitchen\", maxImages: 4 },\r\n            { key: \"washroom\", label: \"Washrooms\", maxImages: 3 },\r\n            { key: \"storageArea\", label: \"Storage / Prep Area\", maxImages: 3 },\r\n            { key: \"parking\", label: \"Parking / Valet Area\", maxImages: 3 },\r\n            { key: \"floorPlan\", label: \"Floor Plan\", maxImages: 1 },\r\n            { key: \"other\", label: \"Other Areas\", maxImages: 5 }\r\n        ],\r\n        \"Co-Working Space\": [\r\n            { key: \"facade\", label: \"Exterior\", maxImages: 3 },\r\n            { key: \"reception\", label: \"Reception / Entry\", maxImages: 3 },\r\n            { key: \"workArea\", label: \"Open Desk Area\", maxImages: 6 },\r\n            { key: \"cabin\", label: \"Private Cabins\", maxImages: 4 },\r\n            { key: \"conferenceRoom\", label: \"Meeting / Conference Rooms\", maxImages: 3 },\r\n            { key: \"seatingArea\", label: \"Lounge / Breakout\", maxImages: 3 },\r\n            { key: \"pantry\", label: \"Pantry / Cafe\", maxImages: 3 },\r\n            { key: \"other\", label: \"Other Areas\", maxImages: 5 }\r\n        ],\r\n        \"Warehouse / Godown\": [\r\n            { key: \"facade\", label: \"Warehouse Exterior\", maxImages: 3 },\r\n            { key: \"warehouse\", label: \"Main Storage Area\", maxImages: 8 },\r\n            { key: \"loadingArea\", label: \"Loading / Unloading Area\", maxImages: 4 },\r\n            { key: \"storageArea\", label: \"Racks / Internal Storage\", maxImages: 4 },\r\n            { key: \"parking\", label: \"Truck / Vehicle Parking\", maxImages: 3 },\r\n            { key: \"floorPlan\", label: \"Site / Floor Plan\", maxImages: 1 },\r\n            { key: \"other\", label: \"Other Areas\", maxImages: 5 }\r\n        ],\r\n        \"Industrial Shed\": [\r\n            { key: \"facade\", label: \"Shed Exterior\", maxImages: 3 },\r\n            { key: \"warehouse\", label: \"Main Production Floor\", maxImages: 8 },\r\n            { key: \"loadingArea\", label: \"Loading / Dock Area\", maxImages: 4 },\r\n            { key: \"storageArea\", label: \"Storage / Raw Material\", maxImages: 4 },\r\n            { key: \"parking\", label: \"Parking / Yard\", maxImages: 3 },\r\n            { key: \"floorPlan\", label: \"Layout / Floor Plan\", maxImages: 1 },\r\n            { key: \"other\", label: \"Other Areas\", maxImages: 5 }\r\n        ],\r\n        \"Commercial Building / Floor\": [\r\n            { key: \"facade\", label: \"Building Exterior\", maxImages: 4 },\r\n            { key: \"reception\", label: \"Main Lobby / Reception\", maxImages: 3 },\r\n            { key: \"workArea\", label: \"Typical Floor / Work Area\", maxImages: 6 },\r\n            { key: \"cabin\", label: \"Cabins / Offices\", maxImages: 4 },\r\n            { key: \"conferenceRoom\", label: \"Conference Rooms\", maxImages: 3 },\r\n            { key: \"parking\", label: \"Parking Levels\", maxImages: 4 },\r\n            { key: \"floorPlan\", label: \"Floor Plan\", maxImages: 2 },\r\n            { key: \"other\", label: \"Other Areas\", maxImages: 5 }\r\n        ]\r\n    }\r\n};\r\n\r\n// Animation variants\r\nconst variants = {\r\n    enter: (direction) => ({\r\n        x: direction > 0 ? 20 : -20,\r\n        opacity: 0,\r\n    }),\r\n    center: {\r\n        x: 0,\r\n        opacity: 1,\r\n    },\r\n    exit: (direction) => ({\r\n        x: direction < 0 ? 20 : -20,\r\n        opacity: 0,\r\n    }),\r\n};\r\n\r\nexport default function AddProperty() {\r\n    const navigate = useNavigate();\r\n\r\n    // Auth state using AuthContext\r\n    const { user: authUser, isAuthenticated, loading: authLoading } = useAuth();\r\n    const [user, setUser] = useState(null);\r\n    const [showVerificationModal, setShowVerificationModal] = useState(false);\r\n    const [isAuthorized, setIsAuthorized] = useState(false);\r\n\r\n    // Check user authorization on mount using AuthContext\r\n    useEffect(() => {\r\n        if (authLoading) return;\r\n\r\n        if (!isAuthenticated || !authUser) {\r\n            toast.error(\"Please login to list your property\");\r\n            navigate(\"/login\");\r\n            return;\r\n        }\r\n\r\n        setUser(authUser);\r\n        const role = authUser.role || \"user\";\r\n        if (role === \"owner\" || role === \"agent\") {\r\n            setIsAuthorized(true);\r\n        } else {\r\n            setShowVerificationModal(true);\r\n        }\r\n    }, [authLoading, isAuthenticated, authUser, navigate]);\r\n\r\n    const handleVerificationSuccess = () => {\r\n        // User state will be automatically updated via AuthContext's checkAuth\r\n        // which runs after successful verification completes\r\n        setIsAuthorized(true);\r\n        setShowVerificationModal(false);\r\n        toast.success(\"You can now list your property!\");\r\n    };\r\n\r\n    // UI state\r\n    const [currentStep, setCurrentStep] = useState(1);\r\n    const [direction, setDirection] = useState(0);\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const [images, setImages] = useState([]);\r\n    const [previewImages, setPreviewImages] = useState([]);\r\n    const [categorizedImages, setCategorizedImages] = useState({});\r\n    const [expandedCategories, setExpandedCategories] = useState([]);\r\n\r\n    const [metadata, setMetadata] = useState({\r\n        categories: [],\r\n        subcategories: [],\r\n        propertyTypes: []\r\n    });\r\n\r\n    const [formData, setFormData] = useState({\r\n        listingType: \"Rent\", propertyCategory: \"Residential\", propertyType: \"Apartment / Flat\",\r\n        bhkType: \"\", bedrooms: \"\", bathrooms: 1, balconies: 0,\r\n        builtUpArea: \"\", carpetArea: \"\", superBuiltUpArea: \"\", plotArea: \"\",\r\n        expectedPrice: \"\", maintenanceIncluded: true, maintenance: \"\", expectedDeposit: \"\", bookingAmount: \"\", priceNegotiable: false, gstApplicable: false,\r\n        furnishing: \"Unfurnished\", floorNo: \"\", totalFloors: \"\", propertyAge: \"New\", facing: \"\", constructionStatus: \"Ready to Move\",\r\n        commercialSubType: \"\", washrooms: 1, loadingArea: \"\", dockAvailable: false, shutters: \"\", floorHeight: \"\",\r\n        workstations: \"\", conferenceRooms: \"\", cabins: \"\", pantry: \"\", frontage: \"\", storage: \"\", displayWindows: \"\", displayArea: \"\",\r\n        seatingCapacity: \"\", kitchenArea: \"\", barArea: \"\", outdoorSeating: \"\", meetingRooms: \"\", privateCabins: \"\", phoneBooths: \"\", loungeArea: \"\",\r\n        loadingDocks: \"\", ceilingHeight: \"\", floorLoadCapacity: \"\", powerConnection: \"\", overheadCrane: \"\", centralAC: \"\", powerBackup: \"\",\r\n        parkingCovered: 0, parkingOpen: 0, selectedAmenities: [],\r\n        servantRoom: false, poojaRoom: false, studyRoom: false, storeRoom: false,\r\n        reraId: \"\", occupancyCertificate: false, tradeLicense: false, fireNoc: false,\r\n        availableFrom: new Date().toISOString().split('T')[0], petFriendly: \"No\", allowedFor: \"Family\", ageOfProperty: \"\",\r\n        city: \"\", locality: \"\", landmark: \"\", address: \"\", nearby: [],\r\n        latitude: \"\", longitude: \"\",\r\n        description: \"\", videoUrl: \"\", showHelpTips: true\r\n    });\r\n\r\n    // Map state\r\n    const [mapPosition, setMapPosition] = useState(null);\r\n    const [isLocating, setIsLocating] = useState(false);\r\n    const defaultCenter = [20.5937, 78.9629]; // Center of India\r\n\r\n    // Location autocomplete state\r\n    const [locationSuggestions, setLocationSuggestions] = useState([]);\r\n    const [isSearchingLocation, setIsSearchingLocation] = useState(false);\r\n    const [activeLocationField, setActiveLocationField] = useState(null); // 'city', 'locality', or 'address'\r\n    const [showSuggestions, setShowSuggestions] = useState(false);\r\n    const searchTimeoutRef = useRef(null);\r\n    const geocodeTimeoutRef = useRef(null);\r\n    const suggestionsRef = useRef(null);\r\n\r\n    // Fetch metadata\r\n    useEffect(() => {\r\n        const fetchMetadata = async () => {\r\n            try {\r\n                const [cats, subs, types] = await Promise.all([\r\n                    api.get('/categories/list-category'),\r\n                    api.get('/subcategories/list'),\r\n                    api.get('/propertyTypes/list-propertytype')\r\n                ]);\r\n                setMetadata({\r\n                    categories: Array.isArray(cats.data) ? cats.data : [],\r\n                    subcategories: Array.isArray(subs.data) ? subs.data : [],\r\n                    propertyTypes: Array.isArray(types.data) ? types.data : []\r\n                });\r\n            } catch (error) {\r\n                console.error(\"Failed to fetch metadata\", error);\r\n            }\r\n        };\r\n        fetchMetadata();\r\n    }, []);\r\n\r\n    const isResidential = formData.propertyCategory === \"Residential\";\r\n    const isCommercial = formData.propertyCategory === \"Commercial\";\r\n    const commercialConfig = isCommercial ? COMMERCIAL_CONFIGS[formData.propertyType] : null;\r\n\r\n    const handleChange = (e) => {\r\n        const { name, value, type, checked } = e.target;\r\n        setFormData(prev => ({ ...prev, [name]: type === \"checkbox\" ? checked : value }));\r\n    };\r\n\r\n    const handleAmenityToggle = (amenity) => {\r\n        setFormData(prev => {\r\n            const list = prev.selectedAmenities || [];\r\n            return {\r\n                ...prev,\r\n                selectedAmenities: list.includes(amenity) ? list.filter(a => a !== amenity) : [...list, amenity]\r\n            };\r\n        });\r\n    };\r\n\r\n    const handleCategoryChange = (category) => {\r\n        const defaultType = PROPERTY_CATEGORIES[category].types[0];\r\n        setFormData(prev => ({\r\n            ...prev,\r\n            propertyCategory: category,\r\n            propertyType: defaultType,\r\n            bhkType: category === \"Residential\" ? prev.bhkType : \"\",\r\n            furnishing: category === \"Residential\" ? prev.furnishing : \"Bare Shell\",\r\n            commercialSubType: category === \"Commercial\" ? prev.commercialSubType : \"\",\r\n        }));\r\n    };\r\n\r\n    const handlePropertyTypeChange = (type) => {\r\n        setFormData(prev => ({\r\n            ...prev,\r\n            propertyType: type,\r\n            bhkType: type.includes(\"Studio\") ? \"Studio\" : prev.bhkType\r\n        }));\r\n    };\r\n\r\n    const getImageCategories = () => {\r\n        if (isResidential) return IMAGE_CATEGORIES.Residential[formData.propertyType] || IMAGE_CATEGORIES.Residential[\"Apartment / Flat\"];\r\n        else if (isCommercial) return IMAGE_CATEGORIES.Commercial[formData.propertyType] || IMAGE_CATEGORIES.Commercial[\"Office Space\"];\r\n        return [];\r\n    };\r\n\r\n    const handleCategorizedImageUpload = (categoryKey, e) => {\r\n        const files = Array.from(e.target.files || []);\r\n        if (!files.length) return;\r\n        const category = getImageCategories().find(c => c.key === categoryKey);\r\n        const maxImages = category?.maxImages || 5;\r\n        const currentImages = categorizedImages[categoryKey]?.files || [];\r\n        if (files.length + currentImages.length > maxImages) return toast.error(`Maximum ${maxImages} images allowed`);\r\n        const newPreviews = files.map(file => URL.createObjectURL(file));\r\n        setCategorizedImages(prev => ({\r\n            ...prev,\r\n            [categoryKey]: {\r\n                files: [...(prev[categoryKey]?.files || []), ...files],\r\n                previews: [...(prev[categoryKey]?.previews || []), ...newPreviews]\r\n            }\r\n        }));\r\n    };\r\n\r\n    const removeCategorizedImage = (categoryKey, index) => {\r\n        setCategorizedImages(prev => ({\r\n            ...prev,\r\n            [categoryKey]: {\r\n                files: prev[categoryKey]?.files?.filter((_, i) => i !== index) || [],\r\n                previews: prev[categoryKey]?.previews?.filter((_, i) => i !== index) || []\r\n            }\r\n        }));\r\n    };\r\n\r\n    const getTotalCategorizedImages = () => {\r\n        return Object.values(categorizedImages).reduce((total, cat) => total + (cat.files?.length || 0), 0);\r\n    };\r\n\r\n    const toggleCategory = (categoryKey) => {\r\n        setExpandedCategories(prev =>\r\n            prev.includes(categoryKey) ? prev.filter(k => k !== categoryKey) : [...prev, categoryKey]\r\n        );\r\n    };\r\n\r\n    // Validation\r\n    const validateStep = (step) => {\r\n        const f = formData;\r\n        switch (step) {\r\n            case 1:\r\n                if (!f.propertyCategory || !f.propertyType) return \"Please choose category and type.\";\r\n                if (isResidential && !f.bhkType && !f.propertyType.toLowerCase().includes(\"studio\")) return \"Please choose BHK.\";\r\n                break;\r\n            case 2:\r\n                if (!f.city || !f.locality) return \"City and Locality are required.\";\r\n                break;\r\n            case 3:\r\n                if (!f.expectedPrice) return \"Please enter expected price.\";\r\n                if (!f.builtUpArea && !(isCommercial && f.propertyType.toLowerCase().includes(\"warehouse\"))) return \"Built-up area is required.\";\r\n                break;\r\n            case 4:\r\n                if (isResidential && !f.bedrooms && !f.bhkType.includes(\"Studio\")) return \"Please confirm bedrooms.\";\r\n                break;\r\n            case 5:\r\n                const categories = getImageCategories();\r\n                const exteriorCategory = categories.find(c => ['exterior', 'facade'].includes(c.key));\r\n\r\n                if (exteriorCategory) {\r\n                    const hasExteriorImage = categorizedImages[exteriorCategory.key]?.files?.length > 0;\r\n                    if (!hasExteriorImage) return `Please upload at least one ${exteriorCategory.label} photo.`;\r\n                }\r\n                break;\r\n            default: break;\r\n        }\r\n        return null;\r\n    };\r\n\r\n    const handleNext = () => {\r\n        const error = validateStep(currentStep);\r\n        if (error) return toast.error(error);\r\n        setDirection(1);\r\n        setCurrentStep(prev => Math.min(prev + 1, 6));\r\n    };\r\n\r\n    const handlePrev = () => {\r\n        setDirection(-1);\r\n        setCurrentStep(prev => Math.max(prev - 1, 1));\r\n    };\r\n\r\n    const findObjectId = (name, type) => {\r\n        if (!metadata[type] || !metadata[type].length) return null;\r\n        let match = metadata[type].find(item => item.name === name) ||\r\n            metadata[type].find(item => item.name.toLowerCase() === name.toLowerCase()) ||\r\n            metadata[type].find(item => item.name.toLowerCase().includes(name.toLowerCase()));\r\n        return match ? match._id : null;\r\n    };\r\n\r\n    // Lightweight number helpers to keep payload clean\r\n    const toNumber = (val) => {\r\n        const num = Number(val);\r\n        return Number.isFinite(num) ? num : undefined;\r\n    };\r\n\r\n    const roundTo = (val, digits = 2) => {\r\n        if (!Number.isFinite(val)) return undefined;\r\n        const factor = 10 ** digits;\r\n        return Math.round(val * factor) / factor;\r\n    };\r\n\r\n    const handleSubmit = async () => {\r\n        setIsLoading(true);\r\n        try {\r\n            const priceValue = toNumber(formData.expectedPrice);\r\n            if (priceValue === undefined) {\r\n                toast.error(\"Please enter a valid price amount.\");\r\n                setIsLoading(false);\r\n                return;\r\n            }\r\n\r\n            const submitData = new FormData();\r\n            const categoryId = findObjectId(formData.propertyCategory, 'categories');\r\n            const propertyTypeId = findObjectId(formData.propertyType, 'propertyTypes');\r\n\r\n            if (!categoryId && !metadata.categories.length) {\r\n                toast.error(\"Categories not loaded. Please retry in a moment.\");\r\n                setIsLoading(false);\r\n                return;\r\n            }\r\n\r\n            if (!propertyTypeId && !metadata.propertyTypes.length) {\r\n                toast.error(\"Property types not loaded. Please retry in a moment.\");\r\n                setIsLoading(false);\r\n                return;\r\n            }\r\n\r\n            submitData.append(\"propertyType\", propertyTypeId || (metadata.propertyTypes[0]?._id));\r\n            submitData.append(\"propertyTypeName\", formData.propertyType);\r\n            submitData.append(\"category\", categoryId || (metadata.categories[0]?._id));\r\n            submitData.append(\"categoryName\", formData.propertyCategory);\r\n            submitData.append(\"title\", generateTitle());\r\n            submitData.append(\"description\", formData.description || generateShortDescription());\r\n            submitData.append(\"price\", priceValue);\r\n            submitData.append(\"listingType\", formData.listingType);\r\n            submitData.append(\"priceUnit\", formData.listingType === \"Rent\" ? \"Monthly\" : \"Total\");\r\n            submitData.append(\"negotiable\", formData.priceNegotiable ? \"true\" : \"false\");\r\n            submitData.append(\"gstApplicable\", formData.gstApplicable ? \"Yes\" : \"No\");\r\n            submitData.append(\"city\", formData.city);\r\n            submitData.append(\"locality\", formData.locality);\r\n            if (formData.bookingAmount) submitData.append(\"bookingAmount\", toNumber(formData.bookingAmount) ?? formData.bookingAmount);\r\n            if (formData.videoUrl) submitData.append(\"videoUrl\", formData.videoUrl.trim());\r\n            if (formData.ageOfProperty || formData.propertyAge) submitData.append(\"ageOfProperty\", formData.ageOfProperty || formData.propertyAge);\r\n\r\n            const builtUp = toNumber(formData.builtUpArea);\r\n            const carpet = toNumber(formData.carpetArea);\r\n            const superBuilt = toNumber(formData.superBuiltUpArea);\r\n            const plot = toNumber(formData.plotArea);\r\n            const totalSqft = builtUp || carpet || superBuilt || plot;\r\n            const pricePerSqft = totalSqft ? roundTo(priceValue / totalSqft) : undefined;\r\n            const areaData = {\r\n                builtUpSqft: builtUp,\r\n                carpetSqft: carpet,\r\n                superBuiltUpSqft: superBuilt,\r\n                plotSqft: plot,\r\n                totalSqft,\r\n                pricePerSqft\r\n            };\r\n            submitData.append(\"area\", JSON.stringify(areaData));\r\n\r\n            const addressData = {\r\n                city: formData.city,\r\n                area: formData.locality,\r\n                line: formData.address,\r\n                landmark: formData.landmark,\r\n                nearby: Array.isArray(formData.nearby)\r\n                    ? formData.nearby\r\n                    : (formData.nearby ? formData.nearby.split(',').map(item => item.trim()).filter(Boolean) : []),\r\n                latitude: formData.latitude ? parseFloat(formData.latitude) : null,\r\n                longitude: formData.longitude ? parseFloat(formData.longitude) : null\r\n            };\r\n            submitData.append(\"address\", JSON.stringify(addressData));\r\n\r\n            // Add coordinates separately for easy access\r\n            if (formData.latitude && formData.longitude) {\r\n                submitData.append(\"latitude\", formData.latitude);\r\n                submitData.append(\"longitude\", formData.longitude);\r\n            }\r\n\r\n            let featuresData = {\r\n                listingType: formData.listingType,\r\n                parking: {\r\n                    covered: toNumber(formData.parkingCovered) ?? 0,\r\n                    open: toNumber(formData.parkingOpen) ?? 0\r\n                },\r\n                amenities: formData.selectedAmenities || [],\r\n                availableFrom: formData.availableFrom ? new Date(formData.availableFrom).toISOString() : undefined,\r\n                deposit: toNumber(formData.expectedDeposit) ?? formData.expectedDeposit,\r\n                securityDeposit: toNumber(formData.expectedDeposit) ?? formData.expectedDeposit,\r\n                maintenance: formData.maintenanceIncluded ? \"Included\" : (toNumber(formData.maintenance) ?? formData.maintenance),\r\n                maintenanceIncluded: formData.maintenanceIncluded,\r\n            };\r\n\r\n            if (isResidential) {\r\n                featuresData = { ...featuresData, bhk: formData.bhkType, bedrooms: formData.bedrooms, bathrooms: formData.bathrooms, balconies: formData.balconies, furnishing: formData.furnishing, floorNo: formData.floorNo, totalFloors: formData.totalFloors, facing: formData.facing, constructionStatus: formData.constructionStatus, propertyAge: formData.propertyAge, extras: { servantRoom: formData.servantRoom, poojaRoom: formData.poojaRoom, studyRoom: formData.studyRoom, storeRoom: formData.storeRoom }, allowedFor: formData.allowedFor, petFriendly: formData.petFriendly };\r\n            } else {\r\n                featuresData = { ...featuresData, commercialSubType: formData.commercialSubType, washrooms: formData.washrooms, loadingArea: formData.loadingArea, dockAvailable: formData.dockAvailable, shutters: formData.shutters, floorHeight: formData.floorHeight, powerLoad: formData.powerLoad };\r\n                if (commercialConfig) commercialConfig.fields.forEach(field => { if (formData[field]) featuresData[field] = formData[field]; });\r\n            }\r\n\r\n            submitData.append(\"features\", JSON.stringify(featuresData));\r\n\r\n            const legalData = { reraId: formData.reraId, occupancyCertificate: !!formData.occupancyCertificate, tradeLicense: !!formData.tradeLicense, fireNoc: !!formData.fireNoc };\r\n            submitData.append(\"legal\", JSON.stringify(legalData));\r\n\r\n            images.forEach(file => submitData.append(\"images\", file));\r\n\r\n            const imageCategoryMap = {};\r\n            Object.entries(categorizedImages).forEach(([categoryKey, data]) => {\r\n                if (data.files && data.files.length > 0) {\r\n                    data.files.forEach((file, index) => {\r\n                        submitData.append(`categorizedImages`, file);\r\n                        if (!imageCategoryMap[categoryKey]) imageCategoryMap[categoryKey] = [];\r\n                        imageCategoryMap[categoryKey].push(index);\r\n                    });\r\n                }\r\n            });\r\n            submitData.append(\"imageCategoryMap\", JSON.stringify(imageCategoryMap));\r\n\r\n            // Use api.js for authenticated request\r\n            await api.post('/properties/add', submitData, {\r\n                headers: { \"Content-Type\": \"multipart/form-data\" }\r\n            });\r\n\r\n            toast.success(\"Property published successfully!\");\r\n            navigate(\"/\");\r\n        } catch (error) {\r\n            console.error(\"Submission failed\", error);\r\n            toast.error(error.response?.data?.message || \"Failed to publish property\");\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    const generateTitle = () => {\r\n        const parts = [];\r\n        if (isResidential) { if (formData.bhkType) parts.push(formData.bhkType); }\r\n        parts.push(formData.propertyType);\r\n        parts.push(formData.listingType === \"Rent\" ? \"for Rent\" : \"for Sale\");\r\n        if (formData.locality) parts.push(`in ${formData.locality}`);\r\n        return parts.filter(Boolean).join(\" \");\r\n    };\r\n\r\n    const generateShortDescription = () => formData.description || `${generateTitle()} | ${formData.builtUpArea || \"Area not specified\"} sq.ft`;\r\n\r\n    // Common Styles (UPDATED: Blue focus ring instead of red)\r\n    const inputStyle = \"w-full px-4 py-3 rounded-xl border border-gray-300 bg-white text-gray-900 placeholder:text-gray-400 focus:border-blue-600 focus:ring-1 focus:ring-blue-600 outline-none transition-all\";\r\n    const labelStyle = \"text-sm font-semibold text-gray-700 mb-1 block\";\r\n    const cardStyle = \"bg-white p-6 rounded-2xl border border-gray-200 shadow-sm\";\r\n\r\n    // Render Steps\r\n    const renderStep1 = () => (\r\n        <div className=\"space-y-6\">\r\n            <div className=\"text-center\">\r\n                <h2 className=\"text-3xl font-bold text-gray-900\">Basics</h2>\r\n                <p className=\"text-gray-500 mt-2\">Choose category and type. We'll show only relevant fields next.</p>\r\n            </div>\r\n\r\n            <div className=\"text-sm font-semibold text-gray-900 uppercase tracking-wider\">Property Category</div>\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                {Object.entries(PROPERTY_CATEGORIES).map(([key, value]) => (\r\n                    <div key={key}\r\n                        // UPDATED: Blue theme for selected category\r\n                        className={`cursor-pointer rounded-2xl p-4 flex gap-4 items-center transition-all ${formData.propertyCategory === key ? \"bg-blue-50 border-2 border-blue-200 text-blue-700 shadow-sm\" : \"bg-white border border-gray-200 hover:bg-gray-50 text-gray-700\"}`}\r\n                        onClick={() => handleCategoryChange(key)}\r\n                    >\r\n                        {/* UPDATED: Blue icon background */}\r\n                        <div className={`p-3 rounded-full ${formData.propertyCategory === key ? \"bg-blue-100 text-blue-600\" : \"bg-gray-100 text-gray-600\"}`}>\r\n                            {value.icon}\r\n                        </div>\r\n                        <div>\r\n                            <div className=\"font-bold\">{key}</div>\r\n                            {/* UPDATED: Blue subtitle text */}\r\n                            <div className={`text-xs ${formData.propertyCategory === key ? \"text-blue-500\" : \"text-gray-500\"}`}>{value.desc}</div>\r\n                        </div>\r\n                        {/* UPDATED: Blue Checkmark */}\r\n                        {formData.propertyCategory === key && <div className=\"ml-auto text-blue-600\"><Check size={18} /></div>}\r\n                    </div>\r\n                ))}\r\n            </div>\r\n\r\n            <div>\r\n                <label className=\"text-sm font-semibold text-gray-900 uppercase tracking-wider\">Property Type</label>\r\n                <div className=\"flex flex-wrap gap-3 mt-2\">\r\n                    {PROPERTY_CATEGORIES[formData.propertyCategory].types.map(type => (\r\n                        <button key={type} onClick={() => handlePropertyTypeChange(type)}\r\n                            // UPDATED: Blue background for active button, Blue hover for inactive\r\n                            className={`px-4 py-2 rounded-xl border text-sm font-medium transition-all ${formData.propertyType === type ? \"bg-blue-600 text-white border-blue-600 shadow-md\" : \"bg-white text-gray-600 border-gray-300 hover:bg-blue-50 hover:border-blue-200\"}`}>\r\n                            {type}\r\n                        </button>\r\n                    ))}\r\n                </div>\r\n            </div>\r\n\r\n            {isResidential && (\r\n                <div>\r\n                    <label className=\"text-sm font-semibold text-gray-900 uppercase tracking-wider\">BHK Configuration</label>\r\n                    <div className=\"flex flex-wrap gap-3 mt-2\">\r\n                        {[\"1 RK\", \"1 BHK\", \"2 BHK\", \"3 BHK\", \"4 BHK\", \"5+ BHK\", \"Studio\"].map(bhk => (\r\n                            <button key={bhk} onClick={() => setFormData(p => ({ ...p, bhkType: bhk, bedrooms: bhk === \"Studio\" ? 0 : (bhk.split(\" \")[0]) }))}\r\n                                // UPDATED: Blue background for active button\r\n                                className={`px-4 py-2 rounded-xl border text-sm font-medium transition-all ${formData.bhkType === bhk ? \"bg-blue-600 text-white border-blue-600 shadow-md\" : \"bg-white text-gray-600 border-gray-300 hover:bg-blue-50 hover:border-blue-200\"}`}>\r\n                                {bhk}\r\n                            </button>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {isCommercial && (\r\n                <div>\r\n                    <label className=\"text-sm font-semibold text-gray-900 uppercase tracking-wider\">Commercial Sub-type</label>\r\n                    <div className=\"flex flex-wrap gap-3 mt-2\">\r\n                        {[\"Bare Shell\", \"Warm Shell\", \"Fully Furnished\"].map(subType => (\r\n                            <button key={subType} onClick={() => setFormData(p => ({ ...p, commercialSubType: subType }))}\r\n                                // UPDATED: Blue background for active button\r\n                                className={`px-4 py-2 rounded-xl border text-sm font-medium transition-all ${formData.commercialSubType === subType ? \"bg-blue-600 text-white border-blue-600 shadow-md\" : \"bg-white text-gray-600 border-gray-300 hover:bg-blue-50 hover:border-blue-200\"}`}>\r\n                                {subType}\r\n                            </button>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n\r\n    // Get current location using Geolocation API\r\n    const getCurrentLocation = () => {\r\n        if (!navigator.geolocation) {\r\n            toast.error(\"Geolocation is not supported by your browser\");\r\n            return;\r\n        }\r\n\r\n        setIsLocating(true);\r\n\r\n        // First try with high accuracy (GPS)\r\n        const tryGetLocation = (highAccuracy, timeout) => {\r\n            return new Promise((resolve, reject) => {\r\n                navigator.geolocation.getCurrentPosition(resolve, reject, {\r\n                    enableHighAccuracy: highAccuracy,\r\n                    timeout: timeout,\r\n                    maximumAge: 60000 // Allow cached position up to 1 minute old\r\n                });\r\n            });\r\n        };\r\n\r\n        // Try high accuracy first, then fall back to low accuracy\r\n        tryGetLocation(true, 15000)\r\n            .catch(() => {\r\n                console.log(\"High accuracy failed, trying low accuracy...\");\r\n                return tryGetLocation(false, 20000);\r\n            })\r\n            .then((position) => {\r\n                const { latitude, longitude } = position.coords;\r\n                setMapPosition([latitude, longitude]);\r\n                setFormData(prev => ({\r\n                    ...prev,\r\n                    latitude: latitude.toFixed(6),\r\n                    longitude: longitude.toFixed(6)\r\n                }));\r\n                setIsLocating(false);\r\n                toast.success(\"Location detected successfully!\");\r\n\r\n                // Reverse geocode to get address details\r\n                reverseGeocode(latitude, longitude);\r\n            })\r\n            .catch((error) => {\r\n                setIsLocating(false);\r\n                console.error(\"Geolocation error:\", error);\r\n                switch (error.code) {\r\n                    case 1: // PERMISSION_DENIED\r\n                        toast.error(\"Location permission denied. Please enable it in your browser settings.\");\r\n                        break;\r\n                    case 2: // POSITION_UNAVAILABLE\r\n                        toast.error(\"Location unavailable. Please check your GPS/network settings.\");\r\n                        break;\r\n                    case 3: // TIMEOUT\r\n                        toast.error(\"Location request timed out. Please try again or enter location manually.\");\r\n                        break;\r\n                    default:\r\n                        toast.error(\"Could not get your location. Please enter it manually.\");\r\n                }\r\n            });\r\n    };\r\n\r\n    // Reverse geocode to get address from coordinates\r\n    const reverseGeocode = async (lat, lng) => {\r\n        try {\r\n            const response = await axios.get(\r\n                `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&addressdetails=1&zoom=18`,\r\n                { headers: { 'Accept-Language': 'en' } }\r\n            );\r\n            if (response.data && response.data.address) {\r\n                const addr = response.data.address;\r\n\r\n                // Extract city (try multiple fields)\r\n                const city = addr.city || addr.town || addr.village || addr.state_district || addr.county || '';\r\n\r\n                // Extract locality/area\r\n                const locality = addr.suburb || addr.neighbourhood || addr.hamlet || addr.residential || addr.quarter || '';\r\n\r\n                // Extract landmark (nearby point of interest)\r\n                const landmark = addr.amenity || addr.building || addr.shop || addr.tourism || addr.leisure || '';\r\n\r\n                // Build a cleaner address line\r\n                const addressParts = [];\r\n                if (addr.house_number) addressParts.push(addr.house_number);\r\n                if (addr.road || addr.street) addressParts.push(addr.road || addr.street);\r\n                if (locality) addressParts.push(locality);\r\n                if (city) addressParts.push(city);\r\n                if (addr.state) addressParts.push(addr.state);\r\n                if (addr.postcode) addressParts.push(addr.postcode);\r\n\r\n                const formattedAddress = addressParts.length > 0\r\n                    ? addressParts.join(', ')\r\n                    : response.data.display_name;\r\n\r\n                setFormData(prev => ({\r\n                    ...prev,\r\n                    city: city || prev.city,\r\n                    locality: locality || prev.locality,\r\n                    address: formattedAddress || prev.address,\r\n                    landmark: landmark || prev.landmark\r\n                }));\r\n\r\n                toast.success(\"Address details filled from your location!\");\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Reverse geocoding failed:\", error);\r\n            toast.error(\"Could not fetch address details. Please enter manually.\");\r\n        }\r\n    };\r\n\r\n    // Forward geocode when user types address/locality/city manually\r\n    const forwardGeocode = async (query) => {\r\n        if (!query || query.length < 3) return;\r\n        try {\r\n            const response = await axios.get(\"https://nominatim.openstreetmap.org/search\", {\r\n                params: { format: \"json\", q: query, addressdetails: 1, limit: 1 },\r\n                headers: { \"Accept-Language\": \"en\" }\r\n            });\r\n\r\n            const best = response.data?.[0];\r\n            if (!best) return;\r\n\r\n            const lat = parseFloat(best.lat);\r\n            const lon = parseFloat(best.lon);\r\n\r\n            if (Number.isFinite(lat) && Number.isFinite(lon)) {\r\n                const latFixed = lat.toFixed(6);\r\n                const lonFixed = lon.toFixed(6);\r\n\r\n                setFormData(prev => {\r\n                    if (prev.latitude === latFixed && prev.longitude === lonFixed) return prev;\r\n                    return { ...prev, latitude: latFixed, longitude: lonFixed };\r\n                });\r\n\r\n                setMapPosition([lat, lon]);\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Forward geocoding failed:\", error);\r\n        }\r\n    };\r\n\r\n    // Search locations using local JSON data\r\n    const searchLocations = (query, fieldType) => {\r\n        setActiveLocationField(fieldType);\r\n        setShowSuggestions(true);\r\n\r\n        const suggestions = [];\r\n        const searchTerm = (query || '').toLowerCase().trim();\r\n\r\n        if (fieldType === 'city') {\r\n            // Search cities\r\n            locationData.cities.forEach(city => {\r\n                if (!searchTerm || city.name.toLowerCase().includes(searchTerm)) {\r\n                    suggestions.push({\r\n                        type: 'city',\r\n                        city: city.name,\r\n                        locality: '',\r\n                        project: '',\r\n                        display_name: city.name,\r\n                        shortName: city.name\r\n                    });\r\n                }\r\n            });\r\n        } else if (fieldType === 'locality') {\r\n            // Search areas/localities within selected city or all cities\r\n            const selectedCity = formData.city?.toLowerCase();\r\n\r\n            locationData.cities.forEach(city => {\r\n                // If city is selected, only search within that city\r\n                if (selectedCity && city.name.toLowerCase() !== selectedCity) return;\r\n\r\n                city.areas.forEach(area => {\r\n                    if (!searchTerm || area.name.toLowerCase().includes(searchTerm)) {\r\n                        suggestions.push({\r\n                            type: 'locality',\r\n                            city: city.name,\r\n                            locality: area.name,\r\n                            project: '',\r\n                            display_name: `${area.name}, ${city.name}`,\r\n                            shortName: `${area.name}, ${city.name}`,\r\n                            projects: area.projects\r\n                        });\r\n                    }\r\n                });\r\n            });\r\n        } else if (fieldType === 'address' || fieldType === 'project') {\r\n            // Search ALL - cities, areas, and projects for comprehensive suggestions\r\n            const selectedCity = formData.city?.toLowerCase();\r\n            const selectedLocality = formData.locality?.toLowerCase();\r\n\r\n            locationData.cities.forEach(city => {\r\n                // If no city selected, also show matching cities\r\n                if (!selectedCity && (!searchTerm || city.name.toLowerCase().includes(searchTerm))) {\r\n                    suggestions.push({\r\n                        type: 'city',\r\n                        city: city.name,\r\n                        locality: '',\r\n                        project: '',\r\n                        display_name: city.name,\r\n                        shortName: city.name\r\n                    });\r\n                }\r\n\r\n                if (selectedCity && city.name.toLowerCase() !== selectedCity) return;\r\n\r\n                city.areas.forEach(area => {\r\n                    // If no locality selected, also show matching areas\r\n                    if (!selectedLocality && (!searchTerm || area.name.toLowerCase().includes(searchTerm))) {\r\n                        suggestions.push({\r\n                            type: 'locality',\r\n                            city: city.name,\r\n                            locality: area.name,\r\n                            project: '',\r\n                            display_name: `${area.name}, ${city.name}`,\r\n                            shortName: `${area.name}, ${city.name}`\r\n                        });\r\n                    }\r\n\r\n                    if (selectedLocality && area.name.toLowerCase() !== selectedLocality) return;\r\n\r\n                    // Always search projects\r\n                    area.projects.forEach(project => {\r\n                        if (!searchTerm || project.toLowerCase().includes(searchTerm)) {\r\n                            suggestions.push({\r\n                                type: 'project',\r\n                                city: city.name,\r\n                                locality: area.name,\r\n                                project: project,\r\n                                display_name: `${project}, ${area.name}, ${city.name}`,\r\n                                shortName: `${project}, ${area.name}`\r\n                            });\r\n                        }\r\n                    });\r\n                });\r\n            });\r\n        }\r\n\r\n        // Limit suggestions\r\n        setLocationSuggestions(suggestions.slice(0, 15));\r\n        setShowSuggestions(suggestions.length > 0);\r\n    };\r\n\r\n    // Get a shorter display name for suggestions\r\n    const getShortDisplayName = (item) => {\r\n        const parts = [];\r\n        const addr = item.address;\r\n\r\n        if (addr?.suburb || addr?.neighbourhood) parts.push(addr.suburb || addr.neighbourhood);\r\n        if (addr?.city || addr?.town || addr?.village) parts.push(addr.city || addr.town || addr.village);\r\n        if (addr?.state) parts.push(addr.state);\r\n\r\n        return parts.length > 0 ? parts.join(', ') : item.display_name?.split(',').slice(0, 3).join(',');\r\n    };\r\n\r\n    // Handle location input change\r\n    const handleLocationInputChange = (e, fieldType) => {\r\n        const { name, value } = e.target;\r\n        setFormData(prev => ({ ...prev, [name]: value }));\r\n        setActiveLocationField(fieldType);\r\n\r\n        // Clear previous timeout\r\n        if (searchTimeoutRef.current) {\r\n            clearTimeout(searchTimeoutRef.current);\r\n        }\r\n\r\n        // Debounce the search - search immediately for local data\r\n        searchTimeoutRef.current = setTimeout(() => {\r\n            searchLocations(value, fieldType);\r\n        }, 100);\r\n    };\r\n\r\n    // Handle input focus - show suggestions immediately on focus\r\n    const handleLocationFocus = (fieldType, value) => {\r\n        setActiveLocationField(fieldType);\r\n        // Show suggestions immediately when focused, even without typing\r\n        searchLocations(value || '', fieldType);\r\n    };\r\n\r\n    // Handle input blur - delay to allow click on suggestions\r\n    const handleLocationBlur = () => {\r\n        setTimeout(() => {\r\n            setShowSuggestions(false);\r\n        }, 200);\r\n    };\r\n\r\n    // Handle suggestion selection\r\n    const handleSuggestionSelect = (suggestion) => {\r\n        const updates = {};\r\n\r\n        // Update fields based on suggestion type and active field\r\n        if (suggestion.type === 'city' || activeLocationField === 'city') {\r\n            updates.city = suggestion.city;\r\n            // Clear locality when city changes\r\n            if (formData.city !== suggestion.city) {\r\n                updates.locality = '';\r\n                updates.address = '';\r\n            }\r\n        }\r\n\r\n        if (suggestion.type === 'locality' || activeLocationField === 'locality') {\r\n            updates.locality = suggestion.locality;\r\n            if (suggestion.city) updates.city = suggestion.city;\r\n        }\r\n\r\n        if (suggestion.type === 'project' || activeLocationField === 'address') {\r\n            updates.address = suggestion.project || suggestion.display_name;\r\n            if (suggestion.city) updates.city = suggestion.city;\r\n            if (suggestion.locality) updates.locality = suggestion.locality;\r\n        }\r\n\r\n        setFormData(prev => ({ ...prev, ...updates }));\r\n        setLocationSuggestions([]);\r\n        setShowSuggestions(false);\r\n        setActiveLocationField(null);\r\n    };\r\n\r\n    // Debounce forward geocoding as user types address/locality/city\r\n    useEffect(() => {\r\n        const query = [formData.address, formData.locality, formData.city]\r\n            .filter(Boolean)\r\n            .join(\", \");\r\n\r\n        if (geocodeTimeoutRef.current) clearTimeout(geocodeTimeoutRef.current);\r\n\r\n        if (!query || query.length < 3) return;\r\n\r\n        geocodeTimeoutRef.current = setTimeout(() => {\r\n            forwardGeocode(query);\r\n        }, 800);\r\n\r\n        return () => {\r\n            if (geocodeTimeoutRef.current) clearTimeout(geocodeTimeoutRef.current);\r\n        };\r\n    }, [formData.address, formData.locality, formData.city]);\r\n\r\n    // Close suggestions when clicking outside\r\n    useEffect(() => {\r\n        const handleClickOutside = (event) => {\r\n            if (suggestionsRef.current && !suggestionsRef.current.contains(event.target)) {\r\n                setShowSuggestions(false);\r\n            }\r\n        };\r\n\r\n        document.addEventListener('mousedown', handleClickOutside);\r\n        return () => document.removeEventListener('mousedown', handleClickOutside);\r\n    }, []);\r\n\r\n    const renderStep2 = () => (\r\n        <div className=\"space-y-6\">\r\n            <div className=\"text-center\">\r\n                <h2 className=\"text-3xl font-bold text-gray-900\">Location</h2>\r\n                <p className=\"text-gray-500 mt-2\">Accurate location increases trust and discoverability.</p>\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                {/* City Field with Autocomplete */}\r\n                <div className=\"relative\">\r\n                    <label className={labelStyle}>City</label>\r\n                    <div className=\"relative\">\r\n                        <input\r\n                            name=\"city\"\r\n                            value={formData.city}\r\n                            onChange={(e) => handleLocationInputChange(e, 'city')}\r\n                            onFocus={() => handleLocationFocus('city', formData.city)}\r\n                            onBlur={handleLocationBlur}\r\n                            placeholder=\"Click to select city...\"\r\n                            className={inputStyle}\r\n                            autoComplete=\"off\"\r\n                        />\r\n                    </div>\r\n                    {/* City Suggestions Dropdown */}\r\n                    {showSuggestions && activeLocationField === 'city' && locationSuggestions.length > 0 && (\r\n                        <div ref={suggestionsRef} className=\"absolute z-50 w-full mt-1 bg-white border border-gray-200 rounded-xl shadow-lg max-h-60 overflow-y-auto\">\r\n                            {locationSuggestions.map((suggestion, index) => (\r\n                                <div\r\n                                    key={index}\r\n                                    onMouseDown={(e) => e.preventDefault()}\r\n                                    onClick={() => handleSuggestionSelect(suggestion)}\r\n                                    className=\"px-4 py-3 hover:bg-blue-50 cursor-pointer border-b border-gray-100 last:border-b-0 transition-colors\"\r\n                                >\r\n                                    <div className=\"flex items-center gap-2\">\r\n                                        <MapPin size={16} className=\"text-blue-600 flex-shrink-0\" />\r\n                                        <span className=\"font-medium text-gray-900 text-sm\">{suggestion.city}</span>\r\n                                    </div>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                {/* Locality Field with Autocomplete */}\r\n                <div className=\"relative\">\r\n                    <label className={labelStyle}>Locality / Area</label>\r\n                    <div className=\"relative\">\r\n                        <input\r\n                            name=\"locality\"\r\n                            value={formData.locality}\r\n                            onChange={(e) => handleLocationInputChange(e, 'locality')}\r\n                            onFocus={() => handleLocationFocus('locality', formData.locality)}\r\n                            onBlur={handleLocationBlur}\r\n                            placeholder={formData.city ? `Select area in ${formData.city}...` : \"Select city first...\"}\r\n                            className={inputStyle}\r\n                            autoComplete=\"off\"\r\n                        />\r\n                    </div>\r\n                    {/* Locality Suggestions Dropdown */}\r\n                    {showSuggestions && activeLocationField === 'locality' && locationSuggestions.length > 0 && (\r\n                        <div ref={suggestionsRef} className=\"absolute z-50 w-full mt-1 bg-white border border-gray-200 rounded-xl shadow-lg max-h-60 overflow-y-auto\">\r\n                            {locationSuggestions.map((suggestion, index) => (\r\n                                <div\r\n                                    key={index}\r\n                                    onMouseDown={(e) => e.preventDefault()}\r\n                                    onClick={() => handleSuggestionSelect(suggestion)}\r\n                                    className=\"px-4 py-3 hover:bg-blue-50 cursor-pointer border-b border-gray-100 last:border-b-0 transition-colors\"\r\n                                >\r\n                                    <div className=\"flex items-center gap-2\">\r\n                                        <Building2 size={16} className=\"text-green-600 flex-shrink-0\" />\r\n                                        <div>\r\n                                            <span className=\"font-medium text-gray-900 text-sm\">{suggestion.locality}</span>\r\n                                            {suggestion.city && <span className=\"text-xs text-gray-500 ml-1\">({suggestion.city})</span>}\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Project/Society Name Field with Autocomplete */}\r\n            <div className=\"relative z-40\">\r\n                <label className={labelStyle}>Project / Society Name</label>\r\n                <div className=\"relative\">\r\n                    <input\r\n                        name=\"address\"\r\n                        value={formData.address}\r\n                        onChange={(e) => handleLocationInputChange(e, 'address')}\r\n                        onFocus={() => handleLocationFocus('address', formData.address)}\r\n                        onBlur={handleLocationBlur}\r\n                        placeholder=\"Search city, area or project name...\"\r\n                        className={inputStyle}\r\n                        autoComplete=\"off\"\r\n                    />\r\n                </div>\r\n                {/* Project Suggestions Dropdown */}\r\n                {showSuggestions && activeLocationField === 'address' && locationSuggestions.length > 0 && (\r\n                    <div ref={suggestionsRef} className=\"absolute z-[100] w-full mt-1 bg-white border border-gray-200 rounded-xl shadow-2xl max-h-64 overflow-y-auto\">\r\n                        {locationSuggestions.map((suggestion, index) => (\r\n                            <div\r\n                                key={index}\r\n                                onMouseDown={(e) => e.preventDefault()}\r\n                                onClick={() => handleSuggestionSelect(suggestion)}\r\n                                className=\"px-4 py-2.5 hover:bg-blue-50 cursor-pointer border-b border-gray-100 last:border-b-0 transition-colors\"\r\n                            >\r\n                                <div className=\"flex items-center gap-3\">\r\n                                    {suggestion.type === 'city' && (\r\n                                        <MapPin size={16} className=\"text-blue-600 flex-shrink-0\" />\r\n                                    )}\r\n                                    {suggestion.type === 'locality' && (\r\n                                        <Building2 size={16} className=\"text-green-600 flex-shrink-0\" />\r\n                                    )}\r\n                                    {suggestion.type === 'project' && (\r\n                                        <Home size={16} className=\"text-orange-600 flex-shrink-0\" />\r\n                                    )}\r\n                                    <div className=\"flex-1 min-w-0\">\r\n                                        <div className=\"font-medium text-gray-900 text-sm truncate\">\r\n                                            {suggestion.type === 'city' && suggestion.city}\r\n                                            {suggestion.type === 'locality' && suggestion.locality}\r\n                                            {suggestion.type === 'project' && suggestion.project}\r\n                                        </div>\r\n                                        <div className=\"text-xs text-gray-500 truncate\">\r\n                                            {suggestion.type === 'city' && 'City'}\r\n                                            {suggestion.type === 'locality' && `Area in ${suggestion.city}`}\r\n                                            {suggestion.type === 'project' && `${suggestion.locality}, ${suggestion.city}`}\r\n                                        </div>\r\n                                    </div>\r\n                                    <span className={`text-xs px-2 py-0.5 rounded-full flex-shrink-0 ${suggestion.type === 'city' ? 'bg-blue-100 text-blue-700' :\r\n                                        suggestion.type === 'locality' ? 'bg-green-100 text-green-700' :\r\n                                            'bg-orange-100 text-orange-700'\r\n                                        }`}>\r\n                                        {suggestion.type === 'city' ? 'City' : suggestion.type === 'locality' ? 'Area' : 'Project'}\r\n                                    </span>\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                <div>\r\n                    <label className={labelStyle}>Landmark</label>\r\n                    <input name=\"landmark\" value={formData.landmark} onChange={handleChange} placeholder=\"e.g. Near City Mall\" className={inputStyle} />\r\n                </div>\r\n                <div>\r\n                    <label className={labelStyle}>Nearby (tags)</label>\r\n                    <input name=\"nearby\" value={(formData.nearby || []).join(\", \")} onChange={(e) => setFormData(p => ({ ...p, nearby: e.target.value.split(\",\").map(s => s.trim()).filter(Boolean) }))} placeholder=\"Metro, School, Hospital (comma separated)\" className={inputStyle} />\r\n                </div>\r\n            </div>\r\n\r\n            {/* Leaflet Map Section */}\r\n            <div className={`${cardStyle} relative z-0`}>\r\n                <div className=\"flex items-center justify-between mb-4\">\r\n                    <h3 className=\"font-bold text-gray-900 flex items-center gap-2\">\r\n                        <MapPin size={18} className=\"text-blue-600\" />\r\n                        Pin Property Location on Map\r\n                    </h3>\r\n                    <button\r\n                        type=\"button\"\r\n                        onClick={getCurrentLocation}\r\n                        disabled={isLocating}\r\n                        className=\"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                    >\r\n                        <Navigation size={16} className={isLocating ? \"animate-pulse\" : \"\"} />\r\n                        {isLocating ? \"Detecting...\" : \"Use My Location\"}\r\n                    </button>\r\n                </div>\r\n\r\n                <p className=\"text-sm text-gray-500 mb-3\">Click on the map to set your property's exact location, or use the \"Use My Location\" button.</p>\r\n\r\n                <div className=\"rounded-xl overflow-hidden border border-gray-200 relative z-0\" style={{ height: \"350px\" }}>\r\n                    <MapContainer\r\n                        center={mapPosition || defaultCenter}\r\n                        zoom={mapPosition ? 15 : 5}\r\n                        style={{ height: \"100%\", width: \"100%\" }}\r\n                        scrollWheelZoom={true}\r\n                    >\r\n                        <TileLayer\r\n                            attribution='&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\r\n                            url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\r\n                        />\r\n                        <LocationMarker\r\n                            position={mapPosition}\r\n                            setPosition={setMapPosition}\r\n                            setFormData={setFormData}\r\n                        />\r\n                        {mapPosition && <RecenterMap position={mapPosition} />}\r\n                    </MapContainer>\r\n                </div>\r\n\r\n                {/* Coordinates Display (always editable) */}\r\n                <div className=\"mt-4 grid grid-cols-2 gap-4\">\r\n                    <div>\r\n                        <label className={labelStyle}>Latitude</label>\r\n                        <input\r\n                            name=\"latitude\"\r\n                            value={formData.latitude}\r\n                            onChange={(e) => {\r\n                                const lat = parseFloat(e.target.value);\r\n                                handleChange(e);\r\n                                if (!isNaN(lat) && formData.longitude) {\r\n                                    setMapPosition([lat, parseFloat(formData.longitude)]);\r\n                                }\r\n                            }}\r\n                            placeholder=\"e.g. 19.0760\"\r\n                            className={inputStyle}\r\n                        />\r\n                    </div>\r\n                    <div>\r\n                        <label className={labelStyle}>Longitude</label>\r\n                        <input\r\n                            name=\"longitude\"\r\n                            value={formData.longitude}\r\n                            onChange={(e) => {\r\n                                const lng = parseFloat(e.target.value);\r\n                                handleChange(e);\r\n                                if (!isNaN(lng) && formData.latitude) {\r\n                                    setMapPosition([parseFloat(formData.latitude), lng]);\r\n                                }\r\n                            }}\r\n                            placeholder=\"e.g. 72.8777\"\r\n                            className={inputStyle}\r\n                        />\r\n                    </div>\r\n                </div>\r\n\r\n                {mapPosition && (\r\n                    <div className=\"mt-3 flex items-center gap-2 text-sm text-green-600 bg-green-50 px-3 py-2 rounded-lg border border-green-200\">\r\n                        <Check size={16} />\r\n                        <span>Location pinned: {mapPosition[0].toFixed(4)}, {mapPosition[1].toFixed(4)}</span>\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n\r\n    const renderStep3 = () => {\r\n        const isRent = formData.listingType === \"Rent\";\r\n        const isSell = formData.listingType === \"Sell\";\r\n\r\n        return (\r\n            <div className=\"space-y-6\">\r\n                <div className=\"text-center\">\r\n                    <h2 className=\"text-3xl font-bold text-gray-900\">Pricing & Area</h2>\r\n                    <p className=\"text-gray-500 mt-2\">Provide accurate area & pricing to attract quality leads.</p>\r\n                </div>\r\n\r\n                <div className={cardStyle}>\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                        <div>\r\n                            <label className={labelStyle}>Listing Type</label>\r\n                            <div className=\"flex gap-2 mt-2\">\r\n                                {[\"Rent\", \"Sell\"].map(t => (\r\n                                    <button key={t} onClick={() => setFormData(p => ({ ...p, listingType: t }))}\r\n                                        // UPDATED: Blue theme for listing type\r\n                                        className={`px-4 py-2 rounded-xl text-sm font-medium ${formData.listingType === t ? \"bg-blue-600 text-white\" : \"bg-white text-gray-600 border border-gray-300 hover:bg-gray-50\"}`}>{t}</button>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                        <div>\r\n                            <label className={labelStyle}>Expected {isRent ? \"Monthly Rent\" : \"Sale Price\"}</label>\r\n                            <div className=\"relative\">\r\n                                <div className=\"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-gray-500\">Γé╣</div>\r\n                                <input name=\"expectedPrice\" value={formData.expectedPrice} onChange={handleChange} type=\"number\" className={`${inputStyle} pl-10`} placeholder=\"0\" />\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {isRent && (\r\n                        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mt-4\">\r\n                            <div>\r\n                                <label className={labelStyle}>Security Deposit</label>\r\n                                <div className=\"relative\">\r\n                                    <div className=\"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-gray-500\">Γé╣</div>\r\n                                    <input name=\"expectedDeposit\" value={formData.expectedDeposit} onChange={handleChange} type=\"number\" className={`${inputStyle} pl-10`} placeholder=\"0\" />\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"md:col-span-2\">\r\n                                <label className={labelStyle}>Monthly Maintenance</label>\r\n                                <div className=\"flex items-center gap-3 mt-2\">\r\n                                    <label className=\"flex items-center gap-2 cursor-pointer\">\r\n                                        {/* UPDATED: Blue checkbox */}\r\n                                        <input type=\"checkbox\" checked={formData.maintenanceIncluded} onChange={(e) => setFormData(p => ({ ...p, maintenanceIncluded: e.target.checked, maintenance: e.target.checked ? \"\" : p.maintenance }))} className=\"w-4 h-4 text-blue-600 rounded border-gray-300 focus:ring-blue-600\" />\r\n                                        <span className=\"text-sm text-gray-700\">Included in rent</span>\r\n                                    </label>\r\n                                    {!formData.maintenanceIncluded && (\r\n                                        <div className=\"relative flex-1\">\r\n                                            <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-500\">Γé╣</div>\r\n                                            <input name=\"maintenance\" value={formData.maintenance} onChange={handleChange} type=\"number\" className={`${inputStyle} pl-8 py-2`} placeholder=\"Monthly amount\" />\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {isSell && (\r\n                        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mt-4\">\r\n                            <div>\r\n                                <label className={labelStyle}>Booking Amount</label>\r\n                                <div className=\"relative\">\r\n                                    <div className=\"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-gray-500\">Γé╣</div>\r\n                                    <input name=\"bookingAmount\" value={formData.bookingAmount} onChange={handleChange} type=\"number\" className={`${inputStyle} pl-10`} placeholder=\"0\" />\r\n                                </div>\r\n                            </div>\r\n                            <div>\r\n                                <label className={labelStyle}>Monthly Maintenance</label>\r\n                                <div className=\"relative\">\r\n                                    <div className=\"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-gray-500\">Γé╣</div>\r\n                                    <input name=\"maintenance\" value={formData.maintenance} onChange={handleChange} type=\"number\" className={`${inputStyle} pl-10`} placeholder=\"Society maintenance\" />\r\n                                </div>\r\n                            </div>\r\n                            <div>\r\n                                <label className={labelStyle}>GST Applicable?</label>\r\n                                <select name=\"gstApplicable\" value={formData.gstApplicable ? \"Yes\" : \"No\"} onChange={(e) => setFormData(p => ({ ...p, gstApplicable: e.target.value === \"Yes\" }))} className={inputStyle}>\r\n                                    <option>No</option>\r\n                                    <option>Yes</option>\r\n                                </select>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    <div className=\"flex items-center gap-4 mt-4\">\r\n                        <label className={labelStyle}>Price Negotiable?</label>\r\n                        <div className=\"flex gap-2\">\r\n                            {[\"No\", \"Yes\"].map(opt => (\r\n                                <button key={opt} type=\"button\" onClick={() => setFormData(p => ({ ...p, priceNegotiable: opt === \"Yes\" }))}\r\n                                    // UPDATED: Blue theme for negotiation toggle\r\n                                    className={`px-4 py-2 rounded-lg text-sm font-medium transition-all ${formData.priceNegotiable === (opt === \"Yes\") ? \"bg-blue-600 text-white shadow-md\" : \"bg-white text-gray-600 border border-gray-300 hover:bg-gray-50\"}`}>\r\n                                    {opt}\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                    <div>\r\n                        <label className={labelStyle}>{isResidential ? \"Built-up Area\" : \"Built-up / Carpet Area\"}</label>\r\n                        <div className=\"relative\">\r\n                            <input name=\"builtUpArea\" value={formData.builtUpArea} onChange={handleChange} type=\"number\" className={inputStyle} placeholder=\"eg. 1200\" />\r\n                            <div className=\"absolute inset-y-0 right-0 pr-4 flex items-center text-gray-500 text-sm\">sq.ft</div>\r\n                        </div>\r\n                    </div>\r\n                    <div>\r\n                        <label className={labelStyle}>Carpet Area</label>\r\n                        <div className=\"relative\">\r\n                            <input name=\"carpetArea\" value={formData.carpetArea} onChange={handleChange} type=\"number\" className={inputStyle} placeholder=\"eg. 900\" />\r\n                            <div className=\"absolute inset-y-0 right-0 pr-4 flex items-center text-gray-500 text-sm\">sq.ft</div>\r\n                        </div>\r\n                    </div>\r\n                    <div>\r\n                        <label className={labelStyle}>Super Built-up (optional)</label>\r\n                        <div className=\"relative\">\r\n                            <input name=\"superBuiltUpArea\" value={formData.superBuiltUpArea} onChange={handleChange} type=\"number\" className={inputStyle} placeholder=\"eg. 1400\" />\r\n                            <div className=\"absolute inset-y-0 right-0 pr-4 flex items-center text-gray-500 text-sm\">sq.ft</div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mt-4\">\r\n                    {isResidential && (\r\n                        <>\r\n                            <div>\r\n                                <label className={labelStyle}>Floor No</label>\r\n                                <input name=\"floorNo\" value={formData.floorNo} onChange={handleChange} type=\"number\" min=\"0\" className={inputStyle} placeholder=\"eg. 3\" />\r\n                            </div>\r\n                            <div>\r\n                                <label className={labelStyle}>Total Floors</label>\r\n                                <input name=\"totalFloors\" value={formData.totalFloors} onChange={handleChange} type=\"number\" min=\"1\" className={inputStyle} placeholder=\"eg. 10\" />\r\n                            </div>\r\n                            <div>\r\n                                <label className={labelStyle}>Facing</label>\r\n                                <select name=\"facing\" value={formData.facing} onChange={handleChange} className={inputStyle}>\r\n                                    <option value=\"\">Select</option>\r\n                                    {[\"East\", \"West\", \"North\", \"South\", \"North-East\", \"North-West\", \"South-East\", \"South-West\"].map(d => <option key={d}>{d}</option>)}\r\n                                </select>\r\n                            </div>\r\n                        </>\r\n                    )}\r\n                    {isCommercial && (\r\n                        <>\r\n                            <div>\r\n                                <label className={labelStyle}>Washrooms</label>\r\n                                <input name=\"washrooms\" value={formData.washrooms} onChange={handleChange} type=\"number\" min=\"0\" className={inputStyle} />\r\n                            </div>\r\n                            <div>\r\n                                <label className={labelStyle}>Floor Height (ft)</label>\r\n                                <input name=\"floorHeight\" value={formData.floorHeight} onChange={handleChange} type=\"number\" className={inputStyle} />\r\n                            </div>\r\n                            <div>\r\n                                <label className={labelStyle}>Power Load (kW)</label>\r\n                                <input name=\"powerLoad\" value={formData.powerLoad} onChange={handleChange} type=\"number\" className={inputStyle} />\r\n                            </div>\r\n                        </>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        );\r\n    };\r\n\r\n    const renderStep4 = () => {\r\n        const isRent = formData.listingType === \"Rent\";\r\n        const isSell = formData.listingType === \"Sell\";\r\n\r\n        return (\r\n            <div className=\"space-y-6\">\r\n                <div className=\"text-center\">\r\n                    <h2 className=\"text-3xl font-bold text-gray-900\">Property Details</h2>\r\n                    <p className=\"text-gray-500 mt-2\">Add specific features to make your listing stand out.</p>\r\n                </div>\r\n\r\n                {isResidential && (\r\n                    <>\r\n                        <div className={cardStyle}>\r\n                            <h3 className=\"font-bold mb-4 flex items-center gap-2 text-gray-900\">\r\n                                {/* UPDATED: Blue icon */}\r\n                                <Home size={18} className=\"text-blue-600\" />\r\n                                Residential Configuration\r\n                            </h3>\r\n                            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                                <div><label className={labelStyle}>Bedrooms</label><input name=\"bedrooms\" value={formData.bedrooms} onChange={handleChange} type=\"number\" className={inputStyle} /></div>\r\n                                <div><label className={labelStyle}>Bathrooms</label><input name=\"bathrooms\" value={formData.bathrooms} onChange={handleChange} type=\"number\" className={inputStyle} /></div>\r\n                                <div><label className={labelStyle}>Balconies</label><input name=\"balconies\" value={formData.balconies} onChange={handleChange} type=\"number\" className={inputStyle} /></div>\r\n                            </div>\r\n\r\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4\">\r\n                                <div>\r\n                                    <label className={labelStyle}>Furnishing</label>\r\n                                    <select name=\"furnishing\" value={formData.furnishing} onChange={handleChange} className={inputStyle}>\r\n                                        <option>Unfurnished</option>\r\n                                        <option>Semi-Furnished</option>\r\n                                        <option>Fully Furnished</option>\r\n                                    </select>\r\n                                </div>\r\n                                <div>\r\n                                    <label className={labelStyle}>Property Age</label>\r\n                                    <select name=\"propertyAge\" value={formData.propertyAge} onChange={handleChange} className={inputStyle}>\r\n                                        <option>New</option>\r\n                                        <option>1-5 Years</option>\r\n                                        <option>5-10 Years</option>\r\n                                        <option>10+ Years</option>\r\n                                    </select>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {isSell && (\r\n                                <div className=\"mt-4\">\r\n                                    <label className={labelStyle}>Construction Status</label>\r\n                                    <div className=\"flex flex-wrap gap-2 mt-2\">\r\n                                        {[\"Ready to Move\", \"Under Construction\", \"New Launch\"].map(status => (\r\n                                            <button key={status} type=\"button\" onClick={() => setFormData(p => ({ ...p, constructionStatus: status }))}\r\n                                                // UPDATED: Blue theme for status toggle\r\n                                                className={`px-4 py-2 rounded-xl text-sm transition-all ${formData.constructionStatus === status ? \"bg-blue-600 text-white shadow-md\" : \"bg-white text-gray-600 border border-gray-300 hover:bg-gray-50\"}`}>\r\n                                                {status}\r\n                                            </button>\r\n                                        ))}\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n\r\n                            <div className=\"grid grid-cols-1 md:grid-cols-4 gap-3 mt-4 text-gray-700\">\r\n                                {[\"servantRoom\", \"poojaRoom\", \"studyRoom\", \"storeRoom\"].map(room => (\r\n                                    <label key={room} className=\"flex items-center gap-2 cursor-pointer\">\r\n                                        {/* UPDATED: Blue checkbox */}\r\n                                        <input type=\"checkbox\" name={room} checked={formData[room]} onChange={handleChange} className=\"w-4 h-4 text-blue-600 rounded border-gray-300 focus:ring-blue-600\" />\r\n                                        <span className=\"text-sm capitalize\">{room.replace(/([A-Z])/g, ' $1').trim()}</span>\r\n                                    </label>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n\r\n                        {isRent && (\r\n                            <div className={cardStyle}>\r\n                                <h3 className=\"font-bold mb-4 flex items-center gap-2 text-gray-900\"><Users size={18} className=\"text-blue-600\" /> Tenant Preferences</h3>\r\n                                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                                    <div>\r\n                                        <label className={labelStyle}>Preferred Tenants</label>\r\n                                        <select name=\"allowedFor\" value={formData.allowedFor} onChange={handleChange} className={inputStyle}>\r\n                                            <option value=\"Family\">Family</option>\r\n                                            <option value=\"Bachelor Male\">Bachelor Male</option>\r\n                                            <option value=\"Bachelor Female\">Bachelor Female</option>\r\n                                            <option value=\"Company Lease\">Company Lease</option>\r\n                                            <option value=\"Any\">Any</option>\r\n                                        </select>\r\n                                    </div>\r\n                                    <div>\r\n                                        <label className={labelStyle}>Pet Friendly?</label>\r\n                                        <select name=\"petFriendly\" value={formData.petFriendly} onChange={handleChange} className={inputStyle}>\r\n                                            <option value=\"No\">No</option>\r\n                                            <option value=\"Yes\">Yes</option>\r\n                                        </select>\r\n                                    </div>\r\n                                    <div>\r\n                                        <label className={labelStyle}>Available From</label>\r\n                                        <input type=\"date\" name=\"availableFrom\" value={formData.availableFrom} onChange={handleChange} min={new Date().toISOString().split('T')[0]} className={inputStyle} />\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n                    </>\r\n                )}\r\n\r\n                {isCommercial && commercialConfig && (\r\n                    <div className={cardStyle}>\r\n                        <h3 className=\"font-bold mb-4 flex items-center gap-2 text-gray-900\">{commercialConfig.icon} {commercialConfig.label}</h3>\r\n                        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                            {commercialConfig.fields.map(field => (\r\n                                <div key={field}>\r\n                                    <label className={labelStyle}>{field.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase())}</label>\r\n                                    <input name={field} value={formData[field]} onChange={handleChange} type=\"number\" className={inputStyle} />\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                <div className={cardStyle}>\r\n                    <h3 className=\"font-bold mb-4 text-gray-900\">Parking & Amenities</h3>\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                        <div><label className={labelStyle}>Parking (Covered)</label><input name=\"parkingCovered\" value={formData.parkingCovered} onChange={handleChange} type=\"number\" className={inputStyle} /></div>\r\n                        <div><label className={labelStyle}>Parking (Open)</label><input name=\"parkingOpen\" value={formData.parkingOpen} onChange={handleChange} type=\"number\" className={inputStyle} /></div>\r\n                    </div>\r\n\r\n                    <div className=\"mt-4\">\r\n                        <label className=\"text-sm font-semibold text-gray-900 uppercase tracking-wider\">Amenities</label>\r\n                        <div className=\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3 mt-2\">\r\n                            {PROPERTY_CATEGORIES[formData.propertyCategory].amenities.map(am => (\r\n                                // UPDATED: Blue theme for selected amenity\r\n                                <div key={am} onClick={() => handleAmenityToggle(am)} className={`p-3 rounded-xl border cursor-pointer ${formData.selectedAmenities.includes(am) ? \"bg-blue-50 border-blue-200 text-blue-700\" : \"bg-white border-gray-200 hover:bg-gray-50 text-gray-600\"}`}>\r\n                                    <div className=\"flex items-center gap-2\">\r\n                                        <div className={formData.selectedAmenities.includes(am) ? \"text-blue-600\" : \"text-gray-400\"}>{AMENITY_ICONS[am] || <Tag size={14} />}</div>\r\n                                        <div className=\"text-sm\">{am}</div>\r\n                                    </div>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    };\r\n\r\n    const renderStep5 = () => {\r\n        const categories = getImageCategories();\r\n        const totalImages = getTotalCategorizedImages();\r\n\r\n        return (\r\n            <div className=\"space-y-6\">\r\n                <div className=\"text-center\">\r\n                    <h2 className=\"text-3xl font-bold text-gray-900\">Photos & Documents</h2>\r\n                    <p className=\"text-gray-500 mt-2\">Click on any category to add photos. All images are optional.</p>\r\n                </div>\r\n\r\n                <div className=\"flex justify-center\">\r\n                    <div className=\"bg-white border border-gray-200 px-4 py-2 rounded-full text-sm flex items-center gap-2 shadow-sm text-gray-700\">\r\n                        {/* UPDATED: Blue icon */}\r\n                        <ImageIcon size={16} className=\"text-blue-600\" />\r\n                        <span>{totalImages} photos uploaded</span>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3\">\r\n                    {categories.map((category) => {\r\n                        const catImages = categorizedImages[category.key] || { files: [], previews: [] };\r\n                        const imageCount = catImages.files?.length || 0;\r\n                        const isExpanded = expandedCategories.includes(category.key);\r\n                        const hasImages = imageCount > 0;\r\n\r\n                        return (\r\n                            <div key={category.key} onClick={() => toggleCategory(category.key)}\r\n                                // UPDATED: Blue theme for active selection\r\n                                className={`rounded-xl p-3 border cursor-pointer transition-all ${isExpanded ? 'border-blue-500 ring-1 ring-blue-500 bg-blue-50' : hasImages ? 'border-green-500 bg-green-50' : 'border-gray-200 bg-white hover:bg-gray-50'}`}\r\n                            >\r\n                                <div className=\"flex items-center justify-between\">\r\n                                    <span className={`font-medium text-sm truncate ${isExpanded ? 'text-blue-700' : 'text-gray-700'}`}>{category.label}</span>\r\n                                    <div className=\"flex items-center gap-1.5\">\r\n                                        {hasImages && <span className=\"bg-green-100 text-green-700 border border-green-200 text-xs px-1.5 py-0.5 rounded-full font-medium\">{imageCount}</span>}\r\n                                        {/* UPDATED: Blue icon color */}\r\n                                        <Plus size={14} className={`transition-transform ${isExpanded ? 'rotate-45 text-blue-600' : 'text-gray-400'}`} />\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        );\r\n                    })}\r\n                </div>\r\n\r\n                {expandedCategories.length > 0 && (\r\n                    <div className=\"space-y-4 mt-6\">\r\n                        {categories.filter(cat => expandedCategories.includes(cat.key)).map((category) => {\r\n                            const catImages = categorizedImages[category.key] || { files: [], previews: [] };\r\n                            const imageCount = catImages.files?.length || 0;\r\n\r\n                            return (\r\n                                <div key={category.key} className=\"rounded-2xl p-4 border border-gray-200 bg-white shadow-sm\">\r\n                                    <div className=\"flex items-center justify-between mb-3\">\r\n                                        <div className=\"flex items-center gap-2\">\r\n                                            <span className=\"text-gray-900 font-semibold\">{category.label}</span>\r\n                                            <span className=\"text-gray-400 text-xs\">({imageCount}/{category.maxImages})</span>\r\n                                        </div>\r\n                                        <button onClick={(e) => { e.stopPropagation(); toggleCategory(category.key); }} className=\"text-gray-400 hover:text-gray-600 p-1\"><X size={16} /></button>\r\n                                    </div>\r\n\r\n                                    {/* UPDATED: Blue hover effects for upload area */}\r\n                                    <div className=\"border-2 border-dashed border-gray-300 rounded-xl p-6 text-center relative hover:border-blue-400 hover:bg-blue-50 transition-all cursor-pointer mb-3\">\r\n                                        <input type=\"file\" multiple accept=\"image/*\" onChange={(e) => handleCategorizedImageUpload(category.key, e)} className=\"absolute inset-0 w-full h-full opacity-0 cursor-pointer\" disabled={imageCount >= category.maxImages} />\r\n                                        <Upload size={24} className=\"mx-auto text-gray-400 mb-2\" />\r\n                                        <div className=\"text-gray-700 font-medium\">{imageCount >= category.maxImages ? 'Maximum images reached' : 'Click to upload'}</div>\r\n                                    </div>\r\n\r\n                                    {catImages.previews?.length > 0 && (\r\n                                        <div className=\"grid grid-cols-4 sm:grid-cols-5 gap-2\">\r\n                                            {catImages.previews.map((src, idx) => (\r\n                                                <div key={idx} className=\"relative rounded-lg overflow-hidden aspect-square border border-gray-200\">\r\n                                                    <img src={src} className=\"w-full h-full object-cover\" alt=\"preview\" />\r\n                                                    <button onClick={(e) => { e.stopPropagation(); removeCategorizedImage(category.key, idx); }} className=\"absolute top-1 right-1 bg-red-600 rounded-full p-1 shadow hover:bg-red-700\"><X size={10} className=\"text-white\" /></button>\r\n                                                </div>\r\n                                            ))}\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                            );\r\n                        })}\r\n                    </div>\r\n                )}\r\n\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 pt-4 border-t border-gray-200\">\r\n                    <div>\r\n                        <label className={labelStyle}>Video Walkthrough (optional)</label>\r\n                        <input name=\"videoUrl\" value={formData.videoUrl} onChange={handleChange} placeholder=\"YouTube / Google Drive link\" className={inputStyle} />\r\n                    </div>\r\n                    <div>\r\n                        <label className={labelStyle}>Upload Documents</label>\r\n                        <input type=\"file\" accept=\".pdf\" className={inputStyle} />\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    };\r\n\r\n    const getFirstPreviewImage = () => {\r\n        const categories = getImageCategories();\r\n        for (const cat of categories) {\r\n            if (categorizedImages[cat.key]?.previews?.length > 0) return categorizedImages[cat.key].previews[0];\r\n        }\r\n        return previewImages[0] || null;\r\n    };\r\n\r\n    const renderStep6 = () => {\r\n        const firstImage = getFirstPreviewImage();\r\n        const totalImages = getTotalCategorizedImages() + (images?.length || 0);\r\n\r\n        return (\r\n            <div className=\"space-y-6\">\r\n                <div className=\"text-center\">\r\n                    <h2 className=\"text-3xl font-bold text-gray-900\">Review & Publish</h2>\r\n                    <p className=\"text-gray-500 mt-2\">Double-check everything ΓÇö buyers prefer complete listings.</p>\r\n                </div>\r\n\r\n                <div className=\"max-w-3xl mx-auto bg-white rounded-2xl shadow-lg p-6 border border-gray-200\">\r\n                    <div className=\"h-56 bg-gray-100 rounded-2xl overflow-hidden relative mb-4 border border-gray-200\">\r\n                        {firstImage ? <img src={firstImage} className=\"w-full h-full object-cover\" alt=\"Property Preview\" /> : <div className=\"w-full h-full flex items-center justify-center text-gray-300\"><ImageIcon size={48} /></div>}\r\n                        {/* UPDATED: Blue theme badge */}\r\n                        <div className=\"absolute top-4 left-4 bg-white text-blue-600 px-3 py-1 rounded-full text-xs font-bold shadow-md uppercase tracking-wide border border-blue-100\">{formData.listingType}</div>\r\n                        <div className=\"absolute bottom-4 right-4 bg-black/70 text-white px-3 py-1 rounded-full text-xs font-semibold backdrop-blur-sm\">{totalImages} photos</div>\r\n                    </div>\r\n\r\n                    <div className=\"space-y-3\">\r\n                        <div className=\"flex justify-between items-start\">\r\n                            <div>\r\n                                <h3 className=\"font-bold text-xl text-gray-900\">{generateTitle()}</h3>\r\n                                <p className=\"text-sm text-gray-500 flex items-center gap-1 mt-1\"><MapPin size={14} /> {formData.locality}, {formData.city}</p>\r\n                            </div>\r\n                            <div className=\"text-right\">\r\n                                {/* UPDATED: Blue price text */}\r\n                                <div className=\"font-bold text-2xl text-blue-600\">Γé╣ {formData.expectedPrice ? Number(formData.expectedPrice).toLocaleString() : \"-\"}</div>\r\n                                <div className=\"text-xs text-gray-500\">{formData.priceNegotiable ? \"Negotiable\" : \"Fixed Price\"}</div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"grid grid-cols-2 sm:grid-cols-4 gap-4 py-4 border-t border-gray-100 mt-2\">\r\n                            <div><div className=\"text-xs text-gray-400 uppercase\">Area</div><div className=\"font-semibold text-gray-800\">{formData.builtUpArea || formData.carpetArea || \"-\"} sq.ft</div></div>\r\n                            <div><div className=\"text-xs text-gray-400 uppercase\">Furnishing</div><div className=\"font-semibold text-gray-800\">{formData.furnishing}</div></div>\r\n                            {isResidential && <div><div className=\"text-xs text-gray-400 uppercase\">Config</div><div className=\"font-semibold text-gray-800\">{formData.bedrooms || formData.bhkType || \"-\"}</div></div>}\r\n                            <div><div className=\"text-xs text-gray-400 uppercase\">Available</div><div className=\"font-semibold text-gray-800\">{formData.availableFrom || \"Immediate\"}</div></div>\r\n                        </div>\r\n\r\n                        {formData.selectedAmenities.length > 0 && (\r\n                            <div>\r\n                                <div className=\"text-xs text-gray-400 uppercase mb-2\">Amenities</div>\r\n                                <div className=\"flex flex-wrap gap-2\">\r\n                                    {formData.selectedAmenities.map(a => <span key={a} className=\"bg-gray-100 text-gray-600 border border-gray-200 px-2 py-1 rounded text-xs\">{a}</span>)}\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n\r\n                        <div className=\"pt-2\">\r\n                            <div className=\"text-xs text-gray-400 uppercase\">Description</div>\r\n                            <div className=\"mt-1 text-sm text-gray-600 leading-relaxed bg-gray-50 p-3 rounded-lg border border-gray-100\">{formData.description || generateShortDescription()}</div>\r\n                        </div>\r\n\r\n                        <div className=\"pt-4\">\r\n                            {/* UPDATED: Blue primary button */}\r\n                            <button onClick={handleSubmit} disabled={isLoading} className=\"w-full bg-blue-600 hover:bg-blue-700 text-white py-4 rounded-xl font-bold flex items-center justify-center gap-2 transition-colors shadow-lg shadow-blue-200\">\r\n                                {isLoading ? \"Publishing...\" : <>Confirm & Publish <Check size={18} /></>}\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"max-w-3xl mx-auto text-xs sm:text-sm text-gray-500 flex flex-wrap items-center justify-between gap-2\">\r\n                    <p>\r\n                        Want higher visibility or more active listings over time? Explore our owner Pricing & Plans.\r\n                    </p>\r\n                    <a\r\n                        href=\"/pricing\"\r\n                        className=\"inline-flex items-center px-3 py-1.5 rounded-full border border-blue-200 text-blue-700 font-semibold hover:bg-blue-50 text-[11px] sm:text-xs\"\r\n                    >\r\n                        View Pricing & Plans\r\n                        <span className=\"ml-1 text-[13px]\">ΓåÆ</span>\r\n                    </a>\r\n                </div>\r\n            </div>\r\n        );\r\n    };\r\n\r\n    if (!isAuthorized) return <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\"><EmailVerificationModal isOpen={showVerificationModal} onClose={() => navigate(\"/\")} user={user} onVerified={handleVerificationSuccess} /></div>;\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-gray-50 flex flex-col md:flex-row font-sans text-gray-900\">\r\n            {/* Sidebar (Kept Red as per previous instruction/layout, but main content is now Blue theme) */}\r\n            <aside className=\"hidden md:flex flex-col w-80 bg-red-600 h-[calc(100vh-5rem)] sticky top-20 p-6 pt-8 z-20 shadow-xl overflow-y-auto\">\r\n                <nav className=\"space-y-2 flex-1\">\r\n                    {STEPS.map(step => {\r\n                        const isActive = currentStep === step.id;\r\n                        const isCompleted = currentStep > step.id;\r\n                        return (\r\n                            <div key={step.id} className={`group flex items-center gap-4 p-4 rounded-2xl transition-all duration-300 relative overflow-hidden ${isActive ? \"bg-white text-red-600 shadow-md\" : \"text-red-100 hover:bg-white/10 hover:text-white\"}`}>\r\n                                <div className={`relative z-10 transition-colors ${isActive ? \"text-red-600\" : isCompleted ? \"text-white\" : \"text-red-200 group-hover:text-white\"}`}>\r\n                                    {isCompleted ? <Check size={18} strokeWidth={3} /> : step.icon}\r\n                                </div>\r\n                                <div className=\"flex flex-col relative z-10\">\r\n                                    <span className={`font-bold text-sm ${isActive ? \"text-red-600\" : \"text-white\"}`}>{step.label}</span>\r\n                                    <span className={`text-xs font-medium ${isActive ? \"text-red-400\" : \"text-red-200/80\"}`}>{step.description}</span>\r\n                                </div>\r\n                                {isActive && <motion.div layoutId=\"activeStep\" className=\"absolute inset-0 bg-white rounded-2xl\" transition={{ type: \"spring\", stiffness: 300, damping: 30 }} />}\r\n                            </div>\r\n                        );\r\n                    })}\r\n                </nav>\r\n                <div className=\"mt-auto pt-8 border-t border-white/20\">\r\n                    <div className=\"bg-white/10 backdrop-blur rounded-2xl p-5 text-white\">\r\n                        <h4 className=\"font-bold\">Seller Assistance</h4>\r\n                        <p className=\"text-xs text-red-100 mt-2\">Need help? Toggle tips in the form fields.</p>\r\n                        <button onClick={() => setFormData(p => ({ ...p, showHelpTips: !p.showHelpTips }))} className=\"mt-3 w-full bg-white/20 hover:bg-white/30 px-3 py-2 rounded-lg text-xs transition-colors\">Toggle Tips</button>\r\n                    </div>\r\n                </div>\r\n            </aside>\r\n\r\n            {/* Mobile Header */}\r\n            <div className=\"md:hidden bg-red-600 p-4 sticky top-20 z-30 shadow-md flex items-center justify-between\">\r\n                <div className=\"flex items-center gap-2\">\r\n                    <div className=\"bg-white/20 p-1.5 rounded-lg\"><Home className=\"text-white\" size={16} /></div>\r\n                    <span className=\"font-bold text-white\">Step {currentStep}</span>\r\n                </div>\r\n                <div className=\"flex gap-1.5\">\r\n                    {STEPS.map(s => <div key={s.id} className={`h-1.5 w-8 rounded-full ${s.id <= currentStep ? \"bg-white\" : \"bg-red-400/50\"}`} />)}\r\n                </div>\r\n            </div>\r\n\r\n            <main className=\"flex-1 p-6 md:p-12 max-w-5xl mx-auto w-full flex flex-col h-full\">\r\n                <div className=\"flex-1 mb-20 md:mb-0 relative\">\r\n                    <AnimatePresence mode=\"wait\" custom={direction}>\r\n                        <motion.div key={currentStep} custom={direction} variants={variants} initial=\"enter\" animate=\"center\" exit=\"exit\" transition={{ x: { type: \"spring\", stiffness: 300, damping: 30 }, opacity: { duration: 0.2 } }} className=\"min-h-[520px]\">\r\n                            {currentStep === 1 && renderStep1()}\r\n                            {currentStep === 2 && renderStep2()}\r\n                            {currentStep === 3 && renderStep3()}\r\n                            {currentStep === 4 && renderStep4()}\r\n                            {currentStep === 5 && renderStep5()}\r\n                            {currentStep === 6 && renderStep6()}\r\n                        </motion.div>\r\n                    </AnimatePresence>\r\n\r\n                    <div className=\"flex justify-between items-center mt-12 pt-8 border-t border-gray-200\">\r\n                        <button onClick={handlePrev} disabled={currentStep === 1} className={`flex items-center gap-2 px-8 py-3 rounded-xl font-bold transition-all ${currentStep === 1 ? \"text-gray-300 cursor-not-allowed\" : \"text-gray-600 hover:bg-gray-100\"}`}>\r\n                            <ChevronLeft size={18} /> Back\r\n                        </button>\r\n\r\n                        <div className=\"flex items-center gap-3\">\r\n                            {currentStep < 6 && (\r\n                                // UPDATED: Blue primary button\r\n                                <button onClick={handleNext} className=\"bg-blue-600 text-white px-10 py-3 rounded-xl font-bold hover:bg-blue-700 transition-all shadow-lg shadow-blue-200 flex items-center gap-2\">\r\n                                    Next Step <ArrowRight size={18} />\r\n                                </button>\r\n                            )}\r\n                            {currentStep === 6 && (\r\n                                // UPDATED: Blue primary button\r\n                                <button onClick={handleSubmit} disabled={isLoading} className=\"bg-blue-600 text-white px-10 py-3 rounded-xl font-bold hover:bg-blue-700 transition-all shadow-lg flex items-center gap-2\">\r\n                                    {isLoading ? \"Publishing...\" : <>Confirm & Publish <Check size={18} /></>}\r\n                                </button>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </main>\r\n        </div>\r\n    );\r\n}","usedDeprecatedRules":[]},{"filePath":"D:\\dealdirectcurrentlive\\dealdirect\\client\\src\\Pages\\Contact\\Contact.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\dealdirectcurrentlive\\dealdirect\\client\\src\\Pages\\EditProperty\\EditProperty.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'motion' is defined but never used. Allowed unused vars must match /^[A-Z_]/u.","line":9,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":16,"suggestions":[{"messageId":"removeVar","data":{"varName":"motion"},"fix":{"range":[453,460],"text":""},"desc":"Remove unused variable 'motion'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'property' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":221,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":221,"endColumn":20,"suggestions":[{"messageId":"removeVar","data":{"varName":"property"},"fix":{"range":[12694,12702],"text":""},"desc":"Remove unused variable 'property'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'existingImages' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":226,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":226,"endColumn":26,"suggestions":[{"messageId":"removeVar","data":{"varName":"existingImages"},"fix":{"range":[12874,12888],"text":""},"desc":"Remove unused variable 'existingImages'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'isSearchingLocation' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":284,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":284,"endColumn":31,"suggestions":[{"messageId":"removeVar","data":{"varName":"isSearchingLocation"},"fix":{"range":[14769,14788],"text":""},"desc":"Remove unused variable 'isSearchingLocation'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'suggestionsRef' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":288,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":288,"endColumn":25,"suggestions":[{"messageId":"removeVar","data":{"varName":"suggestionsRef"},"fix":{"range":[15025,15061],"text":""},"desc":"Remove unused variable 'suggestionsRef'."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchProperty'. Either include it or remove the dependency array.","line":310,"column":8,"nodeType":"ArrayExpression","endLine":310,"endColumn":62,"suggestions":[{"desc":"Update the dependencies array to be: [id, authLoading, isAuthenticated, authUser, navigate, fetchProperty]","fix":{"range":[15690,15744],"text":"[id, authLoading, isAuthenticated, authUser, navigate, fetchProperty]"}}]},{"ruleId":"no-unused-vars","severity":2,"message":"'field' is defined but never used.","line":514,"column":43,"nodeType":"Identifier","messageId":"unusedVar","endLine":514,"endColumn":48,"suggestions":[{"messageId":"removeVar","data":{"varName":"field"},"fix":{"range":[25216,25223],"text":""},"desc":"Remove unused variable 'field'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":598,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":598,"endColumn":19,"suggestions":[{"messageId":"removeVar","data":{"varName":"error"},"fix":{"range":[28793,28798],"text":""},"desc":"Remove unused variable 'error'."}]}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useRef } from \"react\";\r\nimport {\r\n    Home, MapPin, IndianRupee, Layers, Image as ImageIcon, Calendar,\r\n    ChevronLeft, Upload, Check, X, Building2, Users, Utensils, Car, Zap,\r\n    Shield, Store, ArrowRight, FileText, Tag, Wifi, LandPlot, Plus, AlertTriangle, Navigation, Loader2\r\n} from \"lucide-react\";\r\nimport { toast } from \"react-toastify\";\r\nimport { useNavigate, useParams } from \"react-router-dom\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport { MapContainer, TileLayer, Marker, useMapEvents, useMap } from \"react-leaflet\";\r\nimport L from \"leaflet\";\r\nimport \"leaflet/dist/leaflet.css\";\r\nimport api from \"../../utils/api\";\r\nimport { useAuth } from \"../../context/AuthContext\";\r\n\r\n// Fix for default marker icon in react-leaflet\r\ndelete L.Icon.Default.prototype._getIconUrl;\r\nL.Icon.Default.mergeOptions({\r\n    iconRetinaUrl: \"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon-2x.png\",\r\n    iconUrl: \"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png\",\r\n    shadowUrl: \"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png\",\r\n});\r\n\r\n// Custom marker icon\r\nconst customIcon = new L.Icon({\r\n    iconUrl: \"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png\",\r\n    iconRetinaUrl: \"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon-2x.png\",\r\n    shadowUrl: \"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png\",\r\n    iconSize: [25, 41],\r\n    iconAnchor: [12, 41],\r\n    popupAnchor: [1, -34],\r\n    shadowSize: [41, 41]\r\n});\r\n\r\n// Map click handler component\r\nfunction LocationMarker({ position, setPosition, setFormData }) {\r\n    useMapEvents({\r\n        click(e) {\r\n            const { lat, lng } = e.latlng;\r\n            setPosition([lat, lng]);\r\n            setFormData(prev => ({\r\n                ...prev,\r\n                latitude: lat.toFixed(6),\r\n                longitude: lng.toFixed(6)\r\n            }));\r\n        },\r\n    });\r\n\r\n    return position ? <Marker position={position} icon={customIcon} /> : null;\r\n}\r\n\r\n// Component to recenter map\r\nfunction RecenterMap({ position }) {\r\n    const map = useMap();\r\n    useEffect(() => {\r\n        if (position) {\r\n            map.setView(position, 15);\r\n        }\r\n    }, [position, map]);\r\n    return null;\r\n}\r\n\r\nconst API_BASE = import.meta.env.VITE_API_BASE;\r\n\r\n// Steps\r\nconst STEPS = [\r\n    { id: 1, label: \"Basic Info\", icon: <Home size={18} />, description: \"Property basics\" },\r\n    { id: 2, label: \"Location\", icon: <MapPin size={18} />, description: \"Address details\" },\r\n    { id: 3, label: \"Pricing & Area\", icon: <IndianRupee size={18} />, description: \"Value & size\" },\r\n    { id: 4, label: \"Property Details\", icon: <Layers size={18} />, description: \"Specific features\" },\r\n    { id: 5, label: \"Photos\", icon: <ImageIcon size={18} />, description: \"Property images\" },\r\n    { id: 6, label: \"Review\", icon: <Calendar size={18} />, description: \"Final check\" },\r\n];\r\n\r\nconst PROPERTY_CATEGORIES = {\r\n    Residential: {\r\n        icon: <Home size={28} />,\r\n        types: [\"Apartment / Flat\", \"Independent House\", \"Villa\", \"Builder Floor\", \"Row House\", \"Studio Apartment\", \"Penthouse\", \"Farm House\"],\r\n        amenities: [\"Lift\", \"Gym\", \"Swimming Pool\", \"Club House\", \"Power Backup\", \"CCTV\", \"Parking Covered\", \"Parking Open\", \"Modular Kitchen\", \"Wardrobes\", \"Geyser\", \"AC\", \"Fans\", \"Water Purifier\", \"Intercom\", \"Garden\", \"Jogging Track\", \"Kids Play Area\", \"Community Hall\", \"RO Water\", \"Store Room\", \"Servant Room\"]\r\n    },\r\n    Commercial: {\r\n        icon: <Store size={28} />,\r\n        types: [\"Office Space\", \"Shop / Retail\", \"Showroom\", \"Restaurant / Cafe\", \"Co-Working Space\", \"Warehouse / Godown\", \"Industrial Shed\", \"Commercial Building / Floor\"],\r\n        amenities: [\"Lift\", \"Power Backup\", \"CCTV\", \"Fire Safety\", \"Reserved Parking\", \"Visitor Parking\", \"Internet\", \"Loading Dock\", \"Goods Lift\", \"Sprinkler System\", \"Water Storage\", \"Security\", \"Washrooms\", \"AC\"]\r\n    }\r\n};\r\n\r\n// Image categories based on property type (same as AddProperty)\r\nconst IMAGE_CATEGORIES = {\r\n    Residential: {\r\n        \"Apartment / Flat\": [\r\n            { key: \"exterior\", label: \"Building Exterior\", maxImages: 3 },\r\n            { key: \"livingRoom\", label: \"Living Room\", maxImages: 4 },\r\n            { key: \"bedroom\", label: \"Bedroom(s)\", maxImages: 4 },\r\n            { key: \"bathroom\", label: \"Bathroom(s)\", maxImages: 3 },\r\n            { key: \"kitchen\", label: \"Kitchen\", maxImages: 2 },\r\n            { key: \"balcony\", label: \"Balcony / Terrace\", maxImages: 2 },\r\n            { key: \"hall\", label: \"Hall / Lobby\", maxImages: 2 },\r\n            { key: \"parking\", label: \"Parking Area\", maxImages: 2 },\r\n            { key: \"floorPlan\", label: \"Floor Plan\", maxImages: 1 },\r\n            { key: \"other\", label: \"Other Areas\", maxImages: 5 }\r\n        ],\r\n        \"Independent House\": [\r\n            { key: \"exterior\", label: \"House Exterior\", maxImages: 4 },\r\n            { key: \"livingRoom\", label: \"Living Room\", maxImages: 3 },\r\n            { key: \"bedroom\", label: \"Bedroom(s)\", maxImages: 4 },\r\n            { key: \"bathroom\", label: \"Bathroom(s)\", maxImages: 3 },\r\n            { key: \"kitchen\", label: \"Kitchen\", maxImages: 2 },\r\n            { key: \"garden\", label: \"Garden/Lawn\", maxImages: 3 },\r\n            { key: \"parking\", label: \"Parking\", maxImages: 2 },\r\n            { key: \"other\", label: \"Other\", maxImages: 5 }\r\n        ],\r\n        \"Villa\": [\r\n            { key: \"exterior\", label: \"Villa Exterior\", maxImages: 5 },\r\n            { key: \"livingRoom\", label: \"Living Room\", maxImages: 4 },\r\n            { key: \"bedroom\", label: \"Bedroom(s)\", maxImages: 5 },\r\n            { key: \"bathroom\", label: \"Bathroom(s)\", maxImages: 3 },\r\n            { key: \"kitchen\", label: \"Kitchen\", maxImages: 2 },\r\n            { key: \"pool\", label: \"Swimming Pool\", maxImages: 3 },\r\n            { key: \"garden\", label: \"Garden\", maxImages: 3 },\r\n            { key: \"other\", label: \"Other\", maxImages: 5 }\r\n        ],\r\n        \"Builder Floor\": [{ key: \"exterior\", label: \"Building Exterior\", maxImages: 2 }, { key: \"livingRoom\", label: \"Living Room\", maxImages: 3 }, { key: \"bedroom\", label: \"Bedrooms\", maxImages: 4 }, { key: \"other\", label: \"Other\", maxImages: 5 }],\r\n        \"Studio Apartment\": [{ key: \"livingRoom\", label: \"Studio Space\", maxImages: 4 }, { key: \"kitchen\", label: \"Kitchen\", maxImages: 2 }, { key: \"bathroom\", label: \"Bathroom\", maxImages: 2 }, { key: \"other\", label: \"Other\", maxImages: 3 }],\r\n        \"Penthouse\": [{ key: \"exterior\", label: \"Building & Terrace\", maxImages: 4 }, { key: \"livingRoom\", label: \"Living Area\", maxImages: 4 }, { key: \"terrace\", label: \"Terrace\", maxImages: 4 }, { key: \"other\", label: \"Other\", maxImages: 5 }],\r\n        \"Row House\": [{ key: \"exterior\", label: \"House Exterior\", maxImages: 3 }, { key: \"livingRoom\", label: \"Living Room\", maxImages: 3 }, { key: \"bedroom\", label: \"Bedrooms\", maxImages: 4 }, { key: \"other\", label: \"Other\", maxImages: 5 }],\r\n        \"Farm House\": [{ key: \"exterior\", label: \"Property Exterior\", maxImages: 5 }, { key: \"livingRoom\", label: \"Living Space\", maxImages: 3 }, { key: \"land\", label: \"Farm Land\", maxImages: 5 }, { key: \"other\", label: \"Other\", maxImages: 5 }]\r\n    },\r\n    Commercial: {\r\n        // Mirror AddProperty commercial categories and align with backend keys\r\n        \"Office Space\": [\r\n            { key: \"facade\", label: \"Building Exterior\", maxImages: 4 },\r\n            { key: \"reception\", label: \"Reception / Lobby\", maxImages: 3 },\r\n            { key: \"workArea\", label: \"Open Work Area\", maxImages: 6 },\r\n            { key: \"cabin\", label: \"Cabins / Rooms\", maxImages: 4 },\r\n            { key: \"conferenceRoom\", label: \"Conference Rooms\", maxImages: 3 },\r\n            { key: \"pantry\", label: \"Pantry\", maxImages: 3 },\r\n            { key: \"washroom\", label: \"Washrooms\", maxImages: 3 },\r\n            { key: \"parking\", label: \"Parking\", maxImages: 3 },\r\n            { key: \"floorPlan\", label: \"Floor Plan\", maxImages: 1 },\r\n            { key: \"other\", label: \"Other\", maxImages: 5 }\r\n        ],\r\n        \"Shop / Retail\": [\r\n            { key: \"facade\", label: \"Shop Front / Facade\", maxImages: 4 },\r\n            { key: \"shopFloor\", label: \"Shop Floor\", maxImages: 6 },\r\n            { key: \"displayArea\", label: \"Display Area\", maxImages: 4 },\r\n            { key: \"storageArea\", label: \"Storage / Back Area\", maxImages: 4 },\r\n            { key: \"washroom\", label: \"Washrooms\", maxImages: 2 },\r\n            { key: \"parking\", label: \"Customer Parking\", maxImages: 3 },\r\n            { key: \"floorPlan\", label: \"Floor Plan\", maxImages: 1 },\r\n            { key: \"other\", label: \"Other\", maxImages: 5 }\r\n        ],\r\n        \"Showroom\": [\r\n            { key: \"facade\", label: \"Showroom Exterior\", maxImages: 4 },\r\n            { key: \"reception\", label: \"Reception / Front Desk\", maxImages: 3 },\r\n            { key: \"displayArea\", label: \"Display Area\", maxImages: 6 },\r\n            { key: \"seatingArea\", label: \"Customer Seating\", maxImages: 3 },\r\n            { key: \"storageArea\", label: \"Back Office / Storage\", maxImages: 3 },\r\n            { key: \"parking\", label: \"Parking\", maxImages: 3 },\r\n            { key: \"floorPlan\", label: \"Floor Plan\", maxImages: 1 },\r\n            { key: \"other\", label: \"Other\", maxImages: 5 }\r\n        ],\r\n        \"Restaurant / Cafe\": [\r\n            { key: \"facade\", label: \"Exterior / Entrance\", maxImages: 4 },\r\n            { key: \"seatingArea\", label: \"Dining / Seating\", maxImages: 6 },\r\n            { key: \"kitchenCommercial\", label: \"Commercial Kitchen\", maxImages: 4 },\r\n            { key: \"washroom\", label: \"Washrooms\", maxImages: 3 },\r\n            { key: \"storageArea\", label: \"Storage / Prep Area\", maxImages: 3 },\r\n            { key: \"parking\", label: \"Parking / Valet\", maxImages: 3 },\r\n            { key: \"floorPlan\", label: \"Floor Plan\", maxImages: 1 },\r\n            { key: \"other\", label: \"Other\", maxImages: 5 }\r\n        ],\r\n        \"Co-Working Space\": [\r\n            { key: \"facade\", label: \"Exterior\", maxImages: 3 },\r\n            { key: \"reception\", label: \"Reception / Entry\", maxImages: 3 },\r\n            { key: \"workArea\", label: \"Open Desk Area\", maxImages: 6 },\r\n            { key: \"cabin\", label: \"Private Cabins\", maxImages: 4 },\r\n            { key: \"conferenceRoom\", label: \"Meeting Rooms\", maxImages: 3 },\r\n            { key: \"seatingArea\", label: \"Lounge / Breakout\", maxImages: 3 },\r\n            { key: \"pantry\", label: \"Pantry / Cafe\", maxImages: 3 },\r\n            { key: \"other\", label: \"Other\", maxImages: 5 }\r\n        ],\r\n        \"Warehouse / Godown\": [\r\n            { key: \"facade\", label: \"Warehouse Exterior\", maxImages: 3 },\r\n            { key: \"warehouse\", label: \"Main Storage Area\", maxImages: 8 },\r\n            { key: \"loadingArea\", label: \"Loading / Unloading\", maxImages: 4 },\r\n            { key: \"storageArea\", label: \"Racks / Internal Storage\", maxImages: 4 },\r\n            { key: \"parking\", label: \"Truck / Vehicle Parking\", maxImages: 3 },\r\n            { key: \"floorPlan\", label: \"Site / Floor Plan\", maxImages: 1 },\r\n            { key: \"other\", label: \"Other\", maxImages: 5 }\r\n        ],\r\n        \"Industrial Shed\": [\r\n            { key: \"facade\", label: \"Shed Exterior\", maxImages: 3 },\r\n            { key: \"warehouse\", label: \"Main Production Floor\", maxImages: 8 },\r\n            { key: \"loadingArea\", label: \"Loading Area\", maxImages: 4 },\r\n            { key: \"storageArea\", label: \"Storage / Raw Material\", maxImages: 4 },\r\n            { key: \"parking\", label: \"Parking / Yard\", maxImages: 3 },\r\n            { key: \"floorPlan\", label: \"Layout / Floor Plan\", maxImages: 1 },\r\n            { key: \"other\", label: \"Other\", maxImages: 5 }\r\n        ],\r\n        \"Commercial Building / Floor\": [\r\n            { key: \"facade\", label: \"Building Exterior\", maxImages: 4 },\r\n            { key: \"reception\", label: \"Main Lobby / Reception\", maxImages: 3 },\r\n            { key: \"workArea\", label: \"Typical Floor / Work Area\", maxImages: 6 },\r\n            { key: \"cabin\", label: \"Cabins / Offices\", maxImages: 4 },\r\n            { key: \"conferenceRoom\", label: \"Conference Rooms\", maxImages: 3 },\r\n            { key: \"parking\", label: \"Parking Levels\", maxImages: 4 },\r\n            { key: \"floorPlan\", label: \"Floor Plan\", maxImages: 2 },\r\n            { key: \"other\", label: \"Other\", maxImages: 5 }\r\n        ]\r\n    }\r\n};\r\n\r\nexport default function EditProperty() {\r\n    const navigate = useNavigate();\r\n    const { id } = useParams();\r\n\r\n    // Loading states\r\n    const [isLoading, setIsLoading] = useState(true);\r\n    const [isSaving, setIsSaving] = useState(false);\r\n    const [property, setProperty] = useState(null);\r\n\r\n    // UI state\r\n    const [currentStep, setCurrentStep] = useState(1);\r\n    const [direction, setDirection] = useState(0);\r\n    const [existingImages, setExistingImages] = useState([]);\r\n    const [existingCategorizedImages, setExistingCategorizedImages] = useState({});\r\n    const [categorizedImages, setCategorizedImages] = useState({});\r\n    const [expandedCategories, setExpandedCategories] = useState({});\r\n    const [imagesToRemove, setImagesToRemove] = useState([]);\r\n\r\n    const [formData, setFormData] = useState({\r\n        listingType: \"Rent\",\r\n        propertyCategory: \"Residential\",\r\n        propertyType: \"Apartment / Flat\",\r\n        bhkType: \"\",\r\n        bedrooms: \"\",\r\n        bathrooms: 1,\r\n        balconies: 0,\r\n        builtUpArea: \"\",\r\n        carpetArea: \"\",\r\n        superBuiltUpArea: \"\",\r\n        plotArea: \"\",\r\n        expectedPrice: \"\",\r\n        maintenanceIncluded: true,\r\n        maintenance: \"\",\r\n        expectedDeposit: \"\",\r\n        bookingAmount: \"\",\r\n        priceNegotiable: false,\r\n        furnishing: \"Unfurnished\",\r\n        floorNo: \"\",\r\n        totalFloors: \"\",\r\n        propertyAge: \"New\",\r\n        facing: \"\",\r\n        constructionStatus: \"Ready to Move\",\r\n        parkingCovered: 0,\r\n        parkingOpen: 0,\r\n        selectedAmenities: [],\r\n        servantRoom: false,\r\n        poojaRoom: false,\r\n        studyRoom: false,\r\n        storeRoom: false,\r\n        reraId: \"\",\r\n        availableFrom: new Date().toISOString().split('T')[0],\r\n        petFriendly: \"No\",\r\n        allowedFor: \"Family\",\r\n        city: \"\",\r\n        locality: \"\",\r\n        landmark: \"\",\r\n        address: \"\",\r\n        latitude: \"\",\r\n        longitude: \"\",\r\n        description: \"\",\r\n        title: \"\"\r\n    });\r\n\r\n    // Map state\r\n    const [mapPosition, setMapPosition] = useState(null);\r\n    const [isLocating, setIsLocating] = useState(false);\r\n    const defaultCenter = [20.5937, 78.9629];\r\n\r\n    // Location autocomplete state\r\n    const [locationSuggestions, setLocationSuggestions] = useState([]);\r\n    const [isSearchingLocation, setIsSearchingLocation] = useState(false);\r\n    const [activeLocationField, setActiveLocationField] = useState(null);\r\n    const [showSuggestions, setShowSuggestions] = useState(false);\r\n    const searchTimeoutRef = useRef(null);\r\n    const suggestionsRef = useRef(null);\r\n\r\n    // Auth using AuthContext\r\n    const { user: authUser, isAuthenticated, loading: authLoading } = useAuth();\r\n\r\n    // Auth check and fetch property\r\n    useEffect(() => {\r\n        if (authLoading) return;\r\n\r\n        if (!isAuthenticated || !authUser) {\r\n            toast.error(\"Please login to edit your property\");\r\n            navigate(\"/login\");\r\n            return;\r\n        }\r\n\r\n        if (authUser.role !== \"owner\" && authUser.role !== \"agent\") {\r\n            toast.error(\"Only property owners can edit properties\");\r\n            navigate(\"/\");\r\n            return;\r\n        }\r\n\r\n        fetchProperty();\r\n    }, [id, authLoading, isAuthenticated, authUser, navigate]);\r\n\r\n    const fetchProperty = async () => {\r\n        try {\r\n            setIsLoading(true);\r\n            // Use api client - it handles auth via cookies\r\n            const res = await api.get(`/properties/${id}`);\r\n\r\n            if (res.data) {\r\n                const prop = res.data;\r\n                setProperty(prop);\r\n\r\n                // Populate form data from property\r\n                setFormData({\r\n                    listingType: prop.listingType || \"Rent\",\r\n                    propertyCategory: prop.categoryName || \"Residential\",\r\n                    propertyType: prop.propertyTypeName || \"Apartment / Flat\",\r\n                    bhkType: prop.bhk || prop.bhkType || \"\",\r\n                    bedrooms: prop.bedrooms || \"\",\r\n                    bathrooms: prop.bathrooms || 1,\r\n                    balconies: prop.balconies || 0,\r\n                    builtUpArea: prop.builtUpArea || prop.area?.builtUpSqft || \"\",\r\n                    carpetArea: prop.carpetArea || prop.area?.carpetSqft || \"\",\r\n                    superBuiltUpArea: prop.superBuiltUpArea || prop.area?.superBuiltUpSqft || \"\",\r\n                    plotArea: prop.plotArea || prop.area?.plotSqft || \"\",\r\n                    expectedPrice: prop.price || prop.expectedPrice || \"\",\r\n                    maintenanceIncluded: prop.maintenanceIncluded ?? true,\r\n                    maintenance: prop.maintenance || \"\",\r\n                    expectedDeposit: prop.deposit || prop.expectedDeposit || \"\",\r\n                    bookingAmount: prop.bookingAmount || \"\",\r\n                    priceNegotiable: prop.negotiable || prop.priceNegotiable || false,\r\n                    furnishing: prop.furnishing || \"Unfurnished\",\r\n                    floorNo: prop.floorNo || prop.floor || \"\",\r\n                    totalFloors: prop.totalFloors || \"\",\r\n                    propertyAge: prop.propertyAge || \"New\",\r\n                    facing: prop.facing || \"\",\r\n                    constructionStatus: prop.constructionStatus || \"Ready to Move\",\r\n                    parkingCovered: prop.parking?.covered || 0,\r\n                    parkingOpen: prop.parking?.open || 0,\r\n                    selectedAmenities: prop.amenities || [],\r\n                    servantRoom: prop.extras?.servantRoom || prop.servantRoom || false,\r\n                    poojaRoom: prop.extras?.poojaRoom || prop.poojaRoom || false,\r\n                    studyRoom: prop.extras?.studyRoom || prop.studyRoom || false,\r\n                    storeRoom: prop.extras?.storeRoom || prop.storeRoom || false,\r\n                    reraId: prop.legal?.reraId || prop.reraId || \"\",\r\n                    availableFrom: prop.availableFrom ? new Date(prop.availableFrom).toISOString().split('T')[0] : new Date().toISOString().split('T')[0],\r\n                    petFriendly: prop.petFriendly || \"No\",\r\n                    allowedFor: prop.allowedFor || \"Family\",\r\n                    city: prop.city || prop.address?.city || \"\",\r\n                    locality: prop.locality || prop.address?.area || \"\",\r\n                    landmark: prop.landmark || prop.address?.landmark || \"\",\r\n                    address: prop.address?.full || prop.fullAddress || \"\",\r\n                    latitude: prop.latitude || prop.address?.latitude || prop.location?.coordinates?.[1] || \"\",\r\n                    longitude: prop.longitude || prop.address?.longitude || prop.location?.coordinates?.[0] || \"\",\r\n                    description: prop.description || \"\",\r\n                    title: prop.title || \"\"\r\n                });\r\n\r\n                // Set existing categorized images\r\n                const existingCatImages = {};\r\n                const categoryType = prop.categoryName?.toLowerCase() || \"residential\";\r\n\r\n                if (prop.categorizedImages) {\r\n                    const catImages = prop.categorizedImages[categoryType] || prop.categorizedImages.residential || prop.categorizedImages.commercial;\r\n                    if (catImages) {\r\n                        Object.keys(catImages).forEach(key => {\r\n                            if (Array.isArray(catImages[key]) && catImages[key].length > 0) {\r\n                                existingCatImages[key] = catImages[key];\r\n                            }\r\n                        });\r\n                    }\r\n                }\r\n\r\n                // If no categorized images, put all images in \"other\" category\r\n                if (Object.keys(existingCatImages).length === 0 && prop.images?.length > 0) {\r\n                    existingCatImages.other = prop.images;\r\n                }\r\n\r\n                setExistingCategorizedImages(existingCatImages);\r\n\r\n                // Flatten for display purposes\r\n                const allImages = [];\r\n                Object.values(existingCatImages).forEach(imgs => {\r\n                    if (Array.isArray(imgs)) allImages.push(...imgs);\r\n                });\r\n                setExistingImages(allImages);\r\n\r\n                // Set map position if coordinates exist\r\n                if (prop.latitude && prop.longitude) {\r\n                    setMapPosition([parseFloat(prop.latitude), parseFloat(prop.longitude)]);\r\n                } else if (prop.location?.coordinates?.length === 2) {\r\n                    setMapPosition([prop.location.coordinates[1], prop.location.coordinates[0]]);\r\n                }\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Error fetching property:\", error);\r\n            toast.error(\"Failed to load property\");\r\n            navigate(\"/my-properties\");\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    // Get image categories based on property type\r\n    const getImageCategories = () => {\r\n        const category = formData.propertyCategory;\r\n        const type = formData.propertyType;\r\n\r\n        if (IMAGE_CATEGORIES[category] && IMAGE_CATEGORIES[category][type]) {\r\n            return IMAGE_CATEGORIES[category][type];\r\n        }\r\n\r\n        // Default categories\r\n        return [\r\n            { key: \"exterior\", label: \"Exterior\", maxImages: 3 },\r\n            { key: \"interior\", label: \"Interior\", maxImages: 5 },\r\n            { key: \"other\", label: \"Other\", maxImages: 5 }\r\n        ];\r\n    };\r\n\r\n    // Handle categorized image upload\r\n    const handleCategorizedImageUpload = (categoryKey, e) => {\r\n        const files = Array.from(e.target.files);\r\n        const categories = getImageCategories();\r\n        const categoryConfig = categories.find(c => c.key === categoryKey);\r\n        const maxImages = categoryConfig?.maxImages || 5;\r\n\r\n        const existingCount = (existingCategorizedImages[categoryKey]?.length || 0) + (categorizedImages[categoryKey]?.files?.length || 0);\r\n        const remainingSlots = maxImages - existingCount;\r\n\r\n        if (files.length > remainingSlots) {\r\n            toast.error(`You can only add ${remainingSlots} more image(s) to this category (max: ${maxImages})`);\r\n            return;\r\n        }\r\n\r\n        const previews = files.map(file => URL.createObjectURL(file));\r\n\r\n        setCategorizedImages(prev => ({\r\n            ...prev,\r\n            [categoryKey]: {\r\n                files: [...(prev[categoryKey]?.files || []), ...files],\r\n                previews: [...(prev[categoryKey]?.previews || []), ...previews]\r\n            }\r\n        }));\r\n    };\r\n\r\n    // Remove image from category\r\n    const removeCategorizedImage = (categoryKey, index, isExisting = false) => {\r\n        if (isExisting) {\r\n            // Mark existing image for removal\r\n            const imageUrl = existingCategorizedImages[categoryKey][index];\r\n            setImagesToRemove(prev => [...prev, imageUrl]);\r\n\r\n            setExistingCategorizedImages(prev => ({\r\n                ...prev,\r\n                [categoryKey]: prev[categoryKey].filter((_, i) => i !== index)\r\n            }));\r\n        } else {\r\n            // Remove new image preview\r\n            setCategorizedImages(prev => {\r\n                const newCat = { ...prev[categoryKey] };\r\n                URL.revokeObjectURL(newCat.previews[index]);\r\n                newCat.files = newCat.files.filter((_, i) => i !== index);\r\n                newCat.previews = newCat.previews.filter((_, i) => i !== index);\r\n                return { ...prev, [categoryKey]: newCat };\r\n            });\r\n        }\r\n    };\r\n\r\n    // Get total count of categorized images\r\n    const getTotalCategorizedImages = () => {\r\n        let count = 0;\r\n        Object.values(existingCategorizedImages).forEach(imgs => {\r\n            count += imgs?.length || 0;\r\n        });\r\n        Object.values(categorizedImages).forEach(cat => {\r\n            count += cat.files?.length || 0;\r\n        });\r\n        return count;\r\n    };\r\n\r\n    // Toggle category expansion\r\n    const toggleCategory = (categoryKey) => {\r\n        setExpandedCategories(prev => ({\r\n            ...prev,\r\n            [categoryKey]: !prev[categoryKey]\r\n        }));\r\n    };\r\n\r\n    const handleChange = (e) => {\r\n        const { name, value, type, checked } = e.target;\r\n        setFormData(prev => ({ ...prev, [name]: type === \"checkbox\" ? checked : value }));\r\n    };\r\n\r\n    const handleAmenityToggle = (amenity) => {\r\n        setFormData(prev => ({\r\n            ...prev,\r\n            selectedAmenities: prev.selectedAmenities.includes(amenity)\r\n                ? prev.selectedAmenities.filter(a => a !== amenity)\r\n                : [...prev.selectedAmenities, amenity]\r\n        }));\r\n    };\r\n\r\n    // Location search\r\n    const searchLocations = async (query, field) => {\r\n        if (!query || query.length < 3) {\r\n            setLocationSuggestions([]);\r\n            return;\r\n        }\r\n\r\n        setIsSearchingLocation(true);\r\n        try {\r\n            const response = await fetch(\r\n                `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}, India&limit=5&addressdetails=1`,\r\n                { headers: { 'User-Agent': 'DealDirect Property App' } }\r\n            );\r\n            const data = await response.json();\r\n            setLocationSuggestions(data);\r\n            setShowSuggestions(true);\r\n        } catch (error) {\r\n            console.error(\"Error searching locations:\", error);\r\n        } finally {\r\n            setIsSearchingLocation(false);\r\n        }\r\n    };\r\n\r\n    const handleLocationInputChange = (e, field) => {\r\n        const value = e.target.value;\r\n        setFormData(prev => ({ ...prev, [field]: value }));\r\n        setActiveLocationField(field);\r\n\r\n        if (searchTimeoutRef.current) clearTimeout(searchTimeoutRef.current);\r\n        searchTimeoutRef.current = setTimeout(() => searchLocations(value, field), 300);\r\n    };\r\n\r\n    const handleLocationSelect = (suggestion) => {\r\n        const address = suggestion.address || {};\r\n        setFormData(prev => ({\r\n            ...prev,\r\n            city: address.city || address.town || address.village || address.state_district || prev.city,\r\n            locality: address.suburb || address.neighbourhood || address.hamlet || prev.locality,\r\n            address: suggestion.display_name,\r\n            latitude: suggestion.lat,\r\n            longitude: suggestion.lon\r\n        }));\r\n        setMapPosition([parseFloat(suggestion.lat), parseFloat(suggestion.lon)]);\r\n        setShowSuggestions(false);\r\n        setLocationSuggestions([]);\r\n    };\r\n\r\n    const getCurrentLocation = () => {\r\n        if (!navigator.geolocation) {\r\n            toast.error(\"Geolocation not supported\");\r\n            return;\r\n        }\r\n\r\n        setIsLocating(true);\r\n        navigator.geolocation.getCurrentPosition(\r\n            async (position) => {\r\n                const { latitude, longitude } = position.coords;\r\n                setMapPosition([latitude, longitude]);\r\n                setFormData(prev => ({\r\n                    ...prev,\r\n                    latitude: latitude.toFixed(6),\r\n                    longitude: longitude.toFixed(6)\r\n                }));\r\n\r\n                // Reverse geocode\r\n                try {\r\n                    const response = await fetch(\r\n                        `https://nominatim.openstreetmap.org/reverse?format=json&lat=${latitude}&lon=${longitude}&addressdetails=1`,\r\n                        { headers: { 'User-Agent': 'DealDirect Property App' } }\r\n                    );\r\n                    const data = await response.json();\r\n                    if (data.address) {\r\n                        setFormData(prev => ({\r\n                            ...prev,\r\n                            city: data.address.city || data.address.town || data.address.village || data.address.state_district || \"\",\r\n                            locality: data.address.suburb || data.address.neighbourhood || data.address.hamlet || \"\",\r\n                            landmark: data.address.road || \"\",\r\n                            address: data.display_name || \"\"\r\n                        }));\r\n                    }\r\n                } catch (error) {\r\n                    console.error(\"Error reverse geocoding:\", error);\r\n                }\r\n                setIsLocating(false);\r\n            },\r\n            (error) => {\r\n                toast.error(\"Could not get your location\");\r\n                setIsLocating(false);\r\n            },\r\n            { enableHighAccuracy: true }\r\n        );\r\n    };\r\n\r\n    const handleNext = () => {\r\n        setDirection(1);\r\n        setCurrentStep(prev => Math.min(prev + 1, 6));\r\n    };\r\n\r\n    const handlePrev = () => {\r\n        setDirection(-1);\r\n        setCurrentStep(prev => Math.max(prev - 1, 1));\r\n    };\r\n\r\n    const handleSubmit = async () => {\r\n        setIsSaving(true);\r\n        try {\r\n            const formDataToSend = new FormData();\r\n\r\n            // Add all form fields\r\n            Object.entries(formData).forEach(([key, value]) => {\r\n                if (key === 'selectedAmenities') {\r\n                    formDataToSend.append('amenities', JSON.stringify(value));\r\n                } else if (typeof value === 'object') {\r\n                    formDataToSend.append(key, JSON.stringify(value));\r\n                } else {\r\n                    formDataToSend.append(key, value);\r\n                }\r\n            });\r\n\r\n            // Add parking data\r\n            formDataToSend.append('parking', JSON.stringify({\r\n                covered: formData.parkingCovered,\r\n                open: formData.parkingOpen\r\n            }));\r\n\r\n            // Add price field\r\n            formDataToSend.append('price', formData.expectedPrice);\r\n\r\n            // Add categorized new images and build category map\r\n            const imageCategoryMap = [];\r\n            let imageIndex = 0;\r\n\r\n            Object.entries(categorizedImages).forEach(([categoryKey, categoryData]) => {\r\n                if (categoryData.files && categoryData.files.length > 0) {\r\n                    categoryData.files.forEach(file => {\r\n                        formDataToSend.append('images', file);\r\n                        imageCategoryMap.push({\r\n                            index: imageIndex,\r\n                            category: categoryKey\r\n                        });\r\n                        imageIndex++;\r\n                    });\r\n                }\r\n            });\r\n\r\n            // Add category map\r\n            formDataToSend.append('imageCategoryMap', JSON.stringify(imageCategoryMap));\r\n\r\n            // Add images to remove\r\n            if (imagesToRemove.length > 0) {\r\n                formDataToSend.append('imagesToRemove', JSON.stringify(imagesToRemove));\r\n            }\r\n\r\n            // Add existing categorized images\r\n            formDataToSend.append('existingCategorizedImages', JSON.stringify(existingCategorizedImages));\r\n\r\n            // Use api client - handles auth via cookies\r\n            const res = await api.put(\r\n                `/properties/my-properties/${id}`,\r\n                formDataToSend,\r\n                {\r\n                    headers: {\r\n                        'Content-Type': 'multipart/form-data'\r\n                    }\r\n                }\r\n            );\r\n\r\n            if (res.data.success) {\r\n                toast.success(\"Property updated successfully!\");\r\n                navigate(\"/my-properties\");\r\n            } else {\r\n                toast.error(res.data.message || \"Failed to update property\");\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Error updating property:\", error);\r\n            toast.error(error.response?.data?.message || \"Failed to update property\");\r\n        } finally {\r\n            setIsSaving(false);\r\n        }\r\n    };\r\n\r\n    const isResidential = formData.propertyCategory === \"Residential\";\r\n\r\n    // Animation variants\r\n    const variants = {\r\n        enter: (direction) => ({ x: direction > 0 ? 20 : -20, opacity: 0 }),\r\n        center: { x: 0, opacity: 1 },\r\n        exit: (direction) => ({ x: direction < 0 ? 20 : -20, opacity: 0 }),\r\n    };\r\n\r\n    if (isLoading) {\r\n        return (\r\n            <div className=\"min-h-screen bg-gray-50 pt-24 flex items-center justify-center\">\r\n                <div className=\"text-center\">\r\n                    <Loader2 className=\"w-10 h-10 text-blue-600 animate-spin mx-auto mb-4\" />\r\n                    <p className=\"text-gray-600\">Loading property details...</p>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // Render Steps\r\n    const renderStep1 = () => (\r\n        <div className=\"space-y-8\">\r\n            <div className=\"text-center\">\r\n                <h2 className=\"text-3xl font-bold text-gray-900\">Edit Property</h2>\r\n                <p className=\"text-gray-500 mt-2\">Update your property listing information</p>\r\n            </div>\r\n\r\n            {/* Listing Type */}\r\n            <div className=\"grid grid-cols-2 gap-4\">\r\n                {[\"Rent\", \"Sell\"].map(type => (\r\n                    <button\r\n                        key={type}\r\n                        type=\"button\"\r\n                        onClick={() => setFormData(p => ({ ...p, listingType: type }))}\r\n                        className={`p-6 rounded-2xl border-2 transition-all ${formData.listingType === type\r\n                            ? \"border-blue-600 bg-blue-50 ring-4 ring-blue-100\"\r\n                            : \"border-gray-200 hover:border-gray-300 bg-white\"\r\n                            }`}\r\n                    >\r\n                        <div className={`text-xl font-bold ${formData.listingType === type ? \"text-blue-600\" : \"text-gray-700\"}`}>\r\n                            {type === \"Rent\" ? \"For Rent\" : \"For Sale\"}\r\n                        </div>\r\n                    </button>\r\n                ))}\r\n            </div>\r\n\r\n            {/* Property Category */}\r\n            <div>\r\n                <label className=\"block text-sm font-semibold text-gray-700 mb-3\">Property Category</label>\r\n                <div className=\"grid grid-cols-2 gap-4\">\r\n                    {Object.entries(PROPERTY_CATEGORIES).map(([cat, config]) => (\r\n                        <button\r\n                            key={cat}\r\n                            type=\"button\"\r\n                            onClick={() => setFormData(p => ({ ...p, propertyCategory: cat, propertyType: config.types[0] }))}\r\n                            className={`p-6 rounded-2xl border-2 transition-all flex flex-col items-center gap-3 ${formData.propertyCategory === cat\r\n                                ? \"border-blue-600 bg-blue-50 ring-4 ring-blue-100\"\r\n                                : \"border-gray-200 hover:border-gray-300 bg-white\"\r\n                                }`}\r\n                        >\r\n                            <div className={formData.propertyCategory === cat ? \"text-blue-600\" : \"text-gray-400\"}>\r\n                                {config.icon}\r\n                            </div>\r\n                            <span className={`font-bold ${formData.propertyCategory === cat ? \"text-blue-600\" : \"text-gray-700\"}`}>\r\n                                {cat}\r\n                            </span>\r\n                        </button>\r\n                    ))}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Property Type */}\r\n            <div>\r\n                <label className=\"block text-sm font-semibold text-gray-700 mb-3\">Property Type</label>\r\n                <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3\">\r\n                    {PROPERTY_CATEGORIES[formData.propertyCategory].types.map(type => (\r\n                        <button\r\n                            key={type}\r\n                            type=\"button\"\r\n                            onClick={() => setFormData(p => ({ ...p, propertyType: type }))}\r\n                            className={`p-4 rounded-xl border-2 text-sm font-medium transition-all ${formData.propertyType === type\r\n                                ? \"border-blue-600 bg-blue-50 text-blue-600\"\r\n                                : \"border-gray-200 text-gray-600 hover:border-gray-300\"\r\n                                }`}\r\n                        >\r\n                            {type}\r\n                        </button>\r\n                    ))}\r\n                </div>\r\n            </div>\r\n\r\n            {/* BHK for Residential */}\r\n            {isResidential && (\r\n                <div>\r\n                    <label className=\"block text-sm font-semibold text-gray-700 mb-3\">BHK Type</label>\r\n                    <div className=\"grid grid-cols-5 gap-3\">\r\n                        {[\"1 BHK\", \"2 BHK\", \"3 BHK\", \"4 BHK\", \"5+ BHK\"].map(bhk => (\r\n                            <button\r\n                                key={bhk}\r\n                                type=\"button\"\r\n                                onClick={() => setFormData(p => ({ ...p, bhkType: bhk, bedrooms: bhk.split(\" \")[0] }))}\r\n                                className={`p-4 rounded-xl border-2 font-medium transition-all ${formData.bhkType === bhk\r\n                                    ? \"border-blue-600 bg-blue-50 text-blue-600\"\r\n                                    : \"border-gray-200 text-gray-600 hover:border-gray-300\"\r\n                                    }`}\r\n                            >\r\n                                {bhk}\r\n                            </button>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n\r\n    const renderStep2 = () => (\r\n        <div className=\"space-y-6\">\r\n            <div className=\"text-center\">\r\n                <h2 className=\"text-3xl font-bold text-gray-900\">Location Details</h2>\r\n                <p className=\"text-gray-500 mt-2\">Update property location information</p>\r\n            </div>\r\n\r\n            <div className=\"grid md:grid-cols-2 gap-6\">\r\n                <div className=\"relative\">\r\n                    <label className=\"block text-sm font-semibold text-gray-700 mb-2\">City *</label>\r\n                    <input\r\n                        type=\"text\"\r\n                        name=\"city\"\r\n                        value={formData.city}\r\n                        onChange={(e) => handleLocationInputChange(e, 'city')}\r\n                        placeholder=\"Enter city\"\r\n                        className=\"w-full px-4 py-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none\"\r\n                    />\r\n                    {showSuggestions && activeLocationField === 'city' && locationSuggestions.length > 0 && (\r\n                        <div className=\"absolute z-50 w-full mt-1 bg-white border border-gray-200 rounded-xl shadow-lg max-h-60 overflow-auto\">\r\n                            {locationSuggestions.map((suggestion, idx) => (\r\n                                <button\r\n                                    key={idx}\r\n                                    type=\"button\"\r\n                                    onClick={() => handleLocationSelect(suggestion)}\r\n                                    className=\"w-full px-4 py-3 text-left hover:bg-gray-50 border-b border-gray-100 last:border-0\"\r\n                                >\r\n                                    <p className=\"font-medium text-gray-900 text-sm\">{suggestion.display_name}</p>\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                <div className=\"relative\">\r\n                    <label className=\"block text-sm font-semibold text-gray-700 mb-2\">Locality / Area *</label>\r\n                    <input\r\n                        type=\"text\"\r\n                        name=\"locality\"\r\n                        value={formData.locality}\r\n                        onChange={(e) => handleLocationInputChange(e, 'locality')}\r\n                        placeholder=\"Enter locality\"\r\n                        className=\"w-full px-4 py-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none\"\r\n                    />\r\n                </div>\r\n\r\n                <div>\r\n                    <label className=\"block text-sm font-semibold text-gray-700 mb-2\">Landmark</label>\r\n                    <input\r\n                        type=\"text\"\r\n                        name=\"landmark\"\r\n                        value={formData.landmark}\r\n                        onChange={handleChange}\r\n                        placeholder=\"Nearby landmark\"\r\n                        className=\"w-full px-4 py-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none\"\r\n                    />\r\n                </div>\r\n\r\n                <div>\r\n                    <label className=\"block text-sm font-semibold text-gray-700 mb-2\">Full Address</label>\r\n                    <input\r\n                        type=\"text\"\r\n                        name=\"address\"\r\n                        value={formData.address}\r\n                        onChange={(e) => handleLocationInputChange(e, 'address')}\r\n                        placeholder=\"Complete address\"\r\n                        className=\"w-full px-4 py-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none\"\r\n                    />\r\n                </div>\r\n            </div>\r\n\r\n            {/* Map Section */}\r\n            <div className=\"bg-gray-50 rounded-2xl p-6 border border-gray-200\">\r\n                <div className=\"flex items-center justify-between mb-4\">\r\n                    <div>\r\n                        <h3 className=\"font-semibold text-gray-900\">Pin Location on Map</h3>\r\n                        <p className=\"text-sm text-gray-500\">Click on the map or use current location</p>\r\n                    </div>\r\n                    <button\r\n                        type=\"button\"\r\n                        onClick={getCurrentLocation}\r\n                        disabled={isLocating}\r\n                        className=\"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-xl text-sm font-medium hover:bg-blue-700 transition disabled:opacity-50\"\r\n                    >\r\n                        {isLocating ? <Loader2 className=\"w-4 h-4 animate-spin\" /> : <Navigation className=\"w-4 h-4\" />}\r\n                        {isLocating ? \"Locating...\" : \"Use My Location\"}\r\n                    </button>\r\n                </div>\r\n\r\n                <div className=\"h-[300px] rounded-xl overflow-hidden border border-gray-200\">\r\n                    <MapContainer\r\n                        center={mapPosition || defaultCenter}\r\n                        zoom={mapPosition ? 15 : 5}\r\n                        style={{ height: \"100%\", width: \"100%\" }}\r\n                    >\r\n                        <TileLayer\r\n                            attribution='&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a>'\r\n                            url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\r\n                        />\r\n                        <LocationMarker position={mapPosition} setPosition={setMapPosition} setFormData={setFormData} />\r\n                        {mapPosition && <RecenterMap position={mapPosition} />}\r\n                    </MapContainer>\r\n                </div>\r\n\r\n                {formData.latitude && formData.longitude && (\r\n                    <div className=\"mt-3 flex gap-4 text-sm text-gray-600\">\r\n                        <span>Lat: {formData.latitude}</span>\r\n                        <span>Lng: {formData.longitude}</span>\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n\r\n    const renderStep3 = () => (\r\n        <div className=\"space-y-6\">\r\n            <div className=\"text-center\">\r\n                <h2 className=\"text-3xl font-bold text-gray-900\">Pricing & Area</h2>\r\n                <p className=\"text-gray-500 mt-2\">Update price and property dimensions</p>\r\n            </div>\r\n\r\n            <div className=\"grid md:grid-cols-2 gap-6\">\r\n                <div>\r\n                    <label className=\"block text-sm font-semibold text-gray-700 mb-2\">\r\n                        {formData.listingType === \"Rent\" ? \"Monthly Rent\" : \"Expected Price\"} (Γé╣) *\r\n                    </label>\r\n                    <input\r\n                        type=\"number\"\r\n                        name=\"expectedPrice\"\r\n                        value={formData.expectedPrice}\r\n                        onChange={handleChange}\r\n                        placeholder=\"Enter amount\"\r\n                        className=\"w-full px-4 py-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none\"\r\n                    />\r\n                </div>\r\n\r\n                {formData.listingType === \"Rent\" && (\r\n                    <div>\r\n                        <label className=\"block text-sm font-semibold text-gray-700 mb-2\">Security Deposit (Γé╣)</label>\r\n                        <input\r\n                            type=\"number\"\r\n                            name=\"expectedDeposit\"\r\n                            value={formData.expectedDeposit}\r\n                            onChange={handleChange}\r\n                            placeholder=\"Deposit amount\"\r\n                            className=\"w-full px-4 py-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none\"\r\n                        />\r\n                    </div>\r\n                )}\r\n\r\n                <div>\r\n                    <label className=\"block text-sm font-semibold text-gray-700 mb-2\">Built-up Area (sq.ft) *</label>\r\n                    <input\r\n                        type=\"number\"\r\n                        name=\"builtUpArea\"\r\n                        value={formData.builtUpArea}\r\n                        onChange={handleChange}\r\n                        placeholder=\"Enter area\"\r\n                        className=\"w-full px-4 py-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none\"\r\n                    />\r\n                </div>\r\n\r\n                <div>\r\n                    <label className=\"block text-sm font-semibold text-gray-700 mb-2\">Carpet Area (sq.ft)</label>\r\n                    <input\r\n                        type=\"number\"\r\n                        name=\"carpetArea\"\r\n                        value={formData.carpetArea}\r\n                        onChange={handleChange}\r\n                        placeholder=\"Enter carpet area\"\r\n                        className=\"w-full px-4 py-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none\"\r\n                    />\r\n                </div>\r\n\r\n                <div className=\"flex items-center gap-3\">\r\n                    <input\r\n                        type=\"checkbox\"\r\n                        id=\"priceNegotiable\"\r\n                        name=\"priceNegotiable\"\r\n                        checked={formData.priceNegotiable}\r\n                        onChange={handleChange}\r\n                        className=\"w-5 h-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500\"\r\n                    />\r\n                    <label htmlFor=\"priceNegotiable\" className=\"text-sm font-medium text-gray-700\">Price is Negotiable</label>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n\r\n    const renderStep4 = () => (\r\n        <div className=\"space-y-6\">\r\n            <div className=\"text-center\">\r\n                <h2 className=\"text-3xl font-bold text-gray-900\">Property Details</h2>\r\n                <p className=\"text-gray-500 mt-2\">Update additional property information</p>\r\n            </div>\r\n\r\n            <div className=\"grid md:grid-cols-2 gap-6\">\r\n                <div>\r\n                    <label className=\"block text-sm font-semibold text-gray-700 mb-2\">Furnishing Status</label>\r\n                    <select\r\n                        name=\"furnishing\"\r\n                        value={formData.furnishing}\r\n                        onChange={handleChange}\r\n                        className=\"w-full px-4 py-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none\"\r\n                    >\r\n                        <option value=\"Unfurnished\">Unfurnished</option>\r\n                        <option value=\"Semi-Furnished\">Semi-Furnished</option>\r\n                        <option value=\"Fully Furnished\">Fully Furnished</option>\r\n                    </select>\r\n                </div>\r\n\r\n                <div>\r\n                    <label className=\"block text-sm font-semibold text-gray-700 mb-2\">Construction Status</label>\r\n                    <select\r\n                        name=\"constructionStatus\"\r\n                        value={formData.constructionStatus}\r\n                        onChange={handleChange}\r\n                        className=\"w-full px-4 py-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none\"\r\n                    >\r\n                        <option value=\"Ready to Move\">Ready to Move</option>\r\n                        <option value=\"Under Construction\">Under Construction</option>\r\n                        <option value=\"New Launch\">New Launch</option>\r\n                    </select>\r\n                </div>\r\n\r\n                <div>\r\n                    <label className=\"block text-sm font-semibold text-gray-700 mb-2\">Floor Number</label>\r\n                    <input\r\n                        type=\"number\"\r\n                        name=\"floorNo\"\r\n                        value={formData.floorNo}\r\n                        onChange={handleChange}\r\n                        placeholder=\"Floor number\"\r\n                        className=\"w-full px-4 py-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none\"\r\n                    />\r\n                </div>\r\n\r\n                <div>\r\n                    <label className=\"block text-sm font-semibold text-gray-700 mb-2\">Total Floors</label>\r\n                    <input\r\n                        type=\"number\"\r\n                        name=\"totalFloors\"\r\n                        value={formData.totalFloors}\r\n                        onChange={handleChange}\r\n                        placeholder=\"Total floors in building\"\r\n                        className=\"w-full px-4 py-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none\"\r\n                    />\r\n                </div>\r\n\r\n                <div>\r\n                    <label className=\"block text-sm font-semibold text-gray-700 mb-2\">Bathrooms</label>\r\n                    <input\r\n                        type=\"number\"\r\n                        name=\"bathrooms\"\r\n                        value={formData.bathrooms}\r\n                        onChange={handleChange}\r\n                        min=\"1\"\r\n                        className=\"w-full px-4 py-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none\"\r\n                    />\r\n                </div>\r\n\r\n                <div>\r\n                    <label className=\"block text-sm font-semibold text-gray-700 mb-2\">Balconies</label>\r\n                    <input\r\n                        type=\"number\"\r\n                        name=\"balconies\"\r\n                        value={formData.balconies}\r\n                        onChange={handleChange}\r\n                        min=\"0\"\r\n                        className=\"w-full px-4 py-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none\"\r\n                    />\r\n                </div>\r\n\r\n                <div>\r\n                    <label className=\"block text-sm font-semibold text-gray-700 mb-2\">Facing</label>\r\n                    <select\r\n                        name=\"facing\"\r\n                        value={formData.facing}\r\n                        onChange={handleChange}\r\n                        className=\"w-full px-4 py-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none\"\r\n                    >\r\n                        <option value=\"\">Select Facing</option>\r\n                        <option value=\"North\">North</option>\r\n                        <option value=\"South\">South</option>\r\n                        <option value=\"East\">East</option>\r\n                        <option value=\"West\">West</option>\r\n                        <option value=\"North-East\">North-East</option>\r\n                        <option value=\"North-West\">North-West</option>\r\n                        <option value=\"South-East\">South-East</option>\r\n                        <option value=\"South-West\">South-West</option>\r\n                    </select>\r\n                </div>\r\n\r\n                <div>\r\n                    <label className=\"block text-sm font-semibold text-gray-700 mb-2\">Available From</label>\r\n                    <input\r\n                        type=\"date\"\r\n                        name=\"availableFrom\"\r\n                        value={formData.availableFrom}\r\n                        onChange={handleChange}\r\n                        className=\"w-full px-4 py-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none\"\r\n                    />\r\n                </div>\r\n            </div>\r\n\r\n            {/* Amenities */}\r\n            <div>\r\n                <label className=\"block text-sm font-semibold text-gray-700 mb-3\">Amenities</label>\r\n                <div className=\"flex flex-wrap gap-2\">\r\n                    {PROPERTY_CATEGORIES[formData.propertyCategory].amenities.map(amenity => (\r\n                        <button\r\n                            key={amenity}\r\n                            type=\"button\"\r\n                            onClick={() => handleAmenityToggle(amenity)}\r\n                            className={`px-4 py-2 rounded-full text-sm font-medium transition-all ${formData.selectedAmenities.includes(amenity)\r\n                                ? \"bg-blue-600 text-white\"\r\n                                : \"bg-gray-100 text-gray-600 hover:bg-gray-200\"\r\n                                }`}\r\n                        >\r\n                            {amenity}\r\n                        </button>\r\n                    ))}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Description */}\r\n            <div>\r\n                <label className=\"block text-sm font-semibold text-gray-700 mb-2\">Description</label>\r\n                <textarea\r\n                    name=\"description\"\r\n                    value={formData.description}\r\n                    onChange={handleChange}\r\n                    rows={4}\r\n                    placeholder=\"Describe your property...\"\r\n                    className=\"w-full px-4 py-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none resize-none\"\r\n                />\r\n            </div>\r\n        </div>\r\n    );\r\n\r\n    const renderStep5 = () => {\r\n        const categories = getImageCategories();\r\n        const totalImages = getTotalCategorizedImages();\r\n\r\n        return (\r\n            <div className=\"space-y-6\">\r\n                <div className=\"text-center\">\r\n                    <h2 className=\"text-3xl font-bold text-gray-900\">Property Photos</h2>\r\n                    <p className=\"text-gray-500 mt-2\">\r\n                        Organize your property images by category ΓÇó {totalImages} image{totalImages !== 1 ? 's' : ''} total\r\n                    </p>\r\n                </div>\r\n\r\n                <div className=\"space-y-4\">\r\n                    {categories.map((category) => {\r\n                        const existingCount = existingCategorizedImages[category.key]?.length || 0;\r\n                        const newCount = categorizedImages[category.key]?.files?.length || 0;\r\n                        const totalCatImages = existingCount + newCount;\r\n                        const isExpanded = expandedCategories[category.key] !== false;\r\n\r\n                        return (\r\n                            <div key={category.key} className=\"border border-gray-200 rounded-xl overflow-hidden\">\r\n                                {/* Category Header */}\r\n                                <button\r\n                                    type=\"button\"\r\n                                    onClick={() => toggleCategory(category.key)}\r\n                                    className=\"w-full px-4 py-3 bg-gray-50 flex items-center justify-between hover:bg-gray-100 transition-colors\"\r\n                                >\r\n                                    <div className=\"flex items-center gap-3\">\r\n                                        <ImageIcon size={20} className=\"text-blue-500\" />\r\n                                        <span className=\"font-medium text-gray-800\">{category.label}</span>\r\n                                        <span className=\"text-sm text-gray-500\">\r\n                                            ({totalCatImages}/{category.maxImages})\r\n                                        </span>\r\n                                    </div>\r\n                                    <motion.div\r\n                                        animate={{ rotate: isExpanded ? 180 : 0 }}\r\n                                        transition={{ duration: 0.2 }}\r\n                                    >\r\n                                        <ChevronLeft className=\"transform -rotate-90\" size={20} />\r\n                                    </motion.div>\r\n                                </button>\r\n\r\n                                {/* Category Content */}\r\n                                <AnimatePresence>\r\n                                    {isExpanded && (\r\n                                        <motion.div\r\n                                            initial={{ height: 0, opacity: 0 }}\r\n                                            animate={{ height: \"auto\", opacity: 1 }}\r\n                                            exit={{ height: 0, opacity: 0 }}\r\n                                            transition={{ duration: 0.2 }}\r\n                                            className=\"overflow-hidden\"\r\n                                        >\r\n                                            <div className=\"p-4\">\r\n                                                {/* Existing Images */}\r\n                                                <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3 mb-4\">\r\n                                                    {existingCategorizedImages[category.key]?.map((img, idx) => (\r\n                                                        <div key={`existing-${idx}`} className=\"relative group aspect-square rounded-lg overflow-hidden border border-gray-200\">\r\n                                                            <img src={img} alt={`${category.label} ${idx + 1}`} className=\"w-full h-full object-cover\" />\r\n                                                            <button\r\n                                                                type=\"button\"\r\n                                                                onClick={() => removeCategorizedImage(category.key, idx, true)}\r\n                                                                className=\"absolute top-2 right-2 p-1.5 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity\"\r\n                                                            >\r\n                                                                <X size={12} />\r\n                                                            </button>\r\n                                                            <span className=\"absolute bottom-2 left-2 text-xs bg-black/50 text-white px-2 py-0.5 rounded\">\r\n                                                                Current\r\n                                                            </span>\r\n                                                        </div>\r\n                                                    ))}\r\n\r\n                                                    {/* New Image Previews */}\r\n                                                    {categorizedImages[category.key]?.previews?.map((preview, idx) => (\r\n                                                        <div key={`new-${idx}`} className=\"relative group aspect-square rounded-lg overflow-hidden border-2 border-green-400\">\r\n                                                            <img src={preview} alt={`New ${idx + 1}`} className=\"w-full h-full object-cover\" />\r\n                                                            <button\r\n                                                                type=\"button\"\r\n                                                                onClick={() => removeCategorizedImage(category.key, idx, false)}\r\n                                                                className=\"absolute top-2 right-2 p-1.5 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity\"\r\n                                                            >\r\n                                                                <X size={12} />\r\n                                                            </button>\r\n                                                            <span className=\"absolute bottom-2 left-2 text-xs bg-green-500 text-white px-2 py-0.5 rounded\">\r\n                                                                New\r\n                                                            </span>\r\n                                                        </div>\r\n                                                    ))}\r\n\r\n                                                    {/* Upload Button */}\r\n                                                    {totalCatImages < category.maxImages && (\r\n                                                        <label className=\"aspect-square rounded-lg border-2 border-dashed border-gray-300 flex flex-col items-center justify-center cursor-pointer hover:border-blue-500 hover:bg-blue-50 transition-colors\">\r\n                                                            <input\r\n                                                                type=\"file\"\r\n                                                                accept=\"image/*\"\r\n                                                                multiple\r\n                                                                onChange={(e) => handleCategorizedImageUpload(category.key, e)}\r\n                                                                className=\"hidden\"\r\n                                                            />\r\n                                                            <Plus size={24} className=\"text-gray-400\" />\r\n                                                            <span className=\"text-xs text-gray-500 mt-1\">Add</span>\r\n                                                        </label>\r\n                                                    )}\r\n                                                </div>\r\n\r\n                                                {totalCatImages === 0 && (\r\n                                                    <p className=\"text-sm text-gray-400 text-center py-2\">\r\n                                                        No images in this category\r\n                                                    </p>\r\n                                                )}\r\n                                            </div>\r\n                                        </motion.div>\r\n                                    )}\r\n                                </AnimatePresence>\r\n                            </div>\r\n                        );\r\n                    })}\r\n                </div>\r\n\r\n                {totalImages < 3 && (\r\n                    <div className=\"flex items-center gap-2 p-3 bg-amber-50 border border-amber-200 rounded-lg\">\r\n                        <AlertTriangle size={18} className=\"text-amber-500\" />\r\n                        <span className=\"text-sm text-amber-700\">\r\n                            Add at least 3 images for better visibility\r\n                        </span>\r\n                    </div>\r\n                )}\r\n            </div>\r\n        );\r\n    };\r\n\r\n    const renderStep6 = () => {\r\n        // Get first available image for preview\r\n        const getPreviewImage = () => {\r\n            for (const catKey of Object.keys(existingCategorizedImages)) {\r\n                if (existingCategorizedImages[catKey]?.length > 0) {\r\n                    return existingCategorizedImages[catKey][0];\r\n                }\r\n            }\r\n            for (const catKey of Object.keys(categorizedImages)) {\r\n                if (categorizedImages[catKey]?.previews?.length > 0) {\r\n                    return categorizedImages[catKey].previews[0];\r\n                }\r\n            }\r\n            return null;\r\n        };\r\n\r\n        const previewImage = getPreviewImage();\r\n        const totalImages = getTotalCategorizedImages();\r\n\r\n        return (\r\n            <div className=\"space-y-6\">\r\n                <div className=\"text-center\">\r\n                    <h2 className=\"text-3xl font-bold text-gray-900\">Review Changes</h2>\r\n                    <p className=\"text-gray-500 mt-2\">Confirm your property updates</p>\r\n                </div>\r\n\r\n                <div className=\"max-w-3xl mx-auto bg-white rounded-2xl shadow-lg p-6 border border-gray-200\">\r\n                    {/* Preview Image */}\r\n                    <div className=\"h-56 bg-gray-100 rounded-2xl overflow-hidden relative mb-4 border border-gray-200\">\r\n                        {previewImage ? (\r\n                            <img src={previewImage} className=\"w-full h-full object-cover\" alt=\"Property Preview\" />\r\n                        ) : (\r\n                            <div className=\"w-full h-full flex items-center justify-center text-gray-300\">\r\n                                <ImageIcon size={48} />\r\n                            </div>\r\n                        )}\r\n                        <div className=\"absolute top-4 left-4 bg-white text-blue-600 px-3 py-1 rounded-full text-xs font-bold shadow-md uppercase\">\r\n                            {formData.listingType}\r\n                        </div>\r\n                        <div className=\"absolute bottom-4 right-4 bg-black/70 text-white px-3 py-1 rounded-full text-xs font-semibold\">\r\n                            {totalImages} photos\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"space-y-4\">\r\n                        <div className=\"flex justify-between items-start\">\r\n                            <div>\r\n                                <h3 className=\"font-bold text-xl text-gray-900\">\r\n                                    {formData.title || `${formData.bhkType || formData.propertyType} for ${formData.listingType}`}\r\n                                </h3>\r\n                                <p className=\"text-sm text-gray-500 flex items-center gap-1 mt-1\">\r\n                                    <MapPin size={14} /> {formData.locality}, {formData.city}\r\n                                </p>\r\n                            </div>\r\n                            <div className=\"text-right\">\r\n                                <div className=\"font-bold text-2xl text-blue-600\">\r\n                                    Γé╣ {formData.expectedPrice ? Number(formData.expectedPrice).toLocaleString() : \"-\"}\r\n                                </div>\r\n                                <div className=\"text-xs text-gray-500\">\r\n                                    {formData.priceNegotiable ? \"Negotiable\" : \"Fixed Price\"}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"grid grid-cols-2 sm:grid-cols-4 gap-4 py-4 border-t border-gray-100\">\r\n                            <div>\r\n                                <div className=\"text-xs text-gray-400 uppercase\">Area</div>\r\n                                <div className=\"font-semibold text-gray-800\">{formData.builtUpArea || \"-\"} sq.ft</div>\r\n                            </div>\r\n                            <div>\r\n                                <div className=\"text-xs text-gray-400 uppercase\">Furnishing</div>\r\n                                <div className=\"font-semibold text-gray-800\">{formData.furnishing}</div>\r\n                            </div>\r\n                            {isResidential && (\r\n                                <div>\r\n                                    <div className=\"text-xs text-gray-400 uppercase\">Config</div>\r\n                                    <div className=\"font-semibold text-gray-800\">{formData.bhkType || \"-\"}</div>\r\n                                </div>\r\n                            )}\r\n                            <div>\r\n                                <div className=\"text-xs text-gray-400 uppercase\">Available</div>\r\n                                <div className=\"font-semibold text-gray-800\">{formData.availableFrom || \"Immediate\"}</div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {formData.selectedAmenities.length > 0 && (\r\n                            <div>\r\n                                <div className=\"text-xs text-gray-400 uppercase mb-2\">Amenities</div>\r\n                                <div className=\"flex flex-wrap gap-2\">\r\n                                    {formData.selectedAmenities.map(a => (\r\n                                        <span key={a} className=\"bg-gray-100 text-gray-600 border border-gray-200 px-2 py-1 rounded text-xs\">\r\n                                            {a}\r\n                                        </span>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n\r\n                        {formData.description && (\r\n                            <div>\r\n                                <div className=\"text-xs text-gray-400 uppercase\">Description</div>\r\n                                <p className=\"mt-1 text-sm text-gray-600 bg-gray-50 p-3 rounded-lg\">{formData.description}</p>\r\n                            </div>\r\n                        )}\r\n\r\n                        <div className=\"pt-4\">\r\n                            <button\r\n                                onClick={handleSubmit}\r\n                                disabled={isSaving}\r\n                                className=\"w-full bg-blue-600 hover:bg-blue-700 text-white py-4 rounded-xl font-bold flex items-center justify-center gap-2 transition-colors shadow-lg disabled:opacity-50\"\r\n                            >\r\n                                {isSaving ? (\r\n                                    <>\r\n                                        <Loader2 className=\"w-5 h-5 animate-spin\" />\r\n                                        Saving Changes...\r\n                                    </>\r\n                                ) : (\r\n                                    <>\r\n                                        Save Changes <Check size={18} />\r\n                                    </>\r\n                                )}\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    };\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-gray-50 flex flex-col md:flex-row font-sans text-gray-900\">\r\n            {/* Sidebar */}\r\n            <aside className=\"hidden md:flex flex-col w-80 bg-blue-600 h-[calc(100vh-5rem)] sticky top-20 p-6 pt-8 z-20 shadow-xl overflow-y-auto\">\r\n                <div className=\"mb-6\">\r\n                    <h2 className=\"text-white text-xl font-bold\">Edit Property</h2>\r\n                    <p className=\"text-blue-200 text-sm mt-1\">Update your listing</p>\r\n                </div>\r\n                <nav className=\"space-y-2 flex-1\">\r\n                    {STEPS.map(step => {\r\n                        const isActive = currentStep === step.id;\r\n                        const isCompleted = currentStep > step.id;\r\n                        return (\r\n                            <button\r\n                                key={step.id}\r\n                                onClick={() => { setDirection(step.id > currentStep ? 1 : -1); setCurrentStep(step.id); }}\r\n                                className={`w-full group flex items-center gap-4 p-4 rounded-2xl transition-all relative overflow-hidden ${isActive ? \"bg-white text-blue-600 shadow-md\" : \"text-blue-100 hover:bg-white/10 hover:text-white\"\r\n                                    }`}\r\n                            >\r\n                                <div className={`relative z-10 transition-colors ${isActive ? \"text-blue-600\" : isCompleted ? \"text-white\" : \"text-blue-200 group-hover:text-white\"}`}>\r\n                                    {isCompleted ? <Check size={18} strokeWidth={3} /> : step.icon}\r\n                                </div>\r\n                                <div className=\"flex flex-col relative z-10 text-left\">\r\n                                    <span className={`font-bold text-sm ${isActive ? \"text-blue-600\" : \"text-white\"}`}>{step.label}</span>\r\n                                    <span className={`text-xs font-medium ${isActive ? \"text-blue-400\" : \"text-blue-200/80\"}`}>{step.description}</span>\r\n                                </div>\r\n                            </button>\r\n                        );\r\n                    })}\r\n                </nav>\r\n                <div className=\"mt-auto pt-6\">\r\n                    <button\r\n                        onClick={() => navigate(\"/my-properties\")}\r\n                        className=\"w-full flex items-center justify-center gap-2 bg-white/10 hover:bg-white/20 text-white px-4 py-3 rounded-xl font-medium transition\"\r\n                    >\r\n                        <ChevronLeft size={18} />\r\n                        Back to My Properties\r\n                    </button>\r\n                </div>\r\n            </aside>\r\n\r\n            {/* Mobile Header */}\r\n            <div className=\"md:hidden bg-blue-600 p-4 sticky top-20 z-30 shadow-md flex items-center justify-between\">\r\n                <div className=\"flex items-center gap-2\">\r\n                    <button onClick={() => navigate(\"/my-properties\")} className=\"p-1.5 bg-white/20 rounded-lg\">\r\n                        <ChevronLeft className=\"text-white\" size={16} />\r\n                    </button>\r\n                    <span className=\"font-bold text-white\">Step {currentStep} of 6</span>\r\n                </div>\r\n                <div className=\"flex gap-1.5\">\r\n                    {STEPS.map(s => (\r\n                        <div key={s.id} className={`h-1.5 w-6 rounded-full ${s.id <= currentStep ? \"bg-white\" : \"bg-blue-400/50\"}`} />\r\n                    ))}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Main Content */}\r\n            <main className=\"flex-1 p-6 md:p-12 max-w-5xl mx-auto w-full flex flex-col h-full\">\r\n                <div className=\"flex-1 mb-20 md:mb-0 relative\">\r\n                    <AnimatePresence mode=\"wait\" custom={direction}>\r\n                        <motion.div\r\n                            key={currentStep}\r\n                            custom={direction}\r\n                            variants={variants}\r\n                            initial=\"enter\"\r\n                            animate=\"center\"\r\n                            exit=\"exit\"\r\n                            transition={{ x: { type: \"spring\", stiffness: 300, damping: 30 }, opacity: { duration: 0.2 } }}\r\n                            className=\"min-h-[520px]\"\r\n                        >\r\n                            {currentStep === 1 && renderStep1()}\r\n                            {currentStep === 2 && renderStep2()}\r\n                            {currentStep === 3 && renderStep3()}\r\n                            {currentStep === 4 && renderStep4()}\r\n                            {currentStep === 5 && renderStep5()}\r\n                            {currentStep === 6 && renderStep6()}\r\n                        </motion.div>\r\n                    </AnimatePresence>\r\n\r\n                    {/* Navigation Buttons */}\r\n                    <div className=\"flex justify-between items-center mt-12 pt-8 border-t border-gray-200\">\r\n                        <button\r\n                            onClick={handlePrev}\r\n                            disabled={currentStep === 1}\r\n                            className={`flex items-center gap-2 px-8 py-3 rounded-xl font-bold transition-all ${currentStep === 1 ? \"text-gray-300 cursor-not-allowed\" : \"text-gray-600 hover:bg-gray-100\"\r\n                                }`}\r\n                        >\r\n                            <ChevronLeft size={18} /> Back\r\n                        </button>\r\n\r\n                        <div className=\"flex items-center gap-3\">\r\n                            {currentStep < 6 && (\r\n                                <button\r\n                                    onClick={handleNext}\r\n                                    className=\"bg-blue-600 text-white px-10 py-3 rounded-xl font-bold hover:bg-blue-700 transition-all shadow-lg flex items-center gap-2\"\r\n                                >\r\n                                    Next Step <ArrowRight size={18} />\r\n                                </button>\r\n                            )}\r\n                            {currentStep === 6 && (\r\n                                <button\r\n                                    onClick={handleSubmit}\r\n                                    disabled={isSaving}\r\n                                    className=\"bg-blue-600 text-white px-10 py-3 rounded-xl font-bold hover:bg-blue-700 transition-all shadow-lg flex items-center gap-2 disabled:opacity-50\"\r\n                                >\r\n                                    {isSaving ? (\r\n                                        <>\r\n                                            <Loader2 className=\"w-5 h-5 animate-spin\" />\r\n                                            Saving...\r\n                                        </>\r\n                                    ) : (\r\n                                        <>\r\n                                            Save Changes <Check size={18} />\r\n                                        </>\r\n                                    )}\r\n                                </button>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </main>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\dealdirectcurrentlive\\dealdirect\\client\\src\\Pages\\Home\\Home.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'parseBudgetValue' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":43,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":43,"endColumn":23,"suggestions":[{"messageId":"removeVar","data":{"varName":"parseBudgetValue"},"fix":{"range":[1423,2030],"text":""},"desc":"Remove unused variable 'parseBudgetValue'."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useRef } from \"react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport api from \"../../utils/api\";\r\nimport {\r\n  AiOutlineDollarCircle,\r\n  AiOutlineHeart\r\n} from \"react-icons/ai\";\r\nimport {\r\n  FaBuilding,\r\n  FaMapMarkerAlt,\r\n  FaChevronLeft,\r\n  FaChevronRight,\r\n  FaSearch,\r\n  FaRegCommentDots,\r\n  FaKey,\r\n  FaShieldAlt,\r\n  FaUserFriends,\r\n  FaRegClock,\r\n  FaArrowRight,\r\n  FaCheckCircle\r\n} from \"react-icons/fa\";\r\nimport HeroSection from \"../../Components/HeroSection/HeroSection\";\r\nimport TopLocalities from \"../../Components/TopLocalities/TopLocalities\";\r\nimport AuthModal from \"../../Components/AuthModal/AuthModal\";\r\nimport { FaRupeeSign } from \"react-icons/fa\";\r\n\r\n// Asset Imports\r\nimport MumbaiIcon from \"../../assets/Mumbai.png\";\r\nimport DelhiIcon from \"../../assets/Delhi.png\";\r\nimport BangaloreIcon from \"../../assets/Bangalore.png\";\r\nimport HyderabadIcon from \"../../assets/Hyderabad.png\";\r\nimport PuneIcon from \"../../assets/Pune.png\";\r\nimport ChennaiIcon from \"../../assets/chennai.png\";\r\nimport KolkataIcon from \"../../assets/kolkata.png\";\r\nimport AhmedabadIcon from \"../../assets/ahmedabad.png\";\r\nimport GurgaonIcon from \"../../assets/Gurgaon.png\";\r\nimport NoidaIcon from \"../../assets/noida.png\";\r\nimport ChandigarhIcon from \"../../assets/chandigarh.png\";\r\nimport JaipurIcon from \"../../assets/jaipur.png\";\r\n\r\nconst API_BASE = import.meta.env.VITE_API_BASE;\r\n\r\nconst parseBudgetValue = (label) => {\r\n  if (!label) return null;\r\n  const cleaned = label.replace(/Γé╣|,/g, \"\").trim().toLowerCase();\r\n  if (!cleaned) return null;\r\n\r\n  if (cleaned.includes(\"crore\")) {\r\n    const amount = parseFloat(cleaned.replace(\"crore\", \"\")) || 0;\r\n    return amount * 10000000;\r\n  }\r\n\r\n  if (cleaned.includes(\"lakh\")) {\r\n    const amount = parseFloat(\r\n      cleaned.replace(\"lakhs\", \"\").replace(\"lakh\", \"\")\r\n    ) || 0;\r\n    return amount * 100000;\r\n  }\r\n\r\n  const numeric = parseFloat(cleaned.replace(/[^0-9.]/g, \"\"));\r\n  return Number.isNaN(numeric) ? null : Math.round(numeric);\r\n};\r\n\r\nconst normalizePrice = (price, unit) => {\r\n  const amount = Number(price) || 0;\r\n  const normalizedUnit = (unit || \"\").toLowerCase();\r\n\r\n  if (normalizedUnit.includes(\"crore\")) return amount * 10000000;\r\n  if (normalizedUnit.includes(\"lac\") || normalizedUnit.includes(\"lakh\")) return amount * 100000;\r\n  return amount;\r\n};\r\n\r\nconst formatCategoryDisplay = (name) => {\r\n  const value = (name || \"\").toString();\r\n  const lower = value.toLowerCase();\r\n  if (lower.includes(\"commercial land\")) return \"Commercial Property\";\r\n  if (lower.includes(\"commercial property\")) return \"Commercial Property\";\r\n  if (lower.includes(\"residential land\") || lower.includes(\"residential plot\")) return \"Residential Property\";\r\n  if (lower.includes(\"commercial plot\")) return \"Commercial Property\";\r\n  if (lower === \"plot\" || lower === \"plots\" || lower.includes(\"plot & land\") || lower.includes(\"plots & land\")) {\r\n    return \"Residential Property\";\r\n  }\r\n  if (lower.includes(\"residential\")) return \"Residential Property\";\r\n  if (lower.includes(\"commercial\")) return \"Commercial Property\";\r\n  return value || \"Property\";\r\n};\r\n\r\nconst Home = () => {\r\n  const [properties, setProperties] = useState([]);\r\n  const [categories, setCategories] = useState([]);\r\n  const [subcategories, setSubcategories] = useState([]);\r\n  const [propertyTypeOptions, setPropertyTypeOptions] = useState([]);\r\n  const [isAuthModalOpen, setIsAuthModalOpen] = useState(false);\r\n  const [filters, setFilters] = useState({\r\n    search: \"\",\r\n    category: \"\",\r\n    subcategory: \"\",\r\n    city: \"\",\r\n    state: \"\",\r\n    minBudget: \"\",\r\n    maxBudget: \"\",\r\n    propertyTypes: [],\r\n  });\r\n  const navigate = useNavigate();\r\n  const scrollRef = useRef(null);\r\n  const propertiesSectionRef = useRef(null);\r\n\r\n  const handleCityClick = (cityName) => {\r\n    setFilters((prev) => ({ ...prev, city: cityName }));\r\n    propertiesSectionRef.current?.scrollIntoView({ behavior: \"smooth\" });\r\n  };\r\n\r\n  const scroll = (direction) => {\r\n    if (scrollRef.current) {\r\n      const { current } = scrollRef;\r\n      const scrollAmount = 320;\r\n      if (direction === 'left') {\r\n        current.scrollBy({ left: -scrollAmount, behavior: 'smooth' });\r\n      } else {\r\n        current.scrollBy({ left: scrollAmount, behavior: 'smooth' });\r\n      }\r\n    }\r\n  };\r\n\r\n  const resolveImageSrc = (img) => {\r\n    if (!img) return \"\";\r\n    const lower = img.toLowerCase();\r\n    if (lower.startsWith(\"data:\")) return img;\r\n    if (lower.startsWith(\"http://\") || lower.startsWith(\"https://\")) return img;\r\n    if (img.startsWith(\"/uploads\")) return `${API_BASE}${img}`;\r\n    return `${API_BASE}/uploads/${img}`;\r\n  };\r\n\r\n  useEffect(() => {\r\n    window.scrollTo({ top: 0, left: 0, behavior: \"auto\" });\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      try {\r\n        const response = await api.get('/properties/property-list');\r\n        setProperties(response.data.data || []);\r\n      } catch (error) {\r\n        console.error(\"Error loading data:\", error);\r\n      }\r\n    })();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const fetchCategories = async () => {\r\n      try {\r\n        const res = await api.get('/categories/list-category');\r\n        setCategories(res.data || []);\r\n      } catch (error) {\r\n        console.error(\"Error fetching categories:\", error);\r\n      }\r\n    };\r\n    fetchCategories();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const fetchPropertyTypes = async () => {\r\n      try {\r\n        const res = await api.get('/propertyTypes/list-propertytype');\r\n        setPropertyTypeOptions(Array.isArray(res.data) ? res.data : []);\r\n      } catch (error) {\r\n        console.error(\"Error fetching property types:\", error);\r\n      }\r\n    };\r\n    fetchPropertyTypes();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const fetchSubcategories = async () => {\r\n      if (!filters.category) {\r\n        setSubcategories([]);\r\n        return;\r\n      }\r\n      try {\r\n        const res = await api.get(\r\n          `/subcategories/byCategory/${filters.category}`\r\n        );\r\n        setSubcategories(res.data || []);\r\n      } catch (error) {\r\n        console.error(\"Error fetching subcategories:\", error);\r\n      }\r\n    };\r\n    fetchSubcategories();\r\n  }, [filters.category]);\r\n\r\n  const handleViewDetails = (property) => {\r\n    navigate(`/properties/${property._id}`, { state: { property } });\r\n  };\r\n\r\n  return (\r\n    // Changed main background to white and text to dark\r\n    <div className=\"font-sans text-gray-900 bg-white min-h-screen\">\r\n      <AuthModal isOpen={isAuthModalOpen} onClose={() => setIsAuthModalOpen(false)} />\r\n\r\n      <HeroSection\r\n        filters={filters}\r\n        setFilters={setFilters}\r\n        categories={categories}\r\n        subcategories={subcategories}\r\n        propertyTypes={propertyTypeOptions}\r\n      />\r\n\r\n      {/* ≡ƒÅÖ Featured Properties */}\r\n      {/* Reduced padding (py-10), changed background to white */}\r\n      <section ref={propertiesSectionRef} className=\"relative py-10 bg-white\">\r\n        <div className=\"max-w-7xl mx-auto px-6\">\r\n          <div className=\"flex flex-col sm:justify-between sm:flex-row  justify-center items-center sm:items-end mb-3\">\r\n            <div>\r\n              <h2 className=\"text-3xl text-center sm:text-left  font-bold text-gray-900\">\r\n                Popular <span className=\"text-red-600\">Properties</span>\r\n              </h2>\r\n              <p className=\"text-gray-500 mt-2 text-center sm:text-left  max-w-lg\">\r\n                Handpicked premium homes and investments across India's top cities.\r\n              </p>\r\n            </div>\r\n\r\n            <button\r\n              onClick={() => navigate('/properties')}\r\n              className=\"text-red-600 py-2 font-semibold hover:text-red-700 transition flex items-center gap-2 pb-1 border-b-2 border-transparent hover:border-red-600\"\r\n            >\r\n              View All <FaArrowRight className=\"text-sm\" />\r\n            </button>\r\n          </div>\r\n\r\n          {properties.length === 0 ? (\r\n            <p className=\"text-gray-500 text-lg text-center py-12 bg-gray-50 rounded-xl border border-dashed border-gray-200\">No popular properties available right now.</p>\r\n          ) : (\r\n            <div className=\"relative group\">\r\n              <button onClick={() => scroll('left')} className=\"absolute -left-4 top-1/2 -translate-y-1/2 z-10 w-12 h-12 bg-white backdrop-blur-sm rounded-full shadow-xl flex items-center justify-center text-gray-800 hover:text-red-600 transition-all border border-gray-100 opacity-0 group-hover:opacity-100\">\r\n                <FaChevronLeft className=\"text-lg\" />\r\n              </button>\r\n\r\n              <button onClick={() => scroll('right')} className=\"absolute -right-4 top-1/2 -translate-y-1/2 z-10 w-12 h-12 bg-white backdrop-blur-sm rounded-full shadow-xl flex items-center justify-center text-gray-800 hover:text-red-600 transition-all border border-gray-100 opacity-0 group-hover:opacity-100\">\r\n                <FaChevronRight className=\"text-lg\" />\r\n              </button>\r\n\r\n              <div ref={scrollRef} className=\"flex gap-6 overflow-x-auto pb-8 pt-2 snap-x snap-mandatory scrollbar-hide px-2\" style={{ scrollbarWidth: 'none', msOverflowStyle: 'none' }}>\r\n                {[...properties]\r\n                  .sort((a, b) => normalizePrice(b.price, b.priceUnit) - normalizePrice(a.price, a.priceUnit))\r\n                  .slice(0, 8)\r\n                  .map((property) => (\r\n                    <div\r\n                      key={property._id}\r\n                      onClick={() => handleViewDetails(property)}\r\n                      // Added stronger shadow and border for visibility on white background\r\n                      className=\"group relative bg-white rounded-2xl shadow-md hover:shadow-2xl hover:-translate-y-1 transition-all duration-300 border border-gray-100 overflow-hidden cursor-pointer min-w-[300px] w-[300px] flex-shrink-0 snap-start\"\r\n                    >\r\n                      <div className=\"relative h-48 overflow-hidden\">\r\n                        <div className=\"absolute top-3 left-3 z-10 bg-white/90 backdrop-blur text-slate-800 text-xs font-bold px-2 py-1 rounded shadow-sm\">\r\n                          {formatCategoryDisplay(property.category?.name || property.categoryName || property.category || property.propertyCategory)}\r\n                        </div>\r\n                        <img\r\n                          src={resolveImageSrc(property.images?.[0])}\r\n                          alt={property.title}\r\n                          className=\"h-full w-full object-cover group-hover:scale-110 transition-transform duration-700\"\r\n                          onError={(e) => (e.target.src = 'https://images.unsplash.com/photo-1600585154340-be6161a56a0c?q=80&w=800')}\r\n                        />\r\n                        <div className=\"absolute inset-0 bg-gradient-to-t from-black/50 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300\" />\r\n                      </div>\r\n\r\n                      <div className=\"p-4\">\r\n                        <h3 className=\"text-lg font-bold text-gray-900 mb-1 truncate\">{property.title}</h3>\r\n                        <p className=\"text-sm text-gray-500 mb-3 flex items-center gap-1\">\r\n                          <FaMapMarkerAlt className=\"text-red-500\" /> {property.address?.city}, {property.address?.state}\r\n                        </p>\r\n                        <div className=\"flex items-center justify-between border-t border-gray-100 pt-3 mt-3\">\r\n                          <p className=\"text-xl font-bold text-red-600\">\r\n                            Γé╣{property.price?.toLocaleString()} <span className=\"text-xs font-medium text-gray-500\">{property.priceUnit}</span>\r\n                          </p>\r\n                          <span className=\"text-xs bg-gray-100 text-gray-700 px-2 py-1 rounded-md\">\r\n                            {property.propertyTypeName || property.propertyType?.name}\r\n                          </span>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </section>\r\n\r\n      {/* ≡ƒ¢á PREMIUM: How Deal Direct Works Section */}\r\n      {/* Reduced padding (py-12), changed background to white, updated text/card colors */}\r\n      <section className=\"py-12 bg-white relative overflow-hidden\">\r\n        {/* Adjusted blobs for light mode visibility */}\r\n        <div className=\"absolute top-0 left-0 w-96 h-96 bg-blue-100/50 rounded-full blur-3xl -translate-x-1/2 -translate-y-1/2\"></div>\r\n        <div className=\"absolute bottom-0 right-0 w-96 h-96 bg-purple-100/50 rounded-full blur-3xl translate-x-1/2 translate-y-1/2\"></div>\r\n\r\n        <div className=\"max-w-5xl mx-auto text-center px-6 relative z-10\">\r\n          <h2 className=\"text-4xl font-extrabold text-gray-900 mb-3 tracking-tight\">\r\n            How Deal Direct Works\r\n          </h2>\r\n          <p className=\"text-gray-500 text-lg mb-12 max-w-2xl mx-auto leading-relaxed\">\r\n            Three simple steps to find your perfect property or sell directly to buyers\r\n          </p>\r\n        </div>\r\n\r\n        <div className=\"max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-10 px-6 relative z-10\">\r\n          {/* Step 1: Search Properties */}\r\n          <div className=\"group relative bg-white rounded-2xl p-8 shadow-lg hover:shadow-2xl transition-all duration-300 border border-gray-100 hover:border-blue-200 hover:-translate-y-2\">\r\n            <div className=\"absolute -top-4 left-1/2 -translate-x-1/2 w-20 h-20 flex items-center justify-center bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl shadow-xl text-4xl text-white group-hover:scale-110 transition-transform duration-300\">\r\n              <FaSearch />\r\n            </div>\r\n            <div className=\"mt-10 text-center\">\r\n              <h3 className=\"text-2xl font-bold text-gray-900 mb-3\">Search Properties</h3>\r\n              <p className=\"text-gray-500 text-base leading-relaxed\">\r\n                Browse thousands of listings directly from property owners.\r\n              </p>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Step 2: Connect Directly */}\r\n          <div className=\"group relative bg-white rounded-2xl p-8 shadow-lg hover:shadow-2xl transition-all duration-300 border border-gray-100 hover:border-purple-200 hover:-translate-y-2\">\r\n            <div className=\"absolute -top-4 left-1/2 -translate-x-1/2 w-20 h-20 flex items-center justify-center bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl shadow-xl text-4xl text-white group-hover:scale-110 transition-transform duration-300\">\r\n              <FaRegCommentDots />\r\n            </div>\r\n            <div className=\"mt-10 text-center\">\r\n              <h3 className=\"text-2xl font-bold text-gray-900 mb-3\">Connect Directly</h3>\r\n              <p className=\"text-gray-500 text-base leading-relaxed\">\r\n                Message property owners instantly. No intermediaries.\r\n              </p>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Step 3: Close the Deal */}\r\n          <div className=\"group relative bg-white rounded-2xl p-8 shadow-lg hover:shadow-2xl transition-all duration-300 border border-gray-100 hover:border-green-200 hover:-translate-y-2\">\r\n            <div className=\"absolute -top-4 left-1/2 -translate-x-1/2 w-20 h-20 flex items-center justify-center bg-gradient-to-br from-green-500 to-green-600 rounded-2xl shadow-xl text-4xl text-white group-hover:scale-110 transition-transform duration-300\">\r\n              <FaKey />\r\n            </div>\r\n            <div className=\"mt-10 text-center\">\r\n              <h3 className=\"text-2xl font-bold text-gray-900 mb-3\">Close the Deal</h3>\r\n              <p className=\"text-gray-500 text-base leading-relaxed\">\r\n                Negotiate directly and complete your deal confidently.\r\n              </p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </section>\r\n\r\n      {/* Γ£¿ PREMIUM: Why Choose Deal Direct Section */}\r\n      {/* Reduced padding (py-12), changed background to white */}\r\n      <section className=\"py-12 bg-white relative overflow-hidden\">\r\n        {/* Subtle Background Pattern adjusted for white bg */}\r\n        <div className=\"absolute inset-0 opacity-[0.4]\" style={{\r\n          backgroundImage: 'radial-gradient(circle at 1px 1px, rgb(200 200 200) 1px, transparent 0)',\r\n          backgroundSize: '40px 40px'\r\n        }}></div>\r\n\r\n        <div className=\"max-w-6xl mx-auto text-center px-6 relative z-10\">\r\n          <h2 className=\"text-4xl font-extrabold text-gray-900 mb-4 tracking-tight\">\r\n            Why Choose Deal Direct?\r\n          </h2>\r\n          <p className=\"text-gray-500 text-lg mb-16 max-w-2xl mx-auto leading-relaxed\">\r\n            Experience the benefits of direct property transactions\r\n          </p>\r\n        </div>\r\n\r\n        <div className=\"max-w-7xl mx-auto grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-12 px-8 relative z-10\">\r\n          {/* Benefit 1: Zero Commission */}\r\n          <div className=\"group text-center flex flex-col items-center transition-all duration-300 hover:-translate-y-2\">\r\n            <div className=\"w-24 h-24 flex items-center justify-center bg-gradient-to-br from-orange-500 to-orange-600 rounded-3xl mb-6 text-4xl text-white shadow-lg group-hover:shadow-2xl group-hover:scale-105 transition-all duration-300\">\r\n              <FaRupeeSign className=\"w-12 h-12\" />\r\n            </div>\r\n            <h3 className=\"text-xl font-bold text-gray-900 mb-3 tracking-tight\">Zero Commission</h3>\r\n            <p className=\"text-gray-500 text-[15px] leading-relaxed max-w-[220px]\">\r\n              Save thousands by connecting directly with owners.\r\n            </p>\r\n          </div>\r\n\r\n\r\n          {/* Benefit 2: Faster Deals */}\r\n          <div className=\"group text-center flex flex-col items-center transition-all duration-300 hover:-translate-y-2\">\r\n            <div className=\"w-24 h-24 flex items-center justify-center bg-gradient-to-br from-orange-500 to-orange-600 rounded-3xl mb-6 text-4xl text-white shadow-lg group-hover:shadow-2xl group-hover:scale-105 transition-all duration-300\">\r\n              <FaRegClock className=\"w-11 h-11\" />\r\n            </div>\r\n            <h3 className=\"text-xl font-bold text-gray-900 mb-3 tracking-tight\">Faster Deals</h3>\r\n            <p className=\"text-gray-500 text-[15px] leading-relaxed max-w-[220px]\">\r\n              Close deals quicker with direct communication.\r\n            </p>\r\n          </div>\r\n\r\n          {/* Benefit 3: Secure Transactions */}\r\n          <div className=\"group text-center flex flex-col items-center transition-all duration-300 hover:-translate-y-2\">\r\n            <div className=\"w-24 h-24 flex items-center justify-center bg-gradient-to-br from-orange-500 to-orange-600 rounded-3xl mb-6 text-4xl text-white shadow-lg group-hover:shadow-2xl group-hover:scale-105 transition-all duration-300\">\r\n              <FaShieldAlt className=\"w-11 h-11\" />\r\n            </div>\r\n            <h3 className=\"text-xl font-bold text-gray-900 mb-3 tracking-tight\">Secure Transactions</h3>\r\n            <p className=\"text-gray-500 text-[15px] leading-relaxed max-w-[220px]\">\r\n              Safe and transparent property transactions.\r\n            </p>\r\n          </div>\r\n\r\n          {/* Benefit 4: Direct Communication */}\r\n          <div className=\"group text-center flex flex-col items-center transition-all duration-300 hover:-translate-y-2\">\r\n            <div className=\"w-24 h-24 flex items-center justify-center bg-gradient-to-br from-orange-500 to-orange-600 rounded-3xl mb-6 text-4xl text-white shadow-lg group-hover:shadow-2xl group-hover:scale-105 transition-all duration-300\">\r\n              <FaUserFriends className=\"w-11 h-11\" />\r\n            </div>\r\n            <h3 className=\"text-xl font-bold text-gray-900 mb-3 tracking-tight\">Direct Communication</h3>\r\n            <p className=\"text-gray-500 text-[15px] leading-relaxed max-w-[220px]\">\r\n              Chat directly with owners and get instant replies.\r\n            </p>\r\n          </div>\r\n        </div>\r\n      </section>\r\n\r\n      <TopLocalities />\r\n\r\n      {/* ≡ƒÅÖ Explore Popular Cities */}\r\n      {/* Reduced padding (py-12), changed background to white */}\r\n      <section className=\"py-12 bg-white\">\r\n        <div className=\"max-w-7xl mx-auto px-6\">\r\n          <h2 className=\"text-3xl font-bold text-gray-900 mb-4\">\r\n            Explore by City\r\n          </h2>\r\n          <p className=\"text-gray-500 mb-10 max-w-3xl text-base leading-relaxed\">\r\n            Discover city-wise insights and properties in India's most active real estate markets.\r\n          </p>\r\n\r\n          <div className=\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4\">\r\n            {[\r\n              { name: \"Mumbai\", icon: MumbaiIcon },\r\n              { name: \"Delhi\", icon: DelhiIcon },\r\n              { name: \"Bangalore\", icon: BangaloreIcon },\r\n              { name: \"Hyderabad\", icon: HyderabadIcon },\r\n              { name: \"Pune\", icon: PuneIcon },\r\n              { name: \"Chennai\", icon: ChennaiIcon },\r\n              { name: \"Kolkata\", icon: KolkataIcon },\r\n              { name: \"Ahmedabad\", icon: AhmedabadIcon },\r\n              { name: \"Gurgaon\", icon: GurgaonIcon },\r\n              { name: \"Noida\", icon: NoidaIcon },\r\n              { name: \"Chandigarh\", icon: ChandigarhIcon },\r\n              { name: \"Jaipur\", icon: JaipurIcon },\r\n            ].map((city, index) => (\r\n              <div\r\n                key={index}\r\n                onClick={() => handleCityClick(city.name)}\r\n                // Changed card style for white theme\r\n                className=\"flex flex-col items-center justify-center p-6 border border-gray-200 rounded-2xl bg-white hover:shadow-xl hover:-translate-y-1 transition-all cursor-pointer group\"\r\n              >\r\n                <div className=\"w-14 h-14 flex items-center justify-center bg-gray-50 rounded-full mb-3 group-hover:bg-gray-100 transition-colors\">\r\n                  <img src={city.icon} alt={city.name} className=\"w-8 h-8 object-contain opacity-80 group-hover:opacity-100 transition-all\" />\r\n                </div>\r\n                <span className=\"font-semibold text-gray-700 text-sm group-hover:text-red-600 transition-colors\">{city.name}</span>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      </section>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Home;","usedDeprecatedRules":[]},{"filePath":"D:\\dealdirectcurrentlive\\dealdirect\\client\\src\\Pages\\Login\\Login.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'updateUser' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":20,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":20,"endColumn":15,"suggestions":[{"messageId":"removeVar","data":{"varName":"updateUser"},"fix":{"range":[824,841],"text":""},"desc":"Remove unused variable 'updateUser'."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'cancelPendingAuth'. Either include it or remove the dependency array.","line":64,"column":6,"nodeType":"ArrayExpression","endLine":64,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [cancelPendingAuth]","fix":{"range":[2630,2632],"text":"[cancelPendingAuth]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/pages/Auth/Login.jsx\r\nimport React, { useState, useEffect } from \"react\";\r\nimport api from \"../../utils/api\";\r\nimport { toast } from \"react-toastify\";\r\nimport { useNavigate, Link, useLocation } from \"react-router-dom\";\r\nimport { Mail, Lock, Eye, EyeOff, Loader2, X, ArrowLeft, KeyRound, CheckCircle, AlertTriangle, Phone, ShieldCheck } from \"lucide-react\";\r\nimport dealDirectLogo from \"../../assets/dealdirect_logo.png\";\r\nimport { useAuth } from \"../../context/AuthContext\";\r\n\r\n\r\n\r\nexport default function Login() {\r\n  const [formData, setFormData] = useState({ email: \"\", password: \"\", phone: \"\" });\r\n  const [showPassword, setShowPassword] = useState(false);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n  const {\r\n    login: authLogin,\r\n    updateUser,\r\n    requiresMfa,\r\n    requiresPasswordChange,\r\n    verifyMfa,\r\n    changePasswordOnLogin,\r\n    cancelPendingAuth,\r\n    pendingAuthData\r\n  } = useAuth();\r\n\r\n  // Get the redirect path and any pending action from state (if user was redirected here)\r\n  const redirectPath = location.state?.from || \"/\";\r\n  const pendingAction = location.state?.pendingAction;\r\n  const pendingPropertyId = location.state?.propertyId;\r\n\r\n  // Blocked user state\r\n  const [blockedError, setBlockedError] = useState(null);\r\n\r\n  // MFA state\r\n  const [mfaCode, setMfaCode] = useState(\"\");\r\n  const [mfaLoading, setMfaLoading] = useState(false);\r\n\r\n  // Password change state\r\n  const [newPassword, setNewPassword] = useState(\"\");\r\n  const [confirmNewPassword, setConfirmNewPassword] = useState(\"\");\r\n  const [showNewPassword, setShowNewPassword] = useState(false);\r\n  const [showConfirmNewPassword, setShowConfirmNewPassword] = useState(false);\r\n  const [passwordChangeLoading, setPasswordChangeLoading] = useState(false);\r\n\r\n  // Forgot Password Modal State\r\n  const [showForgotModal, setShowForgotModal] = useState(false);\r\n  const [forgotStep, setForgotStep] = useState(1); // 1: email, 2: otp+password, 3: success\r\n  const [forgotEmail, setForgotEmail] = useState(\"\");\r\n  const [forgotOtp, setForgotOtp] = useState(\"\");\r\n  const [forgotNewPassword, setForgotNewPassword] = useState(\"\");\r\n  const [confirmPassword, setConfirmPassword] = useState(\"\");\r\n  const [showForgotNewPassword, setShowForgotNewPassword] = useState(false);\r\n  const [showConfirmPassword, setShowConfirmPassword] = useState(false);\r\n  const [forgotLoading, setForgotLoading] = useState(false);\r\n\r\n  // Reset MFA/password states when component unmounts\r\n  useEffect(() => {\r\n    return () => {\r\n      cancelPendingAuth?.();\r\n    };\r\n  }, []);\r\n\r\n  const handleChange = (e) => {\r\n    const { name, value } = e.target;\r\n    let newValue = value;\r\n\r\n    if (name === \"phone\") {\r\n      newValue = newValue.replace(/[^0-9]/g, \"\").slice(0, 10);\r\n    }\r\n\r\n    setFormData((f) => ({ ...f, [name]: newValue }));\r\n  };\r\n\r\n  const isValidPhone = (phone) => {\r\n    const cleaned = (phone || \"\").trim();\r\n    if (!cleaned) return false;\r\n    return /^[6-9]\\d{9}$/.test(cleaned);\r\n  };\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    if (formData.phone && !isValidPhone(formData.phone)) {\r\n      toast.error(\"Please enter a valid 10-digit phone number\");\r\n      return;\r\n    }\r\n    setIsLoading(true);\r\n    setBlockedError(null);\r\n\r\n    try {\r\n      const result = await authLogin(formData.email, formData.password);\r\n\r\n      // Handle MFA requirement\r\n      if (result.requiresMfa) {\r\n        toast.info(result.message || \"Please enter your MFA code\");\r\n        setIsLoading(false);\r\n        return;\r\n      }\r\n\r\n      // Handle password change requirement\r\n      if (result.passwordChangeRequired) {\r\n        toast.warning(result.message || \"Please change your password to continue\");\r\n        setIsLoading(false);\r\n        return;\r\n      }\r\n\r\n      if (result.success && result.user) {\r\n        toast.success(`Welcome back, ${result.user.name || 'User'}!`);\r\n\r\n        let navigationState = location.state ? { ...location.state } : undefined;\r\n\r\n        // If user was trying to express interest, complete it\r\n        if (pendingAction === \"interest\" && pendingPropertyId) {\r\n          try {\r\n            await api.post(`/properties/interested/${pendingPropertyId}`, {});\r\n            toast.success(\"Interest registered! The owner will be notified.\");\r\n            navigationState = { ...navigationState, interestedPropertyId: pendingPropertyId };\r\n          } catch (interestErr) {\r\n            const msg = interestErr.response?.data?.message || \"Failed to register interest\";\r\n            toast.error(msg);\r\n          }\r\n        }\r\n\r\n        if (navigationState) {\r\n          delete navigationState.pendingAction;\r\n          delete navigationState.propertyId;\r\n        }\r\n\r\n        navigate(redirectPath, { state: navigationState });\r\n      } else {\r\n        // Check for blocked account\r\n        if (result.errorData?.isBlocked || result.errorData?.code === 'ACCOUNT_BLOCKED') {\r\n          setBlockedError({\r\n            message: result.errorData.message,\r\n            reason: result.errorData.blockReason || 'No reason provided',\r\n            blockedAt: result.errorData.blockedAt\r\n          });\r\n        } else {\r\n          toast.error(result.message || \"Invalid credentials. Please try again.\");\r\n        }\r\n      }\r\n    } catch (err) {\r\n      const errorData = err.response?.data;\r\n      if (errorData?.isBlocked || errorData?.code === 'ACCOUNT_BLOCKED') {\r\n        setBlockedError({\r\n          message: errorData.message,\r\n          reason: errorData.blockReason || 'No reason provided',\r\n          blockedAt: errorData.blockedAt\r\n        });\r\n      } else {\r\n        toast.error(errorData?.message || \"Invalid credentials. Please try again.\");\r\n      }\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  // Handle MFA verification\r\n  const handleMfaVerify = async (e) => {\r\n    e.preventDefault();\r\n    if (!mfaCode || mfaCode.length !== 6) {\r\n      toast.error(\"Please enter a valid 6-digit MFA code\");\r\n      return;\r\n    }\r\n\r\n    setMfaLoading(true);\r\n    try {\r\n      const result = await verifyMfa(mfaCode);\r\n\r\n      if (result.success) {\r\n        toast.success(`Welcome back, ${result.user.name || 'User'}!`);\r\n        navigate(redirectPath);\r\n      } else {\r\n        toast.error(result.message || \"MFA verification failed\");\r\n      }\r\n    } catch (err) {\r\n      toast.error(err.response?.data?.message || \"MFA verification failed\");\r\n    } finally {\r\n      setMfaLoading(false);\r\n    }\r\n  };\r\n\r\n  // Handle password change on login\r\n  const handlePasswordChange = async (e) => {\r\n    e.preventDefault();\r\n\r\n    if (newPassword.length < 8) {\r\n      toast.error(\"Password must be at least 8 characters\");\r\n      return;\r\n    }\r\n\r\n    if (newPassword !== confirmNewPassword) {\r\n      toast.error(\"Passwords do not match\");\r\n      return;\r\n    }\r\n\r\n    setPasswordChangeLoading(true);\r\n    try {\r\n      const result = await changePasswordOnLogin(newPassword);\r\n\r\n      if (result.success) {\r\n        toast.success(\"Password changed successfully! Welcome back.\");\r\n        navigate(redirectPath);\r\n      } else {\r\n        toast.error(result.message || \"Password change failed\");\r\n      }\r\n    } catch (err) {\r\n      toast.error(err.response?.data?.message || \"Password change failed\");\r\n    } finally {\r\n      setPasswordChangeLoading(false);\r\n    }\r\n  };\r\n\r\n  // Cancel MFA or password change flow\r\n  const handleCancelFlow = () => {\r\n    cancelPendingAuth();\r\n    setMfaCode(\"\");\r\n    setNewPassword(\"\");\r\n    setConfirmNewPassword(\"\");\r\n  };\r\n\r\n  // Forgot Password Handlers\r\n  const openForgotModal = (e) => {\r\n    e.preventDefault();\r\n    setShowForgotModal(true);\r\n    setForgotStep(1);\r\n    setForgotEmail(\"\");\r\n    setForgotOtp(\"\");\r\n    setForgotNewPassword(\"\");\r\n    setConfirmPassword(\"\");\r\n  };\r\n\r\n  const closeForgotModal = () => {\r\n    setShowForgotModal(false);\r\n    setForgotStep(1);\r\n    setForgotEmail(\"\");\r\n    setForgotOtp(\"\");\r\n    setForgotNewPassword(\"\");\r\n    setConfirmPassword(\"\");\r\n  };\r\n\r\n  const handleSendOtp = async (e) => {\r\n    e.preventDefault();\r\n    if (!forgotEmail) {\r\n      toast.error(\"Please enter your email address\");\r\n      return;\r\n    }\r\n\r\n    setForgotLoading(true);\r\n    try {\r\n      await api.post('/users/forgot-password', { email: forgotEmail });\r\n      toast.success(\"OTP sent to your email!\");\r\n      setForgotStep(2);\r\n    } catch (err) {\r\n      toast.error(err.response?.data?.message || \"Failed to send OTP. Please try again.\");\r\n    } finally {\r\n      setForgotLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleResetPassword = async (e) => {\r\n    e.preventDefault();\r\n\r\n    if (!forgotOtp || forgotOtp.length !== 6) {\r\n      toast.error(\"Please enter a valid 6-digit OTP\");\r\n      return;\r\n    }\r\n\r\n    if (forgotNewPassword.length < 6) {\r\n      toast.error(\"Password must be at least 6 characters\");\r\n      return;\r\n    }\r\n\r\n    if (forgotNewPassword !== confirmPassword) {\r\n      toast.error(\"Passwords do not match\");\r\n      return;\r\n    }\r\n\r\n    setForgotLoading(true);\r\n    try {\r\n      await api.post('/users/reset-password', {\r\n        email: forgotEmail,\r\n        otp: forgotOtp,\r\n        newPassword: forgotNewPassword,\r\n      });\r\n      toast.success(\"Password reset successful!\");\r\n      setForgotStep(3);\r\n    } catch (err) {\r\n      toast.error(err.response?.data?.message || \"Failed to reset password. Please try again.\");\r\n    } finally {\r\n      setForgotLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleResendOtp = async () => {\r\n    setForgotLoading(true);\r\n    try {\r\n      await api.post('/users/forgot-password', { email: forgotEmail });\r\n      toast.success(\"New OTP sent to your email!\");\r\n    } catch (err) {\r\n      toast.error(err.response?.data?.message || \"Failed to resend OTP\");\r\n    } finally {\r\n      setForgotLoading(false);\r\n    }\r\n  };\r\n\r\n  // Render MFA verification form\r\n  if (requiresMfa) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center bg-gray-50 font-sans\">\r\n        <div className=\"w-full max-w-md bg-white rounded-2xl shadow-2xl overflow-hidden p-8\">\r\n          <div className=\"text-center mb-8\">\r\n            <div className=\"mx-auto w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mb-4\">\r\n              <ShieldCheck className=\"w-8 h-8 text-blue-600\" />\r\n            </div>\r\n            <h2 className=\"text-2xl font-bold text-slate-800\">Two-Factor Authentication</h2>\r\n            <p className=\"text-slate-500 mt-2\">\r\n              Enter the 6-digit code from your authenticator app\r\n            </p>\r\n            {pendingAuthData?.email && (\r\n              <p className=\"text-sm text-slate-400 mt-1\">for {pendingAuthData.email}</p>\r\n            )}\r\n          </div>\r\n\r\n          <form onSubmit={handleMfaVerify} className=\"space-y-6\">\r\n            <div className=\"space-y-2\">\r\n              <label className=\"text-sm font-medium text-slate-700 block text-center\">MFA Code</label>\r\n              <input\r\n                type=\"text\"\r\n                value={mfaCode}\r\n                onChange={(e) => setMfaCode(e.target.value.replace(/[^0-9]/g, '').slice(0, 6))}\r\n                placeholder=\"000000\"\r\n                required\r\n                autoFocus\r\n                className=\"w-full text-center text-2xl tracking-[0.5em] py-4 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-900 focus:border-blue-900 transition-colors outline-none text-slate-800 font-mono\"\r\n              />\r\n            </div>\r\n\r\n            <button\r\n              type=\"submit\"\r\n              disabled={mfaLoading || mfaCode.length !== 6}\r\n              className=\"w-full bg-slate-900 text-white py-3.5 rounded-lg font-semibold hover:bg-slate-800 focus:ring-4 focus:ring-slate-200 transition-all flex items-center justify-center disabled:opacity-50\"\r\n            >\r\n              {mfaLoading ? (\r\n                <>\r\n                  <Loader2 className=\"w-5 h-5 mr-2 animate-spin\" />\r\n                  Verifying...\r\n                </>\r\n              ) : (\r\n                \"Verify Code\"\r\n              )}\r\n            </button>\r\n\r\n            <button\r\n              type=\"button\"\r\n              onClick={handleCancelFlow}\r\n              className=\"w-full text-slate-500 text-sm hover:text-slate-700 py-2\"\r\n            >\r\n              <ArrowLeft className=\"w-4 h-4 inline mr-1\" />\r\n              Back to Login\r\n            </button>\r\n          </form>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Render password change requirement form\r\n  if (requiresPasswordChange) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center bg-gray-50 font-sans\">\r\n        <div className=\"w-full max-w-md bg-white rounded-2xl shadow-2xl overflow-hidden p-8\">\r\n          <div className=\"text-center mb-8\">\r\n            <div className=\"mx-auto w-16 h-16 bg-amber-100 rounded-full flex items-center justify-center mb-4\">\r\n              <KeyRound className=\"w-8 h-8 text-amber-600\" />\r\n            </div>\r\n            <h2 className=\"text-2xl font-bold text-slate-800\">Password Change Required</h2>\r\n            <p className=\"text-slate-500 mt-2\">\r\n              For security reasons, you must change your password before continuing\r\n            </p>\r\n          </div>\r\n\r\n          <form onSubmit={handlePasswordChange} className=\"space-y-5\">\r\n            <div className=\"space-y-2\">\r\n              <label className=\"text-sm font-medium text-slate-700 block\">New Password</label>\r\n              <div className=\"relative\">\r\n                <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\r\n                  <Lock className=\"h-5 w-5 text-slate-400\" />\r\n                </div>\r\n                <input\r\n                  type={showNewPassword ? \"text\" : \"password\"}\r\n                  placeholder=\"Enter new password (min 8 characters)\"\r\n                  value={newPassword}\r\n                  onChange={(e) => setNewPassword(e.target.value)}\r\n                  required\r\n                  minLength={8}\r\n                  className=\"w-full pl-10 pr-12 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-900 focus:border-blue-900 transition-colors outline-none text-slate-800\"\r\n                />\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={() => setShowNewPassword(!showNewPassword)}\r\n                  className=\"absolute inset-y-0 right-0 pr-3 flex items-center text-slate-400 hover:text-slate-600\"\r\n                >\r\n                  {showNewPassword ? <EyeOff className=\"h-5 w-5\" /> : <Eye className=\"h-5 w-5\" />}\r\n                </button>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"space-y-2\">\r\n              <label className=\"text-sm font-medium text-slate-700 block\">Confirm New Password</label>\r\n              <div className=\"relative\">\r\n                <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\r\n                  <Lock className=\"h-5 w-5 text-slate-400\" />\r\n                </div>\r\n                <input\r\n                  type={showConfirmNewPassword ? \"text\" : \"password\"}\r\n                  placeholder=\"Confirm new password\"\r\n                  value={confirmNewPassword}\r\n                  onChange={(e) => setConfirmNewPassword(e.target.value)}\r\n                  required\r\n                  minLength={8}\r\n                  className=\"w-full pl-10 pr-12 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-900 focus:border-blue-900 transition-colors outline-none text-slate-800\"\r\n                />\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={() => setShowConfirmNewPassword(!showConfirmNewPassword)}\r\n                  className=\"absolute inset-y-0 right-0 pr-3 flex items-center text-slate-400 hover:text-slate-600\"\r\n                >\r\n                  {showConfirmNewPassword ? <EyeOff className=\"h-5 w-5\" /> : <Eye className=\"h-5 w-5\" />}\r\n                </button>\r\n              </div>\r\n              {confirmNewPassword && newPassword !== confirmNewPassword && (\r\n                <p className=\"text-xs text-red-500\">Passwords do not match</p>\r\n              )}\r\n            </div>\r\n\r\n            <button\r\n              type=\"submit\"\r\n              disabled={passwordChangeLoading || newPassword !== confirmNewPassword || newPassword.length < 8}\r\n              className=\"w-full bg-slate-900 text-white py-3.5 rounded-lg font-semibold hover:bg-slate-800 focus:ring-4 focus:ring-slate-200 transition-all flex items-center justify-center disabled:opacity-50\"\r\n            >\r\n              {passwordChangeLoading ? (\r\n                <>\r\n                  <Loader2 className=\"w-5 h-5 mr-2 animate-spin\" />\r\n                  Changing Password...\r\n                </>\r\n              ) : (\r\n                \"Change Password & Continue\"\r\n              )}\r\n            </button>\r\n\r\n            <button\r\n              type=\"button\"\r\n              onClick={handleCancelFlow}\r\n              className=\"w-full text-slate-500 text-sm hover:text-slate-700 py-2\"\r\n            >\r\n              <ArrowLeft className=\"w-4 h-4 inline mr-1\" />\r\n              Back to Login\r\n            </button>\r\n          </form>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen flex items-center justify-center bg-gray-50 font-sans\">\r\n      <div className=\"w-full max-w-5xl bg-white rounded-2xl shadow-2xl overflow-hidden flex flex-col md:flex-row min-h-[600px]\">\r\n\r\n        {/* LEFT SIDE - IMAGE & BRANDING */}\r\n        <div className=\"md:w-1/2 relative hidden md:flex flex-col justify-between p-12 text-white\">\r\n          {/* Background Image with Overlay */}\r\n          <div className=\"absolute inset-0 bg-cover bg-center z-0\"\r\n            style={{ backgroundImage: \"url('https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?q=80&w=2070&auto=format&fit=crop')\" }}>\r\n          </div>\r\n          <div className=\"absolute inset-0 bg-slate-900/60 z-10\"></div>\r\n\r\n          {/* Content over image */}\r\n          <div className=\"relative z-20 flex items-center gap-2 mb-6\">\r\n            <img src={dealDirectLogo} alt=\"DealDirect\" className=\"h-12 w-auto\" />\r\n          </div>\r\n\r\n          <div className=\"relative z-20 mb-8\">\r\n            <h2 className=\"text-4xl font-bold leading-tight mb-4\">\r\n              Find your dream property, <br /> <span className=\"text-blue-400\">Broker-free.</span>\r\n            </h2>\r\n            <p className=\"text-gray-300 text-lg\">\r\n              Join thousands of buyers and sellers connecting directly on the world's most transparent real estate platform.\r\n            </p>\r\n          </div>\r\n\r\n          <div className=\"relative z-20 text-sm text-gray-400\">\r\n            ┬⌐ 2025 DealDirect. All rights reserved.\r\n          </div>\r\n        </div>\r\n\r\n        {/* RIGHT SIDE - FORM */}\r\n        <div className=\"md:w-1/2 w-full p-8 md:p-12 flex flex-col justify-center\">\r\n          <div className=\"max-w-md mx-auto w-full\">\r\n            <div className=\"text-center mb-10\">\r\n              <h2 className=\"text-3xl font-bold text-slate-800\">Welcome Back</h2>\r\n              <p className=\"text-slate-500 mt-2\">Please enter your details to sign in.</p>\r\n            </div>\r\n\r\n            {/* Blocked User Error */}\r\n            {blockedError && (\r\n              <div className=\"mb-6 p-4 bg-red-50 border border-red-200 rounded-xl\">\r\n                <div className=\"flex items-start gap-3\">\r\n                  <div className=\"flex-shrink-0\">\r\n                    <AlertTriangle className=\"h-6 w-6 text-red-600\" />\r\n                  </div>\r\n                  <div className=\"flex-1\">\r\n                    <h3 className=\"text-red-800 font-semibold text-lg\">Account Blocked</h3>\r\n                    <p className=\"text-red-700 text-sm mt-1\">{blockedError.message}</p>\r\n                    <div className=\"mt-3 p-3 bg-red-100 rounded-lg\">\r\n                      <p className=\"text-red-800 text-sm\">\r\n                        <strong>Reason:</strong> {blockedError.reason}\r\n                      </p>\r\n                    </div>\r\n                    <p className=\"text-red-600 text-xs mt-3\">\r\n                      If you believe this is a mistake, please contact our support team.\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            <form onSubmit={handleSubmit} className=\"space-y-6\">\r\n\r\n              {/* Email Input */}\r\n              <div className=\"space-y-2\">\r\n                <label className=\"text-sm font-medium text-slate-700 block\">Email Address</label>\r\n                <div className=\"relative\">\r\n                  <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\r\n                    <Mail className=\"h-5 w-5 text-slate-400\" />\r\n                  </div>\r\n                  <input\r\n                    type=\"email\"\r\n                    name=\"email\"\r\n                    placeholder=\"name@company.com\"\r\n                    value={formData.email}\r\n                    onChange={handleChange}\r\n                    required\r\n                    className=\"w-full pl-10 pr-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-900 focus:border-blue-900 transition-colors outline-none text-slate-800\"\r\n                  />\r\n                </div>\r\n              </div>\r\n\r\n              {/* Phone Input (Optional) */}\r\n              <div className=\"space-y-2\">\r\n                <label className=\"text-sm font-medium text-slate-700 block\">\r\n                  Phone Number <span className=\"text-xs text-slate-400\">(optional)</span>\r\n                </label>\r\n                <div className=\"relative\">\r\n                  <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\r\n                    <Phone className=\"h-5 w-5 text-slate-400\" />\r\n                  </div>\r\n                  <input\r\n                    type=\"tel\"\r\n                    name=\"phone\"\r\n                    placeholder=\"10-digit mobile number\"\r\n                    value={formData.phone}\r\n                    onChange={handleChange}\r\n                    className=\"w-full pl-10 pr-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-900 focus:border-blue-900 transition-colors outline-none text-slate-800\"\r\n                  />\r\n                </div>\r\n              </div>\r\n\r\n              {/* Password Input */}\r\n              <div className=\"space-y-2\">\r\n                <label className=\"text-sm font-medium text-slate-700 block\">Password</label>\r\n                <div className=\"relative\">\r\n                  <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\r\n                    <Lock className=\"h-5 w-5 text-slate-400\" />\r\n                  </div>\r\n                  <input\r\n                    type={showPassword ? \"text\" : \"password\"}\r\n                    name=\"password\"\r\n                    placeholder=\"ΓÇóΓÇóΓÇóΓÇóΓÇóΓÇóΓÇóΓÇó\"\r\n                    value={formData.password}\r\n                    onChange={handleChange}\r\n                    required\r\n                    className=\"w-full pl-10 pr-12 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-900 focus:border-blue-900 transition-colors outline-none text-slate-800\"\r\n                  />\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => setShowPassword(!showPassword)}\r\n                    className=\"absolute inset-y-0 right-0 pr-3 flex items-center text-slate-400 hover:text-slate-600\"\r\n                  >\r\n                    {showPassword ? <EyeOff className=\"h-5 w-5\" /> : <Eye className=\"h-5 w-5\" />}\r\n                  </button>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Remember Me / Forgot Password */}\r\n              <div className=\"flex items-center justify-between text-sm\">\r\n                <label className=\"flex items-center cursor-pointer\">\r\n                  <input type=\"checkbox\" className=\"w-4 h-4 text-blue-900 border-slate-300 rounded focus:ring-blue-900\" />\r\n                  <span className=\"ml-2 text-slate-600\">Remember me</span>\r\n                </label>\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={openForgotModal}\r\n                  className=\"font-medium text-blue-900 hover:underline\"\r\n                >\r\n                  Forgot password?\r\n                </button>\r\n              </div>\r\n\r\n              {/* Submit Button */}\r\n              <button\r\n                type=\"submit\"\r\n                disabled={isLoading}\r\n                className=\"w-full bg-slate-900 text-white py-3.5 rounded-lg font-semibold hover:bg-slate-800 focus:ring-4 focus:ring-slate-200 transition-all flex items-center justify-center\"\r\n              >\r\n                {isLoading ? (\r\n                  <>\r\n                    <Loader2 className=\"w-5 h-5 mr-2 animate-spin\" />\r\n                    Signing in...\r\n                  </>\r\n                ) : (\r\n                  \"Sign in\"\r\n                )}\r\n              </button>\r\n            </form>\r\n\r\n            {/* Footer */}\r\n            <div className=\"mt-8 text-center text-sm text-slate-500\">\r\n              Don't have an account?{\" \"}\r\n              <Link to=\"/register\" state={{ from: redirectPath }} className=\"font-bold text-blue-900 hover:underline\">\r\n                Create an account\r\n              </Link>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n      </div>\r\n\r\n      {/* Forgot Password Modal */}\r\n      {showForgotModal && (\r\n        <div className=\"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4\">\r\n          <div className=\"bg-white rounded-2xl shadow-2xl max-w-md w-full overflow-hidden animate-in fade-in zoom-in duration-200\">\r\n            {/* Modal Header */}\r\n            <div className=\"bg-gradient-to-r from-slate-900 to-slate-800 p-6 text-white relative\">\r\n              <button\r\n                onClick={closeForgotModal}\r\n                className=\"absolute top-4 right-4 text-white/70 hover:text-white transition-colors\"\r\n              >\r\n                <X className=\"w-6 h-6\" />\r\n              </button>\r\n              <div className=\"flex items-center gap-3\">\r\n                <div className=\"w-12 h-12 bg-white/10 rounded-xl flex items-center justify-center\">\r\n                  <KeyRound className=\"w-6 h-6\" />\r\n                </div>\r\n                <div>\r\n                  <h3 className=\"text-xl font-bold\">\r\n                    {forgotStep === 1 && \"Forgot Password\"}\r\n                    {forgotStep === 2 && \"Reset Password\"}\r\n                    {forgotStep === 3 && \"Success!\"}\r\n                  </h3>\r\n                  <p className=\"text-sm text-white/70\">\r\n                    {forgotStep === 1 && \"Enter your email to receive OTP\"}\r\n                    {forgotStep === 2 && \"Enter OTP and new password\"}\r\n                    {forgotStep === 3 && \"Password changed successfully\"}\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Modal Body */}\r\n            <div className=\"p-6\">\r\n              {/* Step 1: Email */}\r\n              {forgotStep === 1 && (\r\n                <form onSubmit={handleSendOtp} className=\"space-y-5\">\r\n                  <div className=\"space-y-2\">\r\n                    <label className=\"text-sm font-medium text-slate-700 block\">Email Address</label>\r\n                    <div className=\"relative\">\r\n                      <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\r\n                        <Mail className=\"h-5 w-5 text-slate-400\" />\r\n                      </div>\r\n                      <input\r\n                        type=\"email\"\r\n                        placeholder=\"name@company.com\"\r\n                        value={forgotEmail}\r\n                        onChange={(e) => setForgotEmail(e.target.value)}\r\n                        required\r\n                        className=\"w-full pl-10 pr-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-900 focus:border-blue-900 transition-colors outline-none text-slate-800\"\r\n                      />\r\n                    </div>\r\n                    <p className=\"text-xs text-slate-500\">\r\n                      We'll send a 6-digit OTP to your registered email address.\r\n                    </p>\r\n                  </div>\r\n\r\n                  <button\r\n                    type=\"submit\"\r\n                    disabled={forgotLoading}\r\n                    className=\"w-full bg-slate-900 text-white py-3 rounded-lg font-semibold hover:bg-slate-800 focus:ring-4 focus:ring-slate-200 transition-all flex items-center justify-center\"\r\n                  >\r\n                    {forgotLoading ? (\r\n                      <>\r\n                        <Loader2 className=\"w-5 h-5 mr-2 animate-spin\" />\r\n                        Sending OTP...\r\n                      </>\r\n                    ) : (\r\n                      \"Send OTP\"\r\n                    )}\r\n                  </button>\r\n                </form>\r\n              )}\r\n\r\n              {/* Step 2: OTP + New Password */}\r\n              {forgotStep === 2 && (\r\n                <form onSubmit={handleResetPassword} className=\"space-y-5\">\r\n                  <div className=\"space-y-2\">\r\n                    <label className=\"text-sm font-medium text-slate-700 block\">Enter OTP</label>\r\n                    <input\r\n                      type=\"text\"\r\n                      placeholder=\"Enter 6-digit OTP\"\r\n                      value={forgotOtp}\r\n                      onChange={(e) => setForgotOtp(e.target.value.replace(/\\D/g, '').slice(0, 6))}\r\n                      maxLength={6}\r\n                      required\r\n                      className=\"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-900 focus:border-blue-900 transition-colors outline-none text-slate-800 text-center text-2xl tracking-[0.5em] font-mono\"\r\n                    />\r\n                    <div className=\"flex items-center justify-between text-xs\">\r\n                      <span className=\"text-slate-500\">OTP sent to {forgotEmail}</span>\r\n                      <button\r\n                        type=\"button\"\r\n                        onClick={handleResendOtp}\r\n                        disabled={forgotLoading}\r\n                        className=\"text-blue-900 hover:underline font-medium\"\r\n                      >\r\n                        Resend OTP\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div className=\"space-y-2\">\r\n                    <label className=\"text-sm font-medium text-slate-700 block\">New Password</label>\r\n                    <div className=\"relative\">\r\n                      <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\r\n                        <Lock className=\"h-5 w-5 text-slate-400\" />\r\n                      </div>\r\n                      <input\r\n                        type={showForgotNewPassword ? \"text\" : \"password\"}\r\n                        placeholder=\"Enter new password\"\r\n                        value={forgotNewPassword}\r\n                        onChange={(e) => setForgotNewPassword(e.target.value)}\r\n                        required\r\n                        minLength={6}\r\n                        className=\"w-full pl-10 pr-12 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-900 focus:border-blue-900 transition-colors outline-none text-slate-800\"\r\n                      />\r\n                      <button\r\n                        type=\"button\"\r\n                        onClick={() => setShowForgotNewPassword(!showForgotNewPassword)}\r\n                        className=\"absolute inset-y-0 right-0 pr-3 flex items-center text-slate-400 hover:text-slate-600\"\r\n                      >\r\n                        {showForgotNewPassword ? <EyeOff className=\"h-5 w-5\" /> : <Eye className=\"h-5 w-5\" />}\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div className=\"space-y-2\">\r\n                    <label className=\"text-sm font-medium text-slate-700 block\">Confirm Password</label>\r\n                    <div className=\"relative\">\r\n                      <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\r\n                        <Lock className=\"h-5 w-5 text-slate-400\" />\r\n                      </div>\r\n                      <input\r\n                        type={showConfirmPassword ? \"text\" : \"password\"}\r\n                        placeholder=\"Confirm new password\"\r\n                        value={confirmPassword}\r\n                        onChange={(e) => setConfirmPassword(e.target.value)}\r\n                        required\r\n                        minLength={6}\r\n                        className=\"w-full pl-10 pr-12 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-900 focus:border-blue-900 transition-colors outline-none text-slate-800\"\r\n                      />\r\n                      <button\r\n                        type=\"button\"\r\n                        onClick={() => setShowConfirmPassword(!showConfirmPassword)}\r\n                        className=\"absolute inset-y-0 right-0 pr-3 flex items-center text-slate-400 hover:text-slate-600\"\r\n                      >\r\n                        {showConfirmPassword ? <EyeOff className=\"h-5 w-5\" /> : <Eye className=\"h-5 w-5\" />}\r\n                      </button>\r\n                    </div>\r\n                    {confirmPassword && forgotNewPassword !== confirmPassword && (\r\n                      <p className=\"text-xs text-red-500\">Passwords do not match</p>\r\n                    )}\r\n                  </div>\r\n\r\n                  <div className=\"flex gap-3\">\r\n                    <button\r\n                      type=\"button\"\r\n                      onClick={() => setForgotStep(1)}\r\n                      className=\"flex-1 border border-slate-300 text-slate-700 py-3 rounded-lg font-medium hover:bg-slate-50 transition-all flex items-center justify-center\"\r\n                    >\r\n                      <ArrowLeft className=\"w-4 h-4 mr-2\" />\r\n                      Back\r\n                    </button>\r\n                    <button\r\n                      type=\"submit\"\r\n                      disabled={forgotLoading || forgotNewPassword !== confirmPassword}\r\n                      className=\"flex-1 bg-slate-900 text-white py-3 rounded-lg font-semibold hover:bg-slate-800 focus:ring-4 focus:ring-slate-200 transition-all flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                    >\r\n                      {forgotLoading ? (\r\n                        <>\r\n                          <Loader2 className=\"w-5 h-5 mr-2 animate-spin\" />\r\n                          Resetting...\r\n                        </>\r\n                      ) : (\r\n                        \"Reset Password\"\r\n                      )}\r\n                    </button>\r\n                  </div>\r\n                </form>\r\n              )}\r\n\r\n              {/* Step 3: Success */}\r\n              {forgotStep === 3 && (\r\n                <div className=\"text-center py-6\">\r\n                  <div className=\"w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4\">\r\n                    <CheckCircle className=\"w-10 h-10 text-green-600\" />\r\n                  </div>\r\n                  <h4 className=\"text-xl font-bold text-slate-800 mb-2\">Password Reset Successful!</h4>\r\n                  <p className=\"text-slate-500 mb-6\">\r\n                    Your password has been changed successfully. You can now login with your new password.\r\n                  </p>\r\n                  <button\r\n                    onClick={closeForgotModal}\r\n                    className=\"w-full bg-slate-900 text-white py-3 rounded-lg font-semibold hover:bg-slate-800 focus:ring-4 focus:ring-slate-200 transition-all\"\r\n                  >\r\n                    Back to Login\r\n                  </button>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}","usedDeprecatedRules":[]},{"filePath":"D:\\dealdirectcurrentlive\\dealdirect\\client\\src\\Pages\\MyProperties\\MyProperties.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'motion' is defined but never used. Allowed unused vars must match /^[A-Z_]/u.","line":45,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":45,"endColumn":16,"suggestions":[{"messageId":"removeVar","data":{"varName":"motion"},"fix":{"range":[792,799],"text":""},"desc":"Remove unused variable 'motion'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'Icon' is defined but never used.","line":120,"column":28,"nodeType":"Identifier","messageId":"unusedVar","endLine":120,"endColumn":32,"suggestions":[{"messageId":"removeVar","data":{"varName":"Icon"},"fix":{"range":[3472,3483],"text":""},"desc":"Remove unused variable 'Icon'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'onContact' is defined but never used.","line":304,"column":43,"nodeType":"Identifier","messageId":"unusedVar","endLine":304,"endColumn":52,"suggestions":[{"messageId":"removeVar","data":{"varName":"onContact"},"fix":{"range":[11839,11850],"text":""},"desc":"Remove unused variable 'onContact'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'setUser' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":430,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":430,"endColumn":23,"suggestions":[{"messageId":"removeVar","data":{"varName":"setUser"},"fix":{"range":[17248,17257],"text":""},"desc":"Remove unused variable 'setUser'."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchData'. Either include it or remove the dependency array.","line":473,"column":6,"nodeType":"ArrayExpression","endLine":473,"endColumn":56,"suggestions":[{"desc":"Update the dependencies array to be: [authLoading, isAuthenticated, authUser, navigate, fetchData]","fix":{"range":[19004,19054],"text":"[authLoading, isAuthenticated, authUser, navigate, fetchData]"}}]},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":624,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":624,"endColumn":19},{"ruleId":"no-unused-vars","severity":2,"message":"'name' is defined but never used.","line":654,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":654,"endColumn":21,"suggestions":[{"messageId":"removeVar","data":{"varName":"name"},"fix":{"range":[25176,25180],"text":""},"desc":"Remove unused variable 'name'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":728,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":728,"endColumn":17},{"ruleId":"no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":750,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":750,"endColumn":17}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchData'. Either include it or remove the dependency array.","line":538,"column":6,"nodeType":"ArrayExpression","endLine":538,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchData]","fix":{"range":[21183,21185],"text":"[fetchData]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":8,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useCallback } from \"react\";\r\nimport { useNavigate, Link } from \"react-router-dom\";\r\nimport { toast } from \"react-toastify\";\r\nimport api from \"../../utils/api\";\r\nimport { useAuth } from \"../../context/AuthContext\";\r\nimport {\r\n  Home,\r\n  Building2,\r\n  Eye,\r\n  Heart,\r\n  Phone,\r\n  MessageSquare,\r\n  TrendingUp,\r\n  Calendar,\r\n  MapPin,\r\n  IndianRupee,\r\n  Edit3,\r\n  Trash2,\r\n  Plus,\r\n  MoreVertical,\r\n  Filter,\r\n  Search,\r\n  ChevronDown,\r\n  ExternalLink,\r\n  Clock,\r\n  CheckCircle,\r\n  XCircle,\r\n  AlertCircle,\r\n  BarChart3,\r\n  Users,\r\n  Layers,\r\n  RefreshCw,\r\n  Mail,\r\n  User,\r\n  ChevronRight,\r\n  TrendingDown,\r\n  Target,\r\n  UserCheck,\r\n  UserX,\r\n  MessageCircle,\r\n  PhoneCall,\r\n  FileText, // Imported for Export button\r\n  X,\r\n} from \"lucide-react\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport {\r\n  PieChart,\r\n  Pie,\r\n  Cell,\r\n  ResponsiveContainer,\r\n  LineChart,\r\n  Line,\r\n  XAxis,\r\n  YAxis,\r\n  CartesianGrid,\r\n  Tooltip,\r\n  Legend,\r\n  BarChart,\r\n  Bar,\r\n  AreaChart,\r\n  Area,\r\n} from \"recharts\";\r\n\r\nconst API_BASE = import.meta.env.VITE_API_BASE;\r\n\r\n// ... [Keep StatusBadge, LeadStatusBadge, StatsCard, PropertyCard, LeadCard, and COLORS exactly as they were] ...\r\n// (I am omitting the sub-components here for brevity, assume they are present as in your original code)\r\n\r\nconst resolveImageSrc = (img) => {\r\n  if (!img) return \"https://images.unsplash.com/photo-1560518883-ce09059eeffa?w=400\";\r\n  const s = String(img).trim();\r\n  const lower = s.toLowerCase();\r\n  if (lower.startsWith(\"data:\") || lower.startsWith(\"http\")) return s;\r\n  if (s.startsWith(\"/uploads\")) return `${API_BASE}${s}`;\r\n  return `${API_BASE}/uploads/${s}`;\r\n};\r\n\r\n// Status badge component\r\nconst StatusBadge = ({ status }) => {\r\n  const statusConfig = {\r\n    active: { bg: \"bg-green-100\", text: \"text-green-700\", icon: CheckCircle, label: \"Active\" },\r\n    pending: { bg: \"bg-amber-100\", text: \"text-amber-700\", icon: Clock, label: \"Pending\" },\r\n    sold: { bg: \"bg-blue-100\", text: \"text-blue-700\", icon: CheckCircle, label: \"Sold\" },\r\n    rented: { bg: \"bg-purple-100\", text: \"text-purple-700\", icon: CheckCircle, label: \"Rented\" },\r\n    inactive: { bg: \"bg-gray-100\", text: \"text-gray-700\", icon: XCircle, label: \"Inactive\" },\r\n  };\r\n\r\n  const config = statusConfig[status] || statusConfig.pending;\r\n  const Icon = config.icon;\r\n\r\n  return (\r\n    <span className={`inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-medium ${config.bg} ${config.text}`}>\r\n      <Icon className=\"w-3.5 h-3.5\" />\r\n      {config.label}\r\n    </span>\r\n  );\r\n};\r\n\r\n// Lead Status Badge\r\nconst LeadStatusBadge = ({ status }) => {\r\n  const statusConfig = {\r\n    new: { bg: \"bg-blue-100\", text: \"text-blue-700\", label: \"New\" },\r\n    contacted: { bg: \"bg-yellow-100\", text: \"text-yellow-700\", label: \"Contacted\" },\r\n    interested: { bg: \"bg-purple-100\", text: \"text-purple-700\", label: \"Interested\" },\r\n    negotiating: { bg: \"bg-orange-100\", text: \"text-orange-700\", label: \"Negotiating\" },\r\n    converted: { bg: \"bg-green-100\", text: \"text-green-700\", label: \"Converted\" },\r\n    lost: { bg: \"bg-red-100\", text: \"text-red-700\", label: \"Lost\" },\r\n  };\r\n\r\n  const config = statusConfig[status] || statusConfig.new;\r\n\r\n  return (\r\n    <span className={`inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium ${config.bg} ${config.text}`}>\r\n      {config.label}\r\n    </span>\r\n  );\r\n};\r\n\r\n// Stats Card component\r\nconst StatsCard = ({ icon: Icon, label, value, trend, color, subLabel }) => (\r\n  <div className=\"bg-white rounded-xl border border-gray-200 p-5 hover:shadow-md transition-shadow\">\r\n    <div className=\"flex items-center justify-between\">\r\n      <div className={`p-3 rounded-xl ${color}`}>\r\n        <Icon className=\"w-6 h-6 text-white\" />\r\n      </div>\r\n      {trend !== undefined && (\r\n        <span className={`text-xs font-medium flex items-center gap-1 ${trend >= 0 ? \"text-green-600\" : \"text-red-600\"}`}>\r\n          {trend >= 0 ? <TrendingUp className=\"w-3.5 h-3.5\" /> : <TrendingDown className=\"w-3.5 h-3.5\" />}\r\n          {Math.abs(trend)}%\r\n        </span>\r\n      )}\r\n    </div>\r\n    <p className=\"mt-4 text-2xl font-bold text-gray-900\">{value}</p>\r\n    <p className=\"text-sm text-gray-500\">{label}</p>\r\n    {subLabel && <p className=\"text-xs text-gray-400 mt-1\">{subLabel}</p>}\r\n  </div>\r\n);\r\n\r\n// Property Card component\r\nconst PropertyCard = ({ property, onEdit, onDelete, onViewDetails, onViewLeads }) => {\r\n  const [showMenu, setShowMenu] = useState(false);\r\n\r\n  const formatPrice = (price) => {\r\n    if (!price) return \"Price on Request\";\r\n    if (price >= 10000000) return `Γé╣${(price / 10000000).toFixed(2)} Cr`;\r\n    if (price >= 100000) return `Γé╣${(price / 100000).toFixed(2)} Lac`;\r\n    return `Γé╣${price.toLocaleString()}`;\r\n  };\r\n\r\n  const getMainImage = () => {\r\n    if (property.categorizedImages) {\r\n      if (property.categorizedImages.residential) {\r\n        const residentialCategories = ['exterior', 'livingRoom', 'bedroom', 'hall', 'balcony', 'kitchen'];\r\n        for (const cat of residentialCategories) {\r\n          if (property.categorizedImages.residential[cat]?.length > 0) {\r\n            return resolveImageSrc(property.categorizedImages.residential[cat][0]);\r\n          }\r\n        }\r\n      }\r\n      if (property.categorizedImages.commercial) {\r\n        const commercialCategories = ['facade', 'reception', 'workArea', 'cabin', 'shopFloor'];\r\n        for (const cat of commercialCategories) {\r\n          if (property.categorizedImages.commercial[cat]?.length > 0) {\r\n            return resolveImageSrc(property.categorizedImages.commercial[cat][0]);\r\n          }\r\n        }\r\n      }\r\n    }\r\n    if (property.images?.length > 0) {\r\n      return resolveImageSrc(property.images[0]);\r\n    }\r\n    return resolveImageSrc(null);\r\n  };\r\n\r\n  return (\r\n    <motion.div\r\n      initial={{ opacity: 0, y: 20 }}\r\n      animate={{ opacity: 1, y: 0 }}\r\n      className=\"bg-white rounded-xl border border-gray-200 overflow-hidden hover:shadow-lg transition-all group\"\r\n    >\r\n      {/* Image Section */}\r\n      <div className=\"relative h-48 overflow-hidden\">\r\n        <img\r\n          src={getMainImage()}\r\n          alt={property.title}\r\n          loading=\"lazy\"\r\n          onError={(e) => {\r\n            e.target.onerror = null;\r\n            e.target.src = resolveImageSrc(null);\r\n          }}\r\n          className=\"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300\"\r\n        />\r\n        <div className=\"absolute top-3 left-3\">\r\n          <StatusBadge status={property.status || \"active\"} />\r\n        </div>\r\n        <div className=\"absolute top-3 right-3\">\r\n          <div className=\"relative\">\r\n            <button\r\n              onClick={() => setShowMenu(!showMenu)}\r\n              className=\"p-2 bg-white/90 backdrop-blur rounded-lg hover:bg-white transition shadow-sm\"\r\n            >\r\n              <MoreVertical className=\"w-4 h-4 text-gray-700\" />\r\n            </button>\r\n            <AnimatePresence>\r\n              {showMenu && (\r\n                <motion.div\r\n                  initial={{ opacity: 0, scale: 0.95 }}\r\n                  animate={{ opacity: 1, scale: 1 }}\r\n                  exit={{ opacity: 0, scale: 0.95 }}\r\n                  className=\"absolute right-0 mt-2 w-44 bg-white rounded-lg shadow-xl border border-gray-100 py-1 z-10\"\r\n                >\r\n                  <button\r\n                    onClick={() => { onViewDetails(property); setShowMenu(false); }}\r\n                    className=\"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-50 flex items-center gap-2\"\r\n                  >\r\n                    <ExternalLink className=\"w-4 h-4\" /> View Details\r\n                  </button>\r\n                  <button\r\n                    onClick={() => { onViewLeads(property); setShowMenu(false); }}\r\n                    className=\"w-full px-4 py-2 text-left text-sm text-blue-600 hover:bg-blue-50 flex items-center gap-2\"\r\n                  >\r\n                    <Users className=\"w-4 h-4\" /> View Leads\r\n                  </button>\r\n                  <button\r\n                    onClick={() => { onEdit(property); setShowMenu(false); }}\r\n                    className=\"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-50 flex items-center gap-2\"\r\n                  >\r\n                    <Edit3 className=\"w-4 h-4\" /> Edit Property\r\n                  </button>\r\n                  <button\r\n                    onClick={() => { onDelete(property); setShowMenu(false); }}\r\n                    className=\"w-full px-4 py-2 text-left text-sm text-red-600 hover:bg-red-50 flex items-center gap-2\"\r\n                  >\r\n                    <Trash2 className=\"w-4 h-4\" /> Delete\r\n                  </button>\r\n                </motion.div>\r\n              )}\r\n            </AnimatePresence>\r\n          </div>\r\n        </div>\r\n        <div className=\"absolute bottom-3 left-3 right-3 flex justify-between\">\r\n          <span className=\"px-2.5 py-1 bg-black/70 backdrop-blur text-white text-xs font-medium rounded-lg\">\r\n            {property.listingType || \"Rent\"}\r\n          </span>\r\n          <span className=\"px-2.5 py-1 bg-white/90 backdrop-blur text-gray-800 text-xs font-medium rounded-lg\">\r\n            {typeof property.propertyType === 'object' ? property.propertyType?.name : property.propertyType || property.propertyTypeName || \"Property\"}\r\n          </span>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Content Section */}\r\n      <div className=\"p-4\">\r\n        <h3 className=\"font-semibold text-gray-900 text-lg line-clamp-1 mb-1\">\r\n          {property.title}\r\n        </h3>\r\n        <p className=\"text-sm text-gray-500 flex items-center gap-1 mb-3\">\r\n          <MapPin className=\"w-3.5 h-3.5\" />\r\n          {property.locality || property.address?.locality || property.address?.area || \"N/A\"}, {property.city || property.address?.city || \"N/A\"}\r\n        </p>\r\n\r\n        <div className=\"flex items-center justify-between mb-4\">\r\n          <div>\r\n            <p className=\"text-xl font-bold text-gray-900\">{formatPrice(property.price || property.expectedPrice)}</p>\r\n            {property.listingType === \"Rent\" && (\r\n              <p className=\"text-xs text-gray-500\">per month</p>\r\n            )}\r\n          </div>\r\n          <div className=\"text-right\">\r\n            {(property.builtUpArea || property.area?.builtUpSqft) && (\r\n              <p className=\"text-sm font-medium text-gray-700\">{property.builtUpArea || property.area?.builtUpSqft} sq.ft</p>\r\n            )}\r\n            {property.bhk && (\r\n              <p className=\"text-xs text-gray-500\">{property.bhk}</p>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Stats Row */}\r\n        <div className=\"flex items-center justify-between pt-4 border-t border-gray-100\">\r\n          <div className=\"flex items-center gap-4\">\r\n            <div className=\"flex items-center gap-1.5 text-gray-500\">\r\n              <Eye className=\"w-4 h-4\" />\r\n              <span className=\"text-sm font-medium\">{property.views || 0}</span>\r\n            </div>\r\n            <div className=\"flex items-center gap-1.5 text-gray-500\">\r\n              <Heart className=\"w-4 h-4\" />\r\n              <span className=\"text-sm font-medium\">{property.likes || 0}</span>\r\n            </div>\r\n            <div className=\"flex items-center gap-1.5 text-blue-600\">\r\n              <Users className=\"w-4 h-4\" />\r\n              <span className=\"text-sm font-medium\">{property.interestedUsers?.length || 0}</span>\r\n            </div>\r\n          </div>\r\n          <p className=\"text-xs text-gray-400\">\r\n            {new Date(property.createdAt).toLocaleDateString(\"en-IN\", { day: \"numeric\", month: \"short\" })}\r\n          </p>\r\n        </div>\r\n      </div>\r\n    </motion.div>\r\n  );\r\n};\r\n\r\n// Lead Card Component\r\nconst LeadCard = ({ lead, onUpdateStatus, onContact }) => {\r\n  const [showActions, setShowActions] = useState(false);\r\n\r\n  return (\r\n    <motion.div\r\n      initial={{ opacity: 0, x: -20 }}\r\n      animate={{ opacity: 1, x: 0 }}\r\n      className=\"bg-white rounded-xl border border-gray-200 p-4 hover:shadow-md transition-all\"\r\n    >\r\n      <div className=\"flex items-start gap-4\">\r\n        {/* User Avatar */}\r\n        <div className=\"flex-shrink-0\">\r\n          {lead.userSnapshot?.profileImage ? (\r\n            <img\r\n              src={lead.userSnapshot.profileImage}\r\n              alt={lead.userSnapshot.name}\r\n              className=\"w-12 h-12 rounded-full object-cover border-2 border-gray-200\"\r\n            />\r\n          ) : (\r\n            <div className=\"w-12 h-12 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-bold text-lg\">\r\n              {lead.userSnapshot?.name?.charAt(0)?.toUpperCase() || \"U\"}\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Lead Info */}\r\n        <div className=\"flex-1 min-w-0\">\r\n          <div className=\"flex items-start justify-between\">\r\n            <div>\r\n              <h4 className=\"font-semibold text-gray-900\">{lead.userSnapshot?.name || \"Unknown User\"}</h4>\r\n              <p className=\"text-sm text-gray-500 flex items-center gap-1\">\r\n                <Mail className=\"w-3.5 h-3.5\" />\r\n                {lead.userSnapshot?.email}\r\n              </p>\r\n              {lead.userSnapshot?.phone && (\r\n                <p className=\"text-sm text-gray-500 flex items-center gap-1\">\r\n                  <Phone className=\"w-3.5 h-3.5\" />\r\n                  {lead.userSnapshot.phone}\r\n                </p>\r\n              )}\r\n            </div>\r\n            <div className=\"flex items-center gap-2\">\r\n              <LeadStatusBadge status={lead.status} />\r\n              {!lead.isViewed && (\r\n                <span className=\"w-2 h-2 bg-red-500 rounded-full animate-pulse\" title=\"New lead\"></span>\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Property Info */}\r\n          <div className=\"mt-3 p-2 bg-gray-50 rounded-lg\">\r\n            <p className=\"text-sm font-medium text-gray-700 line-clamp-1\">\r\n              {lead.propertySnapshot?.title || \"Property\"}\r\n            </p>\r\n            <p className=\"text-xs text-gray-500\">\r\n              {lead.propertySnapshot?.locality}, {lead.propertySnapshot?.city} ΓÇó Γé╣{(lead.propertySnapshot?.price || 0).toLocaleString()}\r\n            </p>\r\n          </div>\r\n\r\n          {/* Timestamp */}\r\n          <p className=\"text-xs text-gray-400 mt-2\">\r\n            Interested on {new Date(lead.createdAt).toLocaleDateString(\"en-IN\", { day: \"numeric\", month: \"short\", year: \"numeric\", hour: \"2-digit\", minute: \"2-digit\" })}\r\n          </p>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Action Buttons */}\r\n      <div className=\"mt-4 flex items-center gap-2 flex-wrap\">\r\n        <a\r\n          href={`tel:${lead.userSnapshot?.phone}`}\r\n          className=\"flex items-center gap-1.5 px-3 py-1.5 bg-green-100 text-green-700 rounded-lg text-sm font-medium hover:bg-green-200 transition\"\r\n        >\r\n          <PhoneCall className=\"w-4 h-4\" /> Call\r\n        </a>\r\n        <a\r\n          href={`mailto:${lead.userSnapshot?.email}`}\r\n          className=\"flex items-center gap-1.5 px-3 py-1.5 bg-blue-100 text-blue-700 rounded-lg text-sm font-medium hover:bg-blue-200 transition\"\r\n        >\r\n          <Mail className=\"w-4 h-4\" /> Email\r\n        </a>\r\n        <a\r\n          href={`https://wa.me/${lead.userSnapshot?.phone?.replace(/\\D/g, '')}`}\r\n          target=\"_blank\"\r\n          rel=\"noopener noreferrer\"\r\n          className=\"flex items-center gap-1.5 px-3 py-1.5 bg-emerald-100 text-emerald-700 rounded-lg text-sm font-medium hover:bg-emerald-200 transition\"\r\n        >\r\n          <MessageCircle className=\"w-4 h-4\" /> WhatsApp\r\n        </a>\r\n        <div className=\"relative ml-auto\">\r\n          <button\r\n            onClick={() => setShowActions(!showActions)}\r\n            className=\"flex items-center gap-1.5 px-3 py-1.5 bg-gray-100 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-200 transition\"\r\n          >\r\n            Update Status <ChevronDown className=\"w-4 h-4\" />\r\n          </button>\r\n          <AnimatePresence>\r\n            {showActions && (\r\n              <motion.div\r\n                initial={{ opacity: 0, y: 10 }}\r\n                animate={{ opacity: 1, y: 0 }}\r\n                exit={{ opacity: 0, y: 10 }}\r\n                className=\"absolute right-0 bottom-full mb-2 w-40 bg-white rounded-lg shadow-xl border border-gray-100 py-1 z-20\"\r\n              >\r\n                {[\"contacted\", \"interested\", \"negotiating\", \"converted\", \"lost\"].map((status) => (\r\n                  <button\r\n                    key={status}\r\n                    onClick={() => { onUpdateStatus(lead._id, status); setShowActions(false); }}\r\n                    className=\"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-50 capitalize\"\r\n                  >\r\n                    {status}\r\n                  </button>\r\n                ))}\r\n              </motion.div>\r\n            )}\r\n          </AnimatePresence>\r\n        </div>\r\n      </div>\r\n    </motion.div>\r\n  );\r\n};\r\n\r\n// Chart Colors\r\nconst COLORS = ['#3B82F6', '#10B981', '#F59E0B', '#EF4444', '#8B5CF6', '#EC4899'];\r\n\r\nexport default function MyProperties() {\r\n  const navigate = useNavigate();\r\n  const [user, setUser] = useState(null);\r\n  const [properties, setProperties] = useState([]);\r\n  const [leads, setLeads] = useState([]);\r\n  const [leadAnalytics, setLeadAnalytics] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [activeTab, setActiveTab] = useState(\"properties\"); // 'properties', 'leads', 'analytics'\r\n  const [filter, setFilter] = useState(\"all\");\r\n  const [leadFilter, setLeadFilter] = useState(\"all\");\r\n  const [searchQuery, setSearchQuery] = useState(\"\");\r\n  const [sortBy, setSortBy] = useState(\"newest\");\r\n  const [showDeleteModal, setShowDeleteModal] = useState(false);\r\n  const [propertyToDelete, setPropertyToDelete] = useState(null);\r\n  const [deleting, setDeleting] = useState(false);\r\n  const [refreshing, setRefreshing] = useState(false);\r\n  const [lastUpdated, setLastUpdated] = useState(null);\r\n  const [selectedPropertyForLeads, setSelectedPropertyForLeads] = useState(null);\r\n\r\n  // === NEW STATE for Date Filter & Export ===\r\n  const [startDateFilter, setStartDateFilter] = useState(\"\");\r\n  const [endDateFilter, setEndDateFilter] = useState(\"\");\r\n  const [isExporting, setIsExporting] = useState(false);\r\n  const [todayLeadsCount, setTodayLeadsCount] = useState(0);\r\n\r\n  // Auth using AuthContext\r\n  const { user: authUser, isAuthenticated, loading: authLoading } = useAuth();\r\n\r\n  // Auth check\r\n  useEffect(() => {\r\n    if (authLoading) return;\r\n\r\n    if (!isAuthenticated || !authUser) {\r\n      toast.error(\"Please login to view your properties\");\r\n      navigate(\"/login\");\r\n      return;\r\n    }\r\n\r\n    if (authUser.role !== \"owner\" && authUser.role !== \"agent\") {\r\n      toast.error(\"Only property owners can access this page\");\r\n      navigate(\"/\");\r\n      return;\r\n    }\r\n\r\n    fetchData();\r\n  }, [authLoading, isAuthenticated, authUser, navigate]);\r\n\r\n  // Memoized fetchData function to handle date filters\r\n  const fetchData = useCallback(async (isRefresh = false, startFilter = startDateFilter, endFilter = endDateFilter) => {\r\n    try {\r\n      if (isRefresh) {\r\n        setRefreshing(true);\r\n      } else {\r\n        setLoading(true);\r\n      }\r\n\r\n      // Fetch properties first - using api client with cookies\r\n      const propertiesRes = await api.get('/properties/my-properties');\r\n\r\n      if (propertiesRes.data.success) {\r\n        setProperties(propertiesRes.data.data || []);\r\n      }\r\n\r\n      // Build Lead Query Params\r\n      const leadParams = new URLSearchParams();\r\n      if (startFilter) leadParams.append('startDate', startFilter);\r\n      if (endFilter) leadParams.append('endDate', endFilter);\r\n\r\n      // Try to fetch leads and analytics\r\n      try {\r\n        const [leadsRes, analyticsRes] = await Promise.all([\r\n          api.get(`/leads?${leadParams.toString()}`),\r\n          api.get('/leads/analytics')\r\n        ]);\r\n\r\n        if (leadsRes.data.success) {\r\n          setLeads(leadsRes.data.data || []);\r\n          // Update today's lead count if available in stats\r\n          if (leadsRes.data.stats && leadsRes.data.stats.today !== undefined) {\r\n            setTodayLeadsCount(leadsRes.data.stats.today);\r\n          }\r\n        }\r\n\r\n        if (analyticsRes.data.success) {\r\n          setLeadAnalytics(analyticsRes.data.data);\r\n        }\r\n      } catch (leadErr) {\r\n        console.error(\"Error fetching leads data:\", leadErr.message);\r\n        setLeads([]);\r\n        setLeadAnalytics(null);\r\n        setTodayLeadsCount(0);\r\n      }\r\n\r\n      setLastUpdated(new Date());\r\n    } catch (err) {\r\n      console.error(\"Error fetching data:\", err);\r\n      // 401 errors handled by api interceptor\r\n      if (err.response?.status !== 401) {\r\n        toast.error(\"Failed to load data\");\r\n      }\r\n    } finally {\r\n      setLoading(false);\r\n      setRefreshing(false);\r\n    }\r\n  }, [startDateFilter, endDateFilter]);\r\n\r\n  // Initial Fetch (Component Mount)\r\n  useEffect(() => {\r\n    fetchData();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []); // Only run once on mount\r\n\r\n  // === DATE FILTER LOGIC ===\r\n  const handleApplyDateFilter = () => {\r\n    if (!startDateFilter || !endDateFilter) {\r\n      toast.error(\"Please select both start and end dates.\");\r\n      return;\r\n    }\r\n\r\n    const start = new Date(startDateFilter);\r\n    const end = new Date(endDateFilter);\r\n\r\n    if (start > end) {\r\n      toast.error(\"Start date cannot be after end date.\");\r\n      return;\r\n    }\r\n\r\n    // Calculate the difference in days\r\n    const diffTime = Math.abs(end.getTime() - start.getTime());\r\n    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); // Difference in days\r\n\r\n    // 7-day restriction check (allow 0-7 days inclusive)\r\n    if (diffDays > 7) {\r\n      toast.error(\r\n        <div className=\"flex flex-col\">\r\n          <p>You can only view up to <strong>7 days</strong> of leads at once.</p>\r\n          <p className=\"mt-2 text-sm\">For historical data exceeding 7 days, please use the <strong>Export 3-Month Data</strong> button or contact <strong>dealdirect@gmail.com</strong>.</p>\r\n        </div>\r\n      );\r\n      return;\r\n    }\r\n\r\n    // Trigger fetchData with the new dates\r\n    fetchData(false, startDateFilter, endDateFilter);\r\n  };\r\n\r\n  const handleClearDateFilter = () => {\r\n    setStartDateFilter(\"\");\r\n    setEndDateFilter(\"\");\r\n    // Fetch data without filters\r\n    fetchData(false, \"\", \"\");\r\n  };\r\n\r\n\r\n  // === CORRECTED EXPORT FUNCTION ===\r\n  const handleExportLeads = async () => {\r\n    setIsExporting(true);\r\n    try {\r\n      // Use api client for blob response\r\n      const response = await api.get('/leads/export', {\r\n        responseType: 'blob', // Critical: tells axios to handle binary data\r\n      });\r\n\r\n      // Check if the response is actually JSON error (edge case where server sends JSON despite blob request)\r\n      if (response.data.type === 'application/json') {\r\n        const errorData = JSON.parse(await response.data.text());\r\n        throw new Error(errorData.message || \"Export failed\");\r\n      }\r\n\r\n      // Create a download link for the blob\r\n      const url = window.URL.createObjectURL(new Blob([response.data]));\r\n      const link = document.createElement('a');\r\n      link.href = url;\r\n\r\n      // Name the file\r\n      const dateStr = new Date().toISOString().split('T')[0];\r\n      link.setAttribute('download', `MyLeads_History_${dateStr}.xlsx`);\r\n\r\n      document.body.appendChild(link);\r\n      link.click();\r\n\r\n      // Cleanup\r\n      link.parentNode.removeChild(link);\r\n      window.URL.revokeObjectURL(url);\r\n\r\n      toast.success(\"Historical data exported successfully!\");\r\n\r\n    } catch (err) {\r\n      console.error(\"Export error:\", err);\r\n      // Better error message extraction for blob responses\r\n      let errorMsg = \"Failed to export data.\";\r\n      if (err.response && err.response.data instanceof Blob) {\r\n        try {\r\n          const blobText = await err.response.data.text();\r\n          const errorObj = JSON.parse(blobText);\r\n          errorMsg = errorObj.message || errorMsg;\r\n        } catch (e) { /* ignore json parse error */ }\r\n      } else if (err.message) {\r\n        errorMsg = err.message;\r\n      }\r\n      toast.error(errorMsg);\r\n    } finally {\r\n      setIsExporting(false);\r\n    }\r\n  };\r\n\r\n  // ... rest of your component logic and JSX\r\n\r\n  const handleRefresh = () => {\r\n    fetchData(true);\r\n  };\r\n\r\n  // Calculate stats\r\n  const stats = {\r\n    total: properties.length,\r\n    active: properties.filter((p) => p.status === \"active\" || !p.status).length,\r\n    todayLeads: todayLeadsCount, // Updated\r\n    totalViews: properties.reduce((sum, p) => sum + (p.views || 0), 0),\r\n    totalLeads: leadAnalytics?.totalLeads || leads.length,\r\n    newLeads: leadAnalytics?.newLeadsThisWeek || leads.filter(l => l.status === \"new\").length,\r\n    conversionRate: leadAnalytics?.conversionRate || 0,\r\n  };\r\n\r\n  // Prepare chart data (unchanged)\r\n  const leadStatusData = leadAnalytics?.statusStats\r\n    ? Object.entries(leadAnalytics.statusStats)\r\n      .filter(([name, value]) => value > 0)\r\n      .map(([name, value]) => ({ name: name.charAt(0).toUpperCase() + name.slice(1), value }))\r\n    : [];\r\n\r\n  const dailyLeadsData = leadAnalytics?.dailyLeads?.map(d => ({\r\n    date: new Date(d._id).toLocaleDateString('en-IN', { day: 'numeric', month: 'short' }),\r\n    leads: d.count\r\n  })) || [];\r\n\r\n  const propertyLeadsData = leadAnalytics?.leadsByProperty?.map(p => ({\r\n    name: p.propertyTitle?.substring(0, 20) + (p.propertyTitle?.length > 20 ? '...' : '') || 'Property',\r\n    leads: p.count\r\n  })) || [];\r\n\r\n  // Filter properties\r\n  const filteredProperties = properties\r\n    .filter((p) => {\r\n      if (filter === \"all\") return true;\r\n      return (p.status || \"active\") === filter;\r\n    })\r\n    .filter((p) => {\r\n      if (!searchQuery) return true;\r\n      const query = searchQuery.toLowerCase();\r\n      const locality = p.locality || p.address?.locality || p.address?.area || \"\";\r\n      const city = p.city || p.address?.city || \"\";\r\n      return (\r\n        p.title?.toLowerCase().includes(query) ||\r\n        locality.toLowerCase().includes(query) ||\r\n        city.toLowerCase().includes(query)\r\n      );\r\n    })\r\n    .sort((a, b) => {\r\n      switch (sortBy) {\r\n        case \"newest\": return new Date(b.createdAt) - new Date(a.createdAt);\r\n        case \"oldest\": return new Date(a.createdAt) - new Date(b.createdAt);\r\n        case \"price-high\": return (b.expectedPrice || b.price || 0) - (a.expectedPrice || a.price || 0);\r\n        case \"price-low\": return (a.expectedPrice || a.price || 0) - (b.expectedPrice || b.price || 0);\r\n        case \"views\": return (b.views || 0) - (a.views || 0);\r\n        case \"leads\": return (b.interestedUsers?.length || 0) - (a.interestedUsers?.length || 0);\r\n        default: return 0;\r\n      }\r\n    });\r\n\r\n  // Filter leads\r\n  const filteredLeads = leads\r\n    .filter((l) => {\r\n      if (leadFilter === \"all\") return true;\r\n      return l.status === leadFilter;\r\n    })\r\n    .filter((l) => {\r\n      if (selectedPropertyForLeads) {\r\n        return l.property?._id === selectedPropertyForLeads._id || l.property === selectedPropertyForLeads._id;\r\n      }\r\n      return true;\r\n    });\r\n\r\n  const handleEdit = (property) => {\r\n    navigate(`/edit-property/${property._id}`);\r\n  };\r\n\r\n  const handleDelete = (property) => {\r\n    setPropertyToDelete(property);\r\n    setShowDeleteModal(true);\r\n  };\r\n\r\n  const confirmDelete = async () => {\r\n    if (!propertyToDelete) return;\r\n    setDeleting(true);\r\n    try {\r\n      await api.delete(`/properties/${propertyToDelete._id}`);\r\n      toast.success(\"Property deleted successfully\");\r\n      setProperties(properties.filter((p) => p._id !== propertyToDelete._id));\r\n      setShowDeleteModal(false);\r\n      setPropertyToDelete(null);\r\n    } catch (err) {\r\n      toast.error(\"Failed to delete property\");\r\n    } finally {\r\n      setDeleting(false);\r\n    }\r\n  };\r\n\r\n  const handleViewDetails = (property) => {\r\n    navigate(`/properties/${property._id}`);\r\n  };\r\n\r\n  const handleViewLeads = (property) => {\r\n    setSelectedPropertyForLeads(property);\r\n    setActiveTab(\"leads\");\r\n  };\r\n\r\n  const handleUpdateLeadStatus = async (leadId, status) => {\r\n    try {\r\n      await api.put(`/leads/${leadId}/status`, { status });\r\n      toast.success(`Lead status updated to ${status}`);\r\n      // Refresh leads to update UI\r\n      fetchData(false, startDateFilter, endDateFilter);\r\n    } catch (err) {\r\n      toast.error(\"Failed to update lead status\");\r\n    }\r\n  };\r\n\r\n  const [showPlans, setShowPlans] = useState(false);\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 pt-24 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <RefreshCw className=\"w-8 h-8 text-blue-600 animate-spin mx-auto mb-4\" />\r\n          <p className=\"text-gray-600\">Loading your dashboard...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 pt-20\">\r\n      {/* Header */}\r\n      <div className=\"bg-white border-b border-gray-200\">\r\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6\">\r\n          <div className=\"flex flex-col md:flex-row md:items-center md:justify-between gap-4\">\r\n            <div>\r\n              <h1 className=\"text-2xl font-bold text-gray-900\">My Dashboard</h1>\r\n              <p className=\"text-gray-500 mt-1\">Manage properties, track leads & analytics</p>\r\n              {lastUpdated && (\r\n                <p className=\"text-xs text-gray-400 mt-1\">\r\n                  Last updated: {lastUpdated.toLocaleTimeString('en-IN', { hour: '2-digit', minute: '2-digit' })}\r\n                </p>\r\n              )}\r\n            </div>\r\n            <div className=\"flex items-center gap-3\">\r\n              <button\r\n                onClick={handleRefresh}\r\n                disabled={refreshing}\r\n                className=\"inline-flex items-center gap-2 bg-gray-100 text-gray-700 px-4 py-2.5 rounded-xl font-medium hover:bg-gray-200 transition border border-gray-200 disabled:opacity-50\"\r\n              >\r\n                <RefreshCw className={`w-4 h-4 ${refreshing ? 'animate-spin' : ''}`} />\r\n                {refreshing ? 'Refreshing...' : 'Refresh'}\r\n              </button>\r\n              <Link\r\n                to=\"/add-property\"\r\n                className=\"inline-flex items-center gap-2 bg-blue-600 text-white px-5 py-2.5 rounded-xl font-semibold hover:bg-blue-700 transition shadow-md\"\r\n              >\r\n                <Plus className=\"w-5 h-5\" />\r\n                Add Property\r\n              </Link>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Tabs */}\r\n          <div className=\"flex gap-1 mt-6 bg-gray-100 p-1 rounded-xl w-full md:w-fit overflow-x-auto\">\r\n            {[\r\n              { key: \"properties\", label: \"Properties\", icon: Home },\r\n              { key: \"leads\", label: \"Leads\", icon: Users, badge: stats.newLeads },\r\n              { key: \"analytics\", label: \"Analytics\", icon: BarChart3 },\r\n            ].map((tab) => (\r\n              <button\r\n                key={tab.key}\r\n                onClick={() => { setActiveTab(tab.key); setSelectedPropertyForLeads(null); }}\r\n                className={`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition ${activeTab === tab.key\r\n                  ? \"bg-white text-blue-600 shadow-sm\"\r\n                  : \"text-gray-600 hover:text-gray-900\"\r\n                  }`}\r\n              >\r\n                <tab.icon className=\"w-4 h-4\" />\r\n                {tab.label}\r\n                {tab.badge > 0 && (\r\n                  <span className=\"bg-red-500 text-white text-xs px-1.5 py-0.5 rounded-full\">{tab.badge}</span>\r\n                )}\r\n              </button>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\r\n        {/* Stats Grid */}\r\n        <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-8\">\r\n          <StatsCard icon={Layers} label=\"Total Properties\" value={stats.total} color=\"bg-blue-600\" />\r\n          <StatsCard icon={CheckCircle} label=\"Active Listings\" value={stats.active} color=\"bg-green-600\" />\r\n          {/* New \"Today's Leads\" Card */}\r\n          <StatsCard icon={Calendar} label=\"Today's Leads\" value={stats.todayLeads} color=\"bg-indigo-600\" />\r\n          <StatsCard icon={Eye} label=\"Total Views\" value={stats.totalViews} color=\"bg-purple-600\" />\r\n          <StatsCard icon={Users} label=\"Total Leads\" value={stats.totalLeads} color=\"bg-pink-600\" />\r\n          <StatsCard icon={Target} label=\"Conversion Rate\" value={`${stats.conversionRate}%`} color=\"bg-teal-600\" />\r\n        </div>\r\n\r\n        {/* Properties Tab */}\r\n        {activeTab === \"properties\" && (\r\n          <>\r\n            {/* Filters */}\r\n            <div className=\"bg-white rounded-xl border border-gray-200 p-4 mb-6\">\r\n              <div className=\"flex flex-col md:flex-row gap-4\">\r\n                <div className=\"flex-1 relative\">\r\n                  <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400\" />\r\n                  <input\r\n                    type=\"text\"\r\n                    placeholder=\"Search by title, locality, or city...\"\r\n                    value={searchQuery}\r\n                    onChange={(e) => setSearchQuery(e.target.value)}\r\n                    className=\"w-full pl-10 pr-4 py-2.5 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none\"\r\n                  />\r\n                </div>\r\n                <div className=\"flex items-center gap-2 overflow-x-auto pb-1\">\r\n                  {[\r\n                    { key: \"all\", label: \"All\" },\r\n                    { key: \"active\", label: \"Active\" },\r\n                    { key: \"pending\", label: \"Pending\" },\r\n                    { key: \"sold\", label: \"Sold\" },\r\n                    { key: \"rented\", label: \"Rented\" },\r\n                  ].map((tab) => (\r\n                    <button\r\n                      key={tab.key}\r\n                      onClick={() => setFilter(tab.key)}\r\n                      className={`px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap transition ${filter === tab.key\r\n                        ? \"bg-blue-600 text-white\"\r\n                        : \"bg-gray-100 text-gray-600 hover:bg-gray-200\"\r\n                        }`}\r\n                    >\r\n                      {tab.label}\r\n                    </button>\r\n                  ))}\r\n                </div>\r\n                <select\r\n                  value={sortBy}\r\n                  onChange={(e) => setSortBy(e.target.value)}\r\n                  className=\"px-4 py-2.5 border border-gray-200 rounded-lg text-sm font-medium text-gray-700 focus:ring-2 focus:ring-blue-500 outline-none\"\r\n                >\r\n                  <option value=\"newest\">Newest First</option>\r\n                  <option value=\"oldest\">Oldest First</option>\r\n                  <option value=\"price-high\">Price: High to Low</option>\r\n                  <option value=\"price-low\">Price: Low to High</option>\r\n                  <option value=\"views\">Most Viewed</option>\r\n                  <option value=\"leads\">Most Leads</option>\r\n                </select>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Properties Grid */}\r\n            {filteredProperties.length > 0 ? (\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n                {filteredProperties.map((property) => (\r\n                  <PropertyCard\r\n                    key={property._id}\r\n                    property={property}\r\n                    onEdit={handleEdit}\r\n                    onDelete={handleDelete}\r\n                    onViewDetails={handleViewDetails}\r\n                    onViewLeads={handleViewLeads}\r\n                  />\r\n                ))}\r\n              </div>\r\n            ) : (\r\n              <div className=\"bg-white rounded-xl border border-gray-200 p-12 text-center\">\r\n                <div className=\"w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4\">\r\n                  <Home className=\"w-10 h-10 text-gray-400\" />\r\n                </div>\r\n                <h3 className=\"text-xl font-semibold text-gray-900 mb-2\">\r\n                  {searchQuery || filter !== \"all\" ? \"No properties found\" : \"No properties yet\"}\r\n                </h3>\r\n                <p className=\"text-gray-500 mb-6\">\r\n                  {searchQuery || filter !== \"all\"\r\n                    ? \"Try adjusting your search or filter criteria\"\r\n                    : \"Start by listing your first property\"}\r\n                </p>\r\n                {!searchQuery && filter === \"all\" && (\r\n                  <Link\r\n                    to=\"/add-property\"\r\n                    className=\"inline-flex items-center gap-2 bg-blue-600 text-white px-6 py-3 rounded-xl font-semibold hover:bg-blue-700 transition\"\r\n                  >\r\n                    <Plus className=\"w-5 h-5\" />\r\n                    List Your First Property\r\n                  </Link>\r\n                )}\r\n              </div>\r\n            )}\r\n          </>\r\n        )}\r\n\r\n        {/* Leads Tab (Updated) */}\r\n        {activeTab === \"leads\" && (\r\n          <>\r\n            {/* Lead Filters and Date Range */}\r\n            <div className=\"bg-white rounded-xl border border-gray-200 p-4 mb-6\">\r\n              <div className=\"flex flex-col gap-6\">\r\n\r\n                {/* Date Filter & Export Row */}\r\n                <div className=\"flex flex-col lg:flex-row gap-4 items-end justify-between border-b border-gray-100 pb-4\">\r\n                  <div className=\"flex gap-3 flex-1 flex-wrap\">\r\n                    <div className=\"flex flex-col\">\r\n                      <label className=\"text-xs font-medium text-gray-500 mb-1\">From Date (Max 7 days)</label>\r\n                      <input\r\n                        type=\"date\"\r\n                        value={startDateFilter}\r\n                        onChange={(e) => setStartDateFilter(e.target.value)}\r\n                        className=\"px-4 py-2.5 border border-gray-200 rounded-lg text-sm font-medium text-gray-700 focus:ring-2 focus:ring-blue-500 outline-none\"\r\n                      />\r\n                    </div>\r\n                    <div className=\"flex flex-col\">\r\n                      <label className=\"text-xs font-medium text-gray-500 mb-1\">To Date</label>\r\n                      <input\r\n                        type=\"date\"\r\n                        value={endDateFilter}\r\n                        onChange={(e) => setEndDateFilter(e.target.value)}\r\n                        className=\"px-4 py-2.5 border border-gray-200 rounded-lg text-sm font-medium text-gray-700 focus:ring-2 focus:ring-blue-500 outline-none\"\r\n                      />\r\n                    </div>\r\n                    <div className=\"flex items-end gap-2\">\r\n                      <button\r\n                        onClick={handleApplyDateFilter}\r\n                        className=\"inline-flex items-center gap-2 bg-blue-600 text-white px-4 py-2.5 rounded-lg text-sm font-medium hover:bg-blue-700 transition\"\r\n                        disabled={!startDateFilter || !endDateFilter}\r\n                      >\r\n                        <Filter className=\"w-4 h-4\" /> Apply Filter\r\n                      </button>\r\n                      {(startDateFilter || endDateFilter) && (\r\n                        <button\r\n                          onClick={handleClearDateFilter}\r\n                          className=\"p-2.5 text-gray-500 bg-gray-100 rounded-lg hover:bg-gray-200 transition\"\r\n                          title=\"Clear Date Filter\"\r\n                        >\r\n                          <X className=\"w-5 h-5\" />\r\n                        </button>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div className=\"w-full lg:w-auto text-right\">\r\n                    <button\r\n                      onClick={handleExportLeads}\r\n                      disabled={isExporting}\r\n                      className=\"w-full lg:w-auto inline-flex items-center justify-center gap-2 bg-emerald-600 text-white px-5 py-2.5 rounded-xl font-semibold hover:bg-emerald-700 transition disabled:opacity-50\"\r\n                    >\r\n                      <FileText className={`w-5 h-5 ${isExporting ? 'animate-bounce' : ''}`} />\r\n                      {isExporting ? 'Generating Excel...' : 'Export 3-Month Data (Excel)'}\r\n                    </button>\r\n                    <p className=\"text-xs text-gray-500 mt-1\">\r\n                      Max 3 months of historical data.\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Status and Property Filters */}\r\n                <div className=\"flex flex-col md:flex-row gap-4 items-start md:items-center\">\r\n                  {selectedPropertyForLeads && (\r\n                    <div className=\"flex items-center gap-2 bg-blue-50 px-3 py-2 rounded-lg\">\r\n                      <span className=\"text-sm text-blue-700\">Showing leads for:</span>\r\n                      <span className=\"font-medium text-blue-900\">{selectedPropertyForLeads.title}</span>\r\n                      <button\r\n                        onClick={() => setSelectedPropertyForLeads(null)}\r\n                        className=\"ml-2 text-blue-500 hover:text-blue-700\"\r\n                      >\r\n                        <X className=\"w-4 h-4\" />\r\n                      </button>\r\n                    </div>\r\n                  )}\r\n                  <div className=\"flex items-center gap-2 overflow-x-auto pb-1 flex-1\">\r\n                    {[\r\n                      { key: \"all\", label: \"All Leads\" },\r\n                      { key: \"new\", label: \"New\" },\r\n                      { key: \"contacted\", label: \"Contacted\" },\r\n                      { key: \"interested\", label: \"Interested\" },\r\n                      { key: \"negotiating\", label: \"Negotiating\" },\r\n                      { key: \"converted\", label: \"Converted\" },\r\n                      { key: \"lost\", label: \"Lost\" },\r\n                    ].map((tab) => (\r\n                      <button\r\n                        key={tab.key}\r\n                        onClick={() => setLeadFilter(tab.key)}\r\n                        className={`px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap transition ${leadFilter === tab.key\r\n                          ? \"bg-blue-600 text-white\"\r\n                          : \"bg-gray-100 text-gray-600 hover:bg-gray-200\"\r\n                          }`}\r\n                      >\r\n                        {tab.label}\r\n                      </button>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Leads List */}\r\n            {filteredLeads.length > 0 ? (\r\n              <div className=\"space-y-4\">\r\n                {filteredLeads.map((lead) => (\r\n                  <LeadCard\r\n                    key={lead._id}\r\n                    lead={lead}\r\n                    onUpdateStatus={handleUpdateLeadStatus}\r\n                  />\r\n                ))}\r\n              </div>\r\n            ) : (\r\n              <div className=\"bg-white rounded-xl border border-gray-200 p-12 text-center\">\r\n                <div className=\"w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4\">\r\n                  <Users className=\"w-10 h-10 text-gray-400\" />\r\n                </div>\r\n                <h3 className=\"text-xl font-semibold text-gray-900 mb-2\">\r\n                  {startDateFilter && endDateFilter ? \"No leads found for this date range\" : \"No leads yet\"}\r\n                </h3>\r\n                <p className=\"text-gray-500\">\r\n                  When users express interest in your properties, they'll appear here.\r\n                </p>\r\n              </div>\r\n            )}\r\n          </>\r\n        )}\r\n\r\n        {/* Analytics Tab (unchanged) */}\r\n        {activeTab === \"analytics\" && (\r\n          <div className=\"space-y-6\">\r\n            {/* Charts Row 1 */}\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n              {/* Leads Over Time */}\r\n              <div className=\"bg-white rounded-xl border border-gray-200 p-6\">\r\n                <h3 className=\"font-semibold text-gray-900 mb-4\">Leads Over Time</h3>\r\n                {dailyLeadsData.length > 0 ? (\r\n                  <ResponsiveContainer width=\"100%\" height={250}>\r\n                    <AreaChart data={dailyLeadsData}>\r\n                      <defs>\r\n                        <linearGradient id=\"colorLeads\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\r\n                          <stop offset=\"5%\" stopColor=\"#3B82F6\" stopOpacity={0.3} />\r\n                          <stop offset=\"95%\" stopColor=\"#3B82F6\" stopOpacity={0} />\r\n                        </linearGradient>\r\n                      </defs>\r\n                      <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#E5E7EB\" />\r\n                      <XAxis dataKey=\"date\" tick={{ fontSize: 12 }} stroke=\"#9CA3AF\" />\r\n                      <YAxis tick={{ fontSize: 12 }} stroke=\"#9CA3AF\" />\r\n                      <Tooltip\r\n                        contentStyle={{ borderRadius: '8px', border: '1px solid #E5E7EB' }}\r\n                      />\r\n                      <Area\r\n                        type=\"monotone\"\r\n                        dataKey=\"leads\"\r\n                        stroke=\"#3B82F6\"\r\n                        fillOpacity={1}\r\n                        fill=\"url(#colorLeads)\"\r\n                        strokeWidth={2}\r\n                      />\r\n                    </AreaChart>\r\n                  </ResponsiveContainer>\r\n                ) : (\r\n                  <div className=\"h-[250px] flex items-center justify-center text-gray-400\">\r\n                    No data available yet\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              {/* Lead Status Distribution */}\r\n              <div className=\"bg-white rounded-xl border border-gray-200 p-6\">\r\n                <h3 className=\"font-semibold text-gray-900 mb-4\">Lead Status Distribution</h3>\r\n                {leadStatusData.length > 0 ? (\r\n                  <ResponsiveContainer width=\"100%\" height={250}>\r\n                    <PieChart>\r\n                      <Pie\r\n                        data={leadStatusData}\r\n                        cx=\"50%\"\r\n                        cy=\"50%\"\r\n                        innerRadius={60}\r\n                        outerRadius={100}\r\n                        paddingAngle={2}\r\n                        dataKey=\"value\"\r\n                      >\r\n                        {leadStatusData.map((entry, index) => (\r\n                          <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />\r\n                        ))}\r\n                      </Pie>\r\n                      <Tooltip />\r\n                      <Legend />\r\n                    </PieChart>\r\n                  </ResponsiveContainer>\r\n                ) : (\r\n                  <div className=\"h-[250px] flex items-center justify-center text-gray-400\">\r\n                    No data available yet\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Charts Row 2 */}\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n              {/* Leads by Property */}\r\n              <div className=\"bg-white rounded-xl border border-gray-200 p-6\">\r\n                <h3 className=\"font-semibold text-gray-900 mb-4\">Top Properties by Leads</h3>\r\n                {propertyLeadsData.length > 0 ? (\r\n                  <ResponsiveContainer width=\"100%\" height={250}>\r\n                    <BarChart data={propertyLeadsData} layout=\"vertical\">\r\n                      <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#E5E7EB\" />\r\n                      <XAxis type=\"number\" tick={{ fontSize: 12 }} stroke=\"#9CA3AF\" />\r\n                      <YAxis type=\"category\" dataKey=\"name\" tick={{ fontSize: 11 }} stroke=\"#9CA3AF\" width={120} />\r\n                      <Tooltip\r\n                        contentStyle={{ borderRadius: '8px', border: '1px solid #E5E7EB' }}\r\n                      />\r\n                      <Bar dataKey=\"leads\" fill=\"#3B82F6\" radius={[0, 4, 4, 0]} />\r\n                    </BarChart>\r\n                  </ResponsiveContainer>\r\n                ) : (\r\n                  <div className=\"h-[250px] flex items-center justify-center text-gray-400\">\r\n                    No data available yet\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              {/* Quick Stats */}\r\n              <div className=\"bg-white rounded-xl border border-gray-200 p-6\">\r\n                <h3 className=\"font-semibold text-gray-900 mb-4\">Performance Metrics</h3>\r\n                <div className=\"space-y-4\">\r\n                  <div className=\"flex items-center justify-between p-4 bg-gray-50 rounded-xl\">\r\n                    <div className=\"flex items-center gap-3\">\r\n                      <div className=\"p-2 bg-blue-100 rounded-lg\">\r\n                        <Users className=\"w-5 h-5 text-blue-600\" />\r\n                      </div>\r\n                      <div>\r\n                        <p className=\"text-sm text-gray-500\">Total Leads</p>\r\n                        <p className=\"text-xl font-bold text-gray-900\">{leadAnalytics?.totalLeads || 0}</p>\r\n                      </div>\r\n                    </div>\r\n                    <ChevronRight className=\"w-5 h-5 text-gray-400\" />\r\n                  </div>\r\n\r\n                  <div className=\"flex items-center justify-between p-4 bg-gray-50 rounded-xl\">\r\n                    <div className=\"flex items-center gap-3\">\r\n                      <div className=\"p-2 bg-green-100 rounded-lg\">\r\n                        <UserCheck className=\"w-5 h-5 text-green-600\" />\r\n                      </div>\r\n                      <div>\r\n                        <p className=\"text-sm text-gray-500\">Converted</p>\r\n                        <p className=\"text-xl font-bold text-gray-900\">{leadAnalytics?.convertedLeads || 0}</p>\r\n                      </div>\r\n                    </div>\r\n                    <ChevronRight className=\"w-5 h-5 text-gray-400\" />\r\n                  </div>\r\n\r\n                  <div className=\"flex items-center justify-between p-4 bg-gray-50 rounded-xl\">\r\n                    <div className=\"flex items-center gap-3\">\r\n                      <div className=\"p-2 bg-purple-100 rounded-lg\">\r\n                        <Target className=\"w-5 h-5 text-purple-600\" />\r\n                      </div>\r\n                      <div>\r\n                        <p className=\"text-sm text-gray-500\">Conversion Rate</p>\r\n                        <p className=\"text-xl font-bold text-gray-900\">{leadAnalytics?.conversionRate || 0}%</p>\r\n                      </div>\r\n                    </div>\r\n                    <ChevronRight className=\"w-5 h-5 text-gray-400\" />\r\n                  </div>\r\n\r\n                  <div className=\"flex items-center justify-between p-4 bg-gray-50 rounded-xl\">\r\n                    <div className=\"flex items-center gap-3\">\r\n                      <div className=\"p-2 bg-orange-100 rounded-lg\">\r\n                        <AlertCircle className=\"w-5 h-5 text-orange-600\" />\r\n                      </div>\r\n                      <div>\r\n                        <p className=\"text-sm text-gray-500\">Unread Leads</p>\r\n                        <p className=\"text-xl font-bold text-gray-900\">{leadAnalytics?.unreadLeads || 0}</p>\r\n                      </div>\r\n                    </div>\r\n                    <ChevronRight className=\"w-5 h-5 text-gray-400\" />\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Delete Confirmation Modal */}\r\n      <AnimatePresence>\r\n        {showDeleteModal && (\r\n          <>\r\n            <motion.div\r\n              initial={{ opacity: 0 }}\r\n              animate={{ opacity: 1 }}\r\n              exit={{ opacity: 0 }}\r\n              onClick={() => setShowDeleteModal(false)}\r\n              className=\"fixed inset-0 bg-black/60 backdrop-blur-sm z-50\"\r\n            />\r\n            <motion.div\r\n              initial={{ opacity: 0, scale: 0.95 }}\r\n              animate={{ opacity: 1, scale: 1 }}\r\n              exit={{ opacity: 0, scale: 0.95 }}\r\n              className=\"fixed inset-0 z-50 flex items-center justify-center p-4\"\r\n            >\r\n              <div className=\"bg-white rounded-2xl shadow-2xl w-full max-w-md p-6\">\r\n                <div className=\"w-14 h-14 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4\">\r\n                  <Trash2 className=\"w-7 h-7 text-red-600\" />\r\n                </div>\r\n                <h3 className=\"text-xl font-bold text-gray-900 text-center mb-2\">\r\n                  Delete Property?\r\n                </h3>\r\n                <p className=\"text-gray-500 text-center mb-6\">\r\n                  Are you sure you want to delete \"{propertyToDelete?.title}\"? This action cannot be undone.\r\n                </p>\r\n                <div className=\"flex gap-3\">\r\n                  <button\r\n                    onClick={() => setShowDeleteModal(false)}\r\n                    className=\"flex-1 px-4 py-2.5 border border-gray-300 text-gray-700 rounded-xl font-medium hover:bg-gray-50 transition\"\r\n                  >\r\n                    Cancel\r\n                  </button>\r\n                  <button\r\n                    onClick={confirmDelete}\r\n                    disabled={deleting}\r\n                    className=\"flex-1 px-4 py-2.5 bg-red-600 text-white rounded-xl font-medium hover:bg-red-700 transition disabled:opacity-50 flex items-center justify-center gap-2\"\r\n                  >\r\n                    {deleting ? (\r\n                      <>\r\n                        <RefreshCw className=\"w-4 h-4 animate-spin\" />\r\n                        Deleting...\r\n                      </>\r\n                    ) : (\r\n                      \"Delete\"\r\n                    )}\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </motion.div>\r\n          </>\r\n        )}\r\n      </AnimatePresence>\r\n      {/* Owner Upgrade Floating Button */}\r\n      {user?.role === \"owner\" && properties.length >= 1 && (\r\n        <div className=\"fixed bottom-24 right-6 z-40\">\r\n          <button\r\n            onClick={() => setShowPlans(true)}\r\n            className=\"group flex items-center gap-3 bg-gradient-to-r from-blue-600 via-indigo-600 to-violet-600 text-white px-6 py-3.5 rounded-full shadow-lg hover:shadow-2xl transition-all duration-300 hover:scale-[1.03] active:scale-[0.98] relative overflow-hidden\"\r\n          >\r\n            <span className=\"absolute inset-0 bg-white/10 opacity-0 group-hover:opacity-100 transition-opacity\" />\r\n            <span className=\"text-sm font-semibold relative z-10\">\r\n              Want to list more than 1 property?\r\n            </span>\r\n            <span className=\"bg-white/20 border border-white/30 rounded-full px-3 py-1 text-xs font-bold relative z-10\">\r\n              View Plans\r\n            </span>\r\n          </button>\r\n        </div>\r\n      )}\r\n\r\n      {/* Owner Plans Modal */}\r\n      <AnimatePresence>\r\n        {showPlans && (\r\n          <>\r\n            <motion.div\r\n              initial={{ opacity: 0 }}\r\n              animate={{ opacity: 1 }}\r\n              exit={{ opacity: 0 }}\r\n              className=\"fixed inset-0 bg-black/70 backdrop-blur-md z-50\"\r\n              onClick={() => setShowPlans(false)}\r\n            />\r\n\r\n            <motion.div\r\n              initial={{ opacity: 0, y: 60, scale: 0.95 }}\r\n              animate={{ opacity: 1, y: 0, scale: 1 }}\r\n              exit={{ opacity: 0, y: 60, scale: 0.95 }}\r\n              transition={{ type: \"spring\", stiffness: 180, damping: 18 }}\r\n              className=\"fixed bottom-6 md:bottom-10 right-4 md:right-10 z-50 w-[94%] max-w-md\"\r\n            >\r\n              <div className=\"bg-white/90 backdrop-blur-xl rounded-3xl shadow-2xl border border-gray-200 overflow-hidden\">\r\n\r\n                {/* Header */}\r\n                <div className=\"px-6 py-5 flex items-start justify-between gap-3 border-b border-gray-100\">\r\n                  <div>\r\n                    <p className=\"text-xs font-bold text-indigo-600 uppercase tracking-[0.18em]\">\r\n                      Owner Upgrade\r\n                    </p>\r\n                    <h3 className=\"text-xl font-extrabold text-gray-900 mt-1\">\r\n                      Unlock More Listings\r\n                    </h3>\r\n                    <p className=\"text-sm text-gray-500 mt-1\">\r\n                      Choose your plan & grow your property reach.\r\n                    </p>\r\n                  </div>\r\n\r\n                  <button\r\n                    onClick={() => setShowPlans(false)}\r\n                    className=\"p-2 rounded-full hover:bg-gray-100 text-gray-500 transition\"\r\n                  >\r\n                    <X className=\"w-5 h-5\" />\r\n                  </button>\r\n                </div>\r\n\r\n                {/* Plans */}\r\n                <div className=\"px-6 py-5 grid gap-4\">\r\n\r\n                  {/* Starter */}\r\n                  <div className=\"flex items-center justify-between rounded-2xl border border-gray-200 bg-gray-50 px-5 py-4 hover:shadow-sm transition\">\r\n                    <div>\r\n                      <p className=\"text-xs font-bold text-gray-500 uppercase tracking-[0.16em]\">\r\n                        Free\r\n                      </p>\r\n                      <p className=\"text-base font-semibold text-gray-900\">\r\n                        Starter Owner\r\n                      </p>\r\n                      <p className=\"text-xs text-gray-500 mt-1\">\r\n                        1 active property ΓÇó Basic visibility\r\n                      </p>\r\n                    </div>\r\n                    <p className=\"text-base font-bold text-emerald-600\">\r\n                      Γé╣0/mo\r\n                    </p>\r\n                  </div>\r\n\r\n                  {/* Growth - Featured */}\r\n                  <div className=\"relative flex items-center justify-between rounded-2xl border-2 border-indigo-500 bg-indigo-50 px-5 py-4 shadow-md hover:shadow-lg transition\">\r\n                    <span className=\"absolute -top-3 left-4 bg-indigo-600 text-white text-[10px] font-bold px-3 py-1 rounded-full shadow\">\r\n                      MOST POPULAR\r\n                    </span>\r\n\r\n                    <div>\r\n                      <p className=\"text-xs font-bold text-indigo-600 uppercase tracking-[0.16em]\">\r\n                        Growth\r\n                      </p>\r\n                      <p className=\"text-base font-semibold text-gray-900\">\r\n                        Growth Plan\r\n                      </p>\r\n                      <p className=\"text-xs text-gray-600 mt-1\">\r\n                        Up to 3 listings ΓÇó Priority placement ΓÇó Lead insights\r\n                      </p>\r\n                    </div>\r\n                    <Link\r\n                      to=\"/pricing\"\r\n                      className=\"text-xs font-bold text-indigo-700 border border-indigo-300 rounded-full px-3 py-1 hover:bg-indigo-600 hover:text-white transition\"\r\n                    >\r\n                      View Plans\r\n                    </Link>\r\n                  </div>\r\n\r\n                  {/* Premium */}\r\n                  <div className=\"flex items-center justify-between rounded-2xl border border-amber-300 bg-amber-50 px-5 py-4 hover:shadow-md transition\">\r\n                    <div>\r\n                      <p className=\"text-xs font-bold text-amber-600 uppercase tracking-[0.16em]\">\r\n                        Premium\r\n                      </p>\r\n                      <p className=\"text-base font-semibold text-gray-900\">\r\n                        Builder / Portfolio\r\n                      </p>\r\n                      <p className=\"text-xs text-gray-600 mt-1\">\r\n                        Featured badge ΓÇó High limits ΓÇó Dedicated support\r\n                      </p>\r\n                    </div>\r\n                    <p className=\"text-xs font-bold text-amber-800 text-right\">\r\n                      Talk to<br />Sales Team\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Footer */}\r\n                <div className=\"px-6 py-4 border-t border-gray-100 flex items-center justify-between gap-3 text-xs text-gray-500 bg-gray-50\">\r\n                  <p>Online payments coming soon.</p>\r\n\r\n                  <button\r\n                    onClick={() => {\r\n                      navigator.clipboard.writeText(\"dealdirect@gmail.com\");\r\n                      toast.success(\"Support email copied\");\r\n                    }}\r\n                    className=\"text-indigo-600 font-bold hover:underline whitespace-nowrap\"\r\n                  >\r\n                    Copy Support Email\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </motion.div>\r\n          </>\r\n        )}\r\n      </AnimatePresence>\r\n\r\n    </div>\r\n  );\r\n}","usedDeprecatedRules":[]},{"filePath":"D:\\dealdirectcurrentlive\\dealdirect\\client\\src\\Pages\\Notifications\\Notifications.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'markingOneId' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":12,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":22,"suggestions":[{"messageId":"removeVar","data":{"varName":"markingOneId"},"fix":{"range":[496,508],"text":""},"desc":"Remove unused variable 'markingOneId'."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from \"react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { FaBell, FaCheckCircle } from \"react-icons/fa\";\r\nimport { toast } from \"react-toastify\";\r\nimport api from \"../../utils/api\";\r\nimport { useAuth } from \"../../context/AuthContext\";\r\n\r\nconst Notifications = () => {\r\n  const [notifications, setNotifications] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [markingAll, setMarkingAll] = useState(false);\r\n  const [markingOneId, setMarkingOneId] = useState(null);\r\n  const navigate = useNavigate();\r\n  const { isAuthenticated, loading: authLoading } = useAuth();\r\n\r\n  const fetchNotifications = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const res = await api.get('/notifications');\r\n      if (res.data.success) {\r\n        setNotifications(res.data.notifications || []);\r\n      } else {\r\n        toast.error(res.data.message || \"Failed to load notifications\");\r\n      }\r\n    } catch (err) {\r\n      console.error(\"Fetch notifications error\", err);\r\n      // 401 errors are handled by the api interceptor\r\n      if (err.response?.status !== 401) {\r\n        toast.error(err.response?.data?.message || \"Failed to load notifications\");\r\n      }\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    // Wait for auth check to complete\r\n    if (!authLoading) {\r\n      if (isAuthenticated) {\r\n        fetchNotifications();\r\n      } else {\r\n        toast.info(\"Login to view your notifications\");\r\n        navigate(\"/login\", { state: { from: \"/notifications\" } });\r\n      }\r\n    }\r\n  }, [authLoading, isAuthenticated, navigate]);\r\n\r\n  const markOneAsRead = async (id) => {\r\n    try {\r\n      setMarkingOneId(id);\r\n      await api.patch(`/notifications/${id}/read`);\r\n      setNotifications((prev) =>\r\n        prev.map((n) => (n._id === id ? { ...n, isRead: true } : n))\r\n      );\r\n    } catch (err) {\r\n      console.error(\"Mark notification read error\", err);\r\n      // Don't block navigation if this fails; keep silent or show light toast\r\n    } finally {\r\n      setMarkingOneId(null);\r\n    }\r\n  };\r\n\r\n  const handleMarkAllRead = async () => {\r\n    try {\r\n      setMarkingAll(true);\r\n      await api.patch('/notifications/mark-all/read');\r\n      setNotifications((prev) => prev.map((n) => ({ ...n, isRead: true })));\r\n    } catch (err) {\r\n      console.error(\"Mark all read error\", err);\r\n      toast.error(\"Failed to mark all as read\");\r\n    } finally {\r\n      setMarkingAll(false);\r\n    }\r\n  };\r\n\r\n  const handleItemClick = async (n) => {\r\n    if (!n.isRead) {\r\n      // Fire-and-forget; UI is updated via state\r\n      markOneAsRead(n._id);\r\n    }\r\n\r\n    if (n.type === \"saved-search-match\" && n.data?.propertyId) {\r\n      navigate(`/properties/${n.data.propertyId}`);\r\n    } else if (n.type === \"saved-search\" && n.data?.savedSearchId) {\r\n      navigate(`/properties`);\r\n    }\r\n  };\r\n\r\n  const unreadCount = notifications.filter((n) => !n.isRead).length;\r\n\r\n  // Show loading while auth is checking\r\n  if (authLoading) {\r\n    return (\r\n      <div className=\"min-h-screen mt-20 sm:mt-24 px-4 sm:px-8 lg:px-20 bg-slate-50 pb-16\">\r\n        <div className=\"max-w-4xl mx-auto\">\r\n          <div className=\"bg-white rounded-2xl shadow-sm border border-slate-100 p-6 text-sm text-slate-500 flex items-center justify-center\">\r\n            <div className=\"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-red-600 mr-3\"></div>\r\n            Loading...\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen mt-20 sm:mt-24 px-4 sm:px-8 lg:px-20 bg-slate-50 pb-16\">\r\n      <div className=\"max-w-4xl mx-auto\">\r\n        <div className=\"flex items-center justify-between mb-6\">\r\n          <div className=\"flex items-center gap-3\">\r\n            <div className=\"w-10 h-10 rounded-full bg-red-600 flex items-center justify-center text-white shadow-lg\">\r\n              <FaBell />\r\n            </div>\r\n            <div>\r\n              <h1 className=\"text-2xl font-bold text-slate-900\">Notifications</h1>\r\n              <p className=\"text-xs sm:text-sm text-slate-500\">\r\n                All your alerts in one place ΓÇö saved searches, matches and more.\r\n              </p>\r\n            </div>\r\n          </div>\r\n          {notifications.length > 0 && (\r\n            <button\r\n              onClick={handleMarkAllRead}\r\n              disabled={markingAll || unreadCount === 0}\r\n              className=\"text-xs sm:text-sm px-3 py-1.5 rounded-full border border-slate-200 bg-white hover:bg-slate-100 text-slate-700 disabled:opacity-50\"\r\n            >\r\n              <FaCheckCircle className=\"inline mr-1\" /> Mark all as read\r\n            </button>\r\n          )}\r\n        </div>\r\n\r\n        {loading ? (\r\n          <div className=\"bg-white rounded-2xl shadow-sm border border-slate-100 p-6 text-sm text-slate-500\">\r\n            Loading notifications...\r\n          </div>\r\n        ) : notifications.length === 0 ? (\r\n          <div className=\"bg-white rounded-2xl shadow-sm border border-dashed border-slate-200 p-10 text-center\">\r\n            <div className=\"w-12 h-12 rounded-full bg-slate-100 flex items-center justify-center mx-auto mb-4\">\r\n              <FaBell className=\"text-slate-400 text-xl\" />\r\n            </div>\r\n            <h2 className=\"font-semibold text-slate-800 mb-1\">No notifications yet</h2>\r\n            <p className=\"text-xs sm:text-sm text-slate-500 max-w-sm mx-auto\">\r\n              Save a search or interact with properties and we will start showing smart alerts for you here.\r\n            </p>\r\n          </div>\r\n        ) : (\r\n          <div className=\"bg-white rounded-2xl shadow-sm border border-slate-100 divide-y divide-slate-100 overflow-hidden\">\r\n            {notifications.map((n) => (\r\n              <button\r\n                key={n._id}\r\n                onClick={() => handleItemClick(n)}\r\n                className={`w-full text-left px-5 sm:px-6 py-4 flex gap-3 sm:gap-4 items-start hover:bg-slate-50 transition-colors ${n.isRead ? \"bg-white\" : \"bg-red-50/60\"\r\n                  }`}\r\n              >\r\n                <div className=\"mt-1\">\r\n                  <span\r\n                    className={`inline-block w-2 h-2 rounded-full ${n.isRead ? \"bg-slate-300\" : \"bg-red-500\"\r\n                      }`}\r\n                  ></span>\r\n                </div>\r\n                <div className=\"flex-1 min-w-0\">\r\n                  <p className=\"text-xs uppercase tracking-wide text-slate-400 mb-0.5\">\r\n                    {n.type === \"saved-search-match\"\r\n                      ? \"Saved search match\"\r\n                      : n.type === \"saved-search\"\r\n                        ? \"Saved search\"\r\n                        : \"Notification\"}\r\n                  </p>\r\n                  <p className=\"text-sm font-semibold text-slate-900 mb-0.5 truncate\">\r\n                    {n.title}\r\n                  </p>\r\n                  <p className=\"text-xs text-slate-600 line-clamp-2\">{n.message}</p>\r\n                  <p className=\"text-[10px] text-slate-400 mt-1\">\r\n                    {new Date(n.createdAt).toLocaleString(\"en-IN\", {\r\n                      day: \"2-digit\",\r\n                      month: \"short\",\r\n                      hour: \"2-digit\",\r\n                      minute: \"2-digit\",\r\n                    })}\r\n                  </p>\r\n                </div>\r\n              </button>\r\n            ))}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Notifications;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\dealdirectcurrentlive\\dealdirect\\client\\src\\Pages\\Pricing\\Pricing.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\dealdirectcurrentlive\\dealdirect\\client\\src\\Pages\\Privacy\\Privacy.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\dealdirectcurrentlive\\dealdirect\\client\\src\\Pages\\Profile\\Profile.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchProfile'. Either include it or remove the dependency array.","line":121,"column":6,"nodeType":"ArrayExpression","endLine":121,"endColumn":46,"suggestions":[{"desc":"Update the dependencies array to be: [navigate, authLoading, isAuthenticated, fetchProfile]","fix":{"range":[2979,3019],"text":"[navigate, authLoading, isAuthenticated, fetchProfile]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useRef, useCallback } from \"react\";\r\nimport { useNavigate, useSearchParams, Link } from \"react-router-dom\";\r\nimport { toast } from \"react-toastify\";\r\nimport ReactCrop, { centerCrop, makeAspectCrop } from \"react-image-crop\";\r\nimport \"react-image-crop/dist/ReactCrop.css\";\r\nimport api from \"../../utils/api\";\r\nimport { useAuth } from \"../../context/AuthContext\";\r\nimport {\r\n  User,\r\n  Mail,\r\n  Phone,\r\n  MapPin,\r\n  Calendar,\r\n  Camera,\r\n  Save,\r\n  Lock,\r\n  Bell,\r\n  Edit2,\r\n  Check,\r\n  X,\r\n  Home,\r\n  Building2,\r\n  ChevronRight,\r\n  Crop,\r\n  RotateCw,\r\n  ZoomIn,\r\n  ZoomOut,\r\n  Settings,\r\n  Shield,\r\n  Trash2,\r\n  LogOut,\r\n  HelpCircle,\r\n  FileText,\r\n  Heart,\r\n} from \"lucide-react\";\r\n\r\n// Note: API_BASE is no longer needed - api.js handles this\r\n\r\n// Helper function to create centered aspect crop\r\nfunction centerAspectCrop(mediaWidth, mediaHeight, aspect) {\r\n  return centerCrop(\r\n    makeAspectCrop(\r\n      {\r\n        unit: \"%\",\r\n        width: 90,\r\n      },\r\n      aspect,\r\n      mediaWidth,\r\n      mediaHeight\r\n    ),\r\n    mediaWidth,\r\n    mediaHeight\r\n  );\r\n}\r\n\r\nconst Profile = () => {\r\n  const navigate = useNavigate();\r\n  const [searchParams, setSearchParams] = useSearchParams();\r\n  const [loading, setLoading] = useState(true);\r\n  const [saving, setSaving] = useState(false);\r\n  const [activeTab, setActiveTab] = useState(searchParams.get(\"tab\") || \"profile\");\r\n  const [isEditing, setIsEditing] = useState(false);\r\n  const [user, setUser] = useState(null);\r\n  const [profileImage, setProfileImage] = useState(null);\r\n  const [previewImage, setPreviewImage] = useState(null);\r\n\r\n  // Update URL when tab changes\r\n  const handleTabChange = (tab) => {\r\n    setActiveTab(tab);\r\n    setSearchParams({ tab });\r\n  };\r\n\r\n  // Image cropping states\r\n  const [showCropModal, setShowCropModal] = useState(false);\r\n  const [imageSrc, setImageSrc] = useState(\"\");\r\n  const [crop, setCrop] = useState();\r\n  const [completedCrop, setCompletedCrop] = useState();\r\n  const imgRef = useRef(null);\r\n  const [scale, setScale] = useState(1);\r\n  const [rotate, setRotate] = useState(0);\r\n\r\n  const [formData, setFormData] = useState({\r\n    name: \"\",\r\n    email: \"\",\r\n    phone: \"\",\r\n    alternatePhone: \"\",\r\n    address: {\r\n      line1: \"\",\r\n      line2: \"\",\r\n      city: \"\",\r\n      state: \"\",\r\n      pincode: \"\",\r\n    },\r\n    dateOfBirth: \"\",\r\n    gender: \"\",\r\n    bio: \"\",\r\n    preferences: {\r\n      emailNotifications: true,\r\n      smsNotifications: false,\r\n    },\r\n  });\r\n\r\n  const [passwordData, setPasswordData] = useState({\r\n    currentPassword: \"\",\r\n    newPassword: \"\",\r\n    confirmPassword: \"\",\r\n  });\r\n\r\n  const { isAuthenticated, loading: authLoading, updateUser } = useAuth();\r\n\r\n  // Check auth and fetch profile\r\n  useEffect(() => {\r\n    if (!authLoading) {\r\n      if (!isAuthenticated) {\r\n        toast.error(\"Please login to view your profile\");\r\n        navigate(\"/login\");\r\n        return;\r\n      }\r\n      fetchProfile();\r\n    }\r\n  }, [navigate, authLoading, isAuthenticated]);\r\n\r\n  const fetchProfile = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const response = await api.get('/users/profile');\r\n\r\n      const userData = response.data.user;\r\n      setUser(userData);\r\n      updateUser(userData); // Sync global auth state\r\n      setFormData({\r\n        name: userData.name || \"\",\r\n        email: userData.email || \"\",\r\n        phone: userData.phone || \"\",\r\n        alternatePhone: userData.alternatePhone || \"\",\r\n        address: {\r\n          line1: userData.address?.line1 || \"\",\r\n          line2: userData.address?.line2 || \"\",\r\n          city: userData.address?.city || \"\",\r\n          state: userData.address?.state || \"\",\r\n          pincode: userData.address?.pincode || \"\",\r\n        },\r\n        dateOfBirth: userData.dateOfBirth\r\n          ? new Date(userData.dateOfBirth).toISOString().split(\"T\")[0]\r\n          : \"\",\r\n        gender: userData.gender || \"\",\r\n        bio: userData.bio || \"\",\r\n        preferences: {\r\n          emailNotifications: userData.preferences?.emailNotifications ?? true,\r\n          smsNotifications: userData.preferences?.smsNotifications ?? false,\r\n        },\r\n      });\r\n      setPreviewImage(userData.profileImage || null);\r\n    } catch (error) {\r\n      // 401 errors are handled by api interceptor\r\n      if (error.response?.status !== 401) {\r\n        console.error(\"Error fetching profile:\", error);\r\n        toast.error(\"Failed to load profile\");\r\n      }\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleChange = (e) => {\r\n    const { name, value, type, checked } = e.target;\r\n\r\n    if (name.startsWith(\"address.\")) {\r\n      const field = name.split(\".\")[1];\r\n      setFormData((prev) => ({\r\n        ...prev,\r\n        address: { ...prev.address, [field]: value },\r\n      }));\r\n    } else if (name.startsWith(\"preferences.\")) {\r\n      const field = name.split(\".\")[1];\r\n      setFormData((prev) => ({\r\n        ...prev,\r\n        preferences: { ...prev.preferences, [field]: checked },\r\n      }));\r\n    } else {\r\n      setFormData((prev) => ({\r\n        ...prev,\r\n        [name]: type === \"checkbox\" ? checked : value,\r\n      }));\r\n    }\r\n  };\r\n\r\n  const handleImageChange = (e) => {\r\n    const file = e.target.files[0];\r\n    if (file) {\r\n      if (file.size > 10 * 1024 * 1024) {\r\n        toast.error(\"Image size should be less than 10MB\");\r\n        return;\r\n      }\r\n\r\n      // Read file and open crop modal\r\n      const reader = new FileReader();\r\n      reader.addEventListener(\"load\", () => {\r\n        setImageSrc(reader.result?.toString() || \"\");\r\n        setShowCropModal(true);\r\n        setScale(1);\r\n        setRotate(0);\r\n      });\r\n      reader.readAsDataURL(file);\r\n    }\r\n    // Reset input so same file can be selected again\r\n    e.target.value = \"\";\r\n  };\r\n\r\n  // When image loads in crop modal, set initial crop\r\n  const onImageLoad = useCallback((e) => {\r\n    const { width, height } = e.currentTarget;\r\n    setCrop(centerAspectCrop(width, height, 1)); // 1:1 aspect ratio for profile\r\n  }, []);\r\n\r\n  // Generate cropped image blob\r\n  const getCroppedImg = useCallback(async () => {\r\n    const image = imgRef.current;\r\n    if (!image || !completedCrop) return null;\r\n\r\n    const canvas = document.createElement(\"canvas\");\r\n    const ctx = canvas.getContext(\"2d\");\r\n    if (!ctx) return null;\r\n\r\n    const scaleX = image.naturalWidth / image.width;\r\n    const scaleY = image.naturalHeight / image.height;\r\n\r\n    // Set canvas size to desired output size\r\n    const outputSize = 400; // 400x400 for profile image\r\n    canvas.width = outputSize;\r\n    canvas.height = outputSize;\r\n\r\n    // Calculate the crop dimensions in natural image coordinates\r\n    const cropX = completedCrop.x * scaleX;\r\n    const cropY = completedCrop.y * scaleY;\r\n    const cropWidth = completedCrop.width * scaleX;\r\n    const cropHeight = completedCrop.height * scaleY;\r\n\r\n    // Handle rotation\r\n    const rotateRads = (rotate * Math.PI) / 180;\r\n    const centerX = outputSize / 2;\r\n    const centerY = outputSize / 2;\r\n\r\n    ctx.save();\r\n    ctx.translate(centerX, centerY);\r\n    ctx.rotate(rotateRads);\r\n    ctx.scale(scale, scale);\r\n    ctx.translate(-centerX, -centerY);\r\n\r\n    // Draw the cropped portion\r\n    ctx.drawImage(\r\n      image,\r\n      cropX,\r\n      cropY,\r\n      cropWidth,\r\n      cropHeight,\r\n      0,\r\n      0,\r\n      outputSize,\r\n      outputSize\r\n    );\r\n\r\n    ctx.restore();\r\n\r\n    // Convert canvas to blob\r\n    return new Promise((resolve) => {\r\n      canvas.toBlob(\r\n        (blob) => {\r\n          if (blob) {\r\n            const file = new File([blob], \"profile-image.jpg\", { type: \"image/jpeg\" });\r\n            resolve(file);\r\n          } else {\r\n            resolve(null);\r\n          }\r\n        },\r\n        \"image/jpeg\",\r\n        0.95\r\n      );\r\n    });\r\n  }, [completedCrop, rotate, scale]);\r\n\r\n  // Handle crop confirm\r\n  const handleCropConfirm = async () => {\r\n    const croppedFile = await getCroppedImg();\r\n    if (croppedFile) {\r\n      setProfileImage(croppedFile);\r\n      setPreviewImage(URL.createObjectURL(croppedFile));\r\n      setShowCropModal(false);\r\n      setImageSrc(\"\");\r\n      toast.success(\"Image cropped successfully!\");\r\n    } else {\r\n      toast.error(\"Failed to crop image. Please try again.\");\r\n    }\r\n  };\r\n\r\n  // Handle crop cancel\r\n  const handleCropCancel = () => {\r\n    setShowCropModal(false);\r\n    setImageSrc(\"\");\r\n    setCrop(undefined);\r\n    setCompletedCrop(undefined);\r\n    setScale(1);\r\n    setRotate(0);\r\n  };\r\n\r\n  const handleSaveProfile = async () => {\r\n    try {\r\n      setSaving(true);\r\n\r\n      const submitData = new FormData();\r\n      submitData.append(\"name\", formData.name);\r\n      submitData.append(\"phone\", formData.phone || \"\");\r\n      submitData.append(\"alternatePhone\", formData.alternatePhone || \"\");\r\n      submitData.append(\"address\", JSON.stringify(formData.address));\r\n      submitData.append(\"dateOfBirth\", formData.dateOfBirth || \"\");\r\n      submitData.append(\"gender\", formData.gender || \"\");\r\n      submitData.append(\"bio\", formData.bio || \"\");\r\n      submitData.append(\"preferences\", JSON.stringify(formData.preferences));\r\n\r\n      if (profileImage) {\r\n        submitData.append(\"profileImage\", profileImage);\r\n      }\r\n\r\n      const response = await api.put('/users/profile', submitData, {\r\n        headers: {\r\n          \"Content-Type\": \"multipart/form-data\",\r\n        },\r\n      });\r\n\r\n      // Update in AuthContext and localStorage\r\n      const updatedUser = response.data.user;\r\n      updateUser(updatedUser);\r\n\r\n      setUser(updatedUser);\r\n      // Update preview image with the Cloudinary URL from server\r\n      setPreviewImage(updatedUser.profileImage || null);\r\n      setIsEditing(false);\r\n      setProfileImage(null);\r\n      toast.success(\"Profile updated successfully!\");\r\n    } catch (error) {\r\n      console.error(\"Error updating profile:\", error);\r\n      toast.error(error.response?.data?.message || \"Failed to update profile\");\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  const handleChangePassword = async (e) => {\r\n    e.preventDefault();\r\n\r\n    if (passwordData.newPassword !== passwordData.confirmPassword) {\r\n      toast.error(\"New passwords don't match\");\r\n      return;\r\n    }\r\n\r\n    if (passwordData.newPassword.length < 6) {\r\n      toast.error(\"Password must be at least 6 characters\");\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setSaving(true);\r\n\r\n      await api.put('/users/change-password', {\r\n        currentPassword: passwordData.currentPassword,\r\n        newPassword: passwordData.newPassword,\r\n      });\r\n\r\n      setPasswordData({\r\n        currentPassword: \"\",\r\n        newPassword: \"\",\r\n        confirmPassword: \"\",\r\n      });\r\n      toast.success(\"Password changed successfully!\");\r\n    } catch (error) {\r\n      console.error(\"Error changing password:\", error);\r\n      toast.error(error.response?.data?.message || \"Failed to change password\");\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  const cancelEdit = () => {\r\n    setIsEditing(false);\r\n    setProfileImage(null);\r\n    setPreviewImage(user?.profileImage || null);\r\n    // Reset form to original user data\r\n    if (user) {\r\n      setFormData({\r\n        name: user.name || \"\",\r\n        email: user.email || \"\",\r\n        phone: user.phone || \"\",\r\n        alternatePhone: user.alternatePhone || \"\",\r\n        address: {\r\n          line1: user.address?.line1 || \"\",\r\n          line2: user.address?.line2 || \"\",\r\n          city: user.address?.city || \"\",\r\n          state: user.address?.state || \"\",\r\n          pincode: user.address?.pincode || \"\",\r\n        },\r\n        dateOfBirth: user.dateOfBirth\r\n          ? new Date(user.dateOfBirth).toISOString().split(\"T\")[0]\r\n          : \"\",\r\n        gender: user.gender || \"\",\r\n        bio: user.bio || \"\",\r\n        preferences: {\r\n          emailNotifications: user.preferences?.emailNotifications ?? true,\r\n          smsNotifications: user.preferences?.smsNotifications ?? false,\r\n        },\r\n      });\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-slate-50 pt-20 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-red-600 mx-auto\"></div>\r\n          <p className=\"mt-4 text-slate-600\">Loading profile...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-slate-50 pb-10\">\r\n      <div className=\"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8\">\r\n        {/* Breadcrumb */}\r\n        <nav className=\"flex items-center gap-2 text-sm text-slate-500 mb-6\">\r\n          <button onClick={() => navigate(\"/\")} className=\"hover:text-red-600 flex items-center gap-1\">\r\n            <Home size={14} />\r\n            Home\r\n          </button>\r\n          <ChevronRight size={14} />\r\n          <span className=\"text-slate-800 font-medium\">My Profile</span>\r\n        </nav>\r\n\r\n        <div className=\"grid grid-cols-1 lg:grid-cols-4 gap-6\">\r\n          {/* Sidebar */}\r\n          <div className=\"lg:col-span-1\">\r\n            <div className=\"bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden static lg:sticky lg:top-24\">\r\n              {/* Profile Header */}\r\n              <div className=\"bg-gradient-to-br from-red-500 to-rose-600 p-6 text-center\">\r\n                <div className=\"relative inline-block\">\r\n                  <div className=\"w-24 h-24 rounded-full bg-white p-1 mx-auto\">\r\n                    {previewImage ? (\r\n                      <img\r\n                        src={previewImage}\r\n                        alt={formData.name}\r\n                        className=\"w-full h-full rounded-full object-cover\"\r\n                      />\r\n                    ) : (\r\n                      <div className=\"w-full h-full rounded-full bg-slate-100 flex items-center justify-center text-slate-400\">\r\n                        <User size={40} />\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                  {isEditing && (\r\n                    <label className=\"absolute bottom-0 right-0 bg-white rounded-full p-2 shadow-lg cursor-pointer hover:bg-slate-50 transition group\" title=\"Upload & Crop Photo\">\r\n                      <Camera size={16} className=\"text-slate-600\" />\r\n                      <input\r\n                        type=\"file\"\r\n                        accept=\"image/jpeg,image/png,image/webp,image/gif\"\r\n                        onChange={handleImageChange}\r\n                        className=\"hidden\"\r\n                      />\r\n                      {/* Tooltip */}\r\n                      <span className=\"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-2 py-1 text-xs text-white bg-slate-800 rounded-md whitespace-nowrap opacity-0 group-hover:opacity-100 transition pointer-events-none\">\r\n                        Upload & Crop\r\n                      </span>\r\n                    </label>\r\n                  )}\r\n                </div>\r\n                <h2 className=\"mt-3 text-white font-bold text-lg\">{formData.name}</h2>\r\n                <p className=\"text-white/80 text-sm\">{formData.email}</p>\r\n                <span className=\"inline-block mt-2 px-3 py-1 bg-white/20 rounded-full text-xs text-white capitalize\">\r\n                  {user?.role || \"User\"}\r\n                </span>\r\n              </div>\r\n\r\n              {/* Navigation Tabs */}\r\n              <nav className=\"p-4 flex flex-row lg:flex-col overflow-x-auto lg:overflow-visible gap-3 lg:gap-0 space-y-0 lg:space-y-1 scrollbar-hide\">\r\n                <button\r\n                  onClick={() => handleTabChange(\"profile\")}\r\n                  className={`flex-shrink-0 lg:w-full flex items-center gap-3 px-4 py-3 rounded-xl text-left transition whitespace-nowrap ${activeTab === \"profile\"\r\n                    ? \"bg-red-50 text-red-600\"\r\n                    : \"text-slate-600 hover:bg-slate-50\"\r\n                    }`}\r\n                >\r\n                  <User size={18} />\r\n                  <span className=\"font-medium\">Profile Info</span>\r\n                </button>\r\n                <button\r\n                  onClick={() => handleTabChange(\"security\")}\r\n                  className={`flex-shrink-0 lg:w-full flex items-center gap-3 px-4 py-3 rounded-xl text-left transition whitespace-nowrap ${activeTab === \"security\"\r\n                    ? \"bg-red-50 text-red-600\"\r\n                    : \"text-slate-600 hover:bg-slate-50\"\r\n                    }`}\r\n                >\r\n                  <Lock size={18} />\r\n                  <span className=\"font-medium\">Security</span>\r\n                </button>\r\n                <button\r\n                  onClick={() => handleTabChange(\"preferences\")}\r\n                  className={`flex-shrink-0 lg:w-full flex items-center gap-3 px-4 py-3 rounded-xl text-left transition whitespace-nowrap ${activeTab === \"preferences\"\r\n                    ? \"bg-red-50 text-red-600\"\r\n                    : \"text-slate-600 hover:bg-slate-50\"\r\n                    }`}\r\n                >\r\n                  <Bell size={18} />\r\n                  <span className=\"font-medium\">Notifications</span>\r\n                </button>\r\n                <button\r\n                  onClick={() => handleTabChange(\"settings\")}\r\n                  className={`flex-shrink-0 lg:w-full flex items-center gap-3 px-4 py-3 rounded-xl text-left transition whitespace-nowrap ${activeTab === \"settings\"\r\n                    ? \"bg-red-50 text-red-600\"\r\n                    : \"text-slate-600 hover:bg-slate-50\"\r\n                    }`}\r\n                >\r\n                  <Settings size={18} />\r\n                  <span className=\"font-medium\">Settings</span>\r\n                </button>\r\n\r\n                {/* Divider */}\r\n                <div className=\"hidden lg:block border-t border-slate-100 my-2\"></div>\r\n\r\n                {(user?.role === 'owner' || user?.role === 'agent') && (\r\n                  <Link\r\n                    to=\"/my-properties\"\r\n                    className=\"flex-shrink-0 lg:w-full flex items-center gap-3 px-4 py-3 rounded-xl text-left text-slate-600 hover:bg-slate-50 transition whitespace-nowrap\"\r\n                  >\r\n                    <Building2 size={18} />\r\n                    <span className=\"font-medium\">My Properties</span>\r\n                  </Link>\r\n                )}\r\n                <Link\r\n                  to=\"/saved-properties\"\r\n                  className=\"flex-shrink-0 lg:w-full flex items-center gap-3 px-4 py-3 rounded-xl text-left text-slate-600 hover:bg-slate-50 transition whitespace-nowrap\"\r\n                >\r\n                  <Heart size={18} />\r\n                  <span className=\"font-medium\">Saved Properties</span>\r\n                </Link>\r\n              </nav>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Main Content */}\r\n          <div className=\"lg:col-span-3\">\r\n            {/* Profile Info Tab */}\r\n            {activeTab === \"profile\" && (\r\n              <div className=\"bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden\">\r\n                <div className=\"p-6 border-b border-slate-100 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\r\n                  <div>\r\n                    <h3 className=\"text-xl font-bold text-slate-800\">Personal Information</h3>\r\n                    <p className=\"text-slate-500 text-sm mt-1\">Manage your profile details</p>\r\n                  </div>\r\n                  {!isEditing ? (\r\n                    <button\r\n                      onClick={() => setIsEditing(true)}\r\n                      className=\"inline-flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition font-medium text-sm\"\r\n                    >\r\n                      <Edit2 size={16} />\r\n                      Edit Profile\r\n                    </button>\r\n                  ) : (\r\n                    <div className=\"flex gap-2\">\r\n                      <button\r\n                        onClick={cancelEdit}\r\n                        className=\"inline-flex items-center gap-2 px-4 py-2 bg-slate-100 text-slate-600 rounded-lg hover:bg-slate-200 transition font-medium text-sm\"\r\n                      >\r\n                        <X size={16} />\r\n                        Cancel\r\n                      </button>\r\n                      <button\r\n                        onClick={handleSaveProfile}\r\n                        disabled={saving}\r\n                        className=\"inline-flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition font-medium text-sm disabled:opacity-50\"\r\n                      >\r\n                        {saving ? (\r\n                          <>\r\n                            <div className=\"animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full\"></div>\r\n                            Saving...\r\n                          </>\r\n                        ) : (\r\n                          <>\r\n                            <Check size={16} />\r\n                            Save Changes\r\n                          </>\r\n                        )}\r\n                      </button>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n\r\n                <div className=\"p-6 space-y-6\">\r\n                  {/* Basic Info */}\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                    <div>\r\n                      <label className=\"block text-sm font-medium text-slate-700 mb-2\">\r\n                        <User size={14} className=\"inline mr-2\" />\r\n                        Full Name\r\n                      </label>\r\n                      <input\r\n                        type=\"text\"\r\n                        name=\"name\"\r\n                        value={formData.name}\r\n                        onChange={handleChange}\r\n                        disabled={!isEditing}\r\n                        className={`w-full px-4 py-3 rounded-xl border ${isEditing\r\n                          ? \"border-slate-200 focus:border-red-500 focus:ring-2 focus:ring-red-100\"\r\n                          : \"border-transparent bg-slate-50\"\r\n                          } outline-none transition`}\r\n                      />\r\n                    </div>\r\n\r\n                    <div>\r\n                      <label className=\"block text-sm font-medium text-slate-700 mb-2\">\r\n                        <Mail size={14} className=\"inline mr-2\" />\r\n                        Email Address\r\n                      </label>\r\n                      <input\r\n                        type=\"email\"\r\n                        name=\"email\"\r\n                        value={formData.email}\r\n                        disabled\r\n                        className=\"w-full px-4 py-3 rounded-xl border border-transparent bg-slate-50 text-slate-500 cursor-not-allowed\"\r\n                      />\r\n                      <p className=\"text-xs text-slate-400 mt-1\">Email cannot be changed</p>\r\n                    </div>\r\n\r\n                    <div>\r\n                      <label className=\"block text-sm font-medium text-slate-700 mb-2\">\r\n                        <Phone size={14} className=\"inline mr-2\" />\r\n                        Phone Number\r\n                      </label>\r\n                      <input\r\n                        type=\"tel\"\r\n                        name=\"phone\"\r\n                        value={formData.phone}\r\n                        onChange={handleChange}\r\n                        disabled={!isEditing}\r\n                        placeholder=\"+91 9876543210\"\r\n                        className={`w-full px-4 py-3 rounded-xl border ${isEditing\r\n                          ? \"border-slate-200 focus:border-red-500 focus:ring-2 focus:ring-red-100\"\r\n                          : \"border-transparent bg-slate-50\"\r\n                          } outline-none transition`}\r\n                      />\r\n                    </div>\r\n\r\n                    <div>\r\n                      <label className=\"block text-sm font-medium text-slate-700 mb-2\">\r\n                        <Phone size={14} className=\"inline mr-2\" />\r\n                        Alternate Phone\r\n                      </label>\r\n                      <input\r\n                        type=\"tel\"\r\n                        name=\"alternatePhone\"\r\n                        value={formData.alternatePhone}\r\n                        onChange={handleChange}\r\n                        disabled={!isEditing}\r\n                        placeholder=\"+91 9876543210\"\r\n                        className={`w-full px-4 py-3 rounded-xl border ${isEditing\r\n                          ? \"border-slate-200 focus:border-red-500 focus:ring-2 focus:ring-red-100\"\r\n                          : \"border-transparent bg-slate-50\"\r\n                          } outline-none transition`}\r\n                      />\r\n                    </div>\r\n\r\n                    <div>\r\n                      <label className=\"block text-sm font-medium text-slate-700 mb-2\">\r\n                        <Calendar size={14} className=\"inline mr-2\" />\r\n                        Date of Birth\r\n                      </label>\r\n                      <input\r\n                        type=\"date\"\r\n                        name=\"dateOfBirth\"\r\n                        value={formData.dateOfBirth}\r\n                        onChange={handleChange}\r\n                        disabled={!isEditing}\r\n                        className={`w-full px-4 py-3 rounded-xl border ${isEditing\r\n                          ? \"border-slate-200 focus:border-red-500 focus:ring-2 focus:ring-red-100\"\r\n                          : \"border-transparent bg-slate-50\"\r\n                          } outline-none transition`}\r\n                      />\r\n                    </div>\r\n\r\n                    <div>\r\n                      <label className=\"block text-sm font-medium text-slate-700 mb-2\">\r\n                        Gender\r\n                      </label>\r\n                      <select\r\n                        name=\"gender\"\r\n                        value={formData.gender}\r\n                        onChange={handleChange}\r\n                        disabled={!isEditing}\r\n                        className={`w-full px-4 py-3 rounded-xl border ${isEditing\r\n                          ? \"border-slate-200 focus:border-red-500 focus:ring-2 focus:ring-red-100\"\r\n                          : \"border-transparent bg-slate-50\"\r\n                          } outline-none transition`}\r\n                      >\r\n                        <option value=\"\">Select Gender</option>\r\n                        <option value=\"Male\">Male</option>\r\n                        <option value=\"Female\">Female</option>\r\n                        <option value=\"Other\">Other</option>\r\n                      </select>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Bio */}\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-slate-700 mb-2\">\r\n                      About Me\r\n                    </label>\r\n                    <textarea\r\n                      name=\"bio\"\r\n                      value={formData.bio}\r\n                      onChange={handleChange}\r\n                      disabled={!isEditing}\r\n                      rows={3}\r\n                      placeholder=\"Tell us a little about yourself...\"\r\n                      className={`w-full px-4 py-3 rounded-xl border ${isEditing\r\n                        ? \"border-slate-200 focus:border-red-500 focus:ring-2 focus:ring-red-100\"\r\n                        : \"border-transparent bg-slate-50\"\r\n                        } outline-none transition resize-none`}\r\n                    />\r\n                  </div>\r\n\r\n                  {/* Address */}\r\n                  <div>\r\n                    <h4 className=\"font-semibold text-slate-800 mb-4 flex items-center gap-2\">\r\n                      <MapPin size={16} />\r\n                      Address\r\n                    </h4>\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                      <div className=\"md:col-span-2\">\r\n                        <label className=\"block text-sm font-medium text-slate-700 mb-2\">\r\n                          Address Line 1\r\n                        </label>\r\n                        <input\r\n                          type=\"text\"\r\n                          name=\"address.line1\"\r\n                          value={formData.address.line1}\r\n                          onChange={handleChange}\r\n                          disabled={!isEditing}\r\n                          placeholder=\"House/Flat No., Building Name\"\r\n                          className={`w-full px-4 py-3 rounded-xl border ${isEditing\r\n                            ? \"border-slate-200 focus:border-red-500 focus:ring-2 focus:ring-red-100\"\r\n                            : \"border-transparent bg-slate-50\"\r\n                            } outline-none transition`}\r\n                        />\r\n                      </div>\r\n\r\n                      <div className=\"md:col-span-2\">\r\n                        <label className=\"block text-sm font-medium text-slate-700 mb-2\">\r\n                          Address Line 2\r\n                        </label>\r\n                        <input\r\n                          type=\"text\"\r\n                          name=\"address.line2\"\r\n                          value={formData.address.line2}\r\n                          onChange={handleChange}\r\n                          disabled={!isEditing}\r\n                          placeholder=\"Street, Area, Landmark\"\r\n                          className={`w-full px-4 py-3 rounded-xl border ${isEditing\r\n                            ? \"border-slate-200 focus:border-red-500 focus:ring-2 focus:ring-red-100\"\r\n                            : \"border-transparent bg-slate-50\"\r\n                            } outline-none transition`}\r\n                        />\r\n                      </div>\r\n\r\n                      <div>\r\n                        <label className=\"block text-sm font-medium text-slate-700 mb-2\">\r\n                          City\r\n                        </label>\r\n                        <input\r\n                          type=\"text\"\r\n                          name=\"address.city\"\r\n                          value={formData.address.city}\r\n                          onChange={handleChange}\r\n                          disabled={!isEditing}\r\n                          placeholder=\"Mumbai\"\r\n                          className={`w-full px-4 py-3 rounded-xl border ${isEditing\r\n                            ? \"border-slate-200 focus:border-red-500 focus:ring-2 focus:ring-red-100\"\r\n                            : \"border-transparent bg-slate-50\"\r\n                            } outline-none transition`}\r\n                        />\r\n                      </div>\r\n\r\n                      <div>\r\n                        <label className=\"block text-sm font-medium text-slate-700 mb-2\">\r\n                          State\r\n                        </label>\r\n                        <input\r\n                          type=\"text\"\r\n                          name=\"address.state\"\r\n                          value={formData.address.state}\r\n                          onChange={handleChange}\r\n                          disabled={!isEditing}\r\n                          placeholder=\"Maharashtra\"\r\n                          className={`w-full px-4 py-3 rounded-xl border ${isEditing\r\n                            ? \"border-slate-200 focus:border-red-500 focus:ring-2 focus:ring-red-100\"\r\n                            : \"border-transparent bg-slate-50\"\r\n                            } outline-none transition`}\r\n                        />\r\n                      </div>\r\n\r\n                      <div>\r\n                        <label className=\"block text-sm font-medium text-slate-700 mb-2\">\r\n                          PIN Code\r\n                        </label>\r\n                        <input\r\n                          type=\"text\"\r\n                          name=\"address.pincode\"\r\n                          value={formData.address.pincode}\r\n                          onChange={handleChange}\r\n                          disabled={!isEditing}\r\n                          placeholder=\"400001\"\r\n                          maxLength={6}\r\n                          className={`w-full px-4 py-3 rounded-xl border ${isEditing\r\n                            ? \"border-slate-200 focus:border-red-500 focus:ring-2 focus:ring-red-100\"\r\n                            : \"border-transparent bg-slate-50\"\r\n                            } outline-none transition`}\r\n                        />\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* Security Tab */}\r\n            {activeTab === \"security\" && (\r\n              <div className=\"bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden\">\r\n                <div className=\"p-6 border-b border-slate-100\">\r\n                  <h3 className=\"text-xl font-bold text-slate-800\">Security Settings</h3>\r\n                  <p className=\"text-slate-500 text-sm mt-1\">Manage your password and security</p>\r\n                </div>\r\n\r\n                <form onSubmit={handleChangePassword} className=\"p-6 space-y-6\">\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-slate-700 mb-2\">\r\n                      Current Password\r\n                    </label>\r\n                    <input\r\n                      type=\"password\"\r\n                      value={passwordData.currentPassword}\r\n                      onChange={(e) =>\r\n                        setPasswordData((prev) => ({ ...prev, currentPassword: e.target.value }))\r\n                      }\r\n                      required\r\n                      className=\"w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-red-500 focus:ring-2 focus:ring-red-100 outline-none transition\"\r\n                    />\r\n                  </div>\r\n\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-slate-700 mb-2\">\r\n                      New Password\r\n                    </label>\r\n                    <input\r\n                      type=\"password\"\r\n                      value={passwordData.newPassword}\r\n                      onChange={(e) =>\r\n                        setPasswordData((prev) => ({ ...prev, newPassword: e.target.value }))\r\n                      }\r\n                      required\r\n                      minLength={6}\r\n                      className=\"w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-red-500 focus:ring-2 focus:ring-red-100 outline-none transition\"\r\n                    />\r\n                    <p className=\"text-xs text-slate-400 mt-1\">Minimum 6 characters</p>\r\n                  </div>\r\n\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-slate-700 mb-2\">\r\n                      Confirm New Password\r\n                    </label>\r\n                    <input\r\n                      type=\"password\"\r\n                      value={passwordData.confirmPassword}\r\n                      onChange={(e) =>\r\n                        setPasswordData((prev) => ({ ...prev, confirmPassword: e.target.value }))\r\n                      }\r\n                      required\r\n                      className=\"w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-red-500 focus:ring-2 focus:ring-red-100 outline-none transition\"\r\n                    />\r\n                  </div>\r\n\r\n                  <button\r\n                    type=\"submit\"\r\n                    disabled={saving}\r\n                    className=\"inline-flex items-center gap-2 px-6 py-3 bg-red-600 text-white rounded-xl hover:bg-red-700 transition font-medium disabled:opacity-50\"\r\n                  >\r\n                    {saving ? (\r\n                      <>\r\n                        <div className=\"animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full\"></div>\r\n                        Updating...\r\n                      </>\r\n                    ) : (\r\n                      <>\r\n                        <Lock size={18} />\r\n                        Change Password\r\n                      </>\r\n                    )}\r\n                  </button>\r\n                </form>\r\n\r\n                {/* Account Info */}\r\n                <div className=\"p-6 border-t border-slate-100 bg-slate-50\">\r\n                  <h4 className=\"font-semibold text-slate-800 mb-4\">Account Information</h4>\r\n                  <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm\">\r\n                    <div>\r\n                      <span className=\"text-slate-500\">Account Created:</span>\r\n                      <p className=\"font-medium text-slate-800\">\r\n                        {user?.createdAt\r\n                          ? new Date(user.createdAt).toLocaleDateString(\"en-IN\", {\r\n                            day: \"numeric\",\r\n                            month: \"long\",\r\n                            year: \"numeric\",\r\n                          })\r\n                          : \"N/A\"}\r\n                      </p>\r\n                    </div>\r\n                    <div>\r\n                      <span className=\"text-slate-500\">Last Updated:</span>\r\n                      <p className=\"font-medium text-slate-800\">\r\n                        {user?.updatedAt\r\n                          ? new Date(user.updatedAt).toLocaleDateString(\"en-IN\", {\r\n                            day: \"numeric\",\r\n                            month: \"long\",\r\n                            year: \"numeric\",\r\n                          })\r\n                          : \"N/A\"}\r\n                      </p>\r\n                    </div>\r\n                    <div>\r\n                      <span className=\"text-slate-500\">Account Type:</span>\r\n                      <p className=\"font-medium text-slate-800 capitalize\">{user?.role || \"User\"}</p>\r\n                    </div>\r\n                    <div>\r\n                      <span className=\"text-slate-500\">Email Verified:</span>\r\n                      <p className=\"font-medium text-green-600\">Verified Γ£ô</p>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* Preferences Tab */}\r\n            {activeTab === \"preferences\" && (\r\n              <div className=\"bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden\">\r\n                <div className=\"p-6 border-b border-slate-100\">\r\n                  <h3 className=\"text-xl font-bold text-slate-800\">Notification Preferences</h3>\r\n                  <p className=\"text-slate-500 text-sm mt-1\">\r\n                    Manage how you receive notifications\r\n                  </p>\r\n                </div>\r\n\r\n                <div className=\"p-6 space-y-6\">\r\n                  <div className=\"flex items-center justify-between p-4 bg-slate-50 rounded-xl\">\r\n                    <div>\r\n                      <h4 className=\"font-medium text-slate-800\">Email Notifications</h4>\r\n                      <p className=\"text-sm text-slate-500\">\r\n                        Receive property alerts and updates via email\r\n                      </p>\r\n                    </div>\r\n                    <label className=\"relative inline-flex items-center cursor-pointer\">\r\n                      <input\r\n                        type=\"checkbox\"\r\n                        name=\"preferences.emailNotifications\"\r\n                        checked={formData.preferences.emailNotifications}\r\n                        onChange={handleChange}\r\n                        className=\"sr-only peer\"\r\n                      />\r\n                      <div className=\"w-11 h-6 bg-slate-300 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-red-100 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-red-600\"></div>\r\n                    </label>\r\n                  </div>\r\n\r\n                  <div className=\"flex items-center justify-between p-4 bg-slate-50 rounded-xl\">\r\n                    <div>\r\n                      <h4 className=\"font-medium text-slate-800\">SMS Notifications</h4>\r\n                      <p className=\"text-sm text-slate-500\">\r\n                        Receive important alerts via SMS\r\n                      </p>\r\n                    </div>\r\n                    <label className=\"relative inline-flex items-center cursor-pointer\">\r\n                      <input\r\n                        type=\"checkbox\"\r\n                        name=\"preferences.smsNotifications\"\r\n                        checked={formData.preferences.smsNotifications}\r\n                        onChange={handleChange}\r\n                        className=\"sr-only peer\"\r\n                      />\r\n                      <div className=\"w-11 h-6 bg-slate-300 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-red-100 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-red-600\"></div>\r\n                    </label>\r\n                  </div>\r\n\r\n                  <button\r\n                    onClick={handleSaveProfile}\r\n                    disabled={saving}\r\n                    className=\"inline-flex items-center gap-2 px-6 py-3 bg-red-600 text-white rounded-xl hover:bg-red-700 transition font-medium disabled:opacity-50\"\r\n                  >\r\n                    {saving ? (\r\n                      <>\r\n                        <div className=\"animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full\"></div>\r\n                        Saving...\r\n                      </>\r\n                    ) : (\r\n                      <>\r\n                        <Save size={18} />\r\n                        Save Preferences\r\n                      </>\r\n                    )}\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* Settings Tab */}\r\n            {activeTab === \"settings\" && (\r\n              <div className=\"space-y-6\">\r\n                {/* Account Settings */}\r\n                <div className=\"bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden\">\r\n                  <div className=\"p-6 border-b border-slate-100\">\r\n                    <h3 className=\"text-xl font-bold text-slate-800\">Account Settings</h3>\r\n                    <p className=\"text-slate-500 text-sm mt-1\">\r\n                      Manage your account preferences and data\r\n                    </p>\r\n                  </div>\r\n\r\n                  <div className=\"p-6 space-y-4\">\r\n                    {/* Account Type */}\r\n                    <div className=\"flex items-center justify-between p-4 bg-slate-50 rounded-xl\">\r\n                      <div className=\"flex items-center gap-4\">\r\n                        <div className=\"p-3 bg-blue-100 rounded-xl\">\r\n                          <Shield size={20} className=\"text-blue-600\" />\r\n                        </div>\r\n                        <div>\r\n                          <h4 className=\"font-medium text-slate-800\">Account Type</h4>\r\n                          <p className=\"text-sm text-slate-500\">\r\n                            {user?.role === 'owner' ? 'Property Owner - Can list properties' :\r\n                              user?.role === 'agent' ? 'Agent - Full access' :\r\n                                'Buyer - Browse and save properties'}\r\n                          </p>\r\n                        </div>\r\n                      </div>\r\n                      <span className={`px-3 py-1.5 rounded-full text-sm font-medium ${user?.role === 'owner' ? 'bg-blue-100 text-blue-700' :\r\n                        user?.role === 'agent' ? 'bg-purple-100 text-purple-700' :\r\n                          'bg-gray-100 text-gray-700'\r\n                        }`}>\r\n                        {user?.role === 'owner' ? '≡ƒÅá Owner' : user?.role === 'agent' ? '≡ƒæö Agent' : '≡ƒæñ Buyer'}\r\n                      </span>\r\n                    </div>\r\n\r\n                    {/* Email Verification */}\r\n                    <div className=\"flex items-center justify-between p-4 bg-slate-50 rounded-xl\">\r\n                      <div className=\"flex items-center gap-4\">\r\n                        <div className=\"p-3 bg-green-100 rounded-xl\">\r\n                          <Mail size={20} className=\"text-green-600\" />\r\n                        </div>\r\n                        <div>\r\n                          <h4 className=\"font-medium text-slate-800\">Email Verification</h4>\r\n                          <p className=\"text-sm text-slate-500\">{formData.email}</p>\r\n                        </div>\r\n                      </div>\r\n                      <span className=\"px-3 py-1.5 rounded-full text-sm font-medium bg-green-100 text-green-700\">\r\n                        Γ£ô Verified\r\n                      </span>\r\n                    </div>\r\n\r\n                    {/* Member Since */}\r\n                    <div className=\"flex items-center justify-between p-4 bg-slate-50 rounded-xl\">\r\n                      <div className=\"flex items-center gap-4\">\r\n                        <div className=\"p-3 bg-amber-100 rounded-xl\">\r\n                          <Calendar size={20} className=\"text-amber-600\" />\r\n                        </div>\r\n                        <div>\r\n                          <h4 className=\"font-medium text-slate-800\">Member Since</h4>\r\n                          <p className=\"text-sm text-slate-500\">\r\n                            {user?.createdAt ? new Date(user.createdAt).toLocaleDateString('en-IN', {\r\n                              day: 'numeric',\r\n                              month: 'long',\r\n                              year: 'numeric'\r\n                            }) : 'N/A'}\r\n                          </p>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Quick Links */}\r\n                <div className=\"bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden\">\r\n                  <div className=\"p-6 border-b border-slate-100\">\r\n                    <h3 className=\"text-xl font-bold text-slate-800\">Quick Links</h3>\r\n                    <p className=\"text-slate-500 text-sm mt-1\">\r\n                      Helpful resources and support\r\n                    </p>\r\n                  </div>\r\n\r\n                  <div className=\"p-4 space-y-2\">\r\n                    <Link\r\n                      to=\"/about\"\r\n                      className=\"flex items-center justify-between p-4 rounded-xl hover:bg-slate-50 transition group\"\r\n                    >\r\n                      <div className=\"flex items-center gap-4\">\r\n                        <div className=\"p-2 bg-slate-100 rounded-lg group-hover:bg-slate-200 transition\">\r\n                          <HelpCircle size={18} className=\"text-slate-600\" />\r\n                        </div>\r\n                        <span className=\"font-medium text-slate-700\">About DealDirect</span>\r\n                      </div>\r\n                      <ChevronRight size={18} className=\"text-slate-400\" />\r\n                    </Link>\r\n\r\n                    <Link\r\n                      to=\"/contact\"\r\n                      className=\"flex items-center justify-between p-4 rounded-xl hover:bg-slate-50 transition group\"\r\n                    >\r\n                      <div className=\"flex items-center gap-4\">\r\n                        <div className=\"p-2 bg-slate-100 rounded-lg group-hover:bg-slate-200 transition\">\r\n                          <Phone size={18} className=\"text-slate-600\" />\r\n                        </div>\r\n                        <span className=\"font-medium text-slate-700\">Contact Support</span>\r\n                      </div>\r\n                      <ChevronRight size={18} className=\"text-slate-400\" />\r\n                    </Link>\r\n\r\n                    <Link\r\n                      to=\"/agreements\"\r\n                      className=\"flex items-center justify-between p-4 rounded-xl hover:bg-slate-50 transition group\"\r\n                    >\r\n                      <div className=\"flex items-center gap-4\">\r\n                        <div className=\"p-2 bg-slate-100 rounded-lg group-hover:bg-slate-200 transition\">\r\n                          <FileText size={18} className=\"text-slate-600\" />\r\n                        </div>\r\n                        <span className=\"font-medium text-slate-700\">Rent Agreements</span>\r\n                      </div>\r\n                      <ChevronRight size={18} className=\"text-slate-400\" />\r\n                    </Link>\r\n\r\n                    <a\r\n                      href=\"#\"\r\n                      className=\"flex items-center justify-between p-4 rounded-xl hover:bg-slate-50 transition group\"\r\n                    >\r\n                      <div className=\"flex items-center gap-4\">\r\n                        <div className=\"p-2 bg-slate-100 rounded-lg group-hover:bg-slate-200 transition\">\r\n                          <Shield size={18} className=\"text-slate-600\" />\r\n                        </div>\r\n                        <span className=\"font-medium text-slate-700\">Privacy Policy</span>\r\n                      </div>\r\n                      <ChevronRight size={18} className=\"text-slate-400\" />\r\n                    </a>\r\n\r\n                    <a\r\n                      href=\"#\"\r\n                      className=\"flex items-center justify-between p-4 rounded-xl hover:bg-slate-50 transition group\"\r\n                    >\r\n                      <div className=\"flex items-center gap-4\">\r\n                        <div className=\"p-2 bg-slate-100 rounded-lg group-hover:bg-slate-200 transition\">\r\n                          <FileText size={18} className=\"text-slate-600\" />\r\n                        </div>\r\n                        <span className=\"font-medium text-slate-700\">Terms of Service</span>\r\n                      </div>\r\n                      <ChevronRight size={18} className=\"text-slate-400\" />\r\n                    </a>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Danger Zone */}\r\n                <div className=\"bg-white rounded-2xl shadow-sm border border-red-100 overflow-hidden\">\r\n                  <div className=\"p-6 border-b border-red-100 bg-red-50\">\r\n                    <h3 className=\"text-xl font-bold text-red-800\">Danger Zone</h3>\r\n                    <p className=\"text-red-600 text-sm mt-1\">\r\n                      Irreversible actions - proceed with caution\r\n                    </p>\r\n                  </div>\r\n\r\n                  <div className=\"p-6 space-y-4\">\r\n                    <div className=\"flex items-center justify-between p-4 border border-slate-200 rounded-xl\">\r\n                      <div>\r\n                        <h4 className=\"font-medium text-slate-800\">Log out of all devices</h4>\r\n                        <p className=\"text-sm text-slate-500\">\r\n                          This will log you out from all active sessions\r\n                        </p>\r\n                      </div>\r\n                      <button className=\"px-4 py-2 text-amber-600 border border-amber-200 rounded-lg hover:bg-amber-50 font-medium text-sm transition\">\r\n                        Log Out All\r\n                      </button>\r\n                    </div>\r\n\r\n                    <div className=\"flex items-center justify-between p-4 border border-red-200 rounded-xl bg-red-50/50\">\r\n                      <div>\r\n                        <h4 className=\"font-medium text-red-800\">Delete Account</h4>\r\n                        <p className=\"text-sm text-red-600\">\r\n                          Permanently delete your account and all data\r\n                        </p>\r\n                      </div>\r\n                      <button className=\"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 font-medium text-sm transition flex items-center gap-2\">\r\n                        <Trash2 size={16} />\r\n                        Delete\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Image Crop Modal */}\r\n      {showCropModal && (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/70 backdrop-blur-sm\">\r\n          <div className=\"bg-white rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden animate-in fade-in zoom-in duration-200\">\r\n            {/* Modal Header */}\r\n            <div className=\"px-6 py-4 border-b border-slate-100 flex items-center justify-between\">\r\n              <div className=\"flex items-center gap-3\">\r\n                <div className=\"p-2 bg-red-100 rounded-lg\">\r\n                  <Crop size={20} className=\"text-red-600\" />\r\n                </div>\r\n                <div>\r\n                  <h3 className=\"font-bold text-slate-800\">Crop Profile Photo</h3>\r\n                  <p className=\"text-xs text-slate-500\">Adjust the crop area for your profile picture</p>\r\n                </div>\r\n              </div>\r\n              <button\r\n                onClick={handleCropCancel}\r\n                className=\"p-2 hover:bg-slate-100 rounded-lg transition\"\r\n              >\r\n                <X size={20} className=\"text-slate-500\" />\r\n              </button>\r\n            </div>\r\n\r\n            {/* Crop Area */}\r\n            <div className=\"p-6 bg-slate-50\">\r\n              <div className=\"flex justify-center items-center bg-slate-900 rounded-xl overflow-hidden\" style={{ minHeight: \"300px\" }}>\r\n                {imageSrc && (\r\n                  <ReactCrop\r\n                    crop={crop}\r\n                    onChange={(_, percentCrop) => setCrop(percentCrop)}\r\n                    onComplete={(c) => setCompletedCrop(c)}\r\n                    aspect={1}\r\n                    circularCrop\r\n                    className=\"max-h-[400px]\"\r\n                  >\r\n                    <img\r\n                      ref={imgRef}\r\n                      alt=\"Crop preview\"\r\n                      src={imageSrc}\r\n                      style={{\r\n                        transform: `scale(${scale}) rotate(${rotate}deg)`,\r\n                        maxHeight: \"400px\",\r\n                        maxWidth: \"100%\",\r\n                      }}\r\n                      onLoad={onImageLoad}\r\n                    />\r\n                  </ReactCrop>\r\n                )}\r\n              </div>\r\n\r\n              {/* Controls */}\r\n              <div className=\"mt-4 space-y-4\">\r\n                {/* Zoom Control */}\r\n                <div className=\"flex items-center gap-4\">\r\n                  <div className=\"flex items-center gap-2 text-sm text-slate-600\">\r\n                    <ZoomOut size={16} />\r\n                    <span>Zoom</span>\r\n                  </div>\r\n                  <input\r\n                    type=\"range\"\r\n                    min=\"0.5\"\r\n                    max=\"3\"\r\n                    step=\"0.1\"\r\n                    value={scale}\r\n                    onChange={(e) => setScale(Number(e.target.value))}\r\n                    className=\"flex-1 h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-red-600\"\r\n                  />\r\n                  <ZoomIn size={16} className=\"text-slate-600\" />\r\n                </div>\r\n\r\n                {/* Rotate Control */}\r\n                <div className=\"flex items-center gap-4\">\r\n                  <div className=\"flex items-center gap-2 text-sm text-slate-600\">\r\n                    <RotateCw size={16} />\r\n                    <span>Rotate</span>\r\n                  </div>\r\n                  <input\r\n                    type=\"range\"\r\n                    min=\"-180\"\r\n                    max=\"180\"\r\n                    step=\"1\"\r\n                    value={rotate}\r\n                    onChange={(e) => setRotate(Number(e.target.value))}\r\n                    className=\"flex-1 h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-red-600\"\r\n                  />\r\n                  <span className=\"text-sm text-slate-500 w-12 text-right\">{rotate}┬░</span>\r\n                </div>\r\n\r\n                {/* Reset Button */}\r\n                <button\r\n                  onClick={() => {\r\n                    setScale(1);\r\n                    setRotate(0);\r\n                  }}\r\n                  className=\"text-sm text-red-600 hover:text-red-700 font-medium\"\r\n                >\r\n                  Reset Adjustments\r\n                </button>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Modal Footer */}\r\n            <div className=\"px-6 py-4 border-t border-slate-100 flex justify-end gap-3\">\r\n              <button\r\n                onClick={handleCropCancel}\r\n                className=\"px-5 py-2.5 text-slate-600 bg-slate-100 hover:bg-slate-200 rounded-xl font-medium transition\"\r\n              >\r\n                Cancel\r\n              </button>\r\n              <button\r\n                onClick={handleCropConfirm}\r\n                className=\"px-5 py-2.5 bg-red-600 text-white hover:bg-red-700 rounded-xl font-medium transition flex items-center gap-2\"\r\n              >\r\n                <Check size={18} />\r\n                Apply Crop\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Profile;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\dealdirectcurrentlive\\dealdirect\\client\\src\\Pages\\Property Details\\PropertyDetails.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'property'. Either include it or remove the dependency array.","line":613,"column":6,"nodeType":"ArrayExpression","endLine":613,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [id, property]","fix":{"range":[18582,18586],"text":"[id, property]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from \"react\";\r\nimport { useLocation, useParams, useNavigate } from \"react-router-dom\";\r\nimport {\r\n  HeartIcon,\r\n  ShareIcon,\r\n  MapPinIcon,\r\n  BuildingStorefrontIcon,\r\n  BanknotesIcon,\r\n  HomeIcon,\r\n  Square2StackIcon,\r\n  TagIcon,\r\n  CheckCircleIcon,\r\n  ShieldCheckIcon,\r\n  ChatBubbleLeftRightIcon,\r\n} from \"@heroicons/react/24/outline\";\r\nimport { FlagIcon } from \"@heroicons/react/24/outline\";\r\nimport { HeartIcon as HeartIconSolid } from \"@heroicons/react/24/solid\";\r\nimport { toast } from \"react-toastify\";\r\nimport { useChat } from \"../../context/ChatContext\";\r\nimport api from \"../../utils/api\";\r\nimport { useAuth } from \"../../context/AuthContext\";\r\n\r\nconst API_BASE = import.meta.env.VITE_API_BASE;\r\n\r\n// --- Design tokens (3ΓÇæcolor core + neutrals) ---\r\nconst BRAND_BLUE = \"#0f4fb5\";      // primary blue\r\nconst BRAND_BLUE_DARK = \"#0c3f8f\";\r\nconst BRAND_RED = \"#e11d48\";       // accent red\r\nconst BRAND_RED_DARK = \"#be123c\";\r\nconst BRAND_BG_SOFT = \"bg-slate-50\"; // subtle neutral background\r\n\r\n// --- Reusable UI ---\r\n\r\nconst Card = ({ title, icon, children, sticky }) => (\r\n  <div\r\n    className={`bg-white/95 border border-slate-200/80 rounded-3xl shadow-[0_18px_45px_rgba(15,32,70,0.08)] ${sticky ? \"sticky top-24\" : \"\"\r\n      }`}\r\n  >\r\n    <div className=\"p-6 sm:p-7 lg:p-8\">\r\n      <div className=\"flex items-center gap-3 mb-6\">\r\n        <div className=\"inline-flex h-9 w-9 items-center justify-center rounded-2xl bg-[#0f4fb5]/10 text-[#0f4fb5]\">\r\n          {icon}\r\n        </div>\r\n        <h2 className=\"text-xl sm:text-2xl font-semibold tracking-tight text-slate-900\">\r\n          {title}\r\n        </h2>\r\n      </div>\r\n      {children}\r\n    </div>\r\n  </div>\r\n);\r\n\r\nconst InfoChip = ({ label, value }) => (\r\n  <div className=\"flex flex-col gap-1\">\r\n    <span className=\"text-[11px] font-semibold uppercase tracking-[0.08em] text-slate-500\">\r\n      {label}\r\n    </span>\r\n    <span className=\"text-sm font-semibold text-slate-900\">{value}</span>\r\n  </div>\r\n);\r\n\r\nconst PrimaryButton = ({\r\n  onClick,\r\n  disabled,\r\n  loading,\r\n  label,\r\n  icon,\r\n  tone = \"brand\",\r\n}) => {\r\n  const tones = {\r\n    brand: \"bg-[#0f4fb5] hover:bg-[#0c3f8f] text-white\",\r\n    sky: \"bg-sky-600 hover:bg-sky-700 text-white\",\r\n    emerald: \"bg-emerald-600 hover:bg-emerald-700 text-white\",\r\n    red: \"bg-[#e11d48] hover:bg-[#be123c] text-white\",\r\n    subtle:\r\n      \"bg-slate-50 hover:bg-slate-100 text-slate-800 border border-slate-200\",\r\n  };\r\n\r\n  return (\r\n    <button\r\n      onClick={onClick}\r\n      disabled={disabled}\r\n      className={`w-full inline-flex items-center justify-center gap-2 px-5 py-3.5 rounded-2xl font-semibold text-sm tracking-wide shadow-[0_10px_30px_rgba(15,32,70,0.18)] transition-transform duration-150 active:scale-[0.97] disabled:opacity-70 disabled:cursor-not-allowed ${tones[tone]}`}\r\n    >\r\n      {loading && (\r\n        <svg\r\n          className=\"animate-spin h-5 w-5 text-white\"\r\n          xmlns=\"http://www.w3.org/2000/svg\"\r\n          fill=\"none\"\r\n          viewBox=\"0 0 24 24\"\r\n        >\r\n          <circle\r\n            className=\"opacity-25\"\r\n            cx=\"12\"\r\n            cy=\"12\"\r\n            r=\"10\"\r\n            stroke=\"currentColor\"\r\n            strokeWidth=\"4\"\r\n          ></circle>\r\n          <path\r\n            className=\"opacity-75\"\r\n            fill=\"currentColor\"\r\n            d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"\r\n          ></path>\r\n        </svg>\r\n      )}\r\n      {icon}\r\n      <span>{label}</span>\r\n    </button>\r\n  );\r\n};\r\n\r\nconst Row = ({ label, value, highlight }) => (\r\n  <div\r\n    className={`flex justify-between gap-4 border-b border-slate-100/80 pb-2.5 ${highlight ? \"text-emerald-700 font-semibold\" : \"\"\r\n      }`}\r\n  >\r\n    <span className=\"text-sm text-slate-500\">{label}</span>\r\n    <span className=\"text-sm font-semibold text-slate-900 text-right\">\r\n      {value}\r\n    </span>\r\n  </div>\r\n);\r\n\r\n// --- Constants & helpers (unchanged logic, only formatting) ---\r\n\r\nconst COMMERCIAL_FIELD_LABELS = {\r\n  workstations: \"Workstations\",\r\n  conferenceRooms: \"Conference Rooms\",\r\n  cabins: \"Cabins\",\r\n  pantry: \"Pantry\",\r\n  frontage: \"Frontage\",\r\n  storage: \"Storage\",\r\n  displayWindows: \"Display Windows\",\r\n  displayArea: \"Display Area\",\r\n  seatingCapacity: \"Seating Capacity\",\r\n  kitchenArea: \"Kitchen Area\",\r\n  barArea: \"Bar Area\",\r\n  outdoorSeating: \"Outdoor Seating\",\r\n  meetingRooms: \"Meeting Rooms\",\r\n  privateCabins: \"Private Cabins\",\r\n  phoneBooths: \"Phone Booths\",\r\n  loungeArea: \"Lounge Area\",\r\n  loadingDocks: \"Loading Docks\",\r\n  ceilingHeight: \"Ceiling Height\",\r\n  floorLoadCapacity: \"Floor Load Capacity\",\r\n  powerConnection: \"Power Connection\",\r\n  overheadCrane: \"Overhead Crane\",\r\n  centralAC: \"Central AC\",\r\n  powerBackup: \"Power Backup\",\r\n  washrooms: \"Washrooms\",\r\n  floorHeight: \"Floor Height\",\r\n  powerLoad: \"Power Load\",\r\n};\r\n\r\nconst formatCategoryDisplay = (name) => {\r\n  const value = (name || \"\").toString();\r\n  const lower = value.toLowerCase();\r\n  if (lower.includes(\"commercial land\")) return \"Commercial Property\";\r\n  if (lower.includes(\"commercial property\")) return \"Commercial Property\";\r\n  if (lower.includes(\"residential land\") || lower.includes(\"residential plot\"))\r\n    return \"Residential Property\";\r\n  if (lower.includes(\"residential\")) return \"Residential Property\";\r\n  if (lower.includes(\"commercial\")) return \"Commercial Property\";\r\n  return value || \"Property\";\r\n};\r\n\r\nconst COMMERCIAL_FIELD_ORDER = {\r\n  \"Office Space\": [\r\n    \"workstations\",\r\n    \"conferenceRooms\",\r\n    \"cabins\",\r\n    \"pantry\",\r\n    \"washrooms\",\r\n    \"floorHeight\",\r\n    \"powerLoad\",\r\n    \"powerBackup\",\r\n    \"centralAC\",\r\n  ],\r\n  \"Shop / Retail\": [\r\n    \"frontage\",\r\n    \"displayWindows\",\r\n    \"displayArea\",\r\n    \"storage\",\r\n    \"washrooms\",\r\n    \"powerBackup\",\r\n  ],\r\n  Showroom: [\"frontage\", \"displayArea\", \"storage\", \"washrooms\", \"powerLoad\"],\r\n  \"Restaurant / Cafe\": [\r\n    \"seatingCapacity\",\r\n    \"kitchenArea\",\r\n    \"washrooms\",\r\n    \"barArea\",\r\n    \"outdoorSeating\",\r\n    \"powerLoad\",\r\n    \"floorHeight\",\r\n  ],\r\n  \"Co-Working Space\": [\r\n    \"workstations\",\r\n    \"meetingRooms\",\r\n    \"privateCabins\",\r\n    \"phoneBooths\",\r\n    \"loungeArea\",\r\n    \"washrooms\",\r\n    \"pantry\",\r\n    \"powerBackup\",\r\n  ],\r\n  \"Warehouse / Godown\": [\r\n    \"loadingDocks\",\r\n    \"ceilingHeight\",\r\n    \"floorLoadCapacity\",\r\n    \"powerConnection\",\r\n    \"overheadCrane\",\r\n    \"officeSpace\",\r\n    \"washrooms\",\r\n  ],\r\n  \"Industrial Shed\": [\r\n    \"ceilingHeight\",\r\n    \"floorLoadCapacity\",\r\n    \"powerConnection\",\r\n    \"overheadCrane\",\r\n    \"washrooms\",\r\n  ],\r\n  \"Commercial Building / Floor\": [\r\n    \"washrooms\",\r\n    \"pantry\",\r\n    \"centralAC\",\r\n    \"powerBackup\",\r\n    \"floorHeight\",\r\n    \"powerLoad\",\r\n  ],\r\n};\r\n\r\nconst DEFAULT_COMMERCIAL_FIELDS = [\r\n  \"workstations\",\r\n  \"conferenceRooms\",\r\n  \"cabins\",\r\n  \"pantry\",\r\n  \"frontage\",\r\n  \"storage\",\r\n  \"displayWindows\",\r\n  \"displayArea\",\r\n  \"seatingCapacity\",\r\n  \"kitchenArea\",\r\n  \"barArea\",\r\n  \"outdoorSeating\",\r\n  \"meetingRooms\",\r\n  \"privateCabins\",\r\n  \"phoneBooths\",\r\n  \"loungeArea\",\r\n  \"loadingDocks\",\r\n  \"ceilingHeight\",\r\n  \"floorLoadCapacity\",\r\n  \"powerConnection\",\r\n  \"overheadCrane\",\r\n  \"centralAC\",\r\n  \"powerBackup\",\r\n  \"washrooms\",\r\n  \"floorHeight\",\r\n  \"powerLoad\",\r\n];\r\n\r\n// --- Sections (same logic, upgraded Tailwind) ---\r\n\r\nconst OverviewSection = ({ property, isResidential, isCommercial, ageOfProperty }) => (\r\n  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-y-5 gap-x-12\">\r\n    <Row\r\n      label=\"Project / Society\"\r\n      value={property.locality || property.address?.area || \"N/A\"}\r\n    />\r\n    <Row\r\n      label=\"Property Type\"\r\n      value={property.propertyTypeName || property.propertyType?.name || \"N/A\"}\r\n    />\r\n\r\n    {isResidential && (\r\n      <>\r\n        <Row label=\"BHK\" value={property.bhk || \"N/A\"} />\r\n        <Row label=\"Bedrooms\" value={property.bedrooms || \"N/A\"} />\r\n        <Row label=\"Bathrooms\" value={property.bathrooms || \"N/A\"} />\r\n        <Row label=\"Balconies\" value={property.balconies || \"N/A\"} />\r\n        <Row\r\n          label=\"Floor\"\r\n          value={\r\n            property.floorNo\r\n              ? `${property.floorNo} of ${property.totalFloors || \"?\"}`\r\n              : \"N/A\"\r\n          }\r\n        />\r\n        <Row label=\"Facing\" value={property.facing || \"N/A\"} />\r\n        <Row label=\"Age of Property\" value={ageOfProperty || \"N/A\"} />\r\n        {property.allowedFor && (\r\n          <Row label=\"Preferred\" value={property.allowedFor} />\r\n        )}\r\n        {property.petFriendly && (\r\n          <Row label=\"Pet Friendly\" value={property.petFriendly} />\r\n        )}\r\n      </>\r\n    )}\r\n\r\n    {isCommercial && (\r\n      <>\r\n        <Row label=\"Washrooms\" value={property.washrooms || \"N/A\"} />\r\n        <Row\r\n          label=\"Floor Height\"\r\n          value={property.floorHeight ? `${property.floorHeight} ft` : \"N/A\"}\r\n        />\r\n        <Row\r\n          label=\"Power Load\"\r\n          value={property.powerLoad ? `${property.powerLoad} kW` : \"N/A\"}\r\n        />\r\n        {property.commercialSubType && (\r\n          <Row label=\"Condition\" value={property.commercialSubType} />\r\n        )}\r\n      </>\r\n    )}\r\n\r\n    <Row\r\n      label=\"Parking\"\r\n      value={\r\n        property.parking?.covered || property.parking?.open\r\n          ? `${property.parking?.covered ? `${property.parking.covered} Covered` : \"\"}${property.parking?.covered && property.parking?.open ? \", \" : \"\"\r\n          }${property.parking?.open ? `${property.parking.open} Open` : \"\"}`\r\n          : \"N/A\"\r\n      }\r\n    />\r\n  </div>\r\n);\r\n\r\nconst DimensionsSection = ({\r\n  property,\r\n  pricePerSqft,\r\n  formattedPrice,\r\n  bookingAmount,\r\n  maintenanceDisplay,\r\n}) => (\r\n  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-y-5 gap-x-12\">\r\n    <Row\r\n      label=\"Built-up Area\"\r\n      value={`${property.area?.builtUpSqft || property.builtUpArea || \"N/A\"} sq.ft`}\r\n    />\r\n    <Row\r\n      label=\"Carpet Area\"\r\n      value={`${property.area?.carpetSqft || property.carpetArea || \"N/A\"} sq.ft`}\r\n    />\r\n    {property.area?.superBuiltUpSqft && (\r\n      <Row\r\n        label=\"Super Built-up\"\r\n        value={`${property.area.superBuiltUpSqft} sq.ft`}\r\n      />\r\n    )}\r\n    {property.area?.plotSqft && (\r\n      <Row label=\"Plot Area\" value={`${property.area.plotSqft} sq.ft`} />\r\n    )}\r\n    <Row label=\"Expected Price\" value={`Γé╣${formattedPrice}`} />\r\n    <Row label=\"Booking/Token Amount\" value={`Γé╣${bookingAmount || 0}`} />\r\n    <Row\r\n      label=\"Maintenance Charges\"\r\n      value={\r\n        maintenanceDisplay === \"Included\"\r\n          ? \"Included\"\r\n          : `Γé╣${maintenanceDisplay || 0} / month`\r\n      }\r\n    />\r\n    {pricePerSqft && (\r\n      <Row\r\n        label=\"Price / sq.ft\"\r\n        value={`Γé╣${pricePerSqft.toLocaleString()}`}\r\n      />\r\n    )}\r\n  </div>\r\n);\r\n\r\nconst AmenitiesSection = ({ property }) => {\r\n  const list = Array.isArray(property.amenities)\r\n    ? property.amenities\r\n    : Array.isArray(property.selectedAmenities)\r\n      ? property.selectedAmenities\r\n      : [];\r\n\r\n  if (list.length === 0) return null;\r\n\r\n  return (\r\n    <div className=\"grid grid-cols-2 md:grid-cols-3 gap-3.5\">\r\n      {list.map((amenity, idx) => (\r\n        <div\r\n          key={idx}\r\n          className=\"flex items-center gap-2 text-sm text-slate-700\"\r\n        >\r\n          <CheckCircleIcon className=\"w-5 h-5 text-emerald-500\" />\r\n          <span className=\"capitalize\">\r\n            {String(amenity).replace(/([A-Z])/g, \" $1\").trim()}\r\n          </span>\r\n        </div>\r\n      ))}\r\n    </div>\r\n  );\r\n};\r\n\r\nconst ExtrasSection = ({ property }) => {\r\n  if (!property.extras || typeof property.extras !== \"object\") return null;\r\n\r\n  const entries = Object.entries(property.extras).filter(([, val]) => !!val);\r\n  if (entries.length === 0) return null;\r\n\r\n  return (\r\n    <div className=\"flex flex-wrap gap-2.5\">\r\n      {entries.map(([key]) => (\r\n        <span\r\n          key={key}\r\n          className=\"px-3 py-1.5 bg-slate-50 border border-slate-200 text-slate-700 rounded-full text-xs font-medium capitalize\"\r\n        >\r\n          {key.replace(/([A-Z])/g, \" $1\").trim()}\r\n        </span>\r\n      ))}\r\n    </div>\r\n  );\r\n};\r\n\r\nconst CommercialConfigSection = ({ property, fields }) => (\r\n  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-y-5 gap-x-12\">\r\n    {fields\r\n      .map((field) => [field, property[field]])\r\n      .filter(([, val]) => val !== undefined && val !== null && val !== \"\")\r\n      .map(([key, val]) => (\r\n        <Row\r\n          key={key}\r\n          label={\r\n            COMMERCIAL_FIELD_LABELS[key] ||\r\n            key\r\n              .replace(/([A-Z])/g, \" $1\")\r\n              .replace(/^./, (s) => s.toUpperCase())\r\n          }\r\n          value={typeof val === \"boolean\" ? (val ? \"Yes\" : \"No\") : val}\r\n        />\r\n      ))}\r\n  </div>\r\n);\r\n\r\nconst LegalSection = ({ property, isCommercial }) => {\r\n  const legal = property.legal || {};\r\n\r\n  return (\r\n    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-y-5 gap-x-12\">\r\n      <Row label=\"RERA ID\" value={legal.reraId || \"N/A\"} />\r\n      <Row\r\n        label=\"Occupancy Certificate\"\r\n        value={legal.occupancyCertificate ? \"Yes\" : \"No\"}\r\n      />\r\n      {isCommercial && (\r\n        <>\r\n          <Row\r\n            label=\"Trade License\"\r\n            value={legal.tradeLicense ? \"Yes\" : \"No\"}\r\n          />\r\n          <Row label=\"Fire NOC\" value={legal.fireNoc ? \"Yes\" : \"No\"} />\r\n        </>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nconst EmiSection = ({\r\n  loanAmount,\r\n  setLoanAmount,\r\n  interestRate,\r\n  setInterestRate,\r\n  loanTenure,\r\n  setLoanTenure,\r\n  emi,\r\n  totalInterest,\r\n  totalPayment,\r\n}) => (\r\n  <div className=\"space-y-5\">\r\n    <div>\r\n      <label className=\"block text-[11px] font-semibold text-slate-500 uppercase tracking-[0.08em] mb-1.5\">\r\n        Loan Amount (Γé╣)\r\n      </label>\r\n      <input\r\n        type=\"number\"\r\n        value={loanAmount}\r\n        onChange={(e) => setLoanAmount(+e.target.value)}\r\n        className=\"w-full bg-slate-50 border border-slate-200 rounded-xl px-3 py-2.5 text-sm focus:ring-2 focus:ring-[#0f4fb5]/40 focus:border-[#0f4fb5] outline-none\"\r\n      />\r\n    </div>\r\n    <div className=\"grid grid-cols-2 gap-4\">\r\n      <div>\r\n        <label className=\"block text-[11px] font-semibold text-slate-500 uppercase tracking-[0.08em] mb-1.5\">\r\n          Rate (%)\r\n        </label>\r\n        <input\r\n          type=\"number\"\r\n          step=\"0.1\"\r\n          value={interestRate}\r\n          onChange={(e) => setInterestRate(+e.target.value)}\r\n          className=\"w-full bg-slate-50 border border-slate-200 rounded-xl px-3 py-2.5 text-sm focus:ring-2 focus:ring-[#0f4fb5]/40 focus:border-[#0f4fb5] outline-none\"\r\n        />\r\n      </div>\r\n      <div>\r\n        <label className=\"block text-[11px] font-semibold text-slate-500 uppercase tracking-[0.08em] mb-1.5\">\r\n          Years\r\n        </label>\r\n        <input\r\n          type=\"number\"\r\n          value={loanTenure}\r\n          onChange={(e) => setLoanTenure(+e.target.value)}\r\n          className=\"w-full bg-slate-50 border border-slate-200 rounded-xl px-3 py-2.5 text-sm focus:ring-2 focus:ring-[#0f4fb5]/40 focus:border-[#0f4fb5] outline-none\"\r\n        />\r\n      </div>\r\n    </div>\r\n\r\n    <div className=\"mt-5 pt-4 border-t border-slate-100 space-y-2\">\r\n      <Row\r\n        label=\"Monthly EMI\"\r\n        value={emi > 0 ? `Γé╣${emi.toFixed(0).toLocaleString()}` : \"0\"}\r\n        highlight\r\n      />\r\n      <Row\r\n        label=\"Total Interest\"\r\n        value={totalInterest > 0 ? `Γé╣${totalInterest.toFixed(0).toLocaleString()}` : \"0\"}\r\n      />\r\n      <Row\r\n        label=\"Total Amount\"\r\n        value={totalPayment > 0 ? `Γé╣${totalPayment.toFixed(0).toLocaleString()}` : \"0\"}\r\n      />\r\n    </div>\r\n  </div>\r\n);\r\n\r\n// --- Main component (logic same, visuals upgraded) ---\r\n\r\nconst PropertyDetails = () => {\r\n  const location = useLocation();\r\n  const state = location.state;\r\n  const { id } = useParams();\r\n  const navigate = useNavigate();\r\n  const { startConversation, openChat } = useChat();\r\n\r\n  const [property, setProperty] = useState(state?.property || null);\r\n  const [loading, setLoading] = useState(!state?.property);\r\n  const [isInterested, setIsInterested] = useState(false);\r\n  const [interestLoading, setInterestLoading] = useState(false);\r\n  const [chatLoading, setChatLoading] = useState(false);\r\n  const [error, setError] = useState(null);\r\n  const [activeImage, setActiveImage] = useState(0);\r\n  const [showReportModal, setShowReportModal] = useState(false);\r\n  const [reportReason, setReportReason] = useState(\"\");\r\n  const [reportLoading, setReportLoading] = useState(false);\r\n\r\n  // EMI\r\n  const [loanAmount, setLoanAmount] = useState();\r\n  const [interestRate, setInterestRate] = useState();\r\n  const [loanTenure, setLoanTenure] = useState();\r\n  const [emi, setEmi] = useState(0);\r\n  const [totalPayment, setTotalPayment] = useState(0);\r\n  const [totalInterest, setTotalInterest] = useState(0);\r\n\r\n  useEffect(() => {\r\n    window.scrollTo({ top: 0, left: 0, behavior: \"auto\" });\r\n  }, [id]);\r\n\r\n  useEffect(() => {\r\n    const interestedId = location.state?.interestedPropertyId;\r\n    if (interestedId && interestedId === id) {\r\n      setIsInterested(true);\r\n      const newState = { ...(location.state || {}) };\r\n      delete newState.interestedPropertyId;\r\n      navigate(location.pathname, { replace: true, state: newState });\r\n    }\r\n  }, [location.state, location.pathname, id, navigate]);\r\n\r\n  // Use AuthContext for auth checks\r\n  const { isAuthenticated, user } = useAuth();\r\n\r\n  useEffect(() => {\r\n    const checkUserInterest = async () => {\r\n      if (!isAuthenticated || !id) return;\r\n\r\n      try {\r\n        const res = await api.get(`/properties/interested/${id}/check`);\r\n        if (res.data.success) {\r\n          setIsInterested(res.data.isInterested);\r\n        }\r\n      } catch (error) {\r\n        if (error.response?.status !== 401) {\r\n          console.error(\"Error checking interest status:\", error);\r\n        }\r\n      }\r\n    };\r\n    checkUserInterest();\r\n  }, [id, isAuthenticated]);\r\n\r\n  useEffect(() => {\r\n    const fetchProperty = async () => {\r\n      try {\r\n        // Public endpoint - no auth needed, but use api client for consistency\r\n        const res = await api.get(`/properties/${id}`);\r\n        if (res.data) {\r\n          setProperty(res.data);\r\n        } else {\r\n          setError(\"Property not found\");\r\n        }\r\n      } catch (error) {\r\n        console.error(error);\r\n        if (!property) {\r\n          setError(\"Error fetching property details\");\r\n        }\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n    fetchProperty();\r\n  }, [id]);\r\n\r\n  const buildImageUrl = (img) => {\r\n    if (!img) return \"\";\r\n    const lower = img.toLowerCase();\r\n    if (lower.startsWith(\"data:\")) return img;\r\n    if (lower.startsWith(\"http://\") || lower.startsWith(\"https://\")) return img;\r\n    if (img.startsWith(\"/uploads\")) return `${API_BASE}${img}`;\r\n    return `${API_BASE}/uploads/${img}`;\r\n  };\r\n\r\n  const formatCategoryName = (key) =>\r\n    key\r\n      .replace(/([A-Z])/g, \" $1\")\r\n      .replace(/^./, (str) => str.toUpperCase())\r\n      .trim();\r\n\r\n  const getAllImages = () => {\r\n    const allImages = [];\r\n\r\n    if (property?.categorizedImages) {\r\n      const catImages = property.categorizedImages;\r\n\r\n      if (catImages.residential) {\r\n        Object.entries(catImages.residential).forEach(([category, images]) => {\r\n          if (Array.isArray(images)) {\r\n            images.forEach((img) => {\r\n              if (img)\r\n                allImages.push({\r\n                  url: buildImageUrl(img),\r\n                  category: formatCategoryName(category),\r\n                });\r\n            });\r\n          }\r\n        });\r\n      }\r\n\r\n      if (catImages.commercial) {\r\n        Object.entries(catImages.commercial).forEach(([category, images]) => {\r\n          if (Array.isArray(images)) {\r\n            images.forEach((img) => {\r\n              if (img)\r\n                allImages.push({\r\n                  url: buildImageUrl(img),\r\n                  category: formatCategoryName(category),\r\n                });\r\n            });\r\n          }\r\n        });\r\n      }\r\n    }\r\n\r\n    // Fallback for older properties that only used the legacy `images` array\r\n    if (allImages.length === 0 && Array.isArray(property?.images)) {\r\n      property.images.forEach((img) => {\r\n        if (img) {\r\n          allImages.push({\r\n            url: buildImageUrl(img),\r\n            category: \"Exterior\",\r\n          });\r\n        }\r\n      });\r\n    }\r\n\r\n    return allImages;\r\n  };\r\n\r\n  const getVideoEmbedUrl = (url) => {\r\n    if (!url) return null;\r\n    try {\r\n      const ytMatch = url.match(\r\n        /(?:youtu\\.be\\/|youtube\\.com\\/(?:watch\\?v=|embed\\/|v\\/))([\\w-]{11})/\r\n      );\r\n      if (ytMatch && ytMatch[1])\r\n        return `https://www.youtube.com/embed/${ytMatch[1]}`;\r\n      return url;\r\n    } catch {\r\n      return url;\r\n    }\r\n  };\r\n\r\n  const allPropertyImages = getAllImages();\r\n  const imgs = allPropertyImages.map((item) => item.url);\r\n\r\n  const currentImageCategory =\r\n    allPropertyImages[activeImage]?.category || null;\r\n  const videoUrl = property?.videoUrl;\r\n  const videoEmbed = getVideoEmbedUrl(videoUrl);\r\n\r\n  useEffect(() => {\r\n    if (property?.listingType === \"Rent\") return;\r\n\r\n    const principal = Number(loanAmount) || 0;\r\n    const rate = Number(interestRate) || 0;\r\n    const tenureYears = Number(loanTenure) || 0;\r\n\r\n    if (principal <= 0 || rate <= 0 || tenureYears <= 0) {\r\n      setEmi(0);\r\n      setTotalPayment(0);\r\n      setTotalInterest(0);\r\n      return;\r\n    }\r\n\r\n    const r = rate / 100 / 12;\r\n    const n = tenureYears * 12;\r\n    const emiCalc = (principal * r * Math.pow(1 + r, n)) / (Math.pow(1 + r, n) - 1);\r\n    const totalPay = emiCalc * n;\r\n    setEmi(emiCalc);\r\n    setTotalPayment(totalPay);\r\n    setTotalInterest(totalPay - principal);\r\n  }, [loanAmount, interestRate, loanTenure, property]);\r\n\r\n  if (loading)\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center text-slate-500 text-lg\">\r\n        Loading property details...\r\n      </div>\r\n    );\r\n\r\n  if (error)\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center text-red-500\">\r\n        {error}\r\n      </div>\r\n    );\r\n\r\n  if (!property)\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center\">\r\n        Property not found\r\n      </div>\r\n    );\r\n\r\n  const price = property.price || property.expectedPrice || 0;\r\n  const formattedPrice = Number(price).toLocaleString();\r\n\r\n  const address = property.address || {};\r\n  const lat = address.latitude ?? property.lat ?? property.latitude;\r\n  const lng = address.longitude ?? property.lng ?? property.longitude;\r\n  const city = property.city || address.city;\r\n  const locality = property.locality || address.area;\r\n  const landmark = address.landmark || property.landmark;\r\n\r\n  const categoryName = (\r\n    property.category?.name ||\r\n    property.categoryName ||\r\n    property.category ||\r\n    property.propertyCategory ||\r\n    \"\"\r\n  ).toString();\r\n  const categoryNameLower = categoryName.toLowerCase();\r\n  const propertyTypeName =\r\n    property.propertyTypeName ||\r\n    property.propertyType?.name ||\r\n    property.propertyType ||\r\n    \"\";\r\n  const propertyTypeLower = propertyTypeName.toLowerCase();\r\n  const isResidential =\r\n    categoryNameLower.includes(\"residen\") ||\r\n    /apartment|flat|villa|house|studio|row house|farm house|penthouse/.test(\r\n      propertyTypeLower\r\n    );\r\n  const isCommercial =\r\n    categoryNameLower.includes(\"commercial\") ||\r\n    /office|shop|showroom|restaurant|cafe|warehouse|industrial|co-working|coworking|commercial/.test(\r\n      propertyTypeLower\r\n    );\r\n\r\n  const totalSqft =\r\n    property.area?.totalSqft ||\r\n    property.area?.builtUpSqft ||\r\n    property.area?.carpetSqft ||\r\n    property.area?.plotSqft;\r\n  const pricePerSqft =\r\n    property.area?.pricePerSqft ||\r\n    (price && totalSqft ? Math.round(price / totalSqft) : null);\r\n  const maintenanceDisplay = property.maintenanceIncluded\r\n    ? \"Included\"\r\n    : property.maintenance ?? property.area?.maintenance;\r\n  const bookingAmount =\r\n    property.bookingAmount ??\r\n    property.securityDeposit ??\r\n    property.expectedDeposit ??\r\n    0;\r\n  const ageOfProperty = property.ageOfProperty || property.propertyAge;\r\n  const configurationValue = isResidential\r\n    ? property.bhk || (property.bedrooms ? `${property.bedrooms} BHK` : null)\r\n    : property.commercialSubType || propertyTypeName || null;\r\n\r\n  const commercialOrder =\r\n    COMMERCIAL_FIELD_ORDER[propertyTypeName] || DEFAULT_COMMERCIAL_FIELDS;\r\n  const commercialFieldsToShow = commercialOrder.filter(\r\n    (field) =>\r\n      property[field] !== undefined &&\r\n      property[field] !== null &&\r\n      property[field] !== \"\"\r\n  );\r\n  const showCommercialConfig =\r\n    (isCommercial ||\r\n      propertyTypeName.toLowerCase().includes(\"office\") ||\r\n      propertyTypeName.toLowerCase().includes(\"shop\") ||\r\n      propertyTypeName.toLowerCase().includes(\"showroom\") ||\r\n      propertyTypeName.toLowerCase().includes(\"restaurant\") ||\r\n      propertyTypeName.toLowerCase().includes(\"warehouse\") ||\r\n      propertyTypeName.toLowerCase().includes(\"industrial\") ||\r\n      propertyTypeName.toLowerCase().includes(\"commercial\")) &&\r\n    commercialFieldsToShow.length > 0;\r\n\r\n  const handleInterest = async () => {\r\n    if (!isAuthenticated || !user) {\r\n      toast.info(\"Please login to express interest in this property\");\r\n      navigate(\"/login\", {\r\n        state: {\r\n          from: `/properties/${id}`,\r\n          pendingAction: \"interest\",\r\n          propertyId: id,\r\n        },\r\n      });\r\n      return;\r\n    }\r\n\r\n    if (isInterested) {\r\n      setInterestLoading(true);\r\n      try {\r\n        const res = await api.delete(\r\n          `/properties/interested/${id}`\r\n        );\r\n        if (res.data.success) {\r\n          setIsInterested(false);\r\n          toast.success(\"Interest removed\");\r\n        } else {\r\n          toast.error(res.data.message || \"Failed to remove interest\");\r\n        }\r\n      } catch (error) {\r\n        console.error(\"Error removing interest:\", error);\r\n        const errorMsg =\r\n          error.response?.data?.message || \"Failed to remove interest\";\r\n        toast.error(errorMsg);\r\n      } finally {\r\n        setInterestLoading(false);\r\n      }\r\n      return;\r\n    }\r\n\r\n    setInterestLoading(true);\r\n    try {\r\n      const res = await api.post(\r\n        `/properties/interested/${id}`,\r\n        {}\r\n      );\r\n\r\n      if (res.data.success) {\r\n        setIsInterested(true);\r\n        toast.success(\"Interest registered! The owner will be notified.\");\r\n      } else {\r\n        toast.error(res.data.message || \"Failed to register interest\");\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error registering interest:\", error);\r\n      const errorMsg =\r\n        error.response?.data?.message || \"Failed to register interest\";\r\n      toast.error(errorMsg);\r\n    } finally {\r\n      setInterestLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleChatWithOwner = async () => {\r\n    if (!isAuthenticated || !user?._id) {\r\n      toast.info(\"Please login to chat with the owner\");\r\n      navigate(\"/login\", { state: { from: `/properties/${id}` } });\r\n      return;\r\n    }\r\n\r\n    const ownerId = property.owner?._id || property.owner;\r\n\r\n    if (!ownerId) {\r\n      toast.error(\"Unable to contact owner - no owner information available\");\r\n      return;\r\n    }\r\n\r\n    if (user._id === ownerId) {\r\n      toast.info(\"This is your own property\");\r\n      return;\r\n    }\r\n\r\n    setChatLoading(true);\r\n    try {\r\n      // ChatContext.startConversation expects (propertyId, ownerId)\r\n      const conversation = await startConversation(property._id, ownerId);\r\n      if (conversation) {\r\n        openChat(conversation);\r\n      } else {\r\n        toast.error(\"Unable to start chat right now\");\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error starting chat:\", error);\r\n      const msg = error.response?.data?.message || \"Failed to start chat\";\r\n      toast.error(msg);\r\n    } finally {\r\n      setChatLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleSubmitReport = async () => {\r\n    if (!isAuthenticated || !user?._id) {\r\n      toast.info(\"Please login to report this property\");\r\n      navigate(\"/login\", { state: { from: `/properties/${id}` } });\r\n      return;\r\n    }\r\n\r\n    const trimmedReason = reportReason.trim();\r\n    if (!trimmedReason || trimmedReason.length < 10) {\r\n      toast.error(\"Please describe the issue (at least 10 characters)\");\r\n      return;\r\n    }\r\n\r\n    setReportLoading(true);\r\n    try {\r\n      const res = await api.post(\r\n        `/properties/${id}/report`,\r\n        { reason: trimmedReason }\r\n      );\r\n\r\n      if (res.data?.success) {\r\n        toast.success(\"Thank you. Your report has been submitted.\");\r\n        setShowReportModal(false);\r\n        setReportReason(\"\");\r\n      } else {\r\n        toast.error(res.data?.message || \"Failed to submit report\");\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error reporting property:\", error);\r\n      const msg =\r\n        error.response?.data?.message || \"Failed to submit report. Please try again.\";\r\n      toast.error(msg);\r\n    } finally {\r\n      setReportLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className={`min-h-screen ${BRAND_BG_SOFT} text-slate-900`}>\r\n      <div className=\"max-w-6xl mx-auto px-4 sm:px-6 py-8 sm:py-10 lg:py-12 font-sans\">\r\n        {/* Hero */}\r\n        <div className=\"bg-white/95 border border-slate-200/80 rounded-3xl shadow-[0_22px_60px_rgba(15,32,70,0.16)] overflow-hidden\">\r\n          <div className=\"grid lg:grid-cols-3 gap-0\">\r\n            {/* Media */}\r\n            <div className=\"lg:col-span-2 relative\">\r\n              <div className=\"relative h-[380px] sm:h-[480px] lg:h-[520px] bg-slate-100\">\r\n                <img\r\n                  src={\r\n                    imgs[activeImage] ||\r\n                    buildImageUrl(property.image) ||\r\n                    \"https://via.placeholder.com/800x600?text=No+Image\"\r\n                  }\r\n                  alt={property.title}\r\n                  className=\"w-full h-full object-cover\"\r\n                />\r\n                <div className=\"absolute inset-0 bg-gradient-to-t from-slate-950/85 via-slate-900/20 to-transparent\" />\r\n\r\n                {/* Top-right actions */}\r\n                <div className=\"absolute top-4 right-4 flex gap-3\">\r\n                  <button\r\n                    onClick={() => setShowReportModal(true)}\r\n                    className=\"bg-white/90 backdrop-blur-sm p-3 rounded-full shadow-[0_18px_40px_rgba(15,32,70,0.25)] hover:scale-110 transition flex items-center justify-center\"\r\n                    title=\"Report this property\"\r\n                  >\r\n                    <FlagIcon className=\"w-6 h-6 text-red-600\" />\r\n                  </button>\r\n                  <button\r\n                    onClick={() => {\r\n                      navigator.clipboard.writeText(window.location.href);\r\n                      toast.success(\"Property link copied!\");\r\n                    }}\r\n                    className=\"bg-white/90 backdrop-blur-sm p-3 rounded-full shadow-[0_18px_40px_rgba(15,32,70,0.25)] hover:scale-110 transition\"\r\n                  >\r\n                    <ShareIcon className=\"w-6 h-6 text-slate-700\" />\r\n                  </button>\r\n                </div>\r\n\r\n                {/* Bottom overlay info */}\r\n                <div className=\"absolute bottom-4 left-4 flex flex-wrap items-center gap-2\">\r\n                  <div className=\"bg-black/60 text-white text-xs px-3 py-1.5 rounded-full tracking-wide\">\r\n                    {activeImage + 1} / {imgs.length || 1}\r\n                  </div>\r\n                  {currentImageCategory && (\r\n                    <div className=\"bg-[#0f4fb5] text-white text-xs px-3 py-1.5 rounded-full font-semibold\">\r\n                      {currentImageCategory}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n\r\n              {imgs.length > 0 && (\r\n                <div className=\"flex gap-3 px-4 pb-4 pt-3 overflow-x-auto scrollbar-hide bg-white/90 border-t border-slate-100\">\r\n                  {imgs.map((img, i) => (\r\n                    <button\r\n                      key={i}\r\n                      onClick={() => setActiveImage(i)}\r\n                      className={`relative flex-shrink-0 rounded-xl overflow-hidden border ${i === activeImage\r\n                        ? \"border-[#0f4fb5] ring-2 ring-[#0f4fb5]/25\"\r\n                        : \"border-slate-200\"\r\n                        }`}\r\n                    >\r\n                      <img\r\n                        src={img}\r\n                        alt=\"\"\r\n                        className=\"h-20 w-28 object-cover\"\r\n                      />\r\n                      {allPropertyImages[i]?.category && (\r\n                        <span className=\"absolute bottom-1 left-1 bg-black/65 text-white text-[10px] px-1.5 py-0.5 rounded\">\r\n                          {allPropertyImages[i].category}\r\n                        </span>\r\n                      )}\r\n                    </button>\r\n                  ))}\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            {/* Right info panel */}\r\n            <div className=\"bg-white/98 border-l border-slate-100/80 p-6 sm:p-7 lg:p-8 flex flex-col gap-6\">\r\n              {/* Badges */}\r\n              <div className=\"flex flex-wrap items-center gap-2\">\r\n                <span className=\"px-3 py-1 rounded-full bg-[#0f4fb5]/10 text-[#0f4fb5] text-[11px] font-semibold uppercase tracking-[0.08em]\">\r\n                  {property.listingType || \"For Sale\"}\r\n                </span>\r\n                <span className=\"px-3 py-1 rounded-full bg-[#ffe4ea] text-[#e11d48] text-[11px] font-semibold uppercase tracking-[0.08em]\">\r\n                  {formatCategoryDisplay(\r\n                    property.category?.name || property.propertyCategory\r\n                  )}\r\n                </span>\r\n                {property.propertyTypeName && (\r\n                  <span className=\"px-3 py-1 rounded-full bg-slate-100 text-slate-700 text-[11px] font-semibold\">\r\n                    {property.propertyTypeName}\r\n                  </span>\r\n                )}\r\n              </div>\r\n\r\n              {/* Title & location */}\r\n              <div>\r\n                <h1 className=\"text-2xl sm:text-3xl font-semibold text-slate-900 leading-tight mb-2\">\r\n                  {property.title}\r\n                </h1>\r\n                <p className=\"flex items-center text-sm sm:text-base text-slate-600\">\r\n                  <MapPinIcon className=\"w-5 h-5 mr-1 text-[#0f4fb5] flex-shrink-0\" />\r\n                  {locality || \"\"}\r\n                  {locality && city ? \", \" : \"\"}\r\n                  {city || address?.city}\r\n                </p>\r\n                {property.owner?.name && (\r\n                  <p className=\"mt-1 text-xs sm:text-sm text-slate-500\">\r\n                    Listed by\r\n                    {\" \"}\r\n                    <span className=\"font-semibold text-slate-700\">\r\n                      {property.owner.name}\r\n                    </span>\r\n                  </p>\r\n                )}\r\n              </div>\r\n\r\n              {/* Price block */}\r\n              <div className=\"space-y-3\">\r\n                <p className=\"text-xs font-semibold text-slate-500 uppercase tracking-[0.08em]\">\r\n                  Asking Price\r\n                </p>\r\n                <div className=\"flex flex-wrap items-baseline gap-3\">\r\n                  <span className=\"text-3xl sm:text-4xl font-semibold text-slate-900\">\r\n                    Γé╣{formattedPrice}\r\n                  </span>\r\n                  {pricePerSqft && (\r\n                    <span className=\"px-3 py-1 rounded-full bg-slate-100 text-slate-700 text-xs sm:text-sm\">\r\n                      Γé╣{pricePerSqft.toLocaleString()} / sq.ft\r\n                    </span>\r\n                  )}\r\n                </div>\r\n                <div className=\"flex flex-wrap gap-2 text-[11px] font-semibold text-slate-700\">\r\n                  {maintenanceDisplay !== undefined &&\r\n                    maintenanceDisplay !== null &&\r\n                    maintenanceDisplay !== \"\" && (\r\n                      <span className=\"px-3 py-1 rounded-full bg-slate-100\">\r\n                        Maintenance:{\" \"}\r\n                        {maintenanceDisplay === \"Included\"\r\n                          ? \"Included\"\r\n                          : `Γé╣${maintenanceDisplay}`}\r\n                      </span>\r\n                    )}\r\n                  {bookingAmount > 0 && (\r\n                    <span className=\"px-3 py-1 rounded-full bg-slate-100\">\r\n                      Token: Γé╣{Number(bookingAmount).toLocaleString()}\r\n                    </span>\r\n                  )}\r\n                  {property.gstApplicable && (\r\n                    <span className=\"px-3 py-1 rounded-full bg-slate-100\">\r\n                      GST Applicable\r\n                    </span>\r\n                  )}\r\n                  {property.negotiable && (\r\n                    <span className=\"px-3 py-1 rounded-full bg-emerald-50 text-emerald-700 border border-emerald-100\">\r\n                      Negotiable\r\n                    </span>\r\n                  )}\r\n                </div>\r\n              </div>\r\n\r\n              {/* Quick facts */}\r\n              <div className=\"grid grid-cols-2 gap-3 bg-slate-50/70 border border-slate-100 rounded-2xl p-4\">\r\n                <InfoChip\r\n                  label=\"Area\"\r\n                  value={`${property.area?.builtUpSqft ||\r\n                    property.builtUpArea ||\r\n                    property.area?.totalSqft ||\r\n                    \"N/A\"\r\n                    } sq.ft`}\r\n                />\r\n                {configurationValue && (\r\n                  <InfoChip\r\n                    label={isResidential ? \"Configuration\" : \"Use Type\"}\r\n                    value={configurationValue}\r\n                  />\r\n                )}\r\n                {!isCommercial && (\r\n                  <InfoChip\r\n                    label=\"Furnishing\"\r\n                    value={property.furnishing || \"N/A\"}\r\n                  />\r\n                )}\r\n                <InfoChip\r\n                  label=\"Available\"\r\n                  value={\r\n                    property.availableFrom\r\n                      ? new Date(\r\n                        property.availableFrom\r\n                      ).toLocaleDateString()\r\n                      : \"Ready to Move\"\r\n                  }\r\n                />\r\n              </div>\r\n\r\n              {/* Actions */}\r\n              <div className=\"space-y-3 pt-1\">\r\n                <PrimaryButton\r\n                  onClick={handleInterest}\r\n                  disabled={interestLoading}\r\n                  tone={isInterested ? \"red\" : \"brand\"}\r\n                  loading={interestLoading}\r\n                  label={isInterested ? \"Remove Interest\" : \"I'm Interested\"}\r\n                  icon={\r\n                    isInterested ? (\r\n                      <HeartIconSolid className=\"w-5 h-5\" />\r\n                    ) : (\r\n                      <HeartIcon className=\"w-5 h-5\" />\r\n                    )\r\n                  }\r\n                />\r\n                {isInterested && (\r\n                  <PrimaryButton\r\n                    onClick={handleChatWithOwner}\r\n                    disabled={chatLoading}\r\n                    loading={chatLoading}\r\n                    tone=\"subtle\"\r\n                    label=\"Chat with Owner\"\r\n                    icon={<ChatBubbleLeftRightIcon className=\"w-5 h-5\" />}\r\n                  />\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Body */}\r\n        <div className=\"mt-10 grid grid-cols-1 lg:grid-cols-3 gap-8 lg:gap-10\">\r\n          {/* Left column */}\r\n          <div className=\"lg:col-span-2 space-y-8\">\r\n            <Card\r\n              title=\"Property Overview\"\r\n              icon={\r\n                <BuildingStorefrontIcon className=\"w-5 h-5 text-[#0f4fb5]\" />\r\n              }\r\n            >\r\n              <OverviewSection\r\n                property={property}\r\n                isResidential={isResidential}\r\n                isCommercial={isCommercial}\r\n                ageOfProperty={ageOfProperty}\r\n              />\r\n            </Card>\r\n\r\n            <Card\r\n              title=\"Dimensions & Pricing\"\r\n              icon={<Square2StackIcon className=\"w-5 h-5 text-[#0f4fb5]\" />}\r\n            >\r\n              <DimensionsSection\r\n                property={property}\r\n                pricePerSqft={pricePerSqft}\r\n                formattedPrice={formattedPrice}\r\n                bookingAmount={bookingAmount}\r\n                maintenanceDisplay={maintenanceDisplay}\r\n              />\r\n            </Card>\r\n\r\n            {(property.amenities?.length > 0 ||\r\n              property.selectedAmenities?.length > 0) && (\r\n                <Card\r\n                  title=\"Amenities\"\r\n                  icon={<TagIcon className=\"w-5 h-5 text-[#0f4fb5]\" />}\r\n                >\r\n                  <AmenitiesSection property={property} />\r\n                </Card>\r\n              )}\r\n\r\n            {isResidential &&\r\n              property.extras &&\r\n              Object.values(property.extras).some(Boolean) && (\r\n                <Card\r\n                  title=\"Extra Rooms\"\r\n                  icon={<ShieldCheckIcon className=\"w-5 h-5 text-[#0f4fb5]\" />}\r\n                >\r\n                  <ExtrasSection property={property} />\r\n                </Card>\r\n              )}\r\n\r\n            {showCommercialConfig && (\r\n              <Card\r\n                title={`${propertyTypeName || \"Commercial\"} Details`}\r\n                icon={\r\n                  <BuildingStorefrontIcon className=\"w-5 h-5 text-[#0f4fb5]\" />\r\n                }\r\n              >\r\n                <CommercialConfigSection\r\n                  property={property}\r\n                  fields={commercialFieldsToShow}\r\n                />\r\n              </Card>\r\n            )}\r\n\r\n            {property.legal && (\r\n              <Card\r\n                title=\"Legal & Compliance\"\r\n                icon={<ShieldCheckIcon className=\"w-5 h-5 text-[#0f4fb5]\" />}\r\n              >\r\n                <LegalSection property={property} isCommercial={isCommercial} />\r\n              </Card>\r\n            )}\r\n\r\n            {videoEmbed && (\r\n              <Card\r\n                title=\"Video Walkthrough\"\r\n                icon={<HomeIcon className=\"w-5 h-5 text-[#0f4fb5]\" />}\r\n              >\r\n                {videoEmbed.startsWith(\"http\") &&\r\n                  videoEmbed.includes(\"youtube.com/embed\") ? (\r\n                  <div\r\n                    className=\"relative w-full overflow-hidden rounded-2xl shadow-[0_16px_45px_rgba(15,32,70,0.18)]\"\r\n                    style={{ paddingTop: \"56.25%\" }}\r\n                  >\r\n                    <iframe\r\n                      src={videoEmbed}\r\n                      title=\"Property video\"\r\n                      className=\"absolute inset-0 w-full h-full\"\r\n                      allowFullScreen\r\n                      loading=\"lazy\"\r\n                    />\r\n                  </div>\r\n                ) : (\r\n                  <a\r\n                    href={videoEmbed}\r\n                    target=\"_blank\"\r\n                    rel=\"noreferrer\"\r\n                    className=\"text-[#0f4fb5] underline text-sm\"\r\n                  >\r\n                    Open video in new tab\r\n                  </a>\r\n                )}\r\n              </Card>\r\n            )}\r\n\r\n            <Card\r\n              title=\"About Property\"\r\n              icon={<HomeIcon className=\"w-5 h-5 text-[#0f4fb5]\" />}\r\n            >\r\n              <p className=\"text-sm sm:text-base text-slate-700 leading-relaxed whitespace-pre-line\">\r\n                {property.description || \"No description provided.\"}\r\n              </p>\r\n            </Card>\r\n          </div>\r\n\r\n          {/* Right column */}\r\n          <div className=\"space-y-8\">\r\n            {property?.listingType !== \"Rent\" && (\r\n              <Card\r\n                title=\"EMI Calculator\"\r\n                icon={<BanknotesIcon className=\"w-5 h-5 text-[#0f4fb5]\" />}\r\n                sticky\r\n              >\r\n                <EmiSection\r\n                  loanAmount={loanAmount}\r\n                  setLoanAmount={setLoanAmount}\r\n                  interestRate={interestRate}\r\n                  setInterestRate={setInterestRate}\r\n                  loanTenure={loanTenure}\r\n                  setLoanTenure={setLoanTenure}\r\n                  emi={emi}\r\n                  totalInterest={totalInterest}\r\n                  totalPayment={totalPayment}\r\n                />\r\n              </Card>\r\n            )}\r\n\r\n            <Card\r\n              title=\"Location\"\r\n              icon={<MapPinIcon className=\"w-5 h-5 text-[#0f4fb5]\" />}\r\n            >\r\n              <div className=\"rounded-2xl overflow-hidden h-64 bg-slate-100 shadow-[0_14px_40px_rgba(15,32,70,0.15)]\">\r\n                <iframe\r\n                  src={\r\n                    lat && lng\r\n                      ? `https://www.google.com/maps?q=${lat},${lng}&z=16&output=embed`\r\n                      : `https://www.google.com/maps?q=${encodeURIComponent(\r\n                        address.line || locality || city || \"India\"\r\n                      )}&output=embed`\r\n                  }\r\n                  title=\"Map\"\r\n                  width=\"100%\"\r\n                  height=\"100%\"\r\n                  style={{ border: 0 }}\r\n                  loading=\"lazy\"\r\n                />\r\n              </div>\r\n              <p className=\"text-sm text-slate-600 mt-3\">\r\n                {landmark ? `Near ${landmark}, ` : \"\"}\r\n                {address.line || locality || address.area}, {city}\r\n              </p>\r\n              {address?.nearby && address.nearby.length > 0 && (\r\n                <div className=\"mt-3\">\r\n                  <p className=\"text-[11px] font-semibold text-slate-500 uppercase tracking-[0.08em] mb-1\">\r\n                    Nearby\r\n                  </p>\r\n                  <div className=\"flex flex-wrap gap-1.5\">\r\n                    {address.nearby.map((place, i) => (\r\n                      <span\r\n                        key={i}\r\n                        className=\"text-[11px] bg-slate-50 text-slate-700 px-2 py-1 rounded-full border border-slate-200\"\r\n                      >\r\n                        {place}\r\n                      </span>\r\n                    ))}\r\n                  </div>\r\n                  {showReportModal && (\r\n                    <div className=\"fixed inset-0 bg-black/40 backdrop-blur-sm z-50 flex items-center justify-center px-4\">\r\n                      <div className=\"bg-white rounded-2xl shadow-xl max-w-md w-full p-6\">\r\n                        <h3 className=\"text-lg font-semibold text-slate-900 mb-2 flex items-center gap-2\">\r\n                          <FlagIcon className=\"w-5 h-5 text-red-600\" />\r\n                          Report this property\r\n                        </h3>\r\n                        <p className=\"text-sm text-slate-600 mb-4\">\r\n                          Tell us what is wrong with this listing. Our team will review your\r\n                          report and take appropriate action.\r\n                        </p>\r\n                        <textarea\r\n                          rows={4}\r\n                          value={reportReason}\r\n                          onChange={(e) => setReportReason(e.target.value)}\r\n                          placeholder=\"Example: This property seems fraudulent or contains incorrect information.\"\r\n                          className=\"w-full border border-slate-300 rounded-xl px-3 py-2 text-sm text-slate-800 focus:ring-2 focus:ring-red-500 focus:border-red-500 resize-none mb-4\"\r\n                        />\r\n                        <div className=\"flex justify-end gap-3\">\r\n                          <button\r\n                            type=\"button\"\r\n                            onClick={() => {\r\n                              if (!reportLoading) {\r\n                                setShowReportModal(false);\r\n                              }\r\n                            }}\r\n                            className=\"px-4 py-2 text-sm rounded-xl border border-slate-200 text-slate-600 hover:bg-slate-50\"\r\n                          >\r\n                            Cancel\r\n                          </button>\r\n                          <button\r\n                            type=\"button\"\r\n                            onClick={handleSubmitReport}\r\n                            disabled={reportLoading}\r\n                            className=\"px-4 py-2 text-sm rounded-xl bg-red-600 text-white hover:bg-red-700 disabled:opacity-60 flex items-center gap-2\"\r\n                          >\r\n                            {reportLoading && (\r\n                              <span className=\"h-4 w-4 border-2 border-white/60 border-t-transparent rounded-full animate-spin\" />\r\n                            )}\r\n                            Submit report\r\n                          </button>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              )}\r\n            </Card>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default PropertyDetails;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\dealdirectcurrentlive\\dealdirect\\client\\src\\Pages\\PropertyList\\PropertyList.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'propertyIcon' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":66,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":66,"endColumn":19,"suggestions":[{"messageId":"removeVar","data":{"varName":"propertyIcon"},"fix":{"range":[1884,2306],"text":""},"desc":"Remove unused variable 'propertyIcon'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'highlightedIcon' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":77,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":77,"endColumn":22,"suggestions":[{"messageId":"removeVar","data":{"varName":"highlightedIcon"},"fix":{"range":[2357,2704],"text":""},"desc":"Remove unused variable 'highlightedIcon'."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has an unnecessary dependency: 'droppedPin'. Either exclude it or remove the dependency array. Outer scope values like 'droppedPin' aren't valid dependencies because mutating them doesn't re-render the component.","line":847,"column":8,"nodeType":"ArrayExpression","endLine":847,"endColumn":37,"suggestions":[{"desc":"Update the dependencies array to be: [properties, map]","fix":{"range":[28995,29024],"text":"[properties, map]"}}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useMemo, useRef } from \"react\";\r\nimport { useNavigate, useLocation } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\nimport api from \"../../utils/api\";\r\nimport { useAuth } from \"../../context/AuthContext\";\r\nimport { toast } from \"react-toastify\";\r\nimport {\r\n  FaMapMarkerAlt,\r\n  FaSearch,\r\n  FaFilter,\r\n  FaBed,\r\n  FaBath,\r\n  FaRulerCombined,\r\n  FaRegHeart,\r\n  FaHeart,\r\n  FaList,\r\n  FaMap,\r\n  FaCrosshairs,\r\n  FaTimes,\r\n  FaBuilding,\r\n  FaUsers,\r\n  FaBell,\r\n} from \"react-icons/fa\";\r\nimport { MapContainer, TileLayer, Marker, Popup, useMap, useMapEvents, Circle } from \"react-leaflet\";\r\nimport L from \"leaflet\";\r\nimport \"leaflet/dist/leaflet.css\";\r\n\r\n// Custom marker styles\r\nconst markerStyles = `\r\n  .custom-property-marker {\r\n    background: transparent !important;\r\n    border: none !important;\r\n  }\r\n  .custom-property-marker > div {\r\n    cursor: pointer;\r\n    transition: transform 0.2s ease;\r\n  }\r\n  .custom-property-marker > div:hover {\r\n    transform: scale(1.1);\r\n    z-index: 1000 !important;\r\n  }\r\n  .leaflet-popup-content-wrapper {\r\n    border-radius: 12px !important;\r\n    padding: 0 !important;\r\n  }\r\n  .leaflet-popup-content {\r\n    margin: 12px !important;\r\n  }\r\n`;\r\n\r\n// Inject styles\r\nif (typeof document !== 'undefined') {\r\n  const styleSheet = document.createElement(\"style\");\r\n  styleSheet.innerText = markerStyles;\r\n  document.head.appendChild(styleSheet);\r\n}\r\n// Fix for default marker icon in react-leaflet\r\ndelete L.Icon.Default.prototype._getIconUrl;\r\nL.Icon.Default.mergeOptions({\r\n  iconRetinaUrl: \"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon-2x.png\",\r\n  iconUrl: \"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png\",\r\n  shadowUrl: \"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png\",\r\n});\r\n\r\n// Custom marker icon for properties\r\nconst propertyIcon = new L.Icon({\r\n  iconUrl: \"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png\",\r\n  iconRetinaUrl: \"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon-2x.png\",\r\n  shadowUrl: \"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png\",\r\n  iconSize: [25, 41],\r\n  iconAnchor: [12, 41],\r\n  popupAnchor: [1, -34],\r\n  shadowSize: [41, 41]\r\n});\r\n\r\n// Custom red marker for highlighted property\r\nconst highlightedIcon = new L.Icon({\r\n  iconUrl: \"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png\",\r\n  shadowUrl: \"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png\",\r\n  iconSize: [25, 41],\r\n  iconAnchor: [12, 41],\r\n  popupAnchor: [1, -34],\r\n  shadowSize: [41, 41]\r\n});\r\n\r\n// Custom pin drop marker (green)\r\nconst pinDropIcon = new L.Icon({\r\n  iconUrl: \"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png\",\r\n  shadowUrl: \"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png\",\r\n  iconSize: [25, 41],\r\n  iconAnchor: [12, 41],\r\n  popupAnchor: [1, -34],\r\n  shadowSize: [41, 41]\r\n});\r\n\r\n// Create simple pin marker (default state)\r\nconst createSimplePinMarker = (price, isHighlighted = false) => {\r\n  const formattedPrice = price >= 10000000\r\n    ? `Γé╣${(price / 10000000).toFixed(1)}Cr`\r\n    : price >= 100000\r\n      ? `Γé╣${(price / 100000).toFixed(0)}L`\r\n      : `Γé╣${price?.toLocaleString()}`;\r\n\r\n  return L.divIcon({\r\n    className: 'custom-property-marker',\r\n    html: `\r\n      <div style=\"\r\n        background: ${isHighlighted ? '#dc2626' : '#ffffff'};\r\n        color: ${isHighlighted ? '#ffffff' : '#1e293b'};\r\n        padding: 6px 10px;\r\n        border-radius: 20px;\r\n        font-weight: 700;\r\n        font-size: 11px;\r\n        white-space: nowrap;\r\n        box-shadow: 0 2px 8px rgba(0,0,0,0.2);\r\n        border: 2px solid ${isHighlighted ? '#dc2626' : '#e2e8f0'};\r\n        position: relative;\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 4px;\r\n      \">\r\n        ≡ƒÅá ${formattedPrice}\r\n        <div style=\"\r\n          position: absolute;\r\n          bottom: -8px;\r\n          left: 50%;\r\n          transform: translateX(-50%);\r\n          width: 0;\r\n          height: 0;\r\n          border-left: 6px solid transparent;\r\n          border-right: 6px solid transparent;\r\n          border-top: 8px solid ${isHighlighted ? '#dc2626' : '#ffffff'};\r\n        \"></div>\r\n      </div>\r\n    `,\r\n    iconSize: [80, 36],\r\n    iconAnchor: [40, 36],\r\n    popupAnchor: [0, -30]\r\n  });\r\n};\r\n\r\n// Create detailed property marker with image (hover state)\r\nconst createDetailedPropertyMarker = (property) => {\r\n  const price = property.price;\r\n  const formattedPrice = price >= 10000000\r\n    ? `Γé╣${(price / 10000000).toFixed(1)}Cr`\r\n    : price >= 100000\r\n      ? `Γé╣${(price / 100000).toFixed(0)}L`\r\n      : `Γé╣${price?.toLocaleString()}`;\r\n\r\n  // Get first image or fallback\r\n  const imageUrl = property.images?.[0] || 'https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?w=100&h=60&fit=crop';\r\n  const title = property.title?.substring(0, 20) + (property.title?.length > 20 ? '...' : '') || 'Property';\r\n  const location = property.address?.city || property.city || '';\r\n\r\n  return L.divIcon({\r\n    className: 'custom-property-marker',\r\n    html: `\r\n      <div style=\"\r\n        background: #ffffff;\r\n        border-radius: 12px;\r\n        box-shadow: 0 4px 16px rgba(0,0,0,0.3);\r\n        border: 2px solid #dc2626;\r\n        overflow: hidden;\r\n        width: 160px;\r\n        cursor: pointer;\r\n        z-index: 1000 !important;\r\n      \">\r\n        <div style=\"\r\n          width: 100%;\r\n          height: 70px;\r\n          background-image: url('${imageUrl}');\r\n          background-size: cover;\r\n          background-position: center;\r\n          position: relative;\r\n        \">\r\n          <div style=\"\r\n            position: absolute;\r\n            bottom: 4px;\r\n            left: 4px;\r\n            background: #dc2626;\r\n            color: #ffffff;\r\n            padding: 3px 8px;\r\n            border-radius: 4px;\r\n            font-size: 12px;\r\n            font-weight: 700;\r\n          \">${formattedPrice}</div>\r\n        </div>\r\n        <div style=\"\r\n          padding: 8px 10px;\r\n          background: #ffffff;\r\n        \">\r\n          <div style=\"\r\n            font-size: 12px;\r\n            font-weight: 600;\r\n            color: #1e293b;\r\n            white-space: nowrap;\r\n            overflow: hidden;\r\n            text-overflow: ellipsis;\r\n          \">${title}</div>\r\n          <div style=\"\r\n            font-size: 11px;\r\n            color: #64748b;\r\n            display: flex;\r\n            align-items: center;\r\n            gap: 3px;\r\n            margin-top: 3px;\r\n          \">\r\n            <span>≡ƒôì</span>${location}\r\n          </div>\r\n        </div>\r\n        <div style=\"\r\n          position: absolute;\r\n          bottom: -10px;\r\n          left: 50%;\r\n          transform: translateX(-50%);\r\n          width: 0;\r\n          height: 0;\r\n          border-left: 10px solid transparent;\r\n          border-right: 10px solid transparent;\r\n          border-top: 10px solid #ffffff;\r\n        \"></div>\r\n      </div>\r\n    `,\r\n    iconSize: [160, 130],\r\n    iconAnchor: [80, 130],\r\n    popupAnchor: [0, -125]\r\n  });\r\n};\r\n\r\n// Calculate distance between two points (Haversine formula)\r\nconst calculateDistance = (lat1, lon1, lat2, lon2) => {\r\n  const R = 6371; // Earth's radius in km\r\n  const dLat = (lat2 - lat1) * Math.PI / 180;\r\n  const dLon = (lon2 - lon1) * Math.PI / 180;\r\n  const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +\r\n    Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *\r\n    Math.sin(dLon / 2) * Math.sin(dLon / 2);\r\n  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n  return R * c;\r\n};\r\n\r\nconst API_BASE = import.meta.env.VITE_API_BASE;\r\n\r\nconst normalizePrice = (price, unit) => {\r\n  const amount = Number(price) || 0;\r\n  const normalizedUnit = (unit || \"\").toLowerCase();\r\n\r\n  if (normalizedUnit.includes(\"crore\")) return amount * 10000000;\r\n  if (normalizedUnit.includes(\"lac\") || normalizedUnit.includes(\"lakh\")) return amount * 100000;\r\n  return amount;\r\n};\r\n\r\n// Simple in-memory cache for suggestions\r\nconst suggestionsCache = new Map();\r\nconst CACHE_TTL = 60000; // 1 minute cache\r\n\r\nconst initialFilters = {\r\n  search: \"\",\r\n  propertyType: \"\",\r\n  category: \"\",\r\n  city: \"\",\r\n  priceRange: \"\",\r\n  availableFor: \"\", // \"Rent\" or \"Sell\"\r\n};\r\n\r\nconst SkeletonCard = () => (\r\n  <div className=\"bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden animate-pulse\">\r\n    <div className=\"h-64 bg-slate-200\"></div>\r\n    <div className=\"p-5 space-y-3\">\r\n      <div className=\"h-6 bg-slate-200 rounded w-3/4\"></div>\r\n      <div className=\"h-4 bg-slate-200 rounded w-1/2\"></div>\r\n      <div className=\"flex gap-4 pt-2\">\r\n        <div className=\"h-8 bg-slate-200 rounded w-16\"></div>\r\n        <div className=\"h-8 bg-slate-200 rounded w-16\"></div>\r\n      </div>\r\n      <div className=\"h-10 bg-slate-200 rounded w-full mt-4\"></div>\r\n    </div>\r\n  </div>\r\n);\r\n\r\nconst PropertyPage = () => {\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n\r\n  const [properties, setProperties] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [filters, setFilters] = useState(initialFilters);\r\n  const [propertyTypes, setPropertyTypes] = useState([]);\r\n  const [cities, setCities] = useState([]);\r\n  const [viewMode, setViewMode] = useState(\"list\"); // \"list\" or \"map\"\r\n  const [hoveredProperty, setHoveredProperty] = useState(null);\r\n  const [interestedIds, setInterestedIds] = useState(() => new Set());\r\n  const [interestLoadingIds, setInterestLoadingIds] = useState(() => new Set());\r\n  const [compareIds, setCompareIds] = useState([]); // property IDs selected for comparison\r\n  const [showCompareModal, setShowCompareModal] = useState(false);\r\n  const [compareBaseType, setCompareBaseType] = useState(null); // propertyTypeName string for current comparison group\r\n  const [showSaveSearch, setShowSaveSearch] = useState(false);\r\n  const [savingSearch, setSavingSearch] = useState(false);\r\n  const [savedSearchName, setSavedSearchName] = useState(\"\");\r\n  const [notifyByEmail, setNotifyByEmail] = useState(true);\r\n\r\n  // Property types to show in the Type dropdown (hide Plot / Land options)\r\n  const selectablePropertyTypes = useMemo(\r\n    () =>\r\n      propertyTypes.filter((pt) => {\r\n        const name = (pt.name || \"\").toString().toLowerCase();\r\n        return !name.includes(\"plot\") && !name.includes(\"land\");\r\n      }),\r\n    [propertyTypes]\r\n  );\r\n\r\n  // Pin drop states\r\n  const [pinDropMode, setPinDropMode] = useState(false);\r\n  const [droppedPin, setDroppedPin] = useState(null); // { lat, lng }\r\n  const [searchRadius, setSearchRadius] = useState(2); // km\r\n\r\n  // Autocomplete states\r\n  const [suggestions, setSuggestions] = useState([]);\r\n  const [showSuggestions, setShowSuggestions] = useState(false);\r\n  const [isLoadingSuggestions, setIsLoadingSuggestions] = useState(false);\r\n  const [selectedIndex, setSelectedIndex] = useState(-1);\r\n  const searchInputRef = useRef(null);\r\n  const suggestionsRef = useRef(null);\r\n  const abortControllerRef = useRef(null);\r\n\r\n  const resolveImageSrc = (img) => {\r\n    if (!img) return \"\";\r\n    const s = String(img).trim();\r\n    const lower = s.toLowerCase();\r\n    if (lower.startsWith(\"data:\") || lower.startsWith(\"http\")) return s;\r\n    if (s.startsWith(\"/uploads\")) return `${API_BASE}${s}`;\r\n    return `${API_BASE}/uploads/${s}`;\r\n  };\r\n\r\n  const FALLBACK_IMG = \"https://images.unsplash.com/photo-1600585154340-be6161a56a0c?q=80&w=800\";\r\n\r\n  const formatCategoryDisplay = (name) => {\r\n    const value = (name || \"\").toString();\r\n    const lower = value.toLowerCase();\r\n    if (lower.includes(\"commercial land\")) return \"Commercial Property\";\r\n    if (lower.includes(\"commercial property\")) return \"Commercial Property\";\r\n    if (lower.includes(\"residential land\") || lower.includes(\"residential plot\")) return \"Residential Property\";\r\n    if (lower.includes(\"commercial plot\")) return \"Commercial Property\";\r\n    if (lower === \"plot\" || lower === \"plots\" || lower.includes(\"plot & land\") || lower.includes(\"plots & land\")) {\r\n      return \"Residential Property\";\r\n    }\r\n    if (lower.includes(\"residential\")) return \"Residential Property\";\r\n    if (lower.includes(\"commercial\")) return \"Commercial Property\";\r\n    return value || \"Property\";\r\n  };\r\n\r\n  const getTypeFlags = (property) => {\r\n    const categoryName = (\r\n      property.category?.name ||\r\n      property.categoryName ||\r\n      property.category ||\r\n      property.propertyCategory ||\r\n      \"\"\r\n    ).toString();\r\n\r\n    const categoryLower = categoryName.toLowerCase();\r\n\r\n    const propertyTypeName = (\r\n      property.propertyTypeName ||\r\n      (typeof property.propertyType === \"object\"\r\n        ? property.propertyType?.name\r\n        : property.propertyType) ||\r\n      \"\"\r\n    ).toString();\r\n\r\n    const propertyTypeLower = propertyTypeName.toLowerCase();\r\n\r\n    const isResidential =\r\n      categoryLower.includes(\"residen\") ||\r\n      /apartment|flat|villa|house|studio|row house|farm house|penthouse/i.test(\r\n        propertyTypeLower\r\n      );\r\n\r\n    const isCommercial =\r\n      categoryLower.includes(\"commercial\") ||\r\n      /office|shop|showroom|restaurant|cafe|warehouse|industrial|co-working|coworking|commercial/i.test(\r\n        propertyTypeLower\r\n      );\r\n\r\n    return { isResidential, isCommercial, propertyTypeName };\r\n  };\r\n\r\n  useEffect(() => { window.scrollTo({ top: 0, left: 0, behavior: \"auto\" }); }, []);\r\n\r\n  const buildDefaultSearchName = () => {\r\n    const parts = [];\r\n    if (filters.city) parts.push(filters.city);\r\n    if (filters.availableFor) parts.push(filters.availableFor);\r\n    if (filters.priceRange) {\r\n      if (filters.priceRange === \"low\") parts.push(\"Under 50L\");\r\n      if (filters.priceRange === \"mid\") parts.push(\"50L - 1.5Cr\");\r\n      if (filters.priceRange === \"high\") parts.push(\"Above 1.5Cr\");\r\n    }\r\n    if (filters.propertyType) parts.push(\"Selected type\");\r\n    return parts.length ? parts.join(\" ΓÇó \") : \"All properties\";\r\n  };\r\n\r\n  const handleSaveSearchClick = () => {\r\n    if (!isAuthenticated) {\r\n      toast.info(\"Login to save this search and get alerts\");\r\n      navigate(\"/login\", { state: { from: \"/properties\" } });\r\n      return;\r\n    }\r\n    if (!filters.city && !filters.search && !filters.propertyType && !filters.priceRange && !filters.availableFor) {\r\n      toast.warn(\"Apply at least one filter (city, type, price, etc.) before saving.\");\r\n      return;\r\n    }\r\n    setSavedSearchName(buildDefaultSearchName());\r\n    setShowSaveSearch(true);\r\n  };\r\n\r\n  const handleConfirmSaveSearch = async () => {\r\n    if (!isAuthenticated) {\r\n      toast.info(\"Login required to save searches\");\r\n      navigate(\"/login\", { state: { from: \"/properties\" } });\r\n      return;\r\n    }\r\n\r\n    if (!savedSearchName.trim()) {\r\n      toast.warn(\"Give this search a name\");\r\n      return;\r\n    }\r\n\r\n    setSavingSearch(true);\r\n    try {\r\n      await api.post(\r\n        `/saved-searches`,\r\n        {\r\n          name: savedSearchName.trim(),\r\n          filters,\r\n          notifyEmail: notifyByEmail,\r\n          notifyInApp: true,\r\n        }\r\n      );\r\n      toast.success(\"Search saved. We'll use this for future alerts.\");\r\n      setShowSaveSearch(false);\r\n    } catch (err) {\r\n      console.error(\"Save search error\", err);\r\n      toast.error(err.response?.data?.message || \"Failed to save search\");\r\n    } finally {\r\n      setSavingSearch(false);\r\n    }\r\n  };\r\n\r\n  const MAX_COMPARE = 3;\r\n\r\n  const selectedCompareProperties = useMemo(\r\n    () => properties.filter((p) => compareIds.includes(p._id)),\r\n    [properties, compareIds]\r\n  );\r\n\r\n  // Apply post-login interest state passed via navigation state\r\n  useEffect(() => {\r\n    const postLoginInterestId = location.state?.interestedPropertyId;\r\n    if (!postLoginInterestId) return;\r\n\r\n    setInterestedIds((prev) => {\r\n      const updated = new Set(prev);\r\n      updated.add(postLoginInterestId);\r\n      return updated;\r\n    });\r\n\r\n    const newState = { ...(location.state || {}) };\r\n    delete newState.interestedPropertyId;\r\n    navigate(location.pathname + location.search, { replace: true, state: newState });\r\n  }, [location.state, location.pathname, location.search, navigate]);\r\n\r\n  const getPropertyTypeLabel = (property) => {\r\n    return (\r\n      property.propertyTypeName ||\r\n      (typeof property.propertyType === \"object\" ? property.propertyType?.name : property.propertyType) ||\r\n      \"Property\"\r\n    );\r\n  };\r\n\r\n  const toggleCompare = (event, property) => {\r\n    if (event) {\r\n      event.stopPropagation();\r\n      event.preventDefault();\r\n    }\r\n\r\n    setCompareIds((prev) => {\r\n      if (prev.includes(property._id)) {\r\n        const next = prev.filter((id) => id !== property._id);\r\n        // If last item removed, reset base type\r\n        if (next.length === 0) {\r\n          setCompareBaseType(null);\r\n        }\r\n        return next;\r\n      }\r\n      if (prev.length >= MAX_COMPARE) {\r\n        toast.info(`You can compare up to ${MAX_COMPARE} properties at a time.`);\r\n        return prev;\r\n      }\r\n\r\n      const currentType = getPropertyTypeLabel(property);\r\n\r\n      if (!compareBaseType) {\r\n        setCompareBaseType(currentType);\r\n      } else if (compareBaseType !== currentType) {\r\n        toast.info(`You can only compare properties of the same type (currently comparing ${compareBaseType}).`);\r\n        return prev;\r\n      }\r\n      return [...prev, property._id];\r\n    });\r\n  };\r\n\r\n  const clearCompare = () => {\r\n    setCompareIds([]);\r\n    setCompareBaseType(null);\r\n  };\r\n\r\n  useEffect(() => {\r\n    const fetchAllData = async () => {\r\n      try {\r\n        setLoading(true);\r\n        const [propsRes, ptRes] = await Promise.all([\r\n          api.get('/properties/property-list'),\r\n          api.get('/propertyTypes/list-propertytype'),\r\n        ]);\r\n\r\n        const propsData = propsRes.data.data || [];\r\n        setProperties(propsData);\r\n        setPropertyTypes(ptRes.data || []);\r\n        const uniqueCities = [...new Set(propsData.map(p => p.address?.city).filter(Boolean))];\r\n        setCities(uniqueCities);\r\n\r\n      } catch (err) {\r\n        console.error(\"Error fetching data:\", err);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n    fetchAllData();\r\n  }, []);\r\n\r\n  // Optimized autocomplete with caching and request cancellation\r\n  useEffect(() => {\r\n    const searchTerm = filters.search?.trim() || '';\r\n\r\n    if (searchTerm.length < 2) {\r\n      setSuggestions([]);\r\n      setShowSuggestions(false);\r\n      return;\r\n    }\r\n\r\n    // Check cache first\r\n    const cacheKey = searchTerm.toLowerCase();\r\n    const cached = suggestionsCache.get(cacheKey);\r\n    if (cached && Date.now() - cached.timestamp < CACHE_TTL) {\r\n      setSuggestions(cached.data);\r\n      setShowSuggestions(cached.data.length > 0);\r\n      setSelectedIndex(-1);\r\n      return;\r\n    }\r\n\r\n    const fetchSuggestions = async () => {\r\n      // Cancel previous request\r\n      if (abortControllerRef.current) {\r\n        abortControllerRef.current.abort();\r\n      }\r\n      abortControllerRef.current = new AbortController();\r\n\r\n      setIsLoadingSuggestions(true);\r\n      try {\r\n        const response = await api.get(\r\n          '/properties/suggestions',\r\n          {\r\n            params: { q: searchTerm },\r\n            signal: abortControllerRef.current.signal,\r\n            timeout: 3000\r\n          }\r\n        );\r\n\r\n        const data = response.data.suggestions || [];\r\n\r\n        // Cache the result\r\n        suggestionsCache.set(cacheKey, {\r\n          data,\r\n          timestamp: Date.now()\r\n        });\r\n\r\n        setSuggestions(data);\r\n        setShowSuggestions(data.length > 0);\r\n        setSelectedIndex(-1);\r\n      } catch (error) {\r\n        if (!axios.isCancel(error)) {\r\n          console.error('Error fetching suggestions:', error);\r\n          setSuggestions([]);\r\n        }\r\n      } finally {\r\n        setIsLoadingSuggestions(false);\r\n      }\r\n    };\r\n\r\n    // Debounce: 150ms for fast response\r\n    const debounceTimer = setTimeout(fetchSuggestions, 150);\r\n    return () => {\r\n      clearTimeout(debounceTimer);\r\n      if (abortControllerRef.current) {\r\n        abortControllerRef.current.abort();\r\n      }\r\n    };\r\n  }, [filters.search]);\r\n\r\n  // Handle keyboard navigation for suggestions\r\n  const handleSearchKeyDown = (e) => {\r\n    if (!showSuggestions || suggestions.length === 0) {\r\n      if (e.key === 'Enter') {\r\n        handleFilterChange(\"search\", filters.search);\r\n      }\r\n      return;\r\n    }\r\n\r\n    if (e.key === 'ArrowDown') {\r\n      e.preventDefault();\r\n      setSelectedIndex(prev => (prev < suggestions.length - 1 ? prev + 1 : prev));\r\n    } else if (e.key === 'ArrowUp') {\r\n      e.preventDefault();\r\n      setSelectedIndex(prev => (prev > 0 ? prev - 1 : -1));\r\n    } else if (e.key === 'Enter') {\r\n      e.preventDefault();\r\n      if (selectedIndex >= 0) {\r\n        handleSuggestionClick(suggestions[selectedIndex]);\r\n      } else {\r\n        handleFilterChange(\"search\", filters.search);\r\n        setShowSuggestions(false);\r\n      }\r\n    } else if (e.key === 'Escape') {\r\n      setShowSuggestions(false);\r\n    }\r\n  };\r\n\r\n  // Handle suggestion click\r\n  const handleSuggestionClick = (suggestion) => {\r\n    setFilters(prev => ({ ...prev, search: suggestion.value }));\r\n    setShowSuggestions(false);\r\n    setSelectedIndex(-1);\r\n  };\r\n\r\n  // Close suggestions on click outside\r\n  useEffect(() => {\r\n    const handleClickOutside = (event) => {\r\n      if (\r\n        suggestionsRef.current &&\r\n        !suggestionsRef.current.contains(event.target) &&\r\n        searchInputRef.current &&\r\n        !searchInputRef.current.contains(event.target)\r\n      ) {\r\n        setShowSuggestions(false);\r\n      }\r\n    };\r\n    document.addEventListener(\"mousedown\", handleClickOutside);\r\n    return () => document.removeEventListener(\"mousedown\", handleClickOutside);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (!location.search) return;\r\n    const params = new URLSearchParams(location.search);\r\n    const updates = {};\r\n    [\"propertyType\", \"category\", \"city\", \"search\", \"availableFor\"].forEach((key) => {\r\n      const value = params.get(key);\r\n      if (value) updates[key] = value;\r\n    });\r\n    const intent = params.get(\"intent\");\r\n    if (intent && !updates.search) updates.search = intent;\r\n\r\n    // Check for view mode (map or list)\r\n    const viewParam = params.get(\"view\");\r\n    if (viewParam === \"map\" || viewParam === \"list\") {\r\n      setViewMode(viewParam);\r\n    }\r\n\r\n    if (Object.keys(updates).length) setFilters((prev) => ({ ...prev, ...updates }));\r\n  }, [location.search]);\r\n\r\n  const handleFilterChange = (field, value) => {\r\n    setFilters((prev) => ({ ...prev, [field]: value }));\r\n  };\r\n\r\n  // Determine currently selected property type (if any)\r\n  const activePropertyType = filters.propertyType\r\n    ? propertyTypes.find((pt) => String(pt._id) === String(filters.propertyType))\r\n    : null;\r\n  const activePropertyTypeName = (activePropertyType?.name || \"\").toString().toLowerCase();\r\n\r\n  const filteredProperties = properties.filter((p) => {\r\n    const query = filters.search.toLowerCase();\r\n\r\n    const matchesSearch = query\r\n      ? [\r\n        p.title,\r\n        p.address?.city,\r\n        p.address?.state,\r\n        p.address?.area,\r\n        p.address?.landmark,\r\n        p.city,\r\n        p.locality,\r\n        p.propertyTypeName,\r\n        p.propertyType?.name,\r\n        p.bhk,\r\n      ]\r\n        .filter(Boolean).some((f) => f.toLowerCase().includes(query))\r\n      : true;\r\n\r\n    // Type filter: if a high-level type like Residential / Commercial / Plot\r\n    // is selected in the dropdown, use semantic flags instead of strict ID match.\r\n    const matchType = (() => {\r\n      if (!filters.propertyType) return true;\r\n\r\n      const propertyTypeName = (\r\n        p.propertyTypeName ||\r\n        (typeof p.propertyType === \"object\" ? p.propertyType?.name : p.propertyType) ||\r\n        \"\"\r\n      ).toString();\r\n      const propertyTypeLower = propertyTypeName.toLowerCase();\r\n\r\n      const { isResidential, isCommercial } = getTypeFlags(p);\r\n\r\n      if (!activePropertyTypeName) {\r\n        return String(p.propertyType?._id || p.propertyType) === String(filters.propertyType);\r\n      }\r\n\r\n      // If selected type name clearly indicates Residential\r\n      if (activePropertyTypeName.includes(\"residen\")) {\r\n        return isResidential;\r\n      }\r\n\r\n      // If selected type name clearly indicates Commercial (but not specifically a plot)\r\n      if (activePropertyTypeName.includes(\"commercial\") && !activePropertyTypeName.includes(\"plot\")) {\r\n        return isCommercial;\r\n      }\r\n\r\n      // If selected type name is Plot / Land, match only land/plot style properties\r\n      if (\r\n        activePropertyTypeName.includes(\"plot\") ||\r\n        activePropertyTypeName.includes(\"land\")\r\n      ) {\r\n        const isPlotLike =\r\n          propertyTypeLower.includes(\"plot\") ||\r\n          propertyTypeLower.includes(\"land\") ||\r\n          Boolean(p.area?.plotSqft && !p.area?.builtUpSqft && !p.area?.carpetSqft && !p.area?.superBuiltUpSqft);\r\n        return isPlotLike;\r\n      }\r\n\r\n      // Fallback: strict match on propertyType id\r\n      return String(p.propertyType?._id || p.propertyType) === String(filters.propertyType);\r\n    })();\r\n\r\n    const matchCity = filters.city\r\n      ? ((p.address?.city || p.city || \"\").toLowerCase() === filters.city.toLowerCase())\r\n      : true;\r\n\r\n    // Filter by listing type (Rent/Sell)\r\n    const matchListingType = filters.availableFor\r\n      ? p.listingType?.toLowerCase() === filters.availableFor.toLowerCase()\r\n      : true;\r\n\r\n    let matchPrice = true;\r\n    if (filters.priceRange) {\r\n      const priceInRupees = normalizePrice(p.price, p.priceUnit);\r\n      if (filters.priceRange === \"low\") matchPrice = priceInRupees < 5000000;\r\n      if (filters.priceRange === \"mid\") matchPrice = priceInRupees >= 5000000 && priceInRupees <= 15000000;\r\n      if (filters.priceRange === \"high\") matchPrice = priceInRupees > 15000000;\r\n    }\r\n\r\n    return matchesSearch && matchType && matchCity && matchPrice && matchListingType;\r\n  });\r\n\r\n  // Get properties with valid coordinates for map\r\n  const propertiesWithCoords = useMemo(() => {\r\n    const withCoords = filteredProperties.filter(p => {\r\n      // Check multiple possible locations for lat/lng\r\n      const lat = p.lat || p.address?.latitude || p.location?.coordinates?.[1];\r\n      const lng = p.lng || p.address?.longitude || p.location?.coordinates?.[0];\r\n      return lat && lng && !isNaN(lat) && !isNaN(lng);\r\n    }).map(p => ({\r\n      ...p,\r\n      lat: p.lat || p.address?.latitude || p.location?.coordinates?.[1],\r\n      lng: p.lng || p.address?.longitude || p.location?.coordinates?.[0]\r\n    }));\r\n\r\n    // Debug log\r\n    console.log(`Properties: ${filteredProperties.length} total, ${withCoords.length} with coordinates`);\r\n    if (withCoords.length > 0) {\r\n      console.log('Sample property with coords:', withCoords[0]?.title, withCoords[0]?.lat, withCoords[0]?.lng);\r\n    }\r\n\r\n    return withCoords;\r\n  }, [filteredProperties]);\r\n\r\n  // Filter properties near dropped pin\r\n  const nearbyProperties = useMemo(() => {\r\n    if (!droppedPin) return propertiesWithCoords;\r\n    return propertiesWithCoords.filter(p => {\r\n      const distance = calculateDistance(droppedPin.lat, droppedPin.lng, p.lat, p.lng);\r\n      return distance <= searchRadius;\r\n    }).map(p => ({\r\n      ...p,\r\n      distance: calculateDistance(droppedPin.lat, droppedPin.lng, p.lat, p.lng)\r\n    })).sort((a, b) => a.distance - b.distance);\r\n  }, [propertiesWithCoords, droppedPin, searchRadius]);\r\n\r\n  // Get map center based on properties or default to India center (memoized to avoid re-centering on hover)\r\n  const mapCenter = useMemo(() => {\r\n    if (droppedPin) {\r\n      return [droppedPin.lat, droppedPin.lng];\r\n    }\r\n    if (propertiesWithCoords.length > 0) {\r\n      const avgLat = propertiesWithCoords.reduce((sum, p) => sum + p.lat, 0) / propertiesWithCoords.length;\r\n      const avgLng = propertiesWithCoords.reduce((sum, p) => sum + p.lng, 0) / propertiesWithCoords.length;\r\n      return [avgLat, avgLng];\r\n    }\r\n    return [20.5937, 78.9629]; // India center\r\n  }, [droppedPin, propertiesWithCoords]);\r\n\r\n  // Map click handler component\r\n  const MapClickHandler = () => {\r\n    useMapEvents({\r\n      click: (e) => {\r\n        if (pinDropMode) {\r\n          setDroppedPin({ lat: e.latlng.lat, lng: e.latlng.lng });\r\n          setPinDropMode(false);\r\n        }\r\n      }\r\n    });\r\n    return null;\r\n  };\r\n\r\n  // Component to fit map bounds to markers\r\n  const MapBoundsUpdater = ({ properties }) => {\r\n    const map = useMap();\r\n\r\n    useEffect(() => {\r\n      if (droppedPin) {\r\n        map.setView([droppedPin.lat, droppedPin.lng], 14);\r\n      } else if (properties.length > 0) {\r\n        const bounds = L.latLngBounds(properties.map(p => [p.lat, p.lng]));\r\n        map.fitBounds(bounds, { padding: [50, 50], maxZoom: 14 });\r\n      }\r\n    }, [properties, map, droppedPin]);\r\n\r\n    return null;\r\n  };\r\n\r\n  const viewDetails = (property) =>\r\n    navigate(`/properties/${property._id}`, { state: { property } });\r\n\r\n  // Get auth state from context\r\n  const { isAuthenticated, user } = useAuth();\r\n\r\n  const handleInterest = async (event, propertyId) => {\r\n    event.stopPropagation();\r\n    event.preventDefault();\r\n\r\n    if (!isAuthenticated || !user) {\r\n      toast.info(\"Please login to express interest\");\r\n      const from = `${location.pathname}${location.search}` || `/properties/${propertyId}`;\r\n      navigate(\"/login\", { state: { from, pendingAction: \"interest\", propertyId } });\r\n      return;\r\n    }\r\n\r\n    if (interestedIds.has(propertyId)) {\r\n      // Remove interest\r\n      setInterestLoadingIds((prev) => new Set(prev).add(propertyId));\r\n      try {\r\n        const res = await api.delete(\r\n          `/properties/interested/${propertyId}`\r\n        );\r\n        if (res.data.success) {\r\n          setInterestedIds((prev) => {\r\n            const updated = new Set(prev);\r\n            updated.delete(propertyId);\r\n            return updated;\r\n          });\r\n          toast.success(\"Interest removed\");\r\n        } else {\r\n          toast.error(res.data.message || \"Failed to remove interest\");\r\n        }\r\n      } catch (error) {\r\n        console.error(\"Error removing interest:\", error);\r\n        const errorMsg = error.response?.data?.message || \"Failed to remove interest\";\r\n        toast.error(errorMsg);\r\n      } finally {\r\n        setInterestLoadingIds((prev) => {\r\n          const updated = new Set(prev);\r\n          updated.delete(propertyId);\r\n          return updated;\r\n        });\r\n      }\r\n      return;\r\n    }\r\n\r\n    setInterestLoadingIds((prev) => new Set(prev).add(propertyId));\r\n\r\n    try {\r\n      const res = await api.post(\r\n        `/properties/interested/${propertyId}`,\r\n        {}\r\n      );\r\n\r\n      if (res.data.success) {\r\n        setInterestedIds((prev) => {\r\n          const updated = new Set(prev);\r\n          updated.add(propertyId);\r\n          return updated;\r\n        });\r\n        toast.success(\"Interest registered! The owner will be notified.\");\r\n      } else {\r\n        toast.error(res.data.message || \"Failed to register interest\");\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error registering interest:\", error);\r\n      const errorMsg = error.response?.data?.message || \"Failed to register interest\";\r\n      toast.error(errorMsg);\r\n    } finally {\r\n      setInterestLoadingIds((prev) => {\r\n        const updated = new Set(prev);\r\n        updated.delete(propertyId);\r\n        return updated;\r\n      });\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-slate-50 font-sans text-slate-800 -mt-10 lg:-mt-8\">\r\n\r\n      {/* Filter Bar - Sticky */}\r\n      <div className=\"sticky top-1 lg:-top-2 z-30 bg-white shadow-md border-b border-slate-200 py-4 mb-6 px-6 transition-all\">\r\n        <div className=\"max-w-7xl mx-auto\">\r\n\r\n          {/* Search Bar with Button */}\r\n          <div className=\"flex flex-col lg:flex-row gap-4 items-stretch lg:items-center justify-between mb-4\">\r\n            <div className=\"relative w-full lg:w-2/5 flex gap-2\">\r\n              <div className=\"relative flex-1\">\r\n                <FaSearch className=\"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 z-10\" />\r\n                <input\r\n                  ref={searchInputRef}\r\n                  type=\"text\"\r\n                  placeholder=\"Search project, locality...\"\r\n                  className=\"w-full pl-11 pr-4 py-3 bg-slate-50 border border-slate-200 focus:bg-white focus:border-red-500 rounded-xl outline-none transition-all text-sm\"\r\n                  value={filters.search}\r\n                  onChange={(e) => handleFilterChange(\"search\", e.target.value)}\r\n                  onKeyDown={handleSearchKeyDown}\r\n                  onFocus={() => filters.search?.trim().length >= 2 && suggestions.length > 0 && setShowSuggestions(true)}\r\n                />\r\n\r\n                {/* Autocomplete Suggestions Dropdown */}\r\n                {showSuggestions && suggestions.length > 0 && (\r\n                  <div\r\n                    ref={suggestionsRef}\r\n                    className=\"absolute top-full left-0 right-0 mt-1 bg-white border border-slate-200 rounded-xl shadow-lg z-50 max-h-80 overflow-y-auto\"\r\n                  >\r\n                    {isLoadingSuggestions && (\r\n                      <div className=\"px-4 py-2 text-sm text-slate-400\">Loading...</div>\r\n                    )}\r\n                    {suggestions.map((suggestion, index) => (\r\n                      <div\r\n                        key={`${suggestion.type}-${suggestion.value}`}\r\n                        className={`px-4 py-3 cursor-pointer flex items-center gap-3 transition-colors ${index === selectedIndex ? 'bg-red-50' : 'hover:bg-slate-50'\r\n                          }`}\r\n                        onClick={() => handleSuggestionClick(suggestion)}\r\n                        onMouseEnter={() => setSelectedIndex(index)}\r\n                      >\r\n                        {suggestion.type === 'city' ? (\r\n                          <div className=\"w-10 h-10 rounded-lg bg-gradient-to-br from-orange-400 to-red-500 flex items-center justify-center flex-shrink-0\">\r\n                            <FaMapMarkerAlt className=\"text-white text-lg\" />\r\n                          </div>\r\n                        ) : suggestion.image ? (\r\n                          <img\r\n                            src={suggestion.image}\r\n                            alt=\"\"\r\n                            className=\"w-10 h-10 rounded-lg object-cover flex-shrink-0\"\r\n                            onError={(e) => { e.target.style.display = 'none'; }}\r\n                          />\r\n                        ) : (\r\n                          <div className={`w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0 ${suggestion.type === 'project' ? 'bg-blue-100 text-blue-600' :\r\n                            'bg-green-100 text-green-600'\r\n                            }`}>\r\n                            {suggestion.type === 'project' ? '≡ƒÅá' : '≡ƒôì'}\r\n                          </div>\r\n                        )}\r\n                        <div className=\"flex-1 min-w-0\">\r\n                          <div className=\"text-sm font-medium text-slate-800 truncate\">\r\n                            {suggestion.value}\r\n                          </div>\r\n                          {suggestion.subtitle && suggestion.type !== 'city' && (\r\n                            <div className=\"text-xs text-slate-500 truncate\">{suggestion.subtitle}</div>\r\n                          )}\r\n                        </div>\r\n                        <span className={`text-xs px-2 py-0.5 rounded-full ${suggestion.type === 'project' ? 'bg-blue-50 text-blue-600' :\r\n                          suggestion.type === 'locality' ? 'bg-green-50 text-green-600' :\r\n                            'bg-orange-50 text-orange-600'\r\n                          }`}>\r\n                          {suggestion.type}\r\n                        </span>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                )}\r\n              </div>\r\n              <button\r\n                onClick={() => {\r\n                  handleFilterChange(\"search\", filters.search);\r\n                  setShowSuggestions(false);\r\n                }}\r\n                className=\"px-6 py-3 bg-red-600 text-white rounded-xl hover:bg-red-700 transition-colors font-medium text-sm shadow-sm flex items-center gap-2 whitespace-nowrap\"\r\n              >\r\n                <FaSearch className=\"text-sm\" />\r\n                <span className=\"hidden sm:inline\">Search</span>\r\n              </button>\r\n            </div>\r\n\r\n            {/* Dropdowns Group */}\r\n            <div className=\"flex flex-wrap items-center gap-3\">\r\n\r\n              {/* City Dropdown */}\r\n              <div className=\"relative\">\r\n                <select\r\n                  className=\"appearance-none bg-white border border-slate-200 py-3 pl-4 pr-10 rounded-xl text-sm font-medium hover:border-red-400 focus:outline-none focus:ring-2 focus:ring-red-100 cursor-pointer shadow-sm transition-all\"\r\n                  value={filters.city}\r\n                  onChange={(e) => handleFilterChange(\"city\", e.target.value)}\r\n                >\r\n                  <option value=\"\">All Cities</option>\r\n                  {cities.map(c => <option key={c} value={c}>{c}</option>)}\r\n                </select>\r\n                <FaMapMarkerAlt className=\"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none text-xs\" />\r\n              </div>\r\n\r\n              {/* Type Dropdown */}\r\n              <div className=\"relative\">\r\n                <select\r\n                  className=\"appearance-none bg-white border border-slate-200 py-3 pl-4 pr-10 rounded-xl text-sm font-medium hover:border-red-400 focus:outline-none focus:ring-2 focus:ring-red-100 cursor-pointer shadow-sm transition-all\"\r\n                  value={filters.propertyType}\r\n                  onChange={(e) => handleFilterChange(\"propertyType\", e.target.value)}\r\n                >\r\n                  <option value=\"\">All Types</option>\r\n                  {selectablePropertyTypes.map(pt => (\r\n                    <option key={pt._id} value={pt._id}>{pt.name}</option>\r\n                  ))}\r\n                </select>\r\n                <FaFilter className=\"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none text-xs\" />\r\n              </div>\r\n\r\n              {/* Price Range */}\r\n              <div className=\"relative\">\r\n                <select\r\n                  className=\"appearance-none bg-white border border-slate-200 py-3 pl-4 pr-10 rounded-xl text-sm font-medium hover:border-red-400 focus:outline-none focus:ring-2 focus:ring-red-100 cursor-pointer shadow-sm transition-all\"\r\n                  value={filters.priceRange}\r\n                  onChange={(e) => handleFilterChange(\"priceRange\", e.target.value)}\r\n                >\r\n                  <option value=\"\">Price Range</option>\r\n                  <option value=\"low\">Under Γé╣50 Lac</option>\r\n                  <option value=\"mid\">Γé╣50 Lac - Γé╣1.5 Cr</option>\r\n                  <option value=\"high\">Above Γé╣1.5 Cr</option>\r\n                </select>\r\n                <span className=\"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none text-xs\">Γé╣</span>\r\n              </div>\r\n\r\n              {/* Clear Button */}\r\n              {(filters.search || filters.city || filters.propertyType || filters.priceRange || filters.availableFor) && (\r\n                <button\r\n                  onClick={() => setFilters(initialFilters)}\r\n                  className=\"text-red-600 text-sm font-semibold hover:underline px-3 py-2 hover:bg-red-50 rounded-lg transition-colors\"\r\n                >\r\n                  Reset\r\n                </button>\r\n              )}\r\n\r\n              {/* View Toggle */}\r\n              <div className=\"flex items-center bg-slate-100 rounded-xl p-1 ml-2\">\r\n                <button\r\n                  onClick={() => setViewMode(\"list\")}\r\n                  className={`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all ${viewMode === \"list\"\r\n                    ? \"bg-white text-slate-800 shadow-sm\"\r\n                    : \"text-slate-500 hover:text-slate-700\"\r\n                    }`}\r\n                >\r\n                  <FaList size={14} />\r\n                  <span className=\"hidden sm:inline\">List</span>\r\n                </button>\r\n                <button\r\n                  onClick={() => setViewMode(\"map\")}\r\n                  className={`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all ${viewMode === \"map\"\r\n                    ? \"bg-white text-slate-800 shadow-sm\"\r\n                    : \"text-slate-500 hover:text-slate-700\"\r\n                    }`}\r\n                >\r\n                  <FaMap size={14} />\r\n                  <span className=\"hidden sm:inline\">Map</span>\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Content Grid */}\r\n      <main className={viewMode === \"map\" ? \"h-[calc(100vh-180px)]\" : \"max-w-7xl mx-auto px-6 py-8\"}>\r\n        {viewMode === \"list\" && (\r\n          <>\r\n            <div className=\"mb-4 flex flex-col sm:flex-row sm:items-end sm:justify-between gap-3\">\r\n              <div>\r\n                <h1 className=\"text-2xl font-bold text-slate-900\">Real Estate Listings</h1>\r\n                <p className=\"text-slate-500 text-sm mt-1\">\r\n                  {loading\r\n                    ? \"Searching the best options for you...\"\r\n                    : `Showing ${filteredProperties.length} of ${properties.length} properties`}\r\n                </p>\r\n              </div>\r\n              {!loading && filteredProperties.length > 0 && (\r\n                <div className=\"flex flex-col items-end gap-2 text-[11px] text-slate-600\">\r\n                  <div className=\"flex flex-wrap justify-end gap-2\">\r\n                    {filters.city && (\r\n                      <span className=\"px-2.5 py-1 rounded-full bg-slate-100 border border-slate-200\">\r\n                        City: <span className=\"font-semibold\">{filters.city}</span>\r\n                      </span>\r\n                    )}\r\n                    {filters.propertyType && (\r\n                      <span className=\"px-2.5 py-1 rounded-full bg-slate-100 border border-slate-200\">\r\n                        Type: {\" \"}\r\n                        <span className=\"font-semibold\">\r\n                          {propertyTypes.find(pt => String(pt._id) === String(filters.propertyType))?.name || \"Selected type\"}\r\n                        </span>\r\n                      </span>\r\n                    )}\r\n                    {filters.availableFor && (\r\n                      <span className=\"px-2.5 py-1 rounded-full bg-slate-100 border border-slate-200\">\r\n                        For: <span className=\"font-semibold\">{filters.availableFor}</span>\r\n                      </span>\r\n                    )}\r\n                    {filters.priceRange && (\r\n                      <span className=\"px-2.5 py-1 rounded-full bg-slate-100 border border-slate-200\">\r\n                        Budget: <span className=\"font-semibold\">{filters.priceRange}</span>\r\n                      </span>\r\n                    )}\r\n                    {filters.search && (\r\n                      <span className=\"px-2.5 py-1 rounded-full bg-slate-100 border border-slate-200 max-w-[180px] truncate\">\r\n                        Search: <span className=\"font-semibold\">{filters.search}</span>\r\n                      </span>\r\n                    )}\r\n                  </div>\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <button\r\n                      type=\"button\"\r\n                      onClick={handleSaveSearchClick}\r\n                      className=\"inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-white border border-red-200 text-[11px] font-semibold text-red-600 hover:bg-red-50 shadow-sm\"\r\n                    >\r\n                      <FaBell className=\"text-xs\" />\r\n                      Save this search & alerts\r\n                    </button>\r\n                    <span className=\"hidden sm:inline-flex items-center px-2 py-0.5 rounded-full bg-emerald-50 border border-emerald-100 text-[10px] font-semibold text-emerald-700\">\r\n                      Free during beta\r\n                    </span>\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            {showSaveSearch && (\r\n              <div className=\"mb-6 max-w-xl ml-auto bg-white border border-red-100 rounded-2xl shadow-sm p-4 flex flex-col sm:flex-row sm:items-center gap-3\">\r\n                <div className=\"flex-1\">\r\n                  <p className=\"text-xs font-semibold text-slate-700 mb-1\">Save this search (with alerts)</p>\r\n                  <input\r\n                    type=\"text\"\r\n                    value={savedSearchName}\r\n                    onChange={(e) => setSavedSearchName(e.target.value)}\r\n                    placeholder=\"Name this search (e.g. Bangalore rentals under 50L)\"\r\n                    className=\"w-full text-xs sm:text-sm px-3 py-2 rounded-lg border border-slate-200 focus:outline-none focus:ring-1 focus:ring-red-400 focus:border-red-400\"\r\n                  />\r\n                  <label className=\"mt-2 inline-flex items-center gap-2 text-[11px] text-slate-600\">\r\n                    <input\r\n                      type=\"checkbox\"\r\n                      checked={notifyByEmail}\r\n                      onChange={(e) => setNotifyByEmail(e.target.checked)}\r\n                      className=\"w-3 h-3 rounded border-slate-300 text-red-600 focus:ring-red-500\"\r\n                    />\r\n                    Email me when new properties match this search\r\n                  </label>\r\n                  <p className=\"mt-1 text-[10px] text-slate-500\">\r\n                    Alerts are currently free as part of our Premium Tools beta and may later move into a small paid\r\n                    add-on. We&apos;ll always show clear pricing before that.\r\n                  </p>\r\n                </div>\r\n                <div className=\"flex sm:flex-col gap-2 sm:items-end\">\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={handleConfirmSaveSearch}\r\n                    disabled={savingSearch}\r\n                    className=\"px-3 py-1.5 rounded-full bg-red-600 text-white text-[11px] font-semibold hover:bg-red-700 disabled:opacity-60\"\r\n                  >\r\n                    {savingSearch ? \"Saving...\" : \"Save search\"}\r\n                  </button>\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => setShowSaveSearch(false)}\r\n                    disabled={savingSearch}\r\n                    className=\"px-3 py-1.5 rounded-full bg-slate-100 text-slate-600 text-[11px] font-semibold hover:bg-slate-200 disabled:opacity-60\"\r\n                  >\r\n                    Cancel\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            )}\r\n          </>\r\n        )}\r\n\r\n        {loading ? (\r\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8\">\r\n            {[1, 2, 3, 4, 5, 6].map((n) => <SkeletonCard key={n} />)}\r\n          </div>\r\n        ) : filteredProperties.length === 0 ? (\r\n          <div className=\"text-center py-24 bg-white rounded-3xl border border-dashed border-slate-300\">\r\n            <div className=\"bg-slate-50 w-24 h-24 rounded-full flex items-center justify-center mx-auto mb-6\">\r\n              <FaMapMarkerAlt className=\"text-4xl text-slate-400\" />\r\n            </div>\r\n            <h3 className=\"text-2xl font-bold text-slate-700 mb-2\">No Properties Listed</h3>\r\n            <p className=\"text-slate-500 max-w-md mx-auto mb-6\">\r\n              We couldn't find any properties matching your search criteria. Try adjusting your filters or search for a different location.\r\n            </p>\r\n            <div className=\"flex flex-wrap gap-3 justify-center\">\r\n              <button\r\n                onClick={() => setFilters(initialFilters)}\r\n                className=\"bg-slate-900 text-white px-6 py-3 rounded-full text-sm font-semibold hover:bg-red-600 transition-colors\"\r\n              >\r\n                Clear All Filters\r\n              </button>\r\n              <button\r\n                onClick={() => navigate(\"/\")}\r\n                className=\"bg-slate-100 text-slate-700 px-6 py-3 rounded-full text-sm font-semibold hover:bg-slate-200 transition-colors\"\r\n              >\r\n                Back to Home\r\n              </button>\r\n            </div>\r\n          </div>\r\n        ) : viewMode === \"map\" ? (\r\n          /* Map View */\r\n          <div className=\"flex h-full\">\r\n            {/* Property List Sidebar */}\r\n            <div className=\"w-96 h-full overflow-y-auto bg-white border-r border-slate-200 hidden lg:block\">\r\n              <div className=\"p-4 border-b border-slate-100 sticky top-0 bg-white z-10\">\r\n                {droppedPin ? (\r\n                  <div>\r\n                    <h2 className=\"font-bold text-green-600\">\r\n                      ≡ƒÄ» {nearbyProperties.length} Nearby Properties\r\n                    </h2>\r\n                    <p className=\"text-xs text-slate-500 mt-1\">Within {searchRadius} km of pin</p>\r\n                  </div>\r\n                ) : (\r\n                  <h2 className=\"font-bold text-slate-800\">{filteredProperties.length} Properties</h2>\r\n                )}\r\n              </div>\r\n              <div className=\"divide-y divide-slate-100\">\r\n                {(droppedPin ? nearbyProperties : filteredProperties).map((p) => (\r\n                  <div\r\n                    key={p._id}\r\n                    onClick={() => viewDetails(p)}\r\n                    onMouseEnter={() => setHoveredProperty(p._id)}\r\n                    onMouseLeave={() => setHoveredProperty(null)}\r\n                    className={`p-4 cursor-pointer transition-colors ${hoveredProperty === p._id ? \"bg-red-50\" : \"hover:bg-slate-50\"\r\n                      }`}\r\n                  >\r\n                    <div className=\"flex gap-3\">\r\n                      <img\r\n                        src={resolveImageSrc(p.images?.[0]) || FALLBACK_IMG}\r\n                        alt={p.title}\r\n                        className=\"w-24 h-20 object-cover rounded-lg flex-shrink-0\"\r\n                        onError={(e) => { e.target.onerror = null; e.target.src = FALLBACK_IMG; }}\r\n                      />\r\n                      <div className=\"flex-1 min-w-0\">\r\n                        <h3 className=\"font-semibold text-slate-800 text-sm line-clamp-1\">{p.title}</h3>\r\n                        <p className=\"text-slate-500 text-xs flex items-center gap-1 mt-1\">\r\n                          <FaMapMarkerAlt className=\"text-red-500\" size={10} />\r\n                          {p.address?.city}, {p.address?.state}\r\n                        </p>\r\n                        {p.distance !== undefined && (\r\n                          <p className=\"text-green-600 text-xs font-medium mt-1\">\r\n                            ≡ƒôì {p.distance.toFixed(1)} km away\r\n                          </p>\r\n                        )}\r\n                        <p className=\"text-red-600 font-bold mt-2\">\r\n                          Γé╣{p.price?.toLocaleString()}\r\n                        </p>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Map Container */}\r\n            <div className=\"flex-1 h-full relative\">\r\n              {/* Pin Drop Controls */}\r\n              <div className=\"absolute top-4 right-4 z-[40] flex flex-col gap-2\">\r\n                <button\r\n                  onClick={() => {\r\n                    if (droppedPin) {\r\n                      setDroppedPin(null);\r\n                      setPinDropMode(false);\r\n                    } else {\r\n                      setPinDropMode(!pinDropMode);\r\n                    }\r\n                  }}\r\n                  className={`flex items-center gap-2 px-4 py-2 rounded-lg shadow-lg font-medium text-sm transition-all ${pinDropMode\r\n                    ? 'bg-green-600 text-white animate-pulse'\r\n                    : droppedPin\r\n                      ? 'bg-red-100 text-red-600 hover:bg-red-200'\r\n                      : 'bg-white text-slate-700 hover:bg-slate-50'\r\n                    }`}\r\n                >\r\n                  {droppedPin ? (\r\n                    <>\r\n                      <FaTimes /> Clear Pin\r\n                    </>\r\n                  ) : pinDropMode ? (\r\n                    <>\r\n                      <FaCrosshairs className=\"animate-ping\" /> Click on map...\r\n                    </>\r\n                  ) : (\r\n                    <>\r\n                      <FaCrosshairs /> Drop Pin\r\n                    </>\r\n                  )}\r\n                </button>\r\n\r\n                {/* Radius Selector */}\r\n                {droppedPin && (\r\n                  <div className=\"bg-white rounded-lg shadow-lg p-3\">\r\n                    <label className=\"text-xs text-slate-600 font-medium block mb-2\">\r\n                      Search Radius: {searchRadius} km\r\n                    </label>\r\n                    <input\r\n                      type=\"range\"\r\n                      min=\"0.5\"\r\n                      max=\"10\"\r\n                      step=\"0.5\"\r\n                      value={searchRadius}\r\n                      onChange={(e) => setSearchRadius(parseFloat(e.target.value))}\r\n                      className=\"w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-red-600\"\r\n                    />\r\n                    <div className=\"flex justify-between text-xs text-slate-400 mt-1\">\r\n                      <span>0.5 km</span>\r\n                      <span>10 km</span>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              <MapContainer\r\n                center={mapCenter}\r\n                zoom={11}\r\n                className={`w-full h-full z-0 ${pinDropMode ? 'cursor-crosshair' : ''}`}\r\n                scrollWheelZoom={true}\r\n              >\r\n                <TileLayer\r\n                  attribution='&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a>'\r\n                  url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\r\n                />\r\n                <MapClickHandler />\r\n                <MapBoundsUpdater properties={droppedPin ? nearbyProperties : propertiesWithCoords} />\r\n\r\n                {/* No Properties Message */}\r\n                {propertiesWithCoords.length === 0 && !droppedPin && (\r\n                  <div className=\"leaflet-control absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-[40]\">\r\n                    <div className=\"bg-white rounded-xl shadow-lg p-6 text-center max-w-sm\">\r\n                      <div className=\"text-4xl mb-3\">≡ƒôì</div>\r\n                      <h3 className=\"font-bold text-slate-800 mb-2\">No Location Data</h3>\r\n                      <p className=\"text-sm text-slate-500\">\r\n                        Properties don't have latitude/longitude coordinates saved in the database.\r\n                      </p>\r\n                      <p className=\"text-xs text-slate-400 mt-2\">\r\n                        Add coordinates when creating properties to see them on the map.\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n\r\n                {/* Dropped Pin and Search Radius Circle */}\r\n                {droppedPin && (\r\n                  <>\r\n                    <Marker position={[droppedPin.lat, droppedPin.lng]} icon={pinDropIcon}>\r\n                      <Popup>\r\n                        <div className=\"text-center p-2\">\r\n                          <p className=\"font-bold text-green-600\">≡ƒôì Your Pin</p>\r\n                          <p className=\"text-xs text-slate-500 mt-1\">\r\n                            {nearbyProperties.length} properties within {searchRadius} km\r\n                          </p>\r\n                        </div>\r\n                      </Popup>\r\n                    </Marker>\r\n                    <Circle\r\n                      center={[droppedPin.lat, droppedPin.lng]}\r\n                      radius={searchRadius * 1000}\r\n                      pathOptions={{\r\n                        color: '#22c55e',\r\n                        fillColor: '#22c55e',\r\n                        fillOpacity: 0.1,\r\n                        weight: 2\r\n                      }}\r\n                    />\r\n                  </>\r\n                )}\r\n\r\n                {/* Property Markers */}\r\n                {(droppedPin ? nearbyProperties : propertiesWithCoords).map((p) => (\r\n                  <Marker\r\n                    key={p._id}\r\n                    position={[p.lat, p.lng]}\r\n                    icon={hoveredProperty === p._id ? createDetailedPropertyMarker(p) : createSimplePinMarker(p.price, false)}\r\n                    zIndexOffset={hoveredProperty === p._id ? 1000 : 0}\r\n                    eventHandlers={{\r\n                      click: () => viewDetails(p),\r\n                      mouseover: () => setHoveredProperty(p._id),\r\n                      mouseout: () => setHoveredProperty(null)\r\n                    }}\r\n                  >\r\n                    <Popup>\r\n                      <div className=\"min-w-[220px]\">\r\n                        <img\r\n                          src={resolveImageSrc(p.images?.[0]) || FALLBACK_IMG}\r\n                          alt={p.title}\r\n                          className=\"w-full h-32 object-cover rounded-lg mb-2\"\r\n                          onError={(e) => { e.target.onerror = null; e.target.src = FALLBACK_IMG; }}\r\n                        />\r\n                        <h3 className=\"font-bold text-slate-800 text-sm line-clamp-2\">{p.title}</h3>\r\n                        <p className=\"text-slate-500 text-xs mt-1 flex items-center gap-1\">\r\n                          <span>≡ƒôì</span> {p.address?.city}, {p.address?.locality || p.address?.state}\r\n                        </p>\r\n                        {p.distance !== undefined && (\r\n                          <p className=\"text-green-600 text-xs font-medium mt-1\">\r\n                            ≡ƒÄ» {p.distance.toFixed(1)} km from your pin\r\n                          </p>\r\n                        )}\r\n                        <div className=\"flex items-center justify-between mt-2\">\r\n                          <p className=\"text-red-600 font-bold text-lg\">Γé╣{p.price?.toLocaleString()}</p>\r\n                          {p.area?.superBuiltUp && (\r\n                            <p className=\"text-slate-500 text-xs\">{p.area.superBuiltUp} sq.ft</p>\r\n                          )}\r\n                        </div>\r\n                        <button\r\n                          onClick={() => viewDetails(p)}\r\n                          className=\"w-full mt-3 bg-red-600 text-white py-2.5 rounded-lg text-sm font-semibold hover:bg-red-700 transition-colors\"\r\n                        >\r\n                          View Details\r\n                        </button>\r\n                      </div>\r\n                    </Popup>\r\n                  </Marker>\r\n                ))}\r\n              </MapContainer>\r\n\r\n              {/* Map Legend */}\r\n              <div className=\"absolute bottom-4 left-4 bg-white rounded-lg shadow-lg p-3 z-[40]\">\r\n                {droppedPin ? (\r\n                  <>\r\n                    <p className=\"text-xs text-green-600 font-medium\">\r\n                      ≡ƒÄ» {nearbyProperties.length} properties within {searchRadius} km\r\n                    </p>\r\n                    <p className=\"text-xs text-slate-400 mt-1\">\r\n                      Drag radius slider to adjust\r\n                    </p>\r\n                  </>\r\n                ) : (\r\n                  <>\r\n                    <p className=\"text-xs text-slate-600 font-medium\">\r\n                      ≡ƒôì {propertiesWithCoords.length} properties on map\r\n                    </p>\r\n                    {filteredProperties.length - propertiesWithCoords.length > 0 && (\r\n                      <p className=\"text-xs text-slate-400 mt-1\">\r\n                        {filteredProperties.length - propertiesWithCoords.length} without location\r\n                      </p>\r\n                    )}\r\n                  </>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        ) : (\r\n          /* List View */\r\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8\">\r\n            {filteredProperties.map((p) => (\r\n              <div\r\n                key={p._id}\r\n                onClick={() => viewDetails(p)}\r\n                className=\"group bg-white rounded-2xl border border-slate-100 shadow-sm hover:shadow-xl hover:-translate-y-1 transition-all duration-300 overflow-hidden cursor-pointer\"\r\n              >\r\n                <div className=\"relative h-64 overflow-hidden\">\r\n                  <div className=\"absolute top-3 left-3 z-10\">\r\n                    <span className=\"bg-white/95 backdrop-blur-sm text-slate-800 text-xs font-bold px-3 py-1 rounded-md shadow-sm\">\r\n                      {formatCategoryDisplay(p.category?.name || p.categoryName || p.category || p.propertyCategory || \"For Sale\")}\r\n                    </span>\r\n                  </div>\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={(e) => handleInterest(e, p._id)}\r\n                    disabled={interestLoadingIds.has(p._id)}\r\n                    className={`absolute top-3 right-3 z-10 p-2 backdrop-blur-sm rounded-full transition-colors ${interestedIds.has(p._id)\r\n                      ? \"bg-red-600 text-white\"\r\n                      : \"bg-black/20 text-white hover:bg-red-500\"}${interestLoadingIds.has(p._id) ? \" opacity-70 cursor-not-allowed\" : \"\"}`}\r\n                    aria-label={interestedIds.has(p._id) ? \"Interest registered\" : \"I'm interested\"}\r\n                  >\r\n                    {interestedIds.has(p._id) ? <FaHeart /> : <FaRegHeart />}\r\n                  </button>\r\n                  <img\r\n                    src={resolveImageSrc(p.images?.[0]) || FALLBACK_IMG}\r\n                    alt={p.title}\r\n                    className=\"w-full h-full object-cover group-hover:scale-110 transition-transform duration-700\"\r\n                    onError={(e) => { e.target.onerror = null; e.target.src = FALLBACK_IMG; }}\r\n                  />\r\n                  <div className=\"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-60 group-hover:opacity-40 transition-opacity\" />\r\n                  <div className=\"absolute bottom-4 left-4 text-white\">\r\n                    <p className=\"text-2xl font-bold drop-shadow-md\">\r\n                      Γé╣{p.price?.toLocaleString()} <span className=\"text-sm font-normal opacity-90\">{p.priceUnit}</span>\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n                <div className=\"p-5\">\r\n                  <div className=\"flex items-start justify-between gap-2 mb-2\">\r\n                    <h3 className=\"text-lg font-bold text-slate-800 line-clamp-1 group-hover:text-red-600 transition-colors\">\r\n                      {p.title}\r\n                    </h3>\r\n                  </div>\r\n                  <p className=\"text-slate-500 text-sm flex items-center gap-1 mb-4 line-clamp-1\">\r\n                    <FaMapMarkerAlt className=\"text-red-500 flex-shrink-0\" />\r\n                    {p.address?.city}, {p.address?.state}\r\n                  </p>\r\n                  <div className=\"flex items-center gap-4 border-t border-slate-100 pt-4 text-slate-600 text-sm font-medium\">\r\n                    {(() => {\r\n                      const { isResidential, isCommercial, propertyTypeName } = getTypeFlags(p);\r\n                      const builtUp = p.area?.builtUpSqft || p.size;\r\n                      const sizeUnit = p.sizeUnit || \"sqft\";\r\n\r\n                      if (isResidential) {\r\n                        const beds = p.bedrooms || p.bhk;\r\n                        const baths = p.bathrooms;\r\n\r\n                        return (\r\n                          <>\r\n                            {beds && (\r\n                              <div className=\"flex items-center gap-1.5\">\r\n                                <FaBed className=\"text-slate-400\" />\r\n                                <span>{beds} Beds</span>\r\n                              </div>\r\n                            )}\r\n                            {baths && (\r\n                              <div className=\"flex items-center gap-1.5\">\r\n                                <FaBath className=\"text-slate-400\" />\r\n                                <span>{baths} Baths</span>\r\n                              </div>\r\n                            )}\r\n                            {builtUp && (\r\n                              <div className=\"flex items-center gap-1.5\">\r\n                                <FaRulerCombined className=\"text-slate-400\" />\r\n                                <span>\r\n                                  {builtUp} {sizeUnit}\r\n                                </span>\r\n                              </div>\r\n                            )}\r\n                          </>\r\n                        );\r\n                      }\r\n\r\n                      if (isCommercial) {\r\n                        const seating = p.seatingCapacity || p.workstations;\r\n\r\n                        return (\r\n                          <>\r\n                            <div className=\"flex items-center gap-1.5\">\r\n                              <FaBuilding className=\"text-slate-400\" />\r\n                              <span className=\"truncate max-w-[120px]\">\r\n                                {propertyTypeName || \"Commercial\"}\r\n                              </span>\r\n                            </div>\r\n                            {seating && (\r\n                              <div className=\"flex items-center gap-1.5\">\r\n                                <FaUsers className=\"text-slate-400\" />\r\n                                <span>{seating} Seats</span>\r\n                              </div>\r\n                            )}\r\n                            {builtUp && (\r\n                              <div className=\"flex items-center gap-1.5\">\r\n                                <FaRulerCombined className=\"text-slate-400\" />\r\n                                <span>\r\n                                  {builtUp} {sizeUnit}\r\n                                </span>\r\n                              </div>\r\n                            )}\r\n                          </>\r\n                        );\r\n                      }\r\n\r\n                      // Fallback: just show area if available\r\n                      return (\r\n                        <>\r\n                          {builtUp && (\r\n                            <div className=\"flex items-center gap-1.5\">\r\n                              <FaRulerCombined className=\"text-slate-400\" />\r\n                              <span>\r\n                                {builtUp} {sizeUnit}\r\n                              </span>\r\n                            </div>\r\n                          )}\r\n                        </>\r\n                      );\r\n                    })()}\r\n                  </div>\r\n                  <div className=\"mt-3 flex items-center justify-between gap-3\">\r\n                    <button\r\n                      type=\"button\"\r\n                      onClick={(e) => toggleCompare(e, p)}\r\n                      className={`px-3 py-1.5 rounded-full text-xs font-semibold border transition-colors whitespace-nowrap ${compareIds.includes(p._id)\r\n                        ? \"bg-slate-900 text-white border-slate-900\"\r\n                        : \"bg-white text-slate-700 border-slate-300 hover:border-slate-500\"}\r\n                      `}\r\n                    >\r\n                      {compareIds.includes(p._id) ? \"Added to Compare\" : \"Compare\"}\r\n                    </button>\r\n                    <span className=\"text-[11px] text-slate-400 hidden sm:inline\">\r\n                      Click card for full details\r\n                    </span>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        )}\r\n      </main>\r\n\r\n      {/* Sticky Compare Bar */}\r\n      {viewMode === \"list\" && compareIds.length > 0 && (\r\n        <div className=\"fixed inset-x-0 bottom-0 z-40 px-3 pb-3 sm:px-4 sm:pb-4 pointer-events-none\">\r\n          <div className=\"pointer-events-auto max-w-7xl mx-auto bg-white border border-slate-200 shadow-2xl rounded-2xl px-3 py-3 sm:px-4 sm:py-3 flex flex-col sm:flex-row sm:items-center gap-3\">\r\n            <div className=\"flex-1 min-w-0\">\r\n              <p className=\"text-xs sm:text-sm font-semibold text-slate-900\">\r\n                {compareIds.length} {compareIds.length === 1 ? \"property\" : \"properties\"} selected for comparison\r\n              </p>\r\n              <div className=\"mt-2 flex items-center gap-2 overflow-x-auto\">\r\n                {selectedCompareProperties.map((p) => (\r\n                  <button\r\n                    key={p._id}\r\n                    type=\"button\"\r\n                    onClick={(e) => toggleCompare(e, p)}\r\n                    className=\"flex items-center gap-2 px-2 py-1 rounded-full border border-slate-200 bg-slate-50 text-[11px] sm:text-xs whitespace-nowrap hover:bg-red-50\"\r\n                  >\r\n                    <img\r\n                      src={resolveImageSrc(p.images?.[0]) || FALLBACK_IMG}\r\n                      alt={p.title}\r\n                      className=\"w-7 h-7 rounded-full object-cover flex-shrink-0\"\r\n                      onError={(e) => { e.target.onerror = null; e.target.src = FALLBACK_IMG; }}\r\n                    />\r\n                    <span className=\"max-w-[120px] sm:max-w-[180px] truncate\">{p.title}</span>\r\n                    <span className=\"text-[9px] text-slate-400\">Γ£ò</span>\r\n                  </button>\r\n                ))}\r\n              </div>\r\n            </div>\r\n            <div className=\"flex items-center gap-2 sm:gap-3\">\r\n              <button\r\n                type=\"button\"\r\n                onClick={clearCompare}\r\n                className=\"px-3 py-2 rounded-xl border border-slate-200 text-[11px] sm:text-xs font-medium text-slate-600 hover:bg-slate-50\"\r\n              >\r\n                Clear\r\n              </button>\r\n              <button\r\n                type=\"button\"\r\n                onClick={() => {\r\n                  if (selectedCompareProperties.length < 2) {\r\n                    toast.info(\"Select at least 2 properties to compare.\");\r\n                    return;\r\n                  }\r\n                  setShowCompareModal(true);\r\n                }}\r\n                disabled={selectedCompareProperties.length < 2}\r\n                className=\"px-4 py-2 rounded-xl bg-red-600 text-white text-xs sm:text-sm font-semibold hover:bg-red-700 transition-colors disabled:opacity-60 disabled:cursor-not-allowed\"\r\n              >\r\n                Compare Now\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Compare Modal */}\r\n      {viewMode === \"list\" && showCompareModal && selectedCompareProperties.length >= 2 && (\r\n        <div className=\"fixed inset-0 z-[10000] flex items-center justify-center bg-black/60 backdrop-blur-sm px-3 sm:px-6 py-6\">\r\n          <div className=\"bg-white rounded-2xl shadow-2xl w-full max-w-6xl max-h-[90vh] flex flex-col overflow-hidden\">\r\n            <div className=\"flex items-center justify-between px-4 sm:px-6 py-3 border-b border-slate-100\">\r\n              <div>\r\n                <h2 className=\"text-base sm:text-lg font-semibold text-slate-900\">Compare Properties</h2>\r\n                <p className=\"text-xs sm:text-sm text-slate-500\">Side-by-side comparison of key details</p>\r\n              </div>\r\n              <div className=\"flex items-center gap-2\">\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={() => { setShowCompareModal(false); clearCompare(); }}\r\n                  className=\"hidden sm:inline-flex text-xs text-slate-500 hover:text-slate-800\"\r\n                >\r\n                  Close\r\n                </button>\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={() => setShowCompareModal(false)}\r\n                  className=\"w-8 h-8 flex items-center justify-center rounded-full bg-slate-100 hover:bg-slate-200 text-slate-600 text-sm\"\r\n                  aria-label=\"Close comparison\"\r\n                >\r\n                  Γ£ò\r\n                </button>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"flex-1 overflow-auto\">\r\n              <div className=\"min-w-[640px]\">\r\n                <div\r\n                  className=\"grid text-xs sm:text-sm\"\r\n                  style={{ gridTemplateColumns: `140px repeat(${selectedCompareProperties.length}, minmax(180px, 1fr))` }}\r\n                >\r\n                  {/* Header row with property cards */}\r\n                  <div className=\"bg-slate-50 border-b border-slate-200 p-3\"></div>\r\n                  {selectedCompareProperties.map((p) => (\r\n                    <div key={p._id} className=\"bg-slate-50 border-b border-slate-200 p-3\">\r\n                      <div className=\"flex flex-col sm:flex-row sm:items-center gap-3\">\r\n                        <img\r\n                          src={resolveImageSrc(p.images?.[0]) || FALLBACK_IMG}\r\n                          alt={p.title}\r\n                          className=\"w-full sm:w-24 h-24 object-cover rounded-xl border border-slate-200 flex-shrink-0\"\r\n                          onError={(e) => { e.target.onerror = null; e.target.src = FALLBACK_IMG; }}\r\n                        />\r\n                        <div className=\"flex-1 min-w-0\">\r\n                          <p className=\"text-sm font-semibold text-slate-900 truncate mb-1\">{p.title}</p>\r\n                          <p className=\"text-[11px] text-slate-500 flex items-center gap-1 truncate\">\r\n                            <FaMapMarkerAlt className=\"text-red-500 flex-shrink-0\" />\r\n                            {p.address?.city}{p.address?.state ? `, ${p.address.state}` : \"\"}\r\n                          </p>\r\n                          <p className=\"mt-1 text-sm font-bold text-red-600\">\r\n                            Γé╣{p.price?.toLocaleString()} <span className=\"text-[11px] font-normal text-slate-500\">{p.priceUnit}</span>\r\n                          </p>\r\n                          <p className=\"mt-0.5 text-[11px] text-slate-500 uppercase tracking-wide\">\r\n                            {p.listingType || \"Listing\"}\r\n                          </p>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n\r\n                  {/* Spec rows customised by property type */}\r\n                  {(() => {\r\n                    const base = selectedCompareProperties[0];\r\n                    const baseTypeLabel = getPropertyTypeLabel(base).toLowerCase();\r\n\r\n                    const isResidentialType = /apartment|flat|villa|house|studio|row house|farm house|penthouse|independent/i.test(baseTypeLabel);\r\n                    const isCommercialType = /office|shop|showroom|restaurant|cafe|warehouse|industrial|coworking|co-working|commercial/i.test(baseTypeLabel);\r\n\r\n                    let rows;\r\n\r\n                    if (isResidentialType) {\r\n                      rows = [\r\n                        {\r\n                          label: \"BHK / Bedrooms\",\r\n                          value: (p) => p.bhk || (p.bedrooms ? `${p.bedrooms} BHK` : \"ΓÇô\"),\r\n                        },\r\n                        {\r\n                          label: \"Bathrooms\",\r\n                          value: (p) => p.bathrooms || \"ΓÇô\",\r\n                        },\r\n                        {\r\n                          label: \"Built-up Area\",\r\n                          value: (p) =>\r\n                            p.area?.builtUpSqft\r\n                              ? `${p.area.builtUpSqft} sq.ft`\r\n                              : p.size\r\n                                ? `${p.size} ${p.sizeUnit || \"sq.ft\"}`\r\n                                : \"ΓÇô\",\r\n                        },\r\n                        {\r\n                          label: \"Furnishing\",\r\n                          value: (p) => p.furnishing || \"ΓÇô\",\r\n                        },\r\n                        {\r\n                          label: \"Construction Status\",\r\n                          value: (p) => p.constructionStatus || p.propertyAge || p.ageOfProperty || \"ΓÇô\",\r\n                        },\r\n                        {\r\n                          label: \"Facing\",\r\n                          value: (p) => p.facing || \"ΓÇô\",\r\n                        },\r\n                        {\r\n                          label: \"Parking\",\r\n                          value: (p) => {\r\n                            if (!p.parking) return \"ΓÇô\";\r\n                            const parts = [];\r\n                            if (p.parking.covered) parts.push(`Covered: ${p.parking.covered}`);\r\n                            if (p.parking.open) parts.push(`Open: ${p.parking.open}`);\r\n                            return parts.join(\" | \") || \"ΓÇô\";\r\n                          },\r\n                        },\r\n                        {\r\n                          label: \"Amenities\",\r\n                          value: (p) => {\r\n                            if (!Array.isArray(p.amenities) || !p.amenities.length) return \"ΓÇô\";\r\n                            const shown = p.amenities.slice(0, 3).join(\", \");\r\n                            const extra = p.amenities.length > 3 ? ` +${p.amenities.length - 3} more` : \"\";\r\n                            return shown + extra;\r\n                          },\r\n                        },\r\n                        {\r\n                          label: \"Status\",\r\n                          value: (p) => p.status || \"Active\",\r\n                        },\r\n                      ];\r\n                    } else if (isCommercialType) {\r\n                      rows = [\r\n                        {\r\n                          label: \"Configuration\",\r\n                          value: (p) => p.commercialSubType || getPropertyTypeLabel(p),\r\n                        },\r\n                        {\r\n                          label: \"Built-up Area\",\r\n                          value: (p) =>\r\n                            p.area?.builtUpSqft\r\n                              ? `${p.area.builtUpSqft} sq.ft`\r\n                              : p.size\r\n                                ? `${p.size} ${p.sizeUnit || \"sq.ft\"}`\r\n                                : \"ΓÇô\",\r\n                        },\r\n                        {\r\n                          label: \"Floor / Level\",\r\n                          value: (p) => p.floorNo || p.floorHeight || \"ΓÇô\",\r\n                        },\r\n                        {\r\n                          label: \"Seating / Workstations\",\r\n                          value: (p) => p.seatingCapacity || p.workstations || \"ΓÇô\",\r\n                        },\r\n                        {\r\n                          label: \"Pantry / Kitchen\",\r\n                          value: (p) => p.pantry || p.kitchenArea || \"ΓÇô\",\r\n                        },\r\n                        {\r\n                          label: \"Frontage / Visibility\",\r\n                          value: (p) => p.frontage || p.displayArea || \"ΓÇô\",\r\n                        },\r\n                        {\r\n                          label: \"Parking\",\r\n                          value: (p) => {\r\n                            if (!p.parking) return \"ΓÇô\";\r\n                            const parts = [];\r\n                            if (p.parking.covered) parts.push(`Covered: ${p.parking.covered}`);\r\n                            if (p.parking.open) parts.push(`Open: ${p.parking.open}`);\r\n                            return parts.join(\" | \") || \"ΓÇô\";\r\n                          },\r\n                        },\r\n                        {\r\n                          label: \"Power & AC\",\r\n                          value: (p) => {\r\n                            const parts = [];\r\n                            if (p.powerLoad) parts.push(`Load: ${p.powerLoad}`);\r\n                            if (p.powerBackup) parts.push(p.powerBackup);\r\n                            if (p.centralAC) parts.push(p.centralAC);\r\n                            return parts.join(\" | \") || \"ΓÇô\";\r\n                          },\r\n                        },\r\n                        {\r\n                          label: \"Amenities\",\r\n                          value: (p) => {\r\n                            if (!Array.isArray(p.amenities) || !p.amenities.length) return \"ΓÇô\";\r\n                            const shown = p.amenities.slice(0, 3).join(\", \");\r\n                            const extra = p.amenities.length > 3 ? ` +${p.amenities.length - 3} more` : \"\";\r\n                            return shown + extra;\r\n                          },\r\n                        },\r\n                        {\r\n                          label: \"Status\",\r\n                          value: (p) => p.status || \"Active\",\r\n                        },\r\n                      ];\r\n                    } else {\r\n                      // Fallback generic rows\r\n                      rows = [\r\n                        {\r\n                          label: \"Key Details\",\r\n                          value: (p) => getPropertyTypeLabel(p),\r\n                        },\r\n                        {\r\n                          label: \"Area\",\r\n                          value: (p) =>\r\n                            p.area?.builtUpSqft\r\n                              ? `${p.area.builtUpSqft} sq.ft`\r\n                              : p.size\r\n                                ? `${p.size} ${p.sizeUnit || \"sq.ft\"}`\r\n                                : \"ΓÇô\",\r\n                        },\r\n                        {\r\n                          label: \"Construction Status\",\r\n                          value: (p) => p.constructionStatus || p.propertyAge || p.ageOfProperty || \"ΓÇô\",\r\n                        },\r\n                        {\r\n                          label: \"Parking\",\r\n                          value: (p) => {\r\n                            if (!p.parking) return \"ΓÇô\";\r\n                            const parts = [];\r\n                            if (p.parking.covered) parts.push(`Covered: ${p.parking.covered}`);\r\n                            if (p.parking.open) parts.push(`Open: ${p.parking.open}`);\r\n                            return parts.join(\" | \") || \"ΓÇô\";\r\n                          },\r\n                        },\r\n                        {\r\n                          label: \"Amenities\",\r\n                          value: (p) => {\r\n                            if (!Array.isArray(p.amenities) || !p.amenities.length) return \"ΓÇô\";\r\n                            const shown = p.amenities.slice(0, 3).join(\", \");\r\n                            const extra = p.amenities.length > 3 ? ` +${p.amenities.length - 3} more` : \"\";\r\n                            return shown + extra;\r\n                          },\r\n                        },\r\n                        {\r\n                          label: \"Status\",\r\n                          value: (p) => p.status || \"Active\",\r\n                        },\r\n                      ];\r\n                    }\r\n\r\n                    return rows.map((row) => (\r\n                      <React.Fragment key={row.label}>\r\n                        <div className=\"bg-slate-50 border-b border-slate-100 p-3 font-semibold text-slate-700\">\r\n                          {row.label}\r\n                        </div>\r\n                        {selectedCompareProperties.map((p) => (\r\n                          <div key={p._id + row.label} className=\"border-b border-slate-100 p-3 text-slate-700\">\r\n                            {row.value(p)}\r\n                          </div>\r\n                        ))}\r\n                      </React.Fragment>\r\n                    ));\r\n                  })()}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default PropertyPage;","usedDeprecatedRules":[]},{"filePath":"D:\\dealdirectcurrentlive\\dealdirect\\client\\src\\Pages\\Register\\Register.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'cancelPendingAuth'. Either include it or remove the dependency array.","line":62,"column":6,"nodeType":"ArrayExpression","endLine":62,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [cancelPendingAuth]","fix":{"range":[2331,2333],"text":"[cancelPendingAuth]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/pages/Auth/Register.jsx\r\nimport React, { useState, useEffect } from \"react\";\r\nimport api from \"../../utils/api\";\r\nimport { toast } from \"react-toastify\";\r\nimport { useNavigate, Link, useLocation } from \"react-router-dom\";\r\nimport { User, Mail, Lock, Eye, EyeOff, Loader2, CheckCircle, ShieldCheck, RefreshCw, Home, Search, Phone, ArrowLeft, KeyRound } from \"lucide-react\";\r\nimport dealDirectLogo from \"../../assets/dealdirect_logo.png\";\r\nimport { useAuth } from \"../../context/AuthContext\";\r\n\r\n\r\n\r\nexport default function Register() {\r\n  const [formData, setFormData] = useState({ name: \"\", email: \"\", password: \"\", phone: \"\", agree: false });\r\n  const [userType, setUserType] = useState(\"buyer\"); // \"buyer\" or \"owner\"\r\n  const [otp, setOtp] = useState(\"\");\r\n  const [step, setStep] = useState(1); // 1: Details, 2: OTP (only for owners)\r\n  const [showPassword, setShowPassword] = useState(false);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [resendLoading, setResendLoading] = useState(false);\r\n  const [resendTimer, setResendTimer] = useState(0);\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n  const {\r\n    register: authRegister,\r\n    updateUser,\r\n    requiresMfa,\r\n    requiresPasswordChange,\r\n    verifyMfa,\r\n    changePasswordOnLogin,\r\n    cancelPendingAuth,\r\n    pendingAuthData\r\n  } = useAuth();\r\n  const redirectPath = location.state?.from || \"/\";\r\n\r\n  // MFA state\r\n  const [mfaCode, setMfaCode] = useState(\"\");\r\n  const [mfaLoading, setMfaLoading] = useState(false);\r\n\r\n  // Password change state\r\n  const [newPassword, setNewPassword] = useState(\"\");\r\n  const [confirmNewPassword, setConfirmNewPassword] = useState(\"\");\r\n  const [showNewPassword, setShowNewPassword] = useState(false);\r\n  const [showConfirmNewPassword, setShowConfirmNewPassword] = useState(false);\r\n  const [passwordChangeLoading, setPasswordChangeLoading] = useState(false);\r\n\r\n  // Countdown timer for resend OTP\r\n  useEffect(() => {\r\n    let interval;\r\n    if (resendTimer > 0) {\r\n      interval = setInterval(() => {\r\n        setResendTimer((prev) => prev - 1);\r\n      }, 1000);\r\n    }\r\n    return () => clearInterval(interval);\r\n  }, [resendTimer]);\r\n\r\n  // Reset MFA/password states when component unmounts\r\n  useEffect(() => {\r\n    return () => {\r\n      cancelPendingAuth?.();\r\n    };\r\n  }, []);\r\n\r\n  const handleChange = (e) => {\r\n    const { name, value, type, checked } = e.target;\r\n    let newValue = type === \"checkbox\" ? checked : value;\r\n\r\n    if (name === \"phone\") {\r\n      newValue = newValue.replace(/[^0-9]/g, \"\").slice(0, 10);\r\n    }\r\n\r\n    setFormData((f) => ({ ...f, [name]: newValue }));\r\n  };\r\n\r\n  // Handle registration - different flow for buyer vs owner\r\n  const handleRegister = async (e) => {\r\n    e.preventDefault();\r\n    if (!formData.agree) return toast.error(\"Please accept the Terms & Privacy Policy\");\r\n\r\n    if (!formData.phone) {\r\n      toast.error(\"Please enter your phone number\");\r\n      return;\r\n    }\r\n\r\n    if (!/^[6-9]\\d{9}$/.test(formData.phone.trim())) {\r\n      toast.error(\"Please enter a valid 10-digit phone number\");\r\n      return;\r\n    }\r\n\r\n    setIsLoading(true);\r\n    try {\r\n      if (userType === \"buyer\") {\r\n        // Buyers: Direct registration without OTP\r\n        const res = await api.post('/users/register-direct', {\r\n          name: formData.name,\r\n          email: formData.email,\r\n          password: formData.password,\r\n          role: \"user\",\r\n          phone: formData.phone,\r\n        });\r\n\r\n        // Check for MFA requirement\r\n        if (res.data.requiresMfa || res.data.code === 'REQUIRES_MFA') {\r\n          // Let AuthContext handle this\r\n          const result = await authRegister({\r\n            name: formData.name,\r\n            email: formData.email,\r\n            password: formData.password,\r\n            role: \"user\",\r\n            phone: formData.phone,\r\n          });\r\n\r\n          if (result.requiresMfa) {\r\n            toast.info(result.message || \"Please complete MFA verification\");\r\n            setIsLoading(false);\r\n            return;\r\n          }\r\n        }\r\n\r\n        // Check for password change requirement\r\n        if (res.data.passwordChangeRequired || res.data.code === 'PASSWORD_CHANGE_REQUIRED') {\r\n          const result = await authRegister({\r\n            name: formData.name,\r\n            email: formData.email,\r\n            password: formData.password,\r\n            role: \"user\",\r\n            phone: formData.phone,\r\n          });\r\n\r\n          if (result.passwordChangeRequired) {\r\n            toast.warning(result.message || \"Please set a new password\");\r\n            setIsLoading(false);\r\n            return;\r\n          }\r\n        }\r\n\r\n        const { user } = res.data;\r\n        updateUser(user);\r\n\r\n        toast.success(\"Registration successful! Welcome to DealDirect.\");\r\n        navigate(redirectPath);\r\n      } else {\r\n        // Owners: Require OTP verification\r\n        await api.post('/users/register', {\r\n          name: formData.name,\r\n          email: formData.email,\r\n          password: formData.password,\r\n          role: \"owner\",\r\n          phone: formData.phone,\r\n        });\r\n\r\n        toast.success(\"OTP sent to your email! Please verify to complete registration.\");\r\n        setStep(2);\r\n        setResendTimer(60);\r\n      }\r\n    } catch (err) {\r\n      const errorData = err.response?.data;\r\n\r\n      // Handle MFA requirement from error response\r\n      if (errorData?.requiresMfa || errorData?.code === 'REQUIRES_MFA') {\r\n        // Use AuthContext to handle MFA\r\n        await authRegister({\r\n          name: formData.name,\r\n          email: formData.email,\r\n          password: formData.password,\r\n          role: userType === \"buyer\" ? \"user\" : \"owner\",\r\n          phone: formData.phone,\r\n        });\r\n        toast.info(errorData.message || \"Please complete MFA verification\");\r\n        setIsLoading(false);\r\n        return;\r\n      }\r\n\r\n      // Handle password change requirement from error response\r\n      if (errorData?.passwordChangeRequired || errorData?.code === 'PASSWORD_CHANGE_REQUIRED') {\r\n        await authRegister({\r\n          name: formData.name,\r\n          email: formData.email,\r\n          password: formData.password,\r\n          role: userType === \"buyer\" ? \"user\" : \"owner\",\r\n          phone: formData.phone,\r\n        });\r\n        toast.warning(errorData.message || \"Please set a new password\");\r\n        setIsLoading(false);\r\n        return;\r\n      }\r\n\r\n      toast.error(errorData?.message || \"Registration failed. Please try again.\");\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleResendOtp = async () => {\r\n    if (resendTimer > 0) return;\r\n\r\n    setResendLoading(true);\r\n    try {\r\n      await api.post('/users/resend-otp', {\r\n        email: formData.email\r\n      });\r\n      toast.success(\"New OTP sent to your email!\");\r\n      setResendTimer(60); // Reset countdown\r\n      setOtp(\"\"); // Clear old OTP input\r\n    } catch (err) {\r\n      toast.error(err.response?.data?.message || \"Failed to resend OTP. Please try again.\");\r\n    } finally {\r\n      setResendLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleVerifyOtp = async (e) => {\r\n    e.preventDefault();\r\n    setIsLoading(true);\r\n    try {\r\n      const res = await api.post('/users/verify-otp', {\r\n        email: formData.email,\r\n        otp\r\n      });\r\n\r\n      // Check for MFA requirement after OTP verification\r\n      if (res.data.requiresMfa || res.data.code === 'REQUIRES_MFA') {\r\n        await authRegister({\r\n          email: formData.email,\r\n        });\r\n        toast.info(res.data.message || \"Please complete MFA verification\");\r\n        setIsLoading(false);\r\n        return;\r\n      }\r\n\r\n      // Check for password change requirement after OTP verification\r\n      if (res.data.passwordChangeRequired || res.data.code === 'PASSWORD_CHANGE_REQUIRED') {\r\n        await authRegister({\r\n          email: formData.email,\r\n        });\r\n        toast.warning(res.data.message || \"Please set a new password\");\r\n        setIsLoading(false);\r\n        return;\r\n      }\r\n\r\n      const { user } = res.data;\r\n      updateUser(user);\r\n\r\n      toast.success(\"Registration successful! Welcome aboard.\");\r\n      navigate(redirectPath);\r\n    } catch (err) {\r\n      toast.error(err.response?.data?.message || \"Invalid OTP. Please try again.\");\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  // Handle MFA verification\r\n  const handleMfaVerify = async (e) => {\r\n    e.preventDefault();\r\n    if (!mfaCode || mfaCode.length !== 6) {\r\n      toast.error(\"Please enter a valid 6-digit MFA code\");\r\n      return;\r\n    }\r\n\r\n    setMfaLoading(true);\r\n    try {\r\n      const result = await verifyMfa(mfaCode);\r\n\r\n      if (result.success) {\r\n        toast.success(`Welcome, ${result.user.name || 'User'}!`);\r\n        navigate(redirectPath);\r\n      } else {\r\n        toast.error(result.message || \"MFA verification failed\");\r\n      }\r\n    } catch (err) {\r\n      toast.error(err.response?.data?.message || \"MFA verification failed\");\r\n    } finally {\r\n      setMfaLoading(false);\r\n    }\r\n  };\r\n\r\n  // Handle password change on registration\r\n  const handlePasswordChange = async (e) => {\r\n    e.preventDefault();\r\n\r\n    if (newPassword.length < 8) {\r\n      toast.error(\"Password must be at least 8 characters\");\r\n      return;\r\n    }\r\n\r\n    if (newPassword !== confirmNewPassword) {\r\n      toast.error(\"Passwords do not match\");\r\n      return;\r\n    }\r\n\r\n    setPasswordChangeLoading(true);\r\n    try {\r\n      const result = await changePasswordOnLogin(newPassword);\r\n\r\n      if (result.success) {\r\n        toast.success(\"Password set successfully! Welcome aboard.\");\r\n        navigate(redirectPath);\r\n      } else {\r\n        toast.error(result.message || \"Password change failed\");\r\n      }\r\n    } catch (err) {\r\n      toast.error(err.response?.data?.message || \"Password change failed\");\r\n    } finally {\r\n      setPasswordChangeLoading(false);\r\n    }\r\n  };\r\n\r\n  // Cancel MFA or password change flow\r\n  const handleCancelFlow = () => {\r\n    cancelPendingAuth();\r\n    setMfaCode(\"\");\r\n    setNewPassword(\"\");\r\n    setConfirmNewPassword(\"\");\r\n    setStep(1);\r\n  };\r\n\r\n  // Render MFA verification form\r\n  if (requiresMfa) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center bg-gray-50 font-sans\">\r\n        <div className=\"w-full max-w-md bg-white rounded-2xl shadow-2xl overflow-hidden p-8\">\r\n          <div className=\"text-center mb-8\">\r\n            <div className=\"mx-auto w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mb-4\">\r\n              <ShieldCheck className=\"w-8 h-8 text-blue-600\" />\r\n            </div>\r\n            <h2 className=\"text-2xl font-bold text-slate-800\">Two-Factor Authentication</h2>\r\n            <p className=\"text-slate-500 mt-2\">\r\n              Enter the 6-digit code from your authenticator app\r\n            </p>\r\n            {pendingAuthData?.email && (\r\n              <p className=\"text-sm text-slate-400 mt-1\">for {pendingAuthData.email}</p>\r\n            )}\r\n          </div>\r\n\r\n          <form onSubmit={handleMfaVerify} className=\"space-y-6\">\r\n            <div className=\"space-y-2\">\r\n              <label className=\"text-sm font-medium text-slate-700 block text-center\">MFA Code</label>\r\n              <input\r\n                type=\"text\"\r\n                value={mfaCode}\r\n                onChange={(e) => setMfaCode(e.target.value.replace(/[^0-9]/g, '').slice(0, 6))}\r\n                placeholder=\"000000\"\r\n                required\r\n                autoFocus\r\n                className=\"w-full text-center text-2xl tracking-[0.5em] py-4 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-900 focus:border-blue-900 transition-colors outline-none text-slate-800 font-mono\"\r\n              />\r\n            </div>\r\n\r\n            <button\r\n              type=\"submit\"\r\n              disabled={mfaLoading || mfaCode.length !== 6}\r\n              className=\"w-full bg-slate-900 text-white py-3.5 rounded-lg font-semibold hover:bg-slate-800 focus:ring-4 focus:ring-slate-200 transition-all flex items-center justify-center disabled:opacity-50\"\r\n            >\r\n              {mfaLoading ? (\r\n                <>\r\n                  <Loader2 className=\"w-5 h-5 mr-2 animate-spin\" />\r\n                  Verifying...\r\n                </>\r\n              ) : (\r\n                \"Verify Code\"\r\n              )}\r\n            </button>\r\n\r\n            <button\r\n              type=\"button\"\r\n              onClick={handleCancelFlow}\r\n              className=\"w-full text-slate-500 text-sm hover:text-slate-700 py-2\"\r\n            >\r\n              <ArrowLeft className=\"w-4 h-4 inline mr-1\" />\r\n              Back to Register\r\n            </button>\r\n          </form>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Render password change requirement form\r\n  if (requiresPasswordChange) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center bg-gray-50 font-sans\">\r\n        <div className=\"w-full max-w-md bg-white rounded-2xl shadow-2xl overflow-hidden p-8\">\r\n          <div className=\"text-center mb-8\">\r\n            <div className=\"mx-auto w-16 h-16 bg-amber-100 rounded-full flex items-center justify-center mb-4\">\r\n              <KeyRound className=\"w-8 h-8 text-amber-600\" />\r\n            </div>\r\n            <h2 className=\"text-2xl font-bold text-slate-800\">Set Your Password</h2>\r\n            <p className=\"text-slate-500 mt-2\">\r\n              Please set a secure password for your account\r\n            </p>\r\n          </div>\r\n\r\n          <form onSubmit={handlePasswordChange} className=\"space-y-5\">\r\n            <div className=\"space-y-2\">\r\n              <label className=\"text-sm font-medium text-slate-700 block\">New Password</label>\r\n              <div className=\"relative\">\r\n                <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\r\n                  <Lock className=\"h-5 w-5 text-slate-400\" />\r\n                </div>\r\n                <input\r\n                  type={showNewPassword ? \"text\" : \"password\"}\r\n                  placeholder=\"Enter new password (min 8 characters)\"\r\n                  value={newPassword}\r\n                  onChange={(e) => setNewPassword(e.target.value)}\r\n                  required\r\n                  minLength={8}\r\n                  className=\"w-full pl-10 pr-12 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-900 focus:border-blue-900 transition-colors outline-none text-slate-800\"\r\n                />\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={() => setShowNewPassword(!showNewPassword)}\r\n                  className=\"absolute inset-y-0 right-0 pr-3 flex items-center text-slate-400 hover:text-slate-600\"\r\n                >\r\n                  {showNewPassword ? <EyeOff className=\"h-5 w-5\" /> : <Eye className=\"h-5 w-5\" />}\r\n                </button>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"space-y-2\">\r\n              <label className=\"text-sm font-medium text-slate-700 block\">Confirm New Password</label>\r\n              <div className=\"relative\">\r\n                <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\r\n                  <Lock className=\"h-5 w-5 text-slate-400\" />\r\n                </div>\r\n                <input\r\n                  type={showConfirmNewPassword ? \"text\" : \"password\"}\r\n                  placeholder=\"Confirm new password\"\r\n                  value={confirmNewPassword}\r\n                  onChange={(e) => setConfirmNewPassword(e.target.value)}\r\n                  required\r\n                  minLength={8}\r\n                  className=\"w-full pl-10 pr-12 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-900 focus:border-blue-900 transition-colors outline-none text-slate-800\"\r\n                />\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={() => setShowConfirmNewPassword(!showConfirmNewPassword)}\r\n                  className=\"absolute inset-y-0 right-0 pr-3 flex items-center text-slate-400 hover:text-slate-600\"\r\n                >\r\n                  {showConfirmNewPassword ? <EyeOff className=\"h-5 w-5\" /> : <Eye className=\"h-5 w-5\" />}\r\n                </button>\r\n              </div>\r\n              {confirmNewPassword && newPassword !== confirmNewPassword && (\r\n                <p className=\"text-xs text-red-500\">Passwords do not match</p>\r\n              )}\r\n            </div>\r\n\r\n            <button\r\n              type=\"submit\"\r\n              disabled={passwordChangeLoading || newPassword !== confirmNewPassword || newPassword.length < 8}\r\n              className=\"w-full bg-slate-900 text-white py-3.5 rounded-lg font-semibold hover:bg-slate-800 focus:ring-4 focus:ring-slate-200 transition-all flex items-center justify-center disabled:opacity-50\"\r\n            >\r\n              {passwordChangeLoading ? (\r\n                <>\r\n                  <Loader2 className=\"w-5 h-5 mr-2 animate-spin\" />\r\n                  Setting Password...\r\n                </>\r\n              ) : (\r\n                \"Set Password & Continue\"\r\n              )}\r\n            </button>\r\n\r\n            <button\r\n              type=\"button\"\r\n              onClick={handleCancelFlow}\r\n              className=\"w-full text-slate-500 text-sm hover:text-slate-700 py-2\"\r\n            >\r\n              <ArrowLeft className=\"w-4 h-4 inline mr-1\" />\r\n              Back to Register\r\n            </button>\r\n          </form>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen flex items-center justify-center bg-gray-50 font-sans pb-10 px-4\">\r\n      <div className=\"w-full max-w-5xl bg-white rounded-2xl shadow-2xl overflow-hidden flex flex-col md:flex-row md:min-h-[600px]\">\r\n\r\n        {/* LEFT SIDE - IMAGE & BRANDING */}\r\n        <div className=\"md:w-1/2 relative hidden md:flex flex-col justify-between p-12 text-white\">\r\n          {/* Background Image with Overlay */}\r\n          <div className=\"absolute inset-0 bg-cover bg-center z-0\"\r\n            style={{ backgroundImage: \"url('https://images.unsplash.com/photo-1560518883-ce09059eeffa?q=80&w=1973&auto=format&fit=crop')\" }}>\r\n          </div>\r\n          <div className=\"absolute inset-0 bg-slate-900/70 z-10\"></div>\r\n\r\n          {/* Header Branding */}\r\n          <div className=\"relative z-20 flex items-center gap-2 mb-6\">\r\n            <img src={dealDirectLogo} alt=\"DealDirect\" className=\"h-12 w-auto\" />\r\n          </div>\r\n\r\n          {/* Main Text */}\r\n          <div className=\"relative z-20 mb-8\">\r\n            <h2 className=\"text-4xl font-bold leading-tight mb-6\">\r\n              Start your journey <br /> to <span className=\"text-blue-400\">home ownership.</span>\r\n            </h2>\r\n\r\n            <ul className=\"space-y-4 text-gray-300\">\r\n              <li className=\"flex items-center gap-3\">\r\n                <CheckCircle className=\"w-5 h-5 text-blue-400\" />\r\n                <span>Direct connections with sellers</span>\r\n              </li>\r\n              <li className=\"flex items-center gap-3\">\r\n                <CheckCircle className=\"w-5 h-5 text-blue-400\" />\r\n                <span>Zero brokerage fees</span>\r\n              </li>\r\n              <li className=\"flex items-center gap-3\">\r\n                <CheckCircle className=\"w-5 h-5 text-blue-400\" />\r\n                <span>Verified property listings</span>\r\n              </li>\r\n            </ul>\r\n          </div>\r\n\r\n          <div className=\"relative z-20 text-sm text-gray-400\">\r\n            ┬⌐ 2025 DealDirect. Building Trust.\r\n          </div>\r\n        </div>\r\n\r\n        {/* RIGHT SIDE - FORM */}\r\n        <div className=\"md:w-1/2 w-full p-8 md:p-12 flex flex-col justify-center\">\r\n          <div className=\"max-w-md mx-auto w-full\">\r\n\r\n            {step === 1 ? (\r\n              <>\r\n                <div className=\"text-center mb-8\">\r\n                  <h2 className=\"text-3xl font-bold text-slate-800\">Create Account</h2>\r\n                  <p className=\"text-slate-500 mt-2\">Join us to unlock exclusive property deals.</p>\r\n                </div>\r\n\r\n                {/* User Type Selector */}\r\n                <div className=\"mb-6\">\r\n                  <label className=\"text-sm font-medium text-slate-700 block mb-3\">I want to</label>\r\n                  <div className=\"grid grid-cols-2 gap-3\">\r\n                    <button\r\n                      type=\"button\"\r\n                      onClick={() => setUserType(\"buyer\")}\r\n                      className={`flex flex-col items-center p-4 rounded-xl border-2 transition-all ${userType === \"buyer\"\r\n                        ? \"border-blue-600 bg-blue-50 text-blue-700\"\r\n                        : \"border-slate-200 bg-white text-slate-600 hover:border-slate-300\"\r\n                        }`}\r\n                    >\r\n                      <Search className={`w-6 h-6 mb-2 ${userType === \"buyer\" ? \"text-blue-600\" : \"text-slate-400\"}`} />\r\n                      <span className=\"font-semibold text-sm\">Find Property</span>\r\n                      <span className=\"text-xs mt-1 opacity-70\">Browse & Buy</span>\r\n                    </button>\r\n                    <button\r\n                      type=\"button\"\r\n                      onClick={() => setUserType(\"owner\")}\r\n                      className={`flex flex-col items-center p-4 rounded-xl border-2 transition-all ${userType === \"owner\"\r\n                        ? \"border-blue-600 bg-blue-50 text-blue-700\"\r\n                        : \"border-slate-200 bg-white text-slate-600 hover:border-slate-300\"\r\n                        }`}\r\n                    >\r\n                      <Home className={`w-6 h-6 mb-2 ${userType === \"owner\" ? \"text-blue-600\" : \"text-slate-400\"}`} />\r\n                      <span className=\"font-semibold text-sm\">List Property</span>\r\n                      <span className=\"text-xs mt-1 opacity-70\">Sell or Rent</span>\r\n                    </button>\r\n                  </div>\r\n                  {userType === \"owner\" && (\r\n                    <p className=\"text-xs text-amber-600 mt-2 flex items-center gap-1\">\r\n                      <ShieldCheck className=\"w-3.5 h-3.5\" />\r\n                      Email verification required to list properties\r\n                    </p>\r\n                  )}\r\n                </div>\r\n\r\n                <form onSubmit={handleRegister} className=\"space-y-5\">\r\n                  {/* Name Input */}\r\n                  <div className=\"space-y-2\">\r\n                    <label className=\"text-sm font-medium text-slate-700 block\">Full Name</label>\r\n                    <div className=\"relative\">\r\n                      <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\r\n                        <User className=\"h-5 w-5 text-slate-400\" />\r\n                      </div>\r\n                      <input\r\n                        type=\"text\"\r\n                        name=\"name\"\r\n                        placeholder=\"John Doe\"\r\n                        value={formData.name}\r\n                        onChange={handleChange}\r\n                        required\r\n                        className=\"w-full pl-10 pr-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-900 focus:border-blue-900 transition-colors outline-none text-slate-800\"\r\n                      />\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Phone Input */}\r\n                  <div className=\"space-y-2\">\r\n                    <label className=\"text-sm font-medium text-slate-700 block\">Phone Number</label>\r\n                    <div className=\"relative\">\r\n                      <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\r\n                        <Phone className=\"h-5 w-5 text-slate-400\" />\r\n                      </div>\r\n                      <input\r\n                        type=\"tel\"\r\n                        name=\"phone\"\r\n                        placeholder=\"10-digit mobile number\"\r\n                        value={formData.phone}\r\n                        onChange={handleChange}\r\n                        required\r\n                        className=\"w-full pl-10 pr-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-900 focus:border-blue-900 transition-colors outline-none text-slate-800\"\r\n                      />\r\n                    </div>\r\n                    <p className=\"text-xs text-slate-500\">\r\n                      Used for important updates about your account and visits.\r\n                    </p>\r\n                  </div>\r\n\r\n                  {/* Email Input */}\r\n                  <div className=\"space-y-2\">\r\n                    <label className=\"text-sm font-medium text-slate-700 block\">Email Address</label>\r\n                    <div className=\"relative\">\r\n                      <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\r\n                        <Mail className=\"h-5 w-5 text-slate-400\" />\r\n                      </div>\r\n                      <input\r\n                        type=\"email\"\r\n                        name=\"email\"\r\n                        placeholder=\"name@company.com\"\r\n                        value={formData.email}\r\n                        onChange={handleChange}\r\n                        required\r\n                        className=\"w-full pl-10 pr-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-900 focus:border-blue-900 transition-colors outline-none text-slate-800\"\r\n                      />\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Password Input */}\r\n                  <div className=\"space-y-2\">\r\n                    <label className=\"text-sm font-medium text-slate-700 block\">Password</label>\r\n                    <div className=\"relative\">\r\n                      <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\r\n                        <Lock className=\"h-5 w-5 text-slate-400\" />\r\n                      </div>\r\n                      <input\r\n                        type={showPassword ? \"text\" : \"password\"}\r\n                        name=\"password\"\r\n                        placeholder=\"Create a strong password\"\r\n                        value={formData.password}\r\n                        onChange={handleChange}\r\n                        required\r\n                        className=\"w-full pl-10 pr-12 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-900 focus:border-blue-900 transition-colors outline-none text-slate-800\"\r\n                      />\r\n                      <button\r\n                        type=\"button\"\r\n                        onClick={() => setShowPassword(!showPassword)}\r\n                        className=\"absolute inset-y-0 right-0 pr-3 flex items-center text-slate-400 hover:text-slate-600\"\r\n                      >\r\n                        {showPassword ? <EyeOff className=\"h-5 w-5\" /> : <Eye className=\"h-5 w-5\" />}\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Terms Checkbox */}\r\n                  <div className=\"flex items-start\">\r\n                    <div className=\"flex items-center h-5\">\r\n                      <input\r\n                        id=\"agree\"\r\n                        name=\"agree\"\r\n                        type=\"checkbox\"\r\n                        checked={formData.agree}\r\n                        onChange={handleChange}\r\n                        className=\"w-4 h-4 text-blue-900 border-slate-300 rounded focus:ring-blue-900 cursor-pointer\"\r\n                      />\r\n                    </div>\r\n                    <div className=\"ml-3 text-sm\">\r\n                      <label htmlFor=\"agree\" className=\"text-slate-600 cursor-pointer\">\r\n                        I agree to the <a href=\"#\" className=\"text-blue-900 font-medium hover:underline\">Terms of Service</a> and <a href=\"#\" className=\"text-blue-900 font-medium hover:underline\">Privacy Policy</a>\r\n                      </label>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Submit Button */}\r\n                  <button\r\n                    type=\"submit\"\r\n                    disabled={isLoading}\r\n                    className=\"w-full bg-slate-900 text-white py-3.5 rounded-lg font-semibold hover:bg-slate-800 focus:ring-4 focus:ring-slate-200 transition-all flex items-center justify-center\"\r\n                  >\r\n                    {isLoading ? (\r\n                      <>\r\n                        <Loader2 className=\"w-5 h-5 mr-2 animate-spin\" />\r\n                        {userType === \"owner\" ? \"Sending OTP...\" : \"Creating Account...\"}\r\n                      </>\r\n                    ) : (\r\n                      userType === \"owner\" ? \"Verify & Create Account\" : \"Create Account\"\r\n                    )}\r\n                  </button>\r\n                </form>\r\n\r\n                {/* Footer */}\r\n                <div className=\"mt-8 text-center text-sm text-slate-500\">\r\n                  Already have an account?{\" \"}\r\n                  <Link to=\"/login\" className=\"font-bold text-blue-900 hover:underline\">\r\n                    Log in here\r\n                  </Link>\r\n                </div>\r\n              </>\r\n            ) : (\r\n              <>\r\n                {/* OTP STEP */}\r\n                <div className=\"text-center mb-8\">\r\n                  <div className=\"mx-auto w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mb-4\">\r\n                    <ShieldCheck className=\"w-8 h-8 text-blue-600\" />\r\n                  </div>\r\n                  <h2 className=\"text-3xl font-bold text-slate-800\">Verify Email</h2>\r\n                  <p className=\"text-slate-500 mt-2\">\r\n                    We've sent a verification code to <br /> <span className=\"font-semibold text-slate-800\">{formData.email}</span>\r\n                  </p>\r\n                </div>\r\n\r\n                <form onSubmit={handleVerifyOtp} className=\"space-y-6\">\r\n                  <div className=\"space-y-2\">\r\n                    <label className=\"text-sm font-medium text-slate-700 block text-center\">Enter 6-Digit OTP</label>\r\n                    <input\r\n                      type=\"text\"\r\n                      value={otp}\r\n                      onChange={(e) => setOtp(e.target.value.replace(/[^0-9]/g, '').slice(0, 6))}\r\n                      placeholder=\"123456\"\r\n                      required\r\n                      className=\"w-full text-center text-2xl tracking-widest py-4 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-900 focus:border-blue-900 transition-colors outline-none text-slate-800\"\r\n                    />\r\n                  </div>\r\n\r\n                  <button\r\n                    type=\"submit\"\r\n                    disabled={isLoading}\r\n                    className=\"w-full bg-slate-900 text-white py-3.5 rounded-lg font-semibold hover:bg-slate-800 focus:ring-4 focus:ring-slate-200 transition-all flex items-center justify-center\"\r\n                  >\r\n                    {isLoading ? (\r\n                      <>\r\n                        <Loader2 className=\"w-5 h-5 mr-2 animate-spin\" />\r\n                        Verifying...\r\n                      </>\r\n                    ) : (\r\n                      \"Verify & Register\"\r\n                    )}\r\n                  </button>\r\n\r\n                  {/* Resend OTP Section */}\r\n                  <div className=\"text-center space-y-2\">\r\n                    <p className=\"text-sm text-slate-500\">Didn't receive the code?</p>\r\n                    <button\r\n                      type=\"button\"\r\n                      onClick={handleResendOtp}\r\n                      disabled={resendTimer > 0 || resendLoading}\r\n                      className={`inline-flex items-center text-sm font-medium transition-colors ${resendTimer > 0\r\n                        ? 'text-slate-400 cursor-not-allowed'\r\n                        : 'text-blue-900 hover:text-blue-700 hover:underline cursor-pointer'\r\n                        }`}\r\n                    >\r\n                      {resendLoading ? (\r\n                        <>\r\n                          <Loader2 className=\"w-4 h-4 mr-1.5 animate-spin\" />\r\n                          Sending...\r\n                        </>\r\n                      ) : resendTimer > 0 ? (\r\n                        <>\r\n                          <RefreshCw className=\"w-4 h-4 mr-1.5\" />\r\n                          Resend in {resendTimer}s\r\n                        </>\r\n                      ) : (\r\n                        <>\r\n                          <RefreshCw className=\"w-4 h-4 mr-1.5\" />\r\n                          Resend OTP\r\n                        </>\r\n                      )}\r\n                    </button>\r\n                  </div>\r\n\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => setStep(1)}\r\n                    className=\"w-full text-slate-500 text-sm hover:text-slate-700\"\r\n                  >\r\n                    Change Email / Go Back\r\n                  </button>\r\n                </form>\r\n              </>\r\n            )}\r\n\r\n          </div>\r\n        </div>\r\n\r\n      </div>\r\n    </div>\r\n  );\r\n}","usedDeprecatedRules":[]},{"filePath":"D:\\dealdirectcurrentlive\\dealdirect\\client\\src\\Pages\\SavedProperties\\SavedProperties.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'user' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":197,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":197,"endColumn":15,"suggestions":[{"messageId":"removeVar","data":{"varName":"user"},"fix":{"range":[7424,7429],"text":""},"desc":"Remove unused variable 'user'."}]}],"suppressedMessages":[{"ruleId":"no-unused-vars","severity":2,"message":"'motion' is defined but never used. Allowed unused vars must match /^[A-Z_]/u.","line":16,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":16,"endColumn":16,"suggestions":[{"messageId":"removeVar","data":{"varName":"motion"},"fix":{"range":[345,352],"text":""},"desc":"Remove unused variable 'motion'."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\r\nimport { useNavigate, Link } from \"react-router-dom\";\r\nimport { toast } from \"react-toastify\";\r\nimport {\r\n  Heart,\r\n  MapPin,\r\n  Home,\r\n  Building2,\r\n  ExternalLink,\r\n  Search,\r\n  RefreshCw,\r\n  HeartOff,\r\n  Clock,\r\n} from \"lucide-react\";\r\n// eslint-disable-next-line no-unused-vars\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport api from \"../../utils/api\";\r\nimport { useAuth } from \"../../context/AuthContext\";\r\n\r\n// Property Card Component\r\nconst PropertyCard = ({ property, onRemove, onViewDetails }) => {\r\n  const [removing, setRemoving] = useState(false);\r\n\r\n  const formatPrice = (price) => {\r\n    if (!price) return \"Price on Request\";\r\n    if (price >= 10000000) return `Γé╣${(price / 10000000).toFixed(2)} Cr`;\r\n    if (price >= 100000) return `Γé╣${(price / 100000).toFixed(2)} Lac`;\r\n    return `Γé╣${price.toLocaleString()}`;\r\n  };\r\n\r\n  const getMainImage = () => {\r\n    // Check categorized images first (residential or commercial)\r\n    if (property.categorizedImages) {\r\n      if (property.categorizedImages.residential) {\r\n        const residentialCategories = ['exterior', 'livingRoom', 'bedroom', 'hall', 'balcony', 'kitchen'];\r\n        for (const cat of residentialCategories) {\r\n          if (property.categorizedImages.residential[cat]?.length > 0) {\r\n            return property.categorizedImages.residential[cat][0];\r\n          }\r\n        }\r\n      }\r\n      if (property.categorizedImages.commercial) {\r\n        const commercialCategories = ['facade', 'reception', 'workArea', 'cabin', 'shopFloor'];\r\n        for (const cat of commercialCategories) {\r\n          if (property.categorizedImages.commercial[cat]?.length > 0) {\r\n            return property.categorizedImages.commercial[cat][0];\r\n          }\r\n        }\r\n      }\r\n    }\r\n    if (property.images?.length > 0) {\r\n      return property.images[0];\r\n    }\r\n    return \"https://images.unsplash.com/photo-1560518883-ce09059eeffa?w=400\";\r\n  };\r\n\r\n  const handleRemove = async () => {\r\n    setRemoving(true);\r\n    await onRemove(property._id);\r\n    setRemoving(false);\r\n  };\r\n\r\n  const getPropertyType = () => {\r\n    if (typeof property.propertyType === 'object') {\r\n      return property.propertyType?.name;\r\n    }\r\n    return property.propertyType || property.propertyTypeName || \"Property\";\r\n  };\r\n\r\n  const getLocation = () => {\r\n    const locality = property.locality || property.address?.locality || property.address?.area || \"\";\r\n    const city = property.city || property.address?.city || \"\";\r\n    return `${locality}${locality && city ? \", \" : \"\"}${city}`;\r\n  };\r\n\r\n  return (\r\n    <motion.div\r\n      initial={{ opacity: 0, y: 20 }}\r\n      animate={{ opacity: 1, y: 0 }}\r\n      exit={{ opacity: 0, y: -20 }}\r\n      className=\"bg-white rounded-2xl border border-gray-200 overflow-hidden hover:shadow-xl transition-all group\"\r\n    >\r\n      {/* Image Section */}\r\n      <div className=\"relative h-52 overflow-hidden\">\r\n        <img\r\n          src={getMainImage()}\r\n          alt={property.title}\r\n          className=\"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500\"\r\n        />\r\n\r\n        {/* Overlay Gradient */}\r\n        <div className=\"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent\" />\r\n\r\n        {/* Top Badges */}\r\n        <div className=\"absolute top-3 left-3 flex gap-2\">\r\n          <span className=\"px-3 py-1 bg-red-600 text-white text-xs font-bold rounded-full shadow-lg\">\r\n            {property.listingType || \"Rent\"}\r\n          </span>\r\n          <span className=\"px-3 py-1 bg-white/95 text-gray-800 text-xs font-medium rounded-full shadow\">\r\n            {getPropertyType()}\r\n          </span>\r\n        </div>\r\n\r\n        {/* Remove Button */}\r\n        <button\r\n          onClick={handleRemove}\r\n          disabled={removing}\r\n          className=\"absolute top-3 right-3 p-2.5 bg-white/90 backdrop-blur rounded-full hover:bg-red-50 transition shadow-lg group/btn disabled:opacity-50\"\r\n          title=\"Remove from saved\"\r\n        >\r\n          {removing ? (\r\n            <RefreshCw className=\"w-4 h-4 text-red-500 animate-spin\" />\r\n          ) : (\r\n            <HeartOff className=\"w-4 h-4 text-red-500 group-hover/btn:scale-110 transition-transform\" />\r\n          )}\r\n        </button>\r\n\r\n        {/* Price Badge */}\r\n        <div className=\"absolute bottom-3 left-3\">\r\n          <div className=\"bg-white/95 backdrop-blur px-4 py-2 rounded-xl shadow-lg\">\r\n            <p className=\"text-lg font-bold text-gray-900\">{formatPrice(property.expectedPrice || property.price)}</p>\r\n            {property.listingType === \"Rent\" && (\r\n              <p className=\"text-xs text-gray-500\">per month</p>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Interested Badge */}\r\n        <div className=\"absolute bottom-3 right-3\">\r\n          <div className=\"flex items-center gap-1.5 bg-pink-500 text-white px-3 py-1.5 rounded-full text-xs font-medium shadow-lg\">\r\n            <Heart className=\"w-3.5 h-3.5 fill-current\" />\r\n            Interested\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Content Section */}\r\n      <div className=\"p-5\">\r\n        <h3 className=\"font-bold text-gray-900 text-lg line-clamp-1 mb-2 group-hover:text-red-600 transition\">\r\n          {property.title}\r\n        </h3>\r\n\r\n        <p className=\"text-sm text-gray-500 flex items-center gap-1.5 mb-4\">\r\n          <MapPin className=\"w-4 h-4 text-red-500 flex-shrink-0\" />\r\n          <span className=\"line-clamp-1\">{getLocation() || \"Location not specified\"}</span>\r\n        </p>\r\n\r\n        {/* Property Details */}\r\n        <div className=\"flex items-center gap-4 mb-4 text-sm text-gray-600\">\r\n          {property.bhk && (\r\n            <div className=\"flex items-center gap-1\">\r\n              <Home className=\"w-4 h-4 text-gray-400\" />\r\n              <span>{property.bhk}</span>\r\n            </div>\r\n          )}\r\n          {(property.area?.builtUpSqft || property.builtUpArea) && (\r\n            <div className=\"flex items-center gap-1\">\r\n              <Building2 className=\"w-4 h-4 text-gray-400\" />\r\n              <span>{property.area?.builtUpSqft || property.builtUpArea} sq.ft</span>\r\n            </div>\r\n          )}\r\n          {property.furnishing && (\r\n            <span className=\"text-xs bg-gray-100 px-2 py-1 rounded-full\">\r\n              {property.furnishing}\r\n            </span>\r\n          )}\r\n        </div>\r\n\r\n        {/* Footer */}\r\n        <div className=\"flex items-center justify-between pt-4 border-t border-gray-100\">\r\n          <div className=\"flex items-center gap-1.5 text-xs text-gray-400\">\r\n            <Clock className=\"w-3.5 h-3.5\" />\r\n            <span>\r\n              Saved {property.interestedAt ? new Date(property.interestedAt).toLocaleDateString('en-IN', {\r\n                day: 'numeric',\r\n                month: 'short',\r\n                year: 'numeric'\r\n              }) : 'recently'}\r\n            </span>\r\n          </div>\r\n\r\n          <button\r\n            onClick={() => onViewDetails(property)}\r\n            className=\"flex items-center gap-1.5 text-red-600 hover:text-red-700 font-medium text-sm transition\"\r\n          >\r\n            View Details\r\n            <ExternalLink className=\"w-4 h-4\" />\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </motion.div>\r\n  );\r\n};\r\n\r\nexport default function SavedProperties() {\r\n  const navigate = useNavigate();\r\n  const { user, isAuthenticated, loading: authLoading } = useAuth();\r\n  const [properties, setProperties] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [refreshing, setRefreshing] = useState(false);\r\n  const [searchQuery, setSearchQuery] = useState(\"\");\r\n  const [filterType, setFilterType] = useState(\"all\"); // all, rent, sell\r\n  const [sortBy, setSortBy] = useState(\"newest\");\r\n\r\n  // Auth check & fetch saved properties\r\n  useEffect(() => {\r\n    if (!authLoading) {\r\n      if (!isAuthenticated) {\r\n        toast.error(\"Please login to view saved properties\");\r\n        navigate(\"/login\");\r\n        return;\r\n      }\r\n      fetchSavedProperties();\r\n    }\r\n  }, [authLoading, isAuthenticated, navigate]);\r\n\r\n  const fetchSavedProperties = async (isRefresh = false) => {\r\n    try {\r\n      if (isRefresh) {\r\n        setRefreshing(true);\r\n      } else {\r\n        setLoading(true);\r\n      }\r\n\r\n      const res = await api.get('/properties/saved');\r\n\r\n      if (res.data.success) {\r\n        setProperties(res.data.data || []);\r\n      }\r\n    } catch (err) {\r\n      console.error(\"Error fetching saved properties:\", err);\r\n      // 401 errors handled by interceptor\r\n      if (err.response?.status !== 404 && err.response?.status !== 401) {\r\n        toast.error(\"Failed to load saved properties\");\r\n      }\r\n    } finally {\r\n      setLoading(false);\r\n      setRefreshing(false);\r\n    }\r\n  };\r\n\r\n  const handleRemove = async (propertyId) => {\r\n    try {\r\n      await api.delete(`/properties/saved/${propertyId}`);\r\n\r\n      setProperties(prev => prev.filter(p => p._id !== propertyId));\r\n      toast.success(\"Property removed from saved\");\r\n    } catch (err) {\r\n      console.error(\"Error removing property:\", err);\r\n      toast.error(\"Failed to remove property\");\r\n    }\r\n  };\r\n\r\n  const handleViewDetails = (property) => {\r\n    navigate(`/properties/${property._id}`);\r\n  };\r\n\r\n  const handleRefresh = () => {\r\n    fetchSavedProperties(true);\r\n  };\r\n\r\n  // Filter and sort properties\r\n  const filteredProperties = properties\r\n    .filter((p) => {\r\n      if (filterType === \"all\") return true;\r\n      return (p.listingType?.toLowerCase() || \"rent\") === filterType;\r\n    })\r\n    .filter((p) => {\r\n      if (!searchQuery) return true;\r\n      const query = searchQuery.toLowerCase();\r\n      const locality = p.locality || p.address?.locality || p.address?.area || \"\";\r\n      const city = p.city || p.address?.city || \"\";\r\n      return (\r\n        p.title?.toLowerCase().includes(query) ||\r\n        locality.toLowerCase().includes(query) ||\r\n        city.toLowerCase().includes(query)\r\n      );\r\n    })\r\n    .sort((a, b) => {\r\n      switch (sortBy) {\r\n        case \"newest\":\r\n          return new Date(b.interestedAt || b.createdAt) - new Date(a.interestedAt || a.createdAt);\r\n        case \"oldest\":\r\n          return new Date(a.interestedAt || a.createdAt) - new Date(b.interestedAt || b.createdAt);\r\n        case \"price-high\":\r\n          return (b.expectedPrice || b.price || 0) - (a.expectedPrice || a.price || 0);\r\n        case \"price-low\":\r\n          return (a.expectedPrice || a.price || 0) - (b.expectedPrice || b.price || 0);\r\n        default:\r\n          return 0;\r\n      }\r\n    });\r\n\r\n  if (loading || authLoading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 pt-24 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <RefreshCw className=\"w-8 h-8 text-red-600 animate-spin mx-auto mb-4\" />\r\n          <p className=\"text-gray-600\">Loading saved properties...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50\">\r\n      {/* Header */}\r\n      <div className=\"bg-white border-b border-gray-200\">\r\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6\">\r\n          <div className=\"flex flex-col md:flex-row md:items-center md:justify-between gap-4\">\r\n            <div>\r\n              <h1 className=\"text-2xl font-bold text-gray-900 flex items-center gap-2\">\r\n                <Heart className=\"w-7 h-7 text-red-500 fill-red-500\" />\r\n                Saved Properties\r\n              </h1>\r\n              <p className=\"text-gray-500 mt-1\">\r\n                Properties you've expressed interest in ({properties.length} saved)\r\n              </p>\r\n            </div>\r\n\r\n            <div className=\"flex items-center gap-3\">\r\n              <button\r\n                onClick={handleRefresh}\r\n                disabled={refreshing}\r\n                className=\"inline-flex items-center gap-2 bg-gray-100 text-gray-700 px-4 py-2.5 rounded-xl font-medium hover:bg-gray-200 transition border border-gray-200 disabled:opacity-50\"\r\n              >\r\n                <RefreshCw className={`w-4 h-4 ${refreshing ? 'animate-spin' : ''}`} />\r\n                {refreshing ? 'Refreshing...' : 'Refresh'}\r\n              </button>\r\n              <Link\r\n                to=\"/properties\"\r\n                className=\"inline-flex items-center gap-2 bg-red-600 text-white px-5 py-2.5 rounded-xl font-semibold hover:bg-red-700 transition shadow-md\"\r\n              >\r\n                <Search className=\"w-5 h-5\" />\r\n                Browse Properties\r\n              </Link>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\r\n        {/* Filters */}\r\n        {properties.length > 0 && (\r\n          <div className=\"bg-white rounded-xl border border-gray-200 p-4 mb-6\">\r\n            <div className=\"flex flex-col md:flex-row gap-4\">\r\n              {/* Search */}\r\n              <div className=\"flex-1 relative\">\r\n                <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400\" />\r\n                <input\r\n                  type=\"text\"\r\n                  placeholder=\"Search saved properties...\"\r\n                  value={searchQuery}\r\n                  onChange={(e) => setSearchQuery(e.target.value)}\r\n                  className=\"w-full pl-10 pr-4 py-2.5 border border-gray-200 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 outline-none\"\r\n                />\r\n              </div>\r\n\r\n              {/* Filter Tabs */}\r\n              <div className=\"flex items-center gap-2 flex-wrap\">\r\n                {[\r\n                  { key: \"all\", label: \"All\" },\r\n                  { key: \"rent\", label: \"For Rent\" },\r\n                  { key: \"sell\", label: \"For Sale\" },\r\n                ].map((tab) => (\r\n                  <button\r\n                    key={tab.key}\r\n                    onClick={() => setFilterType(tab.key)}\r\n                    className={`px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap transition ${filterType === tab.key\r\n                      ? \"bg-red-600 text-white\"\r\n                      : \"bg-gray-100 text-gray-600 hover:bg-gray-200\"\r\n                      }`}\r\n                  >\r\n                    {tab.label}\r\n                  </button>\r\n                ))}\r\n              </div>\r\n\r\n              {/* Sort */}\r\n              <select\r\n                value={sortBy}\r\n                onChange={(e) => setSortBy(e.target.value)}\r\n                className=\"px-4 py-2.5 border border-gray-200 rounded-lg text-sm font-medium text-gray-700 focus:ring-2 focus:ring-red-500 outline-none\"\r\n              >\r\n                <option value=\"newest\">Recently Saved</option>\r\n                <option value=\"oldest\">Oldest First</option>\r\n                <option value=\"price-high\">Price: High to Low</option>\r\n                <option value=\"price-low\">Price: Low to High</option>\r\n              </select>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Properties Grid */}\r\n        {filteredProperties.length > 0 ? (\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n            <AnimatePresence>\r\n              {filteredProperties.map((property) => (\r\n                <PropertyCard\r\n                  key={property._id}\r\n                  property={property}\r\n                  onRemove={handleRemove}\r\n                  onViewDetails={handleViewDetails}\r\n                />\r\n              ))}\r\n            </AnimatePresence>\r\n          </div>\r\n        ) : (\r\n          <div className=\"bg-white rounded-2xl border border-gray-200 p-12 text-center\">\r\n            <div className=\"w-24 h-24 bg-red-50 rounded-full flex items-center justify-center mx-auto mb-6\">\r\n              <Heart className=\"w-12 h-12 text-red-300\" />\r\n            </div>\r\n            <h3 className=\"text-xl font-semibold text-gray-900 mb-2\">\r\n              {searchQuery || filterType !== \"all\"\r\n                ? \"No properties found\"\r\n                : \"No saved properties yet\"}\r\n            </h3>\r\n            <p className=\"text-gray-500 mb-6 max-w-md mx-auto\">\r\n              {searchQuery || filterType !== \"all\"\r\n                ? \"Try adjusting your search or filter criteria\"\r\n                : \"When you find a property you like, click 'I'm Interested' to save it here for easy access.\"}\r\n            </p>\r\n            <Link\r\n              to=\"/properties\"\r\n              className=\"inline-flex items-center gap-2 bg-red-600 text-white px-6 py-3 rounded-xl font-semibold hover:bg-red-700 transition\"\r\n            >\r\n              <Search className=\"w-5 h-5\" />\r\n              Browse Properties\r\n            </Link>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\dealdirectcurrentlive\\dealdirect\\client\\src\\Pages\\Terms&Conditions\\Terms&Conditions.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\dealdirectcurrentlive\\dealdirect\\client\\src\\Pages\\WhyUs\\WhyUs.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\dealdirectcurrentlive\\dealdirect\\client\\src\\context\\AuthContext.jsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":442,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":442,"endColumn":21}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Auth Context - Cookie-Based Session Management\r\n * \r\n * Provides authentication state management with:\r\n * - Automatic session validation on app load (fetches /api/users/me)\r\n * - Role-based access control helpers\r\n * - Graceful logout on 401 errors\r\n * - MFA and password change requirement handling\r\n * \r\n * NOTE: Uses HttpOnly cookies for authentication - no tokens in localStorage\r\n */\r\n\r\nimport React, { createContext, useContext, useState, useEffect, useCallback } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport api, { authApi, setAuthErrorHandler } from '../utils/api';\r\n\r\n// ============================================\r\n// AUTH CONTEXT\r\n// ============================================\r\n\r\nconst AuthContext = createContext(null);\r\n\r\n// ============================================\r\n// AUTH PROVIDER\r\n// ============================================\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n    // User state - populated from /api/users/me on mount\r\n    const [user, setUser] = useState(null);\r\n    const [loading, setLoading] = useState(true);\r\n    const [error, setError] = useState(null);\r\n\r\n    // Special auth states for MFA and password requirements\r\n    const [requiresMfa, setRequiresMfa] = useState(false);\r\n    const [requiresPasswordChange, setRequiresPasswordChange] = useState(false);\r\n    const [pendingAuthData, setPendingAuthData] = useState(null);\r\n\r\n    const navigate = useNavigate();\r\n\r\n    // ============================================\r\n    // CHECK AUTH STATUS ON MOUNT (Page Refresh)\r\n    // ============================================\r\n\r\n    /**\r\n     * Fetches current user profile from /api/users/me on every page load.\r\n     * HttpOnly cookies are sent automatically via withCredentials: true.\r\n     * No localStorage token management needed.\r\n     */\r\n    const checkAuth = useCallback(async () => {\r\n        try {\r\n            setLoading(true);\r\n            setError(null);\r\n\r\n            const result = await authApi.checkAuth();\r\n\r\n            if (result.authenticated && result.user) {\r\n                setUser(result.user);\r\n                // Check if user needs to change password\r\n                if (result.user.requiresPasswordChange) {\r\n                    setRequiresPasswordChange(true);\r\n                }\r\n            } else {\r\n                setUser(null);\r\n            }\r\n        } catch (err) {\r\n            console.warn('Auth check failed:', err.message);\r\n            setUser(null);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    }, []);\r\n\r\n    // Run auth check on mount (every page refresh)\r\n    useEffect(() => {\r\n        checkAuth();\r\n    }, [checkAuth]);\r\n\r\n    // ============================================\r\n    // HANDLE AUTH ERRORS (401/403)\r\n    // ============================================\r\n\r\n    useEffect(() => {\r\n        setAuthErrorHandler((errorInfo) => {\r\n            if (errorInfo.type === 'UNAUTHORIZED') {\r\n                // Session expired - clear state and redirect\r\n                setUser(null);\r\n                setRequiresMfa(false);\r\n                setRequiresPasswordChange(false);\r\n                setPendingAuthData(null);\r\n\r\n                // Redirect to login with message\r\n                navigate('/login', {\r\n                    state: {\r\n                        message: errorInfo.message,\r\n                        from: window.location.pathname,\r\n                    },\r\n                    replace: true\r\n                });\r\n            } else if (errorInfo.type === 'FORBIDDEN') {\r\n                // User doesn't have permission\r\n                setError(errorInfo.message);\r\n            }\r\n        });\r\n\r\n        return () => {\r\n            setAuthErrorHandler(null);\r\n        };\r\n    }, [navigate]);\r\n\r\n    // ============================================\r\n    // AUTH ACTIONS\r\n    // ============================================\r\n\r\n    /**\r\n     * Login handler with MFA and password change requirement support.\r\n     * No localStorage token storage - uses HttpOnly cookies.\r\n     */\r\n    const login = async (email, password) => {\r\n        try {\r\n            setLoading(true);\r\n            setError(null);\r\n            setRequiresMfa(false);\r\n            setRequiresPasswordChange(false);\r\n\r\n            const response = await authApi.login(email, password);\r\n\r\n            // Handle MFA requirement\r\n            if (response.requiresMfa || response.code === 'REQUIRES_MFA') {\r\n                setRequiresMfa(true);\r\n                setPendingAuthData({ email, mfaToken: response.mfaToken });\r\n                return {\r\n                    success: false,\r\n                    requiresMfa: true,\r\n                    message: response.message || 'Please complete MFA verification'\r\n                };\r\n            }\r\n\r\n            // Handle password change requirement\r\n            if (response.passwordChangeRequired || response.code === 'PASSWORD_CHANGE_REQUIRED') {\r\n                setRequiresPasswordChange(true);\r\n                setPendingAuthData({ email, tempToken: response.tempToken });\r\n                return {\r\n                    success: false,\r\n                    passwordChangeRequired: true,\r\n                    message: response.message || 'You must change your password before continuing'\r\n                };\r\n            }\r\n\r\n            if (response.success && response.user) {\r\n                setUser(response.user);\r\n                return { success: true, user: response.user };\r\n            }\r\n\r\n            return { success: false, message: response.message || 'Login failed' };\r\n        } catch (err) {\r\n            const errorData = err.response?.data;\r\n\r\n            // Handle MFA requirement from error response\r\n            if (errorData?.requiresMfa || errorData?.code === 'REQUIRES_MFA') {\r\n                setRequiresMfa(true);\r\n                setPendingAuthData({ email, mfaToken: errorData.mfaToken });\r\n                return {\r\n                    success: false,\r\n                    requiresMfa: true,\r\n                    message: errorData.message || 'Please complete MFA verification'\r\n                };\r\n            }\r\n\r\n            // Handle password change requirement from error response\r\n            if (errorData?.passwordChangeRequired || errorData?.code === 'PASSWORD_CHANGE_REQUIRED') {\r\n                setRequiresPasswordChange(true);\r\n                setPendingAuthData({ email, tempToken: errorData.tempToken });\r\n                return {\r\n                    success: false,\r\n                    passwordChangeRequired: true,\r\n                    message: errorData.message || 'You must change your password before continuing'\r\n                };\r\n            }\r\n\r\n            const message = errorData?.message || 'Login failed. Please try again.';\r\n            setError(message);\r\n            return { success: false, message, errorData };\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Verify MFA code after login\r\n     */\r\n    const verifyMfa = async (code) => {\r\n        try {\r\n            setLoading(true);\r\n            setError(null);\r\n\r\n            const response = await api.post('/users/verify-mfa', {\r\n                email: pendingAuthData?.email,\r\n                code,\r\n                mfaToken: pendingAuthData?.mfaToken\r\n            });\r\n\r\n            if (response.data.success && response.data.user) {\r\n                setUser(response.data.user);\r\n                setRequiresMfa(false);\r\n                setPendingAuthData(null);\r\n                return { success: true, user: response.data.user };\r\n            }\r\n\r\n            return { success: false, message: response.data.message || 'MFA verification failed' };\r\n        } catch (err) {\r\n            const message = err.response?.data?.message || 'MFA verification failed. Please try again.';\r\n            setError(message);\r\n            return { success: false, message };\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Change password when required before login\r\n     */\r\n    const changePasswordOnLogin = async (newPassword) => {\r\n        try {\r\n            setLoading(true);\r\n            setError(null);\r\n\r\n            const response = await api.post('/users/change-password-required', {\r\n                email: pendingAuthData?.email,\r\n                newPassword,\r\n                tempToken: pendingAuthData?.tempToken\r\n            });\r\n\r\n            if (response.data.success && response.data.user) {\r\n                setUser(response.data.user);\r\n                setRequiresPasswordChange(false);\r\n                setPendingAuthData(null);\r\n                return { success: true, user: response.data.user };\r\n            }\r\n\r\n            return { success: false, message: response.data.message || 'Password change failed' };\r\n        } catch (err) {\r\n            const message = err.response?.data?.message || 'Password change failed. Please try again.';\r\n            setError(message);\r\n            return { success: false, message };\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Cancel MFA or password change flow\r\n     */\r\n    const cancelPendingAuth = () => {\r\n        setRequiresMfa(false);\r\n        setRequiresPasswordChange(false);\r\n        setPendingAuthData(null);\r\n    };\r\n\r\n    /**\r\n     * Register handler - no localStorage token storage.\r\n     */\r\n    const register = async (userData) => {\r\n        try {\r\n            setLoading(true);\r\n            setError(null);\r\n\r\n            const response = await authApi.register(userData);\r\n\r\n            // Handle MFA requirement for registration\r\n            if (response.requiresMfa || response.code === 'REQUIRES_MFA') {\r\n                setRequiresMfa(true);\r\n                setPendingAuthData({ email: userData.email, mfaToken: response.mfaToken });\r\n                return {\r\n                    success: false,\r\n                    requiresMfa: true,\r\n                    message: response.message || 'Please complete MFA verification'\r\n                };\r\n            }\r\n\r\n            // Handle password change requirement for registration\r\n            if (response.passwordChangeRequired || response.code === 'PASSWORD_CHANGE_REQUIRED') {\r\n                setRequiresPasswordChange(true);\r\n                setPendingAuthData({ email: userData.email, tempToken: response.tempToken });\r\n                return {\r\n                    success: false,\r\n                    passwordChangeRequired: true,\r\n                    message: response.message || 'You must set a new password'\r\n                };\r\n            }\r\n\r\n            if (response.success) {\r\n                // Registration successful - may need OTP verification\r\n                return { success: true, ...response };\r\n            }\r\n\r\n            return { success: false, message: response.message || 'Registration failed' };\r\n        } catch (err) {\r\n            const errorData = err.response?.data;\r\n\r\n            // Handle MFA requirement from error response\r\n            if (errorData?.requiresMfa || errorData?.code === 'REQUIRES_MFA') {\r\n                setRequiresMfa(true);\r\n                setPendingAuthData({ email: userData.email, mfaToken: errorData.mfaToken });\r\n                return {\r\n                    success: false,\r\n                    requiresMfa: true,\r\n                    message: errorData.message || 'Please complete MFA verification'\r\n                };\r\n            }\r\n\r\n            // Handle password change requirement from error response\r\n            if (errorData?.passwordChangeRequired || errorData?.code === 'PASSWORD_CHANGE_REQUIRED') {\r\n                setRequiresPasswordChange(true);\r\n                setPendingAuthData({ email: userData.email, tempToken: errorData.tempToken });\r\n                return {\r\n                    success: false,\r\n                    passwordChangeRequired: true,\r\n                    message: errorData.message || 'You must set a new password'\r\n                };\r\n            }\r\n\r\n            const message = errorData?.message || 'Registration failed. Please try again.';\r\n            setError(message);\r\n            return { success: false, message, errorData };\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Logout handler - clears session on server.\r\n     * No localStorage cleanup needed for tokens - only user cache.\r\n     */\r\n    const logout = async () => {\r\n        try {\r\n            setLoading(true);\r\n            await authApi.logout();\r\n        } catch (err) {\r\n            console.warn('Logout error:', err.message);\r\n        } finally {\r\n            // Always clear local state regardless of server response\r\n            setUser(null);\r\n            setRequiresMfa(false);\r\n            setRequiresPasswordChange(false);\r\n            setPendingAuthData(null);\r\n            setLoading(false);\r\n            navigate('/login', { replace: true });\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Update user state - for profile updates etc.\r\n     * No localStorage storage needed.\r\n     */\r\n    const updateUser = (updatedUser) => {\r\n        setUser(updatedUser);\r\n    };\r\n\r\n    // ============================================\r\n    // ROLE HELPERS\r\n    // ============================================\r\n\r\n    const isAuthenticated = !!user;\r\n\r\n    const isOwner = user?.role === 'owner';\r\n\r\n    // 'user' and 'buyer' are equivalent roles (buyers/property seekers)\r\n    const isBuyer = user?.role === 'user' || user?.role === 'buyer';\r\n\r\n    const isVerified = user?.isVerified === true;\r\n\r\n    const hasRole = (role) => {\r\n        if (!user) return false;\r\n        if (Array.isArray(role)) {\r\n            // Handle 'buyer' and 'user' as equivalent\r\n            const normalizedRoles = role.map(r => r === 'buyer' ? 'user' : r);\r\n            const userRole = user.role === 'buyer' ? 'user' : user.role;\r\n            return normalizedRoles.includes(userRole) || role.includes(user.role);\r\n        }\r\n        // Handle 'buyer' and 'user' as equivalent\r\n        if (role === 'buyer' || role === 'user') {\r\n            return user.role === 'buyer' || user.role === 'user';\r\n        }\r\n        return user.role === role;\r\n    };\r\n\r\n    const canAccessOwnerFeatures = isAuthenticated && (isOwner || user?.role === 'owner');\r\n\r\n    const canAddProperty = isAuthenticated && isOwner && isVerified;\r\n\r\n    // ============================================\r\n    // CONTEXT VALUE\r\n    // ============================================\r\n\r\n    const value = {\r\n        // State\r\n        user,\r\n        loading,\r\n        error,\r\n\r\n        // Special auth states\r\n        requiresMfa,\r\n        requiresPasswordChange,\r\n        pendingAuthData,\r\n\r\n        // Auth status\r\n        isAuthenticated,\r\n        isOwner,\r\n        isBuyer,\r\n        isVerified,\r\n\r\n        // Role helpers\r\n        hasRole,\r\n        canAccessOwnerFeatures,\r\n        canAddProperty,\r\n\r\n        // Actions\r\n        login,\r\n        register,\r\n        logout,\r\n        checkAuth,\r\n        updateUser,\r\n        clearError: () => setError(null),\r\n\r\n        // MFA & Password change handlers\r\n        verifyMfa,\r\n        changePasswordOnLogin,\r\n        cancelPendingAuth,\r\n    };\r\n\r\n    return (\r\n        <AuthContext.Provider value={value}>\r\n            {children}\r\n        </AuthContext.Provider>\r\n    );\r\n};\r\n\r\n// ============================================\r\n// AUTH HOOK\r\n// ============================================\r\n\r\nexport const useAuth = () => {\r\n    const context = useContext(AuthContext);\r\n    if (!context) {\r\n        throw new Error('useAuth must be used within an AuthProvider');\r\n    }\r\n    return context;\r\n};\r\n\r\n// ============================================\r\n// PROTECTED ROUTE COMPONENT\r\n// ============================================\r\n\r\nexport const ProtectedRoute = ({ children, requiredRole = null, requireVerified = false }) => {\r\n    const { isAuthenticated, loading, hasRole, isVerified, requiresMfa, requiresPasswordChange } = useAuth();\r\n    const navigate = useNavigate();\r\n\r\n    useEffect(() => {\r\n        if (!loading) {\r\n            // Handle MFA requirement\r\n            if (requiresMfa) {\r\n                navigate('/verify-mfa', { replace: true });\r\n                return;\r\n            }\r\n\r\n            // Handle password change requirement\r\n            if (requiresPasswordChange) {\r\n                navigate('/change-password-required', { replace: true });\r\n                return;\r\n            }\r\n\r\n            if (!isAuthenticated) {\r\n                navigate('/login', {\r\n                    state: { from: window.location.pathname },\r\n                    replace: true\r\n                });\r\n            } else if (requiredRole && !hasRole(requiredRole)) {\r\n                navigate('/', { replace: true });\r\n            } else if (requireVerified && !isVerified) {\r\n                navigate('/verify-email', { replace: true });\r\n            }\r\n        }\r\n    }, [loading, isAuthenticated, hasRole, isVerified, requiredRole, requireVerified, requiresMfa, requiresPasswordChange, navigate]);\r\n\r\n    if (loading) {\r\n        return (\r\n            <div className=\"flex items-center justify-center min-h-screen\">\r\n                <div className=\"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-red-600\"></div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (!isAuthenticated || requiresMfa || requiresPasswordChange) {\r\n        return null;\r\n    }\r\n\r\n    if (requiredRole && !hasRole(requiredRole)) {\r\n        return null;\r\n    }\r\n\r\n    if (requireVerified && !isVerified) {\r\n        return null;\r\n    }\r\n\r\n    return children;\r\n};\r\n\r\nexport default AuthContext;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\dealdirectcurrentlive\\dealdirect\\client\\src\\context\\ChatContext.jsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":10,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":10,"endColumn":21},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'fetchConversations', 'socket', and 'user'. Either include them or remove the dependency array.","line":85,"column":6,"nodeType":"ArrayExpression","endLine":85,"endColumn":34,"suggestions":[{"desc":"Update the dependencies array to be: [fetchConversations, isAuthenticated, socket, user, user._id]","fix":{"range":[2428,2456],"text":"[fetchConversations, isAuthenticated, socket, user, user._id]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { createContext, useContext, useState, useEffect, useCallback } from \"react\";\r\nimport { io } from \"socket.io-client\";\r\nimport api from \"../utils/api\";\r\nimport { useAuth } from \"./AuthContext\";\r\n\r\nconst API_BASE = import.meta.env.VITE_API_BASE;\r\n\r\nconst ChatContext = createContext();\r\n\r\nexport const useChat = () => {\r\n  const context = useContext(ChatContext);\r\n  if (!context) {\r\n    throw new Error(\"useChat must be used within a ChatProvider\");\r\n  }\r\n  return context;\r\n};\r\n\r\nexport const ChatProvider = ({ children }) => {\r\n  const [socket, setSocket] = useState(null);\r\n  const [conversations, setConversations] = useState([]);\r\n  const [currentConversation, setCurrentConversation] = useState(null);\r\n  const [messages, setMessages] = useState([]);\r\n  const [unreadCount, setUnreadCount] = useState(0);\r\n  const [onlineUsers, setOnlineUsers] = useState([]);\r\n  const [isTyping, setIsTyping] = useState(null);\r\n  const [loading, setLoading] = useState(false);\r\n  const [isChatOpen, setIsChatOpen] = useState(false);\r\n\r\n  // Use AuthContext for authentication state\r\n  const { user, isAuthenticated } = useAuth();\r\n\r\n  // Initialize socket connection\r\n  useEffect(() => {\r\n    if (!isAuthenticated || !user) {\r\n      if (socket) {\r\n        socket.disconnect();\r\n        setSocket(null);\r\n        setConversations([]);\r\n        setMessages([]);\r\n        setUnreadCount(0);\r\n      }\r\n      return;\r\n    }\r\n\r\n    // If socket already exists, disconnect before creating new one\r\n    if (socket) {\r\n      socket.disconnect();\r\n    }\r\n\r\n    const newSocket = io(API_BASE, {\r\n      transports: [\"websocket\", \"polling\"],\r\n      withCredentials: true, // Important for cookie auth\r\n    });\r\n\r\n    newSocket.on(\"connect\", () => {\r\n      console.log(\"Socket connected\");\r\n      if (user._id) {\r\n        newSocket.emit(\"user_online\", user._id);\r\n      }\r\n    });\r\n\r\n    newSocket.on(\"users_online\", (users) => {\r\n      setOnlineUsers(users);\r\n    });\r\n\r\n    newSocket.on(\"receive_message\", (message) => {\r\n      setMessages((prev) => [...prev, message]);\r\n      // Update conversation list\r\n      fetchConversations();\r\n    });\r\n\r\n    newSocket.on(\"user_typing\", ({ userId, userName }) => {\r\n      setIsTyping({ userId, userName });\r\n    });\r\n\r\n    newSocket.on(\"user_stop_typing\", () => {\r\n      setIsTyping(null);\r\n    });\r\n\r\n    setSocket(newSocket);\r\n\r\n    return () => {\r\n      newSocket.disconnect();\r\n    };\r\n  }, [isAuthenticated, user?._id]);\r\n\r\n  // Fetch conversations - uses cookie-based auth via api.js\r\n  const fetchConversations = useCallback(async () => {\r\n    if (!isAuthenticated) return;\r\n\r\n    try {\r\n      const res = await api.get('/chat/conversations');\r\n      if (res.data.success) {\r\n        setConversations(res.data.conversations);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error fetching conversations:\", error);\r\n    }\r\n  }, [isAuthenticated]);\r\n\r\n  // Fetch unread count\r\n  const fetchUnreadCount = useCallback(async () => {\r\n    if (!isAuthenticated) return;\r\n\r\n    try {\r\n      const res = await api.get('/chat/unread-count');\r\n      if (res.data.success) {\r\n        setUnreadCount(res.data.unreadCount);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error fetching unread count:\", error);\r\n    }\r\n  }, [isAuthenticated]);\r\n\r\n  // Fetch messages for a conversation\r\n  const fetchMessages = useCallback(async (conversationId) => {\r\n    if (!isAuthenticated) return;\r\n\r\n    setLoading(true);\r\n    try {\r\n      const res = await api.get(`/chat/messages/${conversationId}`);\r\n      if (res.data.success) {\r\n        setMessages(res.data.messages);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error fetching messages:\", error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [isAuthenticated]);\r\n\r\n  // Start or get conversation\r\n  const startConversation = useCallback(async (propertyId, ownerId) => {\r\n    if (!isAuthenticated) return null;\r\n\r\n    try {\r\n      const res = await api.post('/chat/conversation/start', { propertyId, ownerId });\r\n      if (res.data.success) {\r\n        fetchConversations();\r\n        return res.data.conversation;\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error starting conversation:\", error);\r\n      return null;\r\n    }\r\n  }, [fetchConversations, isAuthenticated]);\r\n\r\n  // Send a standard text message\r\n  const sendMessage = useCallback(async (conversationId, text) => {\r\n    if (!isAuthenticated) return null;\r\n\r\n    try {\r\n      const res = await api.post('/chat/message/send', { conversationId, text });\r\n      if (res.data.success) {\r\n        const newMessage = res.data.message;\r\n        setMessages((prev) => [...prev, newMessage]);\r\n\r\n        // Emit to socket\r\n        if (socket) {\r\n          socket.emit(\"send_message\", { conversationId, message: newMessage });\r\n        }\r\n\r\n        fetchConversations();\r\n        return newMessage;\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error sending message:\", error);\r\n      return null;\r\n    }\r\n  }, [socket, fetchConversations, isAuthenticated]);\r\n\r\n  // Send a special visit-related message (request or confirmation)\r\n  const sendVisitMessage = useCallback(\r\n    async (conversationId, text, messageType) => {\r\n      if (!isAuthenticated) return null;\r\n\r\n      try {\r\n        const res = await api.post('/chat/message/send', { conversationId, text, messageType });\r\n        if (res.data.success) {\r\n          const newMessage = res.data.message;\r\n          setMessages((prev) => [...prev, newMessage]);\r\n\r\n          if (socket) {\r\n            socket.emit(\"send_message\", { conversationId, message: newMessage });\r\n          }\r\n\r\n          fetchConversations();\r\n          return newMessage;\r\n        }\r\n      } catch (error) {\r\n        console.error(\"Error sending visit message:\", error);\r\n        return null;\r\n      }\r\n    },\r\n    [socket, fetchConversations, isAuthenticated]\r\n  );\r\n\r\n  // Join conversation room\r\n  const joinConversation = useCallback((conversationId) => {\r\n    if (socket) {\r\n      socket.emit(\"join_conversation\", conversationId);\r\n    }\r\n  }, [socket]);\r\n\r\n  // Leave conversation room\r\n  const leaveConversation = useCallback((conversationId) => {\r\n    if (socket) {\r\n      socket.emit(\"leave_conversation\", conversationId);\r\n    }\r\n  }, [socket]);\r\n\r\n  // Emit typing\r\n  const emitTyping = useCallback((conversationId) => {\r\n    if (socket && user) {\r\n      socket.emit(\"typing\", { conversationId, userId: user._id, userName: user.name });\r\n    }\r\n  }, [socket, user]);\r\n\r\n  // Emit stop typing\r\n  const emitStopTyping = useCallback((conversationId) => {\r\n    if (socket && user) {\r\n      socket.emit(\"stop_typing\", { conversationId, userId: user._id });\r\n    }\r\n  }, [socket, user]);\r\n\r\n  // Report message\r\n  const reportMessage = useCallback(async (messageId, reason) => {\r\n    if (!isAuthenticated) return null;\r\n\r\n    try {\r\n      const res = await api.post('/chat/message/report', { messageId, reason });\r\n      return res.data;\r\n    } catch (error) {\r\n      console.error(\"Error reporting message:\", error);\r\n      return { success: false, message: error.response?.data?.message || \"Failed to report\" };\r\n    }\r\n  }, [isAuthenticated]);\r\n\r\n  // Open chat with a conversation\r\n  const openChat = useCallback((conversation = null) => {\r\n    setCurrentConversation(conversation);\r\n    setIsChatOpen(true);\r\n    if (conversation) {\r\n      fetchMessages(conversation._id);\r\n      joinConversation(conversation._id);\r\n    }\r\n  }, [fetchMessages, joinConversation]);\r\n\r\n  // Close chat\r\n  const closeChat = useCallback(() => {\r\n    if (currentConversation) {\r\n      leaveConversation(currentConversation._id);\r\n    }\r\n    setIsChatOpen(false);\r\n    setCurrentConversation(null);\r\n    setMessages([]);\r\n  }, [currentConversation, leaveConversation]);\r\n\r\n  // Check if user is online\r\n  const isUserOnline = useCallback((userId) => {\r\n    return onlineUsers.includes(userId);\r\n  }, [onlineUsers]);\r\n\r\n  // Initial fetch\r\n  useEffect(() => {\r\n    if (isAuthenticated) {\r\n      fetchConversations();\r\n      fetchUnreadCount();\r\n    } else {\r\n      setConversations([]);\r\n      setUnreadCount(0);\r\n    }\r\n  }, [fetchConversations, fetchUnreadCount, isAuthenticated]);\r\n\r\n  // Poll for unread count\r\n  useEffect(() => {\r\n    if (!isAuthenticated) return;\r\n\r\n    const interval = setInterval(() => {\r\n      fetchUnreadCount();\r\n    }, 30000); // Every 30 seconds\r\n\r\n    return () => clearInterval(interval);\r\n  }, [fetchUnreadCount, isAuthenticated]);\r\n\r\n  const value = {\r\n    socket,\r\n    conversations,\r\n    currentConversation,\r\n    messages,\r\n    unreadCount,\r\n    onlineUsers,\r\n    isTyping,\r\n    loading,\r\n    isChatOpen,\r\n    fetchConversations,\r\n    fetchUnreadCount,\r\n    fetchMessages,\r\n    startConversation,\r\n    sendMessage,\r\n    sendVisitMessage,\r\n    joinConversation,\r\n    leaveConversation,\r\n    emitTyping,\r\n    emitStopTyping,\r\n    reportMessage,\r\n    openChat,\r\n    closeChat,\r\n    isUserOnline,\r\n    setCurrentConversation,\r\n  };\r\n\r\n  return <ChatContext.Provider value={value}>{children}</ChatContext.Provider>;\r\n};\r\n\r\nexport default ChatContext;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\dealdirectcurrentlive\\dealdirect\\client\\src\\main.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\dealdirectcurrentlive\\dealdirect\\client\\src\\utils\\api.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\dealdirectcurrentlive\\dealdirect\\client\\vite.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]
